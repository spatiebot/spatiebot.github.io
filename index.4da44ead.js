function t(t){return t&&t.__esModule?t.default:t}var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},s={},n={},i=e.parcelRequire94c2;null==i&&((i=function(t){if(t in s)return s[t].exports;if(t in n){var e=n[t];delete n[t];var i={id:t,exports:{}};return s[t]=i,e.call(i.exports,i,i.exports),i.exports}var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(t,e){n[t]=e},e.parcelRequire94c2=i),i.register("7we3r",(function(t,e){var s=i("gKvUL"),n=i("jJbMR"),o=i("ewFRw"),a=i("lk5EI");var r=function t(e){var i=new o(e),r=n(o.prototype.request,i);return s.extend(r,o.prototype,i),s.extend(r,i),r.create=function(s){return t(a(e,s))},r}(i("lJY4v"));r.Axios=o,r.Cancel=i("4Tkeq"),r.CancelToken=i("lAKPy"),r.isCancel=i("7L4QX"),r.VERSION=i("35BUy").version,r.all=function(t){return Promise.all(t)},r.spread=i("JEeti"),r.isAxiosError=i("dxy9O"),t.exports=r,t.exports.default=r})),i.register("gKvUL",(function(t,e){var s=i("jJbMR"),n=Object.prototype.toString;function o(t){return Array.isArray(t)}function a(t){return void 0===t}function r(t){return"[object ArrayBuffer]"===n.call(t)}function c(t){return null!==t&&"object"==typeof t}function l(t){if("[object Object]"!==n.call(t))return!1;var e=Object.getPrototypeOf(t);return null===e||e===Object.prototype}function h(t){return"[object Function]"===n.call(t)}function u(t,e){if(null!=t)if("object"!=typeof t&&(t=[t]),o(t))for(var s=0,n=t.length;s<n;s++)e.call(null,t[s],s,t);else for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.call(null,t[i],i,t)}t.exports={isArray:o,isArrayBuffer:r,isBuffer:function(t){return null!==t&&!a(t)&&null!==t.constructor&&!a(t.constructor)&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)},isFormData:function(t){return"[object FormData]"===n.call(t)},isArrayBufferView:function(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&r(t.buffer)},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isObject:c,isPlainObject:l,isUndefined:a,isDate:function(t){return"[object Date]"===n.call(t)},isFile:function(t){return"[object File]"===n.call(t)},isBlob:function(t){return"[object Blob]"===n.call(t)},isFunction:h,isStream:function(t){return c(t)&&h(t.pipe)},isURLSearchParams:function(t){return"[object URLSearchParams]"===n.call(t)},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:u,merge:function t(){var e={};function s(s,n){l(e[n])&&l(s)?e[n]=t(e[n],s):l(s)?e[n]=t({},s):o(s)?e[n]=s.slice():e[n]=s}for(var n=0,i=arguments.length;n<i;n++)u(arguments[n],s);return e},extend:function(t,e,n){return u(e,(function(e,i){t[i]=n&&"function"==typeof e?s(e,n):e})),t},trim:function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},stripBOM:function(t){return 65279===t.charCodeAt(0)&&(t=t.slice(1)),t}}})),i.register("jJbMR",(function(t,e){t.exports=function(t,e){return function(){for(var s=new Array(arguments.length),n=0;n<s.length;n++)s[n]=arguments[n];return t.apply(e,s)}}})),i.register("ewFRw",(function(t,e){var s=i("gKvUL"),n=i("cbIsf"),o=i("83RYu"),a=i("dlZEJ"),r=i("lk5EI"),c=i("bv3QM"),l=c.validators;function h(t){this.defaults=t,this.interceptors={request:new o,response:new o}}h.prototype.request=function(t,e){if("string"==typeof t?(e=e||{}).url=t:e=t||{},!e.url)throw new Error("Provided config url is not valid");(e=r(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var s=e.transitional;void 0!==s&&c.assertOptions(s,{silentJSONParsing:l.transitional(l.boolean),forcedJSONParsing:l.transitional(l.boolean),clarifyTimeoutError:l.transitional(l.boolean)},!1);var n=[],i=!0;this.interceptors.request.forEach((function(t){"function"==typeof t.runWhen&&!1===t.runWhen(e)||(i=i&&t.synchronous,n.unshift(t.fulfilled,t.rejected))}));var o,h=[];if(this.interceptors.response.forEach((function(t){h.push(t.fulfilled,t.rejected)})),!i){var u=[a,void 0];for(Array.prototype.unshift.apply(u,n),u=u.concat(h),o=Promise.resolve(e);u.length;)o=o.then(u.shift(),u.shift());return o}for(var d=e;n.length;){var g=n.shift(),p=n.shift();try{d=g(d)}catch(t){p(t);break}}try{o=a(d)}catch(t){return Promise.reject(t)}for(;h.length;)o=o.then(h.shift(),h.shift());return o},h.prototype.getUri=function(t){if(!t.url)throw new Error("Provided config url is not valid");return t=r(this.defaults,t),n(t.url,t.params,t.paramsSerializer).replace(/^\?/,"")},s.forEach(["delete","get","head","options"],(function(t){h.prototype[t]=function(e,s){return this.request(r(s||{},{method:t,url:e,data:(s||{}).data}))}})),s.forEach(["post","put","patch"],(function(t){h.prototype[t]=function(e,s,n){return this.request(r(n||{},{method:t,url:e,data:s}))}})),t.exports=h})),i.register("cbIsf",(function(t,e){var s=i("gKvUL");function n(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}t.exports=function(t,e,i){if(!e)return t;var o;if(i)o=i(e);else if(s.isURLSearchParams(e))o=e.toString();else{var a=[];s.forEach(e,(function(t,e){null!=t&&(s.isArray(t)?e+="[]":t=[t],s.forEach(t,(function(t){s.isDate(t)?t=t.toISOString():s.isObject(t)&&(t=JSON.stringify(t)),a.push(n(e)+"="+n(t))})))})),o=a.join("&")}if(o){var r=t.indexOf("#");-1!==r&&(t=t.slice(0,r)),t+=(-1===t.indexOf("?")?"?":"&")+o}return t}})),i.register("83RYu",(function(t,e){var s=i("gKvUL");function n(){this.handlers=[]}n.prototype.use=function(t,e,s){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1},n.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},n.prototype.forEach=function(t){s.forEach(this.handlers,(function(e){null!==e&&t(e)}))},t.exports=n})),i.register("dlZEJ",(function(t,e){var s=i("gKvUL"),n=i("7YJ0v"),o=i("7L4QX"),a=i("lJY4v"),r=i("4Tkeq");function c(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new r("canceled")}t.exports=function(t){return c(t),t.headers=t.headers||{},t.data=n.call(t,t.data,t.headers,t.transformRequest),t.headers=s.merge(t.headers.common||{},t.headers[t.method]||{},t.headers),s.forEach(["delete","get","head","post","put","patch","common"],(function(e){delete t.headers[e]})),(t.adapter||a.adapter)(t).then((function(e){return c(t),e.data=n.call(t,e.data,e.headers,t.transformResponse),e}),(function(e){return o(e)||(c(t),e&&e.response&&(e.response.data=n.call(t,e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)}))}})),i.register("7YJ0v",(function(t,e){var s=i("gKvUL"),n=i("lJY4v");t.exports=function(t,e,i){var o=this||n;return s.forEach(i,(function(s){t=s.call(o,t,e)})),t}})),i.register("lJY4v",(function(t,e){var s=i("hPtJY"),n=i("gKvUL"),o=i("kiL6T"),a=i("8v8A7"),r={"Content-Type":"application/x-www-form-urlencoded"};function c(t,e){!n.isUndefined(t)&&n.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}var l,h={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:(("undefined"!=typeof XMLHttpRequest||void 0!==s&&"[object process]"===Object.prototype.toString.call(s))&&(l=i("at5cb")),l),transformRequest:[function(t,e){return o(e,"Accept"),o(e,"Content-Type"),n.isFormData(t)||n.isArrayBuffer(t)||n.isBuffer(t)||n.isStream(t)||n.isFile(t)||n.isBlob(t)?t:n.isArrayBufferView(t)?t.buffer:n.isURLSearchParams(t)?(c(e,"application/x-www-form-urlencoded;charset=utf-8"),t.toString()):n.isObject(t)||e&&"application/json"===e["Content-Type"]?(c(e,"application/json"),function(t,e,s){if(n.isString(t))try{return(e||JSON.parse)(t),n.trim(t)}catch(t){if("SyntaxError"!==t.name)throw t}return(s||JSON.stringify)(t)}(t)):t}],transformResponse:[function(t){var e=this.transitional||h.transitional,s=e&&e.silentJSONParsing,i=e&&e.forcedJSONParsing,o=!s&&"json"===this.responseType;if(o||i&&n.isString(t)&&t.length)try{return JSON.parse(t)}catch(t){if(o){if("SyntaxError"===t.name)throw a(t,this,"E_JSON_PARSE");throw t}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};n.forEach(["delete","get","head"],(function(t){h.headers[t]={}})),n.forEach(["post","put","patch"],(function(t){h.headers[t]=n.merge(r)})),t.exports=h})),i.register("hPtJY",(function(t,e){var s,n,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function r(t){if(s===setTimeout)return setTimeout(t,0);if((s===o||!s)&&setTimeout)return s=setTimeout,setTimeout(t,0);try{return s(t,0)}catch(e){try{return s.call(null,t,0)}catch(e){return s.call(this,t,0)}}}!function(){try{s="function"==typeof setTimeout?setTimeout:o}catch(t){s=o}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(t){n=a}}();var c,l=[],h=!1,u=-1;function d(){h&&c&&(h=!1,c.length?l=c.concat(l):u=-1,l.length&&g())}function g(){if(!h){var t=r(d);h=!0;for(var e=l.length;e;){for(c=l,l=[];++u<e;)c&&c[u].run();u=-1,e=l.length}c=null,h=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function E(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var s=1;s<arguments.length;s++)e[s-1]=arguments[s];l.push(new p(t,e)),1!==l.length||h||r(g)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=E,i.addListener=E,i.once=E,i.off=E,i.removeListener=E,i.removeAllListeners=E,i.emit=E,i.prependListener=E,i.prependOnceListener=E,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}})),i.register("kiL6T",(function(t,e){var s=i("gKvUL");t.exports=function(t,e){s.forEach(t,(function(s,n){n!==e&&n.toUpperCase()===e.toUpperCase()&&(t[e]=s,delete t[n])}))}})),i.register("8v8A7",(function(t,e){t.exports=function(t,e,s,n,i){return t.config=e,s&&(t.code=s),t.request=n,t.response=i,t.isAxiosError=!0,t.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},t}})),i.register("at5cb",(function(t,e){var s=i("gKvUL"),n=i("kk0E9"),o=i("8JRzs"),a=i("cbIsf"),r=i("7GD7a"),c=i("lDriZ"),l=i("889er"),h=i("kjF3e"),u=i("lJY4v"),d=i("4Tkeq");t.exports=function(t){return new Promise((function(e,i){var g,p=t.data,E=t.headers,y=t.responseType;function f(){t.cancelToken&&t.cancelToken.unsubscribe(g),t.signal&&t.signal.removeEventListener("abort",g)}s.isFormData(p)&&delete E["Content-Type"];var m=new XMLHttpRequest;if(t.auth){var A=t.auth.username||"",U=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";E.Authorization="Basic "+btoa(A+":"+U)}var R=r(t.baseURL,t.url);function w(){if(m){var s="getAllResponseHeaders"in m?c(m.getAllResponseHeaders()):null,o={data:y&&"text"!==y&&"json"!==y?m.response:m.responseText,status:m.status,statusText:m.statusText,headers:s,config:t,request:m};n((function(t){e(t),f()}),(function(t){i(t),f()}),o),m=null}}if(m.open(t.method.toUpperCase(),a(R,t.params,t.paramsSerializer),!0),m.timeout=t.timeout,"onloadend"in m?m.onloadend=w:m.onreadystatechange=function(){m&&4===m.readyState&&(0!==m.status||m.responseURL&&0===m.responseURL.indexOf("file:"))&&setTimeout(w)},m.onabort=function(){m&&(i(h("Request aborted",t,"ECONNABORTED",m)),m=null)},m.onerror=function(){i(h("Network Error",t,null,m)),m=null},m.ontimeout=function(){var e=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded",s=t.transitional||u.transitional;t.timeoutErrorMessage&&(e=t.timeoutErrorMessage),i(h(e,t,s.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",m)),m=null},s.isStandardBrowserEnv()){var T=(t.withCredentials||l(R))&&t.xsrfCookieName?o.read(t.xsrfCookieName):void 0;T&&(E[t.xsrfHeaderName]=T)}"setRequestHeader"in m&&s.forEach(E,(function(t,e){void 0===p&&"content-type"===e.toLowerCase()?delete E[e]:m.setRequestHeader(e,t)})),s.isUndefined(t.withCredentials)||(m.withCredentials=!!t.withCredentials),y&&"json"!==y&&(m.responseType=t.responseType),"function"==typeof t.onDownloadProgress&&m.addEventListener("progress",t.onDownloadProgress),"function"==typeof t.onUploadProgress&&m.upload&&m.upload.addEventListener("progress",t.onUploadProgress),(t.cancelToken||t.signal)&&(g=function(t){m&&(i(!t||t&&t.type?new d("canceled"):t),m.abort(),m=null)},t.cancelToken&&t.cancelToken.subscribe(g),t.signal&&(t.signal.aborted?g():t.signal.addEventListener("abort",g))),p||(p=null),m.send(p)}))}})),i.register("kk0E9",(function(t,e){var s=i("kjF3e");t.exports=function(t,e,n){var i=n.config.validateStatus;n.status&&i&&!i(n.status)?e(s("Request failed with status code "+n.status,n.config,null,n.request,n)):t(n)}})),i.register("kjF3e",(function(t,e){var s=i("8v8A7");t.exports=function(t,e,n,i,o){var a=new Error(t);return s(a,e,n,i,o)}})),i.register("8JRzs",(function(t,e){var s=i("gKvUL");t.exports=s.isStandardBrowserEnv()?{write:function(t,e,n,i,o,a){var r=[];r.push(t+"="+encodeURIComponent(e)),s.isNumber(n)&&r.push("expires="+new Date(n).toGMTString()),s.isString(i)&&r.push("path="+i),s.isString(o)&&r.push("domain="+o),!0===a&&r.push("secure"),document.cookie=r.join("; ")},read:function(t){var e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}})),i.register("7GD7a",(function(t,e){var s=i("ckHwb"),n=i("fE4ul");t.exports=function(t,e){return t&&!s(e)?n(t,e):e}})),i.register("ckHwb",(function(t,e){t.exports=function(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}})),i.register("fE4ul",(function(t,e){t.exports=function(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t}})),i.register("lDriZ",(function(t,e){var s=i("gKvUL"),n=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];t.exports=function(t){var e,i,o,a={};return t?(s.forEach(t.split("\n"),(function(t){if(o=t.indexOf(":"),e=s.trim(t.substr(0,o)).toLowerCase(),i=s.trim(t.substr(o+1)),e){if(a[e]&&n.indexOf(e)>=0)return;a[e]="set-cookie"===e?(a[e]?a[e]:[]).concat([i]):a[e]?a[e]+", "+i:i}})),a):a}})),i.register("889er",(function(t,e){var s=i("gKvUL");t.exports=s.isStandardBrowserEnv()?function(){var t,e=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function i(t){var s=t;return e&&(n.setAttribute("href",s),s=n.href),n.setAttribute("href",s),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return t=i(window.location.href),function(e){var n=s.isString(e)?i(e):e;return n.protocol===t.protocol&&n.host===t.host}}():function(){return!0}})),i.register("4Tkeq",(function(t,e){function s(t){this.message=t}s.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},s.prototype.__CANCEL__=!0,t.exports=s})),i.register("7L4QX",(function(t,e){t.exports=function(t){return!(!t||!t.__CANCEL__)}})),i.register("lk5EI",(function(t,e){var s=i("gKvUL");t.exports=function(t,e){e=e||{};var n={};function i(t,e){return s.isPlainObject(t)&&s.isPlainObject(e)?s.merge(t,e):s.isPlainObject(e)?s.merge({},e):s.isArray(e)?e.slice():e}function o(n){return s.isUndefined(e[n])?s.isUndefined(t[n])?void 0:i(void 0,t[n]):i(t[n],e[n])}function a(t){if(!s.isUndefined(e[t]))return i(void 0,e[t])}function r(n){return s.isUndefined(e[n])?s.isUndefined(t[n])?void 0:i(void 0,t[n]):i(void 0,e[n])}function c(s){return s in e?i(t[s],e[s]):s in t?i(void 0,t[s]):void 0}var l={url:a,method:a,data:a,baseURL:r,transformRequest:r,transformResponse:r,paramsSerializer:r,timeout:r,timeoutMessage:r,withCredentials:r,adapter:r,responseType:r,xsrfCookieName:r,xsrfHeaderName:r,onUploadProgress:r,onDownloadProgress:r,decompress:r,maxContentLength:r,maxBodyLength:r,transport:r,httpAgent:r,httpsAgent:r,cancelToken:r,socketPath:r,responseEncoding:r,validateStatus:c};return s.forEach(Object.keys(t).concat(Object.keys(e)),(function(t){var e=l[t]||o,i=e(t);s.isUndefined(i)&&e!==c||(n[t]=i)})),n}})),i.register("bv3QM",(function(t,e){var s=i("35BUy").version,n={};["object","boolean","number","function","string","symbol"].forEach((function(t,e){n[t]=function(s){return typeof s===t||"a"+(e<1?"n ":" ")+t}}));var o={};n.transitional=function(t,e,n){function i(t,e){return"[Axios v"+s+"] Transitional option '"+t+"'"+e+(n?". "+n:"")}return function(s,n,a){if(!1===t)throw new Error(i(n," has been removed"+(e?" in "+e:"")));return e&&!o[n]&&(o[n]=!0,console.warn(i(n," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(s,n,a)}},t.exports={assertOptions:function(t,e,s){if("object"!=typeof t)throw new TypeError("options must be an object");for(var n=Object.keys(t),i=n.length;i-- >0;){var o=n[i],a=e[o];if(a){var r=t[o],c=void 0===r||a(r,o,t);if(!0!==c)throw new TypeError("option "+o+" must be "+c)}else if(!0!==s)throw Error("Unknown option "+o)}},validators:n}})),i.register("35BUy",(function(t,e){t.exports={version:"0.25.0"}})),i.register("lAKPy",(function(t,e){var s=i("4Tkeq");function n(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var e;this.promise=new Promise((function(t){e=t}));var n=this;this.promise.then((function(t){if(n._listeners){var e,s=n._listeners.length;for(e=0;e<s;e++)n._listeners[e](t);n._listeners=null}})),this.promise.then=function(t){var e,s=new Promise((function(t){n.subscribe(t),e=t})).then(t);return s.cancel=function(){n.unsubscribe(e)},s},t((function(t){n.reason||(n.reason=new s(t),e(n.reason))}))}n.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},n.prototype.subscribe=function(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]},n.prototype.unsubscribe=function(t){if(this._listeners){var e=this._listeners.indexOf(t);-1!==e&&this._listeners.splice(e,1)}},n.source=function(){var t;return{token:new n((function(e){t=e})),cancel:t}},t.exports=n})),i.register("JEeti",(function(t,e){t.exports=function(t){return function(e){return t.apply(null,e)}}})),i.register("dxy9O",(function(t,e){var s=i("gKvUL");t.exports=function(t){return s.isObject(t)&&!0===t.isAxiosError}}));class o{constructor(t=""){this.name=this.constructor.name,this.message=t}}class a extends o{}class r extends o{}var c={LOGIN:0,BACKUP:1,HORIZON:2,ACK:5,PONG:6,KEY:10,COMMAND:11,SCOREDETAILED:12,CHAT:20,WHISPER:21,SAY:22,TEAMCHAT:23,VOTEMUTE:24,LOCALPING:255},l={LOGIN:0,BACKUP:1,PING:5,PING_RESULT:6,ACK:7,ERROR:8,COMMAND_REPLY:9,PLAYER_NEW:10,PLAYER_LEAVE:11,PLAYER_UPDATE:12,PLAYER_FIRE:13,PLAYER_HIT:14,PLAYER_RESPAWN:15,PLAYER_FLAG:16,PLAYER_KILL:17,PLAYER_UPGRADE:18,PLAYER_TYPE:19,PLAYER_POWERUP:20,PLAYER_LEVEL:21,PLAYER_RETEAM:22,GAME_FLAG:30,GAME_SPECTATE:31,GAME_PLAYERSALIVE:32,GAME_FIREWALL:33,EVENT_REPEL:40,EVENT_BOOST:41,EVENT_BOUNCE:42,EVENT_STEALTH:43,EVENT_LEAVEHORIZON:44,MOB_UPDATE:60,MOB_UPDATE_STATIONARY:61,MOB_DESPAWN:62,MOB_DESPAWN_COORDS:63,CHAT_PUBLIC:70,CHAT_TEAM:71,CHAT_SAY:72,CHAT_WHISPER:73,CHAT_VOTEMUTEPASSED:78,CHAT_VOTEMUTED:79,SCORE_UPDATE:80,SCORE_BOARD:81,SCORE_DETAILED:82,SCORE_DETAILED_CTF:83,SCORE_DETAILED_BTR:84,SERVER_MESSAGE:90,SERVER_CUSTOM:91};let h;var u;(u=h||(h={}))[u.text=1]="text",u[u.textbig=2]="textbig",u[u.arraysmall=4]="arraysmall",u[u.array=3]="array",u[u.uint8=5]="uint8",u[u.uint16=6]="uint16",u[u.uint24=7]="uint24",u[u.uint32=8]="uint32",u[u.float32=9]="float32",u[u.float64=10]="float64",u[u.boolean=11]="boolean",u[u.speed=12]="speed",u[u.accel=13]="accel",u[u.coordx=14]="coordx",u[u.coordy=15]="coordy",u[u.coord24=16]="coord24",u[u.rotation=17]="rotation",u[u.healthenergy=18]="healthenergy",u[u.regen=19]="regen";h.text,h.textbig,h.arraysmall,h.array,h.uint8,h.uint16,h.uint24,h.uint32,h.float32,h.float64,h.boolean,h.speed,h.accel,h.coordx,h.coordy,h.coord24,h.rotation,h.healthenergy,h.regen;var d={[c.LOGIN]:[["protocol",h.uint8],["name",h.text],["session",h.text],["horizonX",h.uint16],["horizonY",h.uint16],["flag",h.text]],[c.BACKUP]:[["token",h.text]],[c.HORIZON]:[["horizonX",h.uint16],["horizonY",h.uint16]],[c.ACK]:[],[c.PONG]:[["num",h.uint32]],[c.KEY]:[["seq",h.uint32],["key",h.uint8],["state",h.boolean]],[c.COMMAND]:[["com",h.text],["data",h.text]],[c.SCOREDETAILED]:[],[c.CHAT]:[["text",h.text]],[c.WHISPER]:[["id",h.uint16],["text",h.text]],[c.SAY]:[["text",h.text]],[c.TEAMCHAT]:[["text",h.text]],[c.VOTEMUTE]:[["id",h.uint16]],[c.LOCALPING]:[["auth",h.uint32]]},g={[l.LOGIN]:[["success",h.boolean],["id",h.uint16],["team",h.uint16],["clock",h.uint32],["token",h.text],["type",h.uint8],["room",h.text],["players",h.array,[["id",h.uint16],["status",h.uint8],["level",h.uint8],["name",h.text],["type",h.uint8],["team",h.uint16],["posX",h.coordx],["posY",h.coordy],["rot",h.rotation],["flag",h.uint16],["upgrades",h.uint8]]],["serverConfiguration",h.textbig],["bots",h.array,[["id",h.uint16]]]],[l.BACKUP]:[],[l.PING]:[["clock",h.uint32],["num",h.uint32]],[l.PING_RESULT]:[["ping",h.uint16],["playerstotal",h.uint32],["playersgame",h.uint32]],[l.ACK]:[],[l.ERROR]:[["error",h.uint8]],[l.COMMAND_REPLY]:[["type",h.uint8],["text",h.textbig]],[l.PLAYER_NEW]:[["id",h.uint16],["status",h.uint8],["name",h.text],["type",h.uint8],["team",h.uint16],["posX",h.coordx],["posY",h.coordy],["rot",h.rotation],["flag",h.uint16],["upgrades",h.uint8],["isBot",h.boolean]],[l.PLAYER_LEAVE]:[["id",h.uint16]],[l.PLAYER_UPDATE]:[["clock",h.uint32],["id",h.uint16],["keystate",h.uint8],["upgrades",h.uint8],["posX",h.coord24],["posY",h.coord24],["rot",h.rotation],["speedX",h.speed],["speedY",h.speed]],[l.PLAYER_FIRE]:[["clock",h.uint32],["id",h.uint16],["energy",h.healthenergy],["energyRegen",h.regen],["projectiles",h.arraysmall,[["id",h.uint16],["type",h.uint8],["posX",h.coordx],["posY",h.coordy],["speedX",h.speed],["speedY",h.speed],["accelX",h.accel],["accelY",h.accel],["maxSpeed",h.speed]]]],[l.PLAYER_RESPAWN]:[["id",h.uint16],["posX",h.coord24],["posY",h.coord24],["rot",h.rotation],["upgrades",h.uint8]],[l.PLAYER_FLAG]:[["id",h.uint16],["flag",h.uint16]],[l.PLAYER_HIT]:[["id",h.uint16],["type",h.uint8],["posX",h.coordx],["posY",h.coordy],["owner",h.uint16],["players",h.arraysmall,[["id",h.uint16],["health",h.healthenergy],["healthRegen",h.regen]]]],[l.PLAYER_KILL]:[["id",h.uint16],["killer",h.uint16],["posX",h.coordx],["posY",h.coordy]],[l.PLAYER_UPGRADE]:[["upgrades",h.uint16],["type",h.uint8],["speed",h.uint8],["defense",h.uint8],["energy",h.uint8],["missile",h.uint8]],[l.PLAYER_TYPE]:[["id",h.uint16],["type",h.uint8]],[l.PLAYER_POWERUP]:[["type",h.uint8],["duration",h.uint32]],[l.PLAYER_LEVEL]:[["id",h.uint16],["type",h.uint8],["level",h.uint8]],[l.PLAYER_RETEAM]:[["players",h.array,[["id",h.uint16],["team",h.uint16]]]],[l.GAME_FLAG]:[["type",h.uint8],["flag",h.uint8],["id",h.uint16],["posX",h.coord24],["posY",h.coord24],["blueteam",h.uint8],["redteam",h.uint8]],[l.GAME_SPECTATE]:[["id",h.uint16]],[l.GAME_PLAYERSALIVE]:[["players",h.uint16]],[l.GAME_FIREWALL]:[["type",h.uint8],["status",h.uint8],["posX",h.coordx],["posY",h.coordy],["radius",h.float32],["speed",h.float32]],[l.EVENT_REPEL]:[["clock",h.uint32],["id",h.uint16],["posX",h.coordx],["posY",h.coordy],["rot",h.rotation],["speedX",h.speed],["speedY",h.speed],["energy",h.healthenergy],["energyRegen",h.regen],["players",h.arraysmall,[["id",h.uint16],["keystate",h.uint8],["posX",h.coordx],["posY",h.coordy],["rot",h.rotation],["speedX",h.speed],["speedY",h.speed],["energy",h.healthenergy],["energyRegen",h.regen],["playerHealth",h.healthenergy],["playerHealthRegen",h.regen]]],["mobs",h.arraysmall,[["id",h.uint16],["type",h.uint8],["posX",h.coordx],["posY",h.coordy],["speedX",h.speed],["speedY",h.speed],["accelX",h.accel],["accelY",h.accel],["maxSpeed",h.speed]]]],[l.EVENT_BOOST]:[["clock",h.uint32],["id",h.uint16],["boost",h.boolean],["posX",h.coord24],["posY",h.coord24],["rot",h.rotation],["speedX",h.speed],["speedY",h.speed],["energy",h.healthenergy],["energyRegen",h.regen]],[l.EVENT_BOUNCE]:[["clock",h.uint32],["id",h.uint16],["keystate",h.uint8],["posX",h.coord24],["posY",h.coord24],["rot",h.rotation],["speedX",h.speed],["speedY",h.speed]],[l.EVENT_STEALTH]:[["id",h.uint16],["state",h.boolean],["energy",h.healthenergy],["energyRegen",h.regen]],[l.EVENT_LEAVEHORIZON]:[["type",h.uint8],["id",h.uint16]],[l.MOB_UPDATE]:[["clock",h.uint32],["id",h.uint16],["type",h.uint8],["posX",h.coordx],["posY",h.coordy],["speedX",h.speed],["speedY",h.speed],["accelX",h.accel],["accelY",h.accel],["maxSpeed",h.speed]],[l.MOB_UPDATE_STATIONARY]:[["id",h.uint16],["type",h.uint8],["posX",h.float32],["posY",h.float32]],[l.MOB_DESPAWN]:[["id",h.uint16],["type",h.uint8]],[l.MOB_DESPAWN_COORDS]:[["id",h.uint16],["type",h.uint8],["posX",h.coordx],["posY",h.coordy]],[l.SCORE_UPDATE]:[["id",h.uint16],["score",h.uint32],["earnings",h.uint32],["upgrades",h.uint16],["totalkills",h.uint32],["totaldeaths",h.uint32]],[l.SCORE_BOARD]:[["data",h.array,[["id",h.uint16],["score",h.uint32],["level",h.uint8]]],["rankings",h.array,[["id",h.uint16],["x",h.uint8],["y",h.uint8]]]],[l.SCORE_DETAILED]:[["scores",h.array,[["id",h.uint16],["level",h.uint8],["score",h.uint32],["kills",h.uint16],["deaths",h.uint16],["damage",h.float32],["ping",h.uint16]]]],[l.SCORE_DETAILED_CTF]:[["scores",h.array,[["id",h.uint16],["level",h.uint8],["captures",h.uint16],["score",h.uint32],["kills",h.uint16],["deaths",h.uint16],["damage",h.float32],["ping",h.uint16]]]],[l.SCORE_DETAILED_BTR]:[["scores",h.array,[["id",h.uint16],["level",h.uint8],["alive",h.boolean],["wins",h.uint16],["score",h.uint32],["kills",h.uint16],["deaths",h.uint16],["damage",h.float32],["ping",h.uint16]]]],[l.CHAT_TEAM]:[["id",h.uint16],["text",h.text]],[l.CHAT_PUBLIC]:[["id",h.uint16],["text",h.text]],[l.CHAT_SAY]:[["id",h.uint16],["text",h.text]],[l.CHAT_WHISPER]:[["from",h.uint16],["to",h.uint16],["text",h.text]],[l.CHAT_VOTEMUTEPASSED]:[["id",h.uint16]],[l.CHAT_VOTEMUTED]:[],[l.SERVER_MESSAGE]:[["type",h.uint8],["duration",h.uint32],["text",h.textbig]],[l.SERVER_CUSTOM]:[["type",h.uint8],["data",h.textbig]]};const p=t=>{let e=0;const s=new Uint8Array(4*t.length);for(let n=0;n!==t.length;n+=1){let i=t.charCodeAt(n);if(i<128)s[e++]=i;else{if(i<2048)s[e++]=i>>6|192;else{if(i>55295&&i<56320){if(++n>=t.length)throw new a("UTF-8 encode: incomplete surrogate pair");const o=t.charCodeAt(n);if(o<56320||o>57343)throw new a(`UTF-8 encode: second surrogate character 0x${o.toString(16)} at index ${n} out of range`);i=65536+((1023&i)<<10)+(1023&o),s[e++]=i>>18|240,s[e++]=i>>12&63|128}else s[e++]=i>>12|224;s[e++]=i>>6&63|128}s[e++]=63&i|128}}return s.subarray(0,e)},E=t=>{let e=0,s="";for(;e<t.length;){let n=t[e++];if(n>127)if(n>191&&n<224){if(e>=t.length)throw new r("UTF-8 decode: incomplete 2-byte sequence");n=(31&n)<<6|63&t[e++]}else if(n>223&&n<240){if(e+1>=t.length)throw new r("UTF-8 decode: incomplete 3-byte sequence");n=(15&n)<<12|(63&t[e++])<<6|63&t[e++]}else{if(!(n>239&&n<248))throw new r(`UTF-8 decode: unknown multibyte start 0x${n.toString(16)} at index ${e-1}`);if(e+2>=t.length)throw new r("UTF-8 decode: incomplete 4-byte sequence");n=(7&n)<<18|(63&t[e++])<<12|(63&t[e++])<<6|63&t[e++]}if(n<=65535)s+=String.fromCharCode(n);else{if(!(n<=1114111))throw new r(`UTF-8 decode: code point 0x${n.toString(16)} exceeds UTF-16 reach`);n-=65536,s+=String.fromCharCode(n>>10|55296),s+=String.fromCharCode(1023&n|56320)}}return s},y=(()=>{const t=new ArrayBuffer(1);return new DataView(t).setUint8(0,5),t})(),f=(()=>{const t=new ArrayBuffer(1);return new DataView(t).setUint8(0,12),t})();var m={[c.LOGIN]:t=>{const e=p(t.name),s=p(t.session),n=p(t.flag),i=new ArrayBuffer(9+e.length+s.length+n.length),o=new DataView(i);let a=0;o.setUint8(a,t.c),a+=1,o.setUint8(a,t.protocol),a+=1,o.setUint8(a,e.length),a+=1;for(let t=0;t<e.length;t+=1)o.setUint8(a+t,e[t]);a+=e.length,o.setUint8(a,s.length),a+=1;for(let t=0;t<s.length;t+=1)o.setUint8(a+t,s[t]);a+=s.length,o.setUint16(a,t.horizonX,!0),a+=2,o.setUint16(a,t.horizonY,!0),a+=2,o.setUint8(a,n.length),a+=1;for(let t=0;t<n.length;t+=1)o.setUint8(a+t,n[t]);return i},[c.BACKUP]:t=>{const e=p(t.token),s=new ArrayBuffer(2+e.length),n=new DataView(s);let i=0;n.setUint8(i,t.c),i+=1,n.setUint8(i,e.length),i+=1;for(let t=0;t<e.length;t+=1)n.setUint8(i+t,e[t]);return s},[c.HORIZON]:t=>{const e=new ArrayBuffer(5),s=new DataView(e);let n=0;return s.setUint8(n,t.c),n+=1,s.setUint16(n,t.horizonX,!0),n+=2,s.setUint16(n,t.horizonY,!0),n+=2,e},[c.ACK]:()=>y,[c.PONG]:t=>{const e=new ArrayBuffer(5),s=new DataView(e);let n=0;return s.setUint8(n,t.c),n+=1,s.setUint32(n,t.num,!0),n+=4,e},[c.KEY]:t=>{const e=new ArrayBuffer(7),s=new DataView(e);let n=0;return s.setUint8(n,t.c),n+=1,s.setUint32(n,t.seq,!0),n+=4,s.setUint8(n,t.key),n+=1,s.setUint8(n,!1===t.state?0:1),n+=1,e},[c.COMMAND]:t=>{const e=p(t.com),s=p(t.data),n=new ArrayBuffer(3+e.length+s.length),i=new DataView(n);let o=0;i.setUint8(o,t.c),o+=1,i.setUint8(o,e.length),o+=1;for(let t=0;t<e.length;t+=1)i.setUint8(o+t,e[t]);o+=e.length,i.setUint8(o,s.length),o+=1;for(let t=0;t<s.length;t+=1)i.setUint8(o+t,s[t]);return n},[c.SCOREDETAILED]:()=>f,[c.CHAT]:t=>{const e=p(t.text),s=new ArrayBuffer(2+e.length),n=new DataView(s);let i=0;n.setUint8(i,t.c),i+=1,n.setUint8(i,e.length),i+=1;for(let t=0;t<e.length;t+=1)n.setUint8(i+t,e[t]);return s},[c.WHISPER]:t=>{const e=p(t.text),s=new ArrayBuffer(4+e.length),n=new DataView(s);let i=0;n.setUint8(i,t.c),i+=1,n.setUint16(i,t.id,!0),i+=2,n.setUint8(i,e.length),i+=1;for(let t=0;t<e.length;t+=1)n.setUint8(i+t,e[t]);return s},[c.SAY]:t=>{const e=p(t.text),s=new ArrayBuffer(2+e.length),n=new DataView(s);let i=0;n.setUint8(i,t.c),i+=1,n.setUint8(i,e.length),i+=1;for(let t=0;t<e.length;t+=1)n.setUint8(i+t,e[t]);return s},[c.TEAMCHAT]:t=>{const e=p(t.text),s=new ArrayBuffer(2+e.length),n=new DataView(s);let i=0;n.setUint8(i,t.c),i+=1,n.setUint8(i,e.length),i+=1;for(let t=0;t<e.length;t+=1)n.setUint8(i+t,e[t]);return s},[c.VOTEMUTE]:t=>{const e=new ArrayBuffer(3),s=new DataView(e);let n=0;return s.setUint8(n,t.c),n+=1,s.setUint16(n,t.id,!0),n+=2,e},[c.LOCALPING]:t=>{const e=new ArrayBuffer(5),s=new DataView(e);let n=0;return s.setUint8(n,t.c),n+=1,s.setUint32(n,t.auth,!0),n+=4,e}};const A=(()=>{const t=new ArrayBuffer(1);return new DataView(t).setUint8(0,1),t})(),U=(()=>{const t=new ArrayBuffer(1);return new DataView(t).setUint8(0,7),t})(),R=(()=>{const t=new ArrayBuffer(1);return new DataView(t).setUint8(0,79),t})();var w={[l.LOGIN]:t=>{const e=[];let s=0,n=0;for(let i=0;i<t.players.length;i+=1)n+=17,e[s]=p(t.players[i].name),n+=e[s].length,s+=1;for(let e=0;e<t.bots.length;e+=1)n+=2;const i=p(t.token),o=p(t.room),a=p(t.serverConfiguration),r=new ArrayBuffer(19+i.length+o.length+a.length+n),c=new DataView(r);let l=0;s=0,c.setUint8(l,t.c),l+=1,c.setUint8(l,!1===t.success?0:1),l+=1,c.setUint16(l,t.id,!0),l+=2,c.setUint16(l,t.team,!0),l+=2,c.setUint32(l,t.clock,!0),l+=4,c.setUint8(l,i.length),l+=1;for(let t=0;t<i.length;t+=1)c.setUint8(l+t,i[t]);l+=i.length,c.setUint8(l,t.type),l+=1,c.setUint8(l,o.length),l+=1;for(let t=0;t<o.length;t+=1)c.setUint8(l+t,o[t]);l+=o.length;{const{players:n}=t;c.setUint16(l,n.length,!0),l+=2;for(let t=0;t<n.length;t+=1){c.setUint16(l,n[t].id,!0),l+=2,c.setUint8(l,n[t].status),l+=1,c.setUint8(l,n[t].level),l+=1,c.setUint8(l,e[s].length),l+=1;for(let t=0;t<e[s].length;t+=1)c.setUint8(l+t,e[s][t]);l+=e[s].length,s+=1,c.setUint8(l,n[t].type),l+=1,c.setUint16(l,n[t].team,!0),l+=2,c.setUint16(l,2*n[t].posX+32768,!0),l+=2,c.setUint16(l,4*n[t].posY+32768,!0),l+=2,c.setUint16(l,6553.6*n[t].rot,!0),l+=2,c.setUint16(l,n[t].flag,!0),l+=2,c.setUint8(l,n[t].upgrades),l+=1}}c.setUint16(l,a.length,!0),l+=2;for(let t=0;t<a.length;t+=1)c.setUint8(l+t,a[t]);l+=a.length;{const{bots:e}=t;c.setUint16(l,e.length,!0),l+=2;for(let t=0;t<e.length;t+=1)c.setUint16(l,e[t].id,!0),l+=2}return r},[l.BACKUP]:()=>A,[l.PING]:t=>{const e=new ArrayBuffer(9),s=new DataView(e);let n=0;return s.setUint8(n,t.c),n+=1,s.setUint32(n,t.clock,!0),n+=4,s.setUint32(n,t.num,!0),n+=4,e},[l.PING_RESULT]:t=>{const e=new ArrayBuffer(11),s=new DataView(e);let n=0;return s.setUint8(n,t.c),n+=1,s.setUint16(n,t.ping,!0),n+=2,s.setUint32(n,t.playerstotal,!0),n+=4,s.setUint32(n,t.playersgame,!0),n+=4,e},[l.ACK]:()=>U,[l.ERROR]:t=>{const e=new ArrayBuffer(2),s=new DataView(e);let n=0;return s.setUint8(n,t.c),n+=1,s.setUint8(n,t.error),n+=1,e},[l.COMMAND_REPLY]:t=>{const e=p(t.text),s=new ArrayBuffer(4+e.length),n=new DataView(s);let i=0;n.setUint8(i,t.c),i+=1,n.setUint8(i,t.type),i+=1,n.setUint16(i,e.length,!0),i+=2;for(let t=0;t<e.length;t+=1)n.setUint8(i+t,e[t]);return s},[l.PLAYER_NEW]:t=>{const e=p(t.name),s=new ArrayBuffer(18+e.length),n=new DataView(s);let i=0;n.setUint8(i,t.c),i+=1,n.setUint16(i,t.id,!0),i+=2,n.setUint8(i,t.status),i+=1,n.setUint8(i,e.length),i+=1;for(let t=0;t<e.length;t+=1)n.setUint8(i+t,e[t]);return i+=e.length,n.setUint8(i,t.type),i+=1,n.setUint16(i,t.team,!0),i+=2,n.setUint16(i,2*t.posX+32768,!0),i+=2,n.setUint16(i,4*t.posY+32768,!0),i+=2,n.setUint16(i,6553.6*t.rot,!0),i+=2,n.setUint16(i,t.flag,!0),i+=2,n.setUint8(i,t.upgrades),i+=1,n.setUint8(i,!1===t.isBot?0:1),i+=1,s},[l.PLAYER_LEAVE]:t=>{const e=new ArrayBuffer(3),s=new DataView(e);let n=0;return s.setUint8(n,t.c),n+=1,s.setUint16(n,t.id,!0),n+=2,e},[l.PLAYER_UPDATE]:t=>{const e=new ArrayBuffer(21),s=new DataView(e);let n=0;s.setUint8(n,t.c),n+=1,s.setUint32(n,t.clock,!0),n+=4,s.setUint16(n,t.id,!0),n+=2,s.setUint8(n,t.keystate),n+=1,s.setUint8(n,t.upgrades),n+=1;{const e=512*t.posX+8388608,i=e%256,o=(e-i)/256;s.setUint16(n,o,!0),n+=2,s.setUint8(n,i),n+=1}{const e=512*t.posY+8388608,i=e%256,o=(e-i)/256;s.setUint16(n,o,!0),n+=2,s.setUint8(n,i),n+=1}return s.setUint16(n,6553.6*t.rot,!0),n+=2,s.setUint16(n,1638.4*t.speedX+32768,!0),n+=2,s.setUint16(n,1638.4*t.speedY+32768,!0),n+=2,e},[l.PLAYER_FIRE]:t=>{let e=0;for(let s=0;s<t.projectiles.length;s+=1)e+=17;const s=new ArrayBuffer(11+e),n=new DataView(s);let i=0;n.setUint8(i,t.c),i+=1,n.setUint32(i,t.clock,!0),i+=4,n.setUint16(i,t.id,!0),i+=2,n.setUint8(i,255*t.energy),i+=1,n.setUint16(i,1e6*t.energyRegen+32768,!0),i+=2;{const{projectiles:e}=t;n.setUint8(i,e.length),i+=1;for(let t=0;t<e.length;t+=1)n.setUint16(i,e[t].id,!0),i+=2,n.setUint8(i,e[t].type),i+=1,n.setUint16(i,2*e[t].posX+32768,!0),i+=2,n.setUint16(i,4*e[t].posY+32768,!0),i+=2,n.setUint16(i,1638.4*e[t].speedX+32768,!0),i+=2,n.setUint16(i,1638.4*e[t].speedY+32768,!0),i+=2,n.setUint16(i,32768*e[t].accelX+32768,!0),i+=2,n.setUint16(i,32768*e[t].accelY+32768,!0),i+=2,n.setUint16(i,1638.4*e[t].maxSpeed+32768,!0),i+=2}return s},[l.PLAYER_HIT]:t=>{let e=0;for(let s=0;s<t.players.length;s+=1)e+=5;const s=new ArrayBuffer(11+e),n=new DataView(s);let i=0;n.setUint8(i,t.c),i+=1,n.setUint16(i,t.id,!0),i+=2,n.setUint8(i,t.type),i+=1,n.setUint16(i,2*t.posX+32768,!0),i+=2,n.setUint16(i,4*t.posY+32768,!0),i+=2,n.setUint16(i,t.owner,!0),i+=2;{const{players:e}=t;n.setUint8(i,e.length),i+=1;for(let t=0;t<e.length;t+=1)n.setUint16(i,e[t].id,!0),i+=2,n.setUint8(i,255*e[t].health),i+=1,n.setUint16(i,1e6*e[t].healthRegen+32768,!0),i+=2}return s},[l.PLAYER_RESPAWN]:t=>{const e=new ArrayBuffer(12),s=new DataView(e);let n=0;s.setUint8(n,t.c),n+=1,s.setUint16(n,t.id,!0),n+=2;{const e=512*t.posX+8388608,i=e%256,o=(e-i)/256;s.setUint16(n,o,!0),n+=2,s.setUint8(n,i),n+=1}{const e=512*t.posY+8388608,i=e%256,o=(e-i)/256;s.setUint16(n,o,!0),n+=2,s.setUint8(n,i),n+=1}return s.setUint16(n,6553.6*t.rot,!0),n+=2,s.setUint8(n,t.upgrades),n+=1,e},[l.PLAYER_FLAG]:t=>{const e=new ArrayBuffer(5),s=new DataView(e);let n=0;return s.setUint8(n,t.c),n+=1,s.setUint16(n,t.id,!0),n+=2,s.setUint16(n,t.flag,!0),n+=2,e},[l.PLAYER_KILL]:t=>{const e=new ArrayBuffer(9),s=new DataView(e);let n=0;return s.setUint8(n,t.c),n+=1,s.setUint16(n,t.id,!0),n+=2,s.setUint16(n,t.killer,!0),n+=2,s.setUint16(n,2*t.posX+32768,!0),n+=2,s.setUint16(n,4*t.posY+32768,!0),n+=2,e},[l.PLAYER_UPGRADE]:t=>{const e=new ArrayBuffer(8),s=new DataView(e);let n=0;return s.setUint8(n,t.c),n+=1,s.setUint16(n,t.upgrades,!0),n+=2,s.setUint8(n,t.type),n+=1,s.setUint8(n,t.speed),n+=1,s.setUint8(n,t.defense),n+=1,s.setUint8(n,t.energy),n+=1,s.setUint8(n,t.missile),n+=1,e},[l.PLAYER_TYPE]:t=>{const e=new ArrayBuffer(4),s=new DataView(e);let n=0;return s.setUint8(n,t.c),n+=1,s.setUint16(n,t.id,!0),n+=2,s.setUint8(n,t.type),n+=1,e},[l.PLAYER_POWERUP]:t=>{const e=new ArrayBuffer(6),s=new DataView(e);let n=0;return s.setUint8(n,t.c),n+=1,s.setUint8(n,t.type),n+=1,s.setUint32(n,t.duration,!0),n+=4,e},[l.PLAYER_LEVEL]:t=>{const e=new ArrayBuffer(5),s=new DataView(e);let n=0;return s.setUint8(n,t.c),n+=1,s.setUint16(n,t.id,!0),n+=2,s.setUint8(n,t.type),n+=1,s.setUint8(n,t.level),n+=1,e},[l.PLAYER_RETEAM]:t=>{let e=0;for(let s=0;s<t.players.length;s+=1)e+=4;const s=new ArrayBuffer(3+e),n=new DataView(s);let i=0;n.setUint8(i,t.c),i+=1;{const{players:e}=t;n.setUint16(i,e.length,!0),i+=2;for(let t=0;t<e.length;t+=1)n.setUint16(i,e[t].id,!0),i+=2,n.setUint16(i,e[t].team,!0),i+=2}return s},[l.GAME_FLAG]:t=>{const e=new ArrayBuffer(13),s=new DataView(e);let n=0;s.setUint8(n,t.c),n+=1,s.setUint8(n,t.type),n+=1,s.setUint8(n,t.flag),n+=1,s.setUint16(n,t.id,!0),n+=2;{const e=512*t.posX+8388608,i=e%256,o=(e-i)/256;s.setUint16(n,o,!0),n+=2,s.setUint8(n,i),n+=1}{const e=512*t.posY+8388608,i=e%256,o=(e-i)/256;s.setUint16(n,o,!0),n+=2,s.setUint8(n,i),n+=1}return s.setUint8(n,t.blueteam),n+=1,s.setUint8(n,t.redteam),n+=1,e},[l.GAME_SPECTATE]:t=>{const e=new ArrayBuffer(3),s=new DataView(e);let n=0;return s.setUint8(n,t.c),n+=1,s.setUint16(n,t.id,!0),n+=2,e},[l.GAME_PLAYERSALIVE]:t=>{const e=new ArrayBuffer(3),s=new DataView(e);let n=0;return s.setUint8(n,t.c),n+=1,s.setUint16(n,t.players,!0),n+=2,e},[l.GAME_FIREWALL]:t=>{const e=new ArrayBuffer(15),s=new DataView(e);let n=0;return s.setUint8(n,t.c),n+=1,s.setUint8(n,t.type),n+=1,s.setUint8(n,t.status),n+=1,s.setUint16(n,2*t.posX+32768,!0),n+=2,s.setUint16(n,4*t.posY+32768,!0),n+=2,s.setFloat32(n,t.radius,!0),n+=4,s.setFloat32(n,t.speed,!0),n+=4,e},[l.EVENT_REPEL]:t=>{let e=0;for(let s=0;s<t.players.length;s+=1)e+=19;for(let s=0;s<t.mobs.length;s+=1)e+=17;const s=new ArrayBuffer(22+e),n=new DataView(s);let i=0;n.setUint8(i,t.c),i+=1,n.setUint32(i,t.clock,!0),i+=4,n.setUint16(i,t.id,!0),i+=2,n.setUint16(i,2*t.posX+32768,!0),i+=2,n.setUint16(i,4*t.posY+32768,!0),i+=2,n.setUint16(i,6553.6*t.rot,!0),i+=2,n.setUint16(i,1638.4*t.speedX+32768,!0),i+=2,n.setUint16(i,1638.4*t.speedY+32768,!0),i+=2,n.setUint8(i,255*t.energy),i+=1,n.setUint16(i,1e6*t.energyRegen+32768,!0),i+=2;{const{players:e}=t;n.setUint8(i,e.length),i+=1;for(let t=0;t<e.length;t+=1)n.setUint16(i,e[t].id,!0),i+=2,n.setUint8(i,e[t].keystate),i+=1,n.setUint16(i,2*e[t].posX+32768,!0),i+=2,n.setUint16(i,4*e[t].posY+32768,!0),i+=2,n.setUint16(i,6553.6*e[t].rot,!0),i+=2,n.setUint16(i,1638.4*e[t].speedX+32768,!0),i+=2,n.setUint16(i,1638.4*e[t].speedY+32768,!0),i+=2,n.setUint8(i,255*e[t].energy),i+=1,n.setUint16(i,1e6*e[t].energyRegen+32768,!0),i+=2,n.setUint8(i,255*e[t].playerHealth),i+=1,n.setUint16(i,1e6*e[t].playerHealthRegen+32768,!0),i+=2}{const{mobs:e}=t;n.setUint8(i,e.length),i+=1;for(let t=0;t<e.length;t+=1)n.setUint16(i,e[t].id,!0),i+=2,n.setUint8(i,e[t].type),i+=1,n.setUint16(i,2*e[t].posX+32768,!0),i+=2,n.setUint16(i,4*e[t].posY+32768,!0),i+=2,n.setUint16(i,1638.4*e[t].speedX+32768,!0),i+=2,n.setUint16(i,1638.4*e[t].speedY+32768,!0),i+=2,n.setUint16(i,32768*e[t].accelX+32768,!0),i+=2,n.setUint16(i,32768*e[t].accelY+32768,!0),i+=2,n.setUint16(i,1638.4*e[t].maxSpeed+32768,!0),i+=2}return s},[l.EVENT_BOOST]:t=>{const e=new ArrayBuffer(23),s=new DataView(e);let n=0;s.setUint8(n,t.c),n+=1,s.setUint32(n,t.clock,!0),n+=4,s.setUint16(n,t.id,!0),n+=2,s.setUint8(n,!1===t.boost?0:1),n+=1;{const e=512*t.posX+8388608,i=e%256,o=(e-i)/256;s.setUint16(n,o,!0),n+=2,s.setUint8(n,i),n+=1}{const e=512*t.posY+8388608,i=e%256,o=(e-i)/256;s.setUint16(n,o,!0),n+=2,s.setUint8(n,i),n+=1}return s.setUint16(n,6553.6*t.rot,!0),n+=2,s.setUint16(n,1638.4*t.speedX+32768,!0),n+=2,s.setUint16(n,1638.4*t.speedY+32768,!0),n+=2,s.setUint8(n,255*t.energy),n+=1,s.setUint16(n,1e6*t.energyRegen+32768,!0),n+=2,e},[l.EVENT_BOUNCE]:t=>{const e=new ArrayBuffer(20),s=new DataView(e);let n=0;s.setUint8(n,t.c),n+=1,s.setUint32(n,t.clock,!0),n+=4,s.setUint16(n,t.id,!0),n+=2,s.setUint8(n,t.keystate),n+=1;{const e=512*t.posX+8388608,i=e%256,o=(e-i)/256;s.setUint16(n,o,!0),n+=2,s.setUint8(n,i),n+=1}{const e=512*t.posY+8388608,i=e%256,o=(e-i)/256;s.setUint16(n,o,!0),n+=2,s.setUint8(n,i),n+=1}return s.setUint16(n,6553.6*t.rot,!0),n+=2,s.setUint16(n,1638.4*t.speedX+32768,!0),n+=2,s.setUint16(n,1638.4*t.speedY+32768,!0),n+=2,e},[l.EVENT_STEALTH]:t=>{const e=new ArrayBuffer(7),s=new DataView(e);let n=0;return s.setUint8(n,t.c),n+=1,s.setUint16(n,t.id,!0),n+=2,s.setUint8(n,!1===t.state?0:1),n+=1,s.setUint8(n,255*t.energy),n+=1,s.setUint16(n,1e6*t.energyRegen+32768,!0),n+=2,e},[l.EVENT_LEAVEHORIZON]:t=>{const e=new ArrayBuffer(4),s=new DataView(e);let n=0;return s.setUint8(n,t.c),n+=1,s.setUint8(n,t.type),n+=1,s.setUint16(n,t.id,!0),n+=2,e},[l.MOB_UPDATE]:t=>{const e=new ArrayBuffer(22),s=new DataView(e);let n=0;return s.setUint8(n,t.c),n+=1,s.setUint32(n,t.clock,!0),n+=4,s.setUint16(n,t.id,!0),n+=2,s.setUint8(n,t.type),n+=1,s.setUint16(n,2*t.posX+32768,!0),n+=2,s.setUint16(n,4*t.posY+32768,!0),n+=2,s.setUint16(n,1638.4*t.speedX+32768,!0),n+=2,s.setUint16(n,1638.4*t.speedY+32768,!0),n+=2,s.setUint16(n,32768*t.accelX+32768,!0),n+=2,s.setUint16(n,32768*t.accelY+32768,!0),n+=2,s.setUint16(n,1638.4*t.maxSpeed+32768,!0),n+=2,e},[l.MOB_UPDATE_STATIONARY]:t=>{const e=new ArrayBuffer(12),s=new DataView(e);let n=0;return s.setUint8(n,t.c),n+=1,s.setUint16(n,t.id,!0),n+=2,s.setUint8(n,t.type),n+=1,s.setFloat32(n,t.posX,!0),n+=4,s.setFloat32(n,t.posY,!0),n+=4,e},[l.MOB_DESPAWN]:t=>{const e=new ArrayBuffer(4),s=new DataView(e);let n=0;return s.setUint8(n,t.c),n+=1,s.setUint16(n,t.id,!0),n+=2,s.setUint8(n,t.type),n+=1,e},[l.MOB_DESPAWN_COORDS]:t=>{const e=new ArrayBuffer(8),s=new DataView(e);let n=0;return s.setUint8(n,t.c),n+=1,s.setUint16(n,t.id,!0),n+=2,s.setUint8(n,t.type),n+=1,s.setUint16(n,2*t.posX+32768,!0),n+=2,s.setUint16(n,4*t.posY+32768,!0),n+=2,e},[l.CHAT_PUBLIC]:t=>{const e=p(t.text),s=new ArrayBuffer(4+e.length),n=new DataView(s);let i=0;n.setUint8(i,t.c),i+=1,n.setUint16(i,t.id,!0),i+=2,n.setUint8(i,e.length),i+=1;for(let t=0;t<e.length;t+=1)n.setUint8(i+t,e[t]);return s},[l.CHAT_TEAM]:t=>{const e=p(t.text),s=new ArrayBuffer(4+e.length),n=new DataView(s);let i=0;n.setUint8(i,t.c),i+=1,n.setUint16(i,t.id,!0),i+=2,n.setUint8(i,e.length),i+=1;for(let t=0;t<e.length;t+=1)n.setUint8(i+t,e[t]);return s},[l.CHAT_SAY]:t=>{const e=p(t.text),s=new ArrayBuffer(4+e.length),n=new DataView(s);let i=0;n.setUint8(i,t.c),i+=1,n.setUint16(i,t.id,!0),i+=2,n.setUint8(i,e.length),i+=1;for(let t=0;t<e.length;t+=1)n.setUint8(i+t,e[t]);return s},[l.CHAT_WHISPER]:t=>{const e=p(t.text),s=new ArrayBuffer(6+e.length),n=new DataView(s);let i=0;n.setUint8(i,t.c),i+=1,n.setUint16(i,t.from,!0),i+=2,n.setUint16(i,t.to,!0),i+=2,n.setUint8(i,e.length),i+=1;for(let t=0;t<e.length;t+=1)n.setUint8(i+t,e[t]);return s},[l.CHAT_VOTEMUTEPASSED]:t=>{const e=new ArrayBuffer(3),s=new DataView(e);let n=0;return s.setUint8(n,t.c),n+=1,s.setUint16(n,t.id,!0),n+=2,e},[l.CHAT_VOTEMUTED]:()=>R,[l.SCORE_UPDATE]:t=>{const e=new ArrayBuffer(21),s=new DataView(e);let n=0;return s.setUint8(n,t.c),n+=1,s.setUint16(n,t.id,!0),n+=2,s.setUint32(n,t.score,!0),n+=4,s.setUint32(n,t.earnings,!0),n+=4,s.setUint16(n,t.upgrades,!0),n+=2,s.setUint32(n,t.totalkills,!0),n+=4,s.setUint32(n,t.totaldeaths,!0),n+=4,e},[l.SCORE_BOARD]:t=>{let e=0;for(let s=0;s<t.data.length;s+=1)e+=7;for(let s=0;s<t.rankings.length;s+=1)e+=4;const s=new ArrayBuffer(5+e),n=new DataView(s);let i=0;n.setUint8(i,t.c),i+=1;{const{data:e}=t;n.setUint16(i,e.length,!0),i+=2;for(let t=0;t<e.length;t+=1)n.setUint16(i,e[t].id,!0),i+=2,n.setUint32(i,e[t].score,!0),i+=4,n.setUint8(i,e[t].level),i+=1}{const{rankings:e}=t;n.setUint16(i,e.length,!0),i+=2;for(let t=0;t<e.length;t+=1)n.setUint16(i,e[t].id,!0),i+=2,n.setUint8(i,e[t].x),i+=1,n.setUint8(i,e[t].y),i+=1}return s},[l.SCORE_DETAILED]:t=>{let e=0;for(let s=0;s<t.scores.length;s+=1)e+=17;const s=new ArrayBuffer(3+e),n=new DataView(s);let i=0;n.setUint8(i,t.c),i+=1;{const{scores:e}=t;n.setUint16(i,e.length,!0),i+=2;for(let t=0;t<e.length;t+=1)n.setUint16(i,e[t].id,!0),i+=2,n.setUint8(i,e[t].level),i+=1,n.setUint32(i,e[t].score,!0),i+=4,n.setUint16(i,e[t].kills,!0),i+=2,n.setUint16(i,e[t].deaths,!0),i+=2,n.setFloat32(i,e[t].damage,!0),i+=4,n.setUint16(i,e[t].ping,!0),i+=2}return s},[l.SCORE_DETAILED_CTF]:t=>{let e=0;for(let s=0;s<t.scores.length;s+=1)e+=19;const s=new ArrayBuffer(3+e),n=new DataView(s);let i=0;n.setUint8(i,t.c),i+=1;{const{scores:e}=t;n.setUint16(i,e.length,!0),i+=2;for(let t=0;t<e.length;t+=1)n.setUint16(i,e[t].id,!0),i+=2,n.setUint8(i,e[t].level),i+=1,n.setUint16(i,e[t].captures,!0),i+=2,n.setUint32(i,e[t].score,!0),i+=4,n.setUint16(i,e[t].kills,!0),i+=2,n.setUint16(i,e[t].deaths,!0),i+=2,n.setFloat32(i,e[t].damage,!0),i+=4,n.setUint16(i,e[t].ping,!0),i+=2}return s},[l.SCORE_DETAILED_BTR]:t=>{let e=0;for(let s=0;s<t.scores.length;s+=1)e+=20;const s=new ArrayBuffer(3+e),n=new DataView(s);let i=0;n.setUint8(i,t.c),i+=1;{const{scores:e}=t;n.setUint16(i,e.length,!0),i+=2;for(let t=0;t<e.length;t+=1)n.setUint16(i,e[t].id,!0),i+=2,n.setUint8(i,e[t].level),i+=1,n.setUint8(i,!1===e[t].alive?0:1),i+=1,n.setUint16(i,e[t].wins,!0),i+=2,n.setUint32(i,e[t].score,!0),i+=4,n.setUint16(i,e[t].kills,!0),i+=2,n.setUint16(i,e[t].deaths,!0),i+=2,n.setFloat32(i,e[t].damage,!0),i+=4,n.setUint16(i,e[t].ping,!0),i+=2}return s},[l.SERVER_MESSAGE]:t=>{const e=p(t.text),s=new ArrayBuffer(8+e.length),n=new DataView(s);let i=0;n.setUint8(i,t.c),i+=1,n.setUint8(i,t.type),i+=1,n.setUint32(i,t.duration,!0),i+=4,n.setUint16(i,e.length,!0),i+=2;for(let t=0;t<e.length;t+=1)n.setUint8(i+t,e[t]);return s},[l.SERVER_CUSTOM]:t=>{const e=p(t.data),s=new ArrayBuffer(4+e.length),n=new DataView(s);let i=0;n.setUint8(i,t.c),i+=1,n.setUint8(i,t.type),i+=1,n.setUint16(i,e.length,!0),i+=2;for(let t=0;t<e.length;t+=1)n.setUint8(i+t,e[t]);return s}};const T=new class{constructor(){this.storage=[]}last(){return this.storage.length>0?this.storage[this.storage.length-1]:null}put(t){this.storage.push(t)}shift(){return this.storage.shift()}flush(){this.storage=[]}},x=(t,e)=>{let s=0;for(let n=0;n<e.length;n+=1){const[i,o,a]=e[n],r=t[i];switch(o){case h.text:case h.textbig:T.put(p(r)),o===h.textbig?s+=2:s+=1,s+=T.last().length;break;case h.array:case h.arraysmall:o===h.array?s+=2:s+=1;for(let t=0;t<r.length;t+=1)s+=x(r[t],a);break;case h.uint8:case h.boolean:case h.healthenergy:s+=1;break;case h.uint16:case h.speed:case h.accel:case h.coordx:case h.coordy:case h.rotation:case h.regen:s+=2;break;case h.uint24:case h.coord24:s+=3;break;case h.uint32:case h.float32:s+=4;break;case h.float64:s+=8}}return s},I=(t,e,s,n)=>{let i=e;1===i&&t.setUint8(0,s.c);for(let e=0;e<n.length;e+=1){const[o,a,r]=n[e],c=s[o];switch(a){case h.text:case h.textbig:{const e=T.shift();a===h.textbig?(t.setUint16(i,e.length,!0),i+=2):(t.setUint8(i,e.length),i+=1);for(let s=0;s<e.length;s+=1)t.setUint8(i+s,e[s]);i+=e.length}break;case h.array:case h.arraysmall:a===h.array?(t.setUint16(i,c.length,!0),i+=2):(t.setUint8(i,c.length),i+=1);for(let e=0;e<c.length;e+=1)i=I(t,i,c[e],r);break;case h.uint8:t.setUint8(i,c),i+=1;break;case h.healthenergy:t.setUint8(i,255*c),i+=1;break;case h.uint16:t.setUint16(i,c,!0),i+=2;break;case h.regen:t.setUint16(i,1e6*c+32768,!0),i+=2;break;case h.rotation:t.setUint16(i,6553.6*c,!0),i+=2;break;case h.coordy:t.setUint16(i,4*c+32768,!0),i+=2;break;case h.coordx:t.setUint16(i,2*c+32768,!0),i+=2;break;case h.accel:t.setUint16(i,32768*c+32768,!0),i+=2;break;case h.speed:t.setUint16(i,1638.4*c+32768,!0),i+=2;break;case h.uint24:{const e=c%256,s=(c-e)/256;t.setUint16(i,s,!0),i+=2,t.setUint8(i,e),i+=1}break;case h.coord24:{const e=512*c+8388608,s=e%256,n=(e-s)/256;t.setUint16(i,n,!0),i+=2,t.setUint8(i,s),i+=1}break;case h.uint32:t.setUint32(i,c,!0),i+=4;break;case h.float32:t.setFloat32(i,c,!0),i+=4;break;case h.float64:t.setFloat64(i,c,!0),i+=8;break;case h.boolean:t.setUint8(i,!1===c?0:1),i+=1}}return i},S=(t,e,s)=>{T.flush();const n=t.c;let i=null,o=null;switch(e){case 1:o=m[n],i=d[n];break;case 0:o=w[n],i=g[n];break;default:return null}if(null===i)return null;let a=null;if(s&&o)a=o(t);else{let e=null,s=0;s=1+x(t,i),a=new ArrayBuffer(s),e=new DataView(a),I(e,1,t,i)}return a},P={c:5},L={c:12};var _={[c.LOGIN]:t=>{const e={c:0},s=new DataView(t);let n=1;e.protocol=s.getUint8(n),n+=1;{const t=s.getUint8(n),i=new Uint8Array(t);n+=1;for(let e=0;e<t;e+=1)i[e]=s.getUint8(n+e);e.name=E(i),n+=t}{const t=s.getUint8(n),i=new Uint8Array(t);n+=1;for(let e=0;e<t;e+=1)i[e]=s.getUint8(n+e);e.session=E(i),n+=t}e.horizonX=s.getUint16(n,!0),n+=2,e.horizonY=s.getUint16(n,!0),n+=2;{const t=s.getUint8(n),i=new Uint8Array(t);n+=1;for(let e=0;e<t;e+=1)i[e]=s.getUint8(n+e);e.flag=E(i),n+=t}return e},[c.BACKUP]:t=>{const e={c:1},s=new DataView(t);let n=1;{const t=s.getUint8(n),i=new Uint8Array(t);n+=1;for(let e=0;e<t;e+=1)i[e]=s.getUint8(n+e);e.token=E(i),n+=t}return e},[c.HORIZON]:t=>{const e={c:2},s=new DataView(t);let n=1;return e.horizonX=s.getUint16(n,!0),n+=2,e.horizonY=s.getUint16(n,!0),n+=2,e},[c.ACK]:()=>P,[c.PONG]:t=>{const e={c:6},s=new DataView(t);let n=1;return e.num=s.getUint32(n,!0),n+=4,e},[c.KEY]:t=>{const e={c:10},s=new DataView(t);let n=1;return e.seq=s.getUint32(n,!0),n+=4,e.key=s.getUint8(n),n+=1,e.state=0!==s.getUint8(n),n+=1,e},[c.COMMAND]:t=>{const e={c:11},s=new DataView(t);let n=1;{const t=s.getUint8(n),i=new Uint8Array(t);n+=1;for(let e=0;e<t;e+=1)i[e]=s.getUint8(n+e);e.com=E(i),n+=t}{const t=s.getUint8(n),i=new Uint8Array(t);n+=1;for(let e=0;e<t;e+=1)i[e]=s.getUint8(n+e);e.data=E(i),n+=t}return e},[c.SCOREDETAILED]:()=>L,[c.CHAT]:t=>{const e={c:20},s=new DataView(t);let n=1;{const t=s.getUint8(n),i=new Uint8Array(t);n+=1;for(let e=0;e<t;e+=1)i[e]=s.getUint8(n+e);e.text=E(i),n+=t}return e},[c.WHISPER]:t=>{const e={c:21},s=new DataView(t);let n=1;e.id=s.getUint16(n,!0),n+=2;{const t=s.getUint8(n),i=new Uint8Array(t);n+=1;for(let e=0;e<t;e+=1)i[e]=s.getUint8(n+e);e.text=E(i),n+=t}return e},[c.SAY]:t=>{const e={c:22},s=new DataView(t);let n=1;{const t=s.getUint8(n),i=new Uint8Array(t);n+=1;for(let e=0;e<t;e+=1)i[e]=s.getUint8(n+e);e.text=E(i),n+=t}return e},[c.TEAMCHAT]:t=>{const e={c:23},s=new DataView(t);let n=1;{const t=s.getUint8(n),i=new Uint8Array(t);n+=1;for(let e=0;e<t;e+=1)i[e]=s.getUint8(n+e);e.text=E(i),n+=t}return e},[c.VOTEMUTE]:t=>{const e={c:24},s=new DataView(t);let n=1;return e.id=s.getUint16(n,!0),n+=2,e},[c.LOCALPING]:t=>{const e={c:255},s=new DataView(t);let n=1;return e.auth=s.getUint32(n,!0),n+=4,e}};const O={c:1},b={c:7},C={c:79};var M={[l.LOGIN]:t=>{const e={c:0},s=new DataView(t);let n=1;e.success=0!==s.getUint8(n),n+=1,e.id=s.getUint16(n,!0),n+=2,e.team=s.getUint16(n,!0),n+=2,e.clock=s.getUint32(n,!0),n+=4;{const t=s.getUint8(n),i=new Uint8Array(t);n+=1;for(let e=0;e<t;e+=1)i[e]=s.getUint8(n+e);e.token=E(i),n+=t}e.type=s.getUint8(n),n+=1;{const t=s.getUint8(n),i=new Uint8Array(t);n+=1;for(let e=0;e<t;e+=1)i[e]=s.getUint8(n+e);e.room=E(i),n+=t}{const t=s.getUint16(n,!0);n+=2,e.players=[];for(let i=0;i<t;i+=1){const t={};t.id=s.getUint16(n,!0),n+=2,t.status=s.getUint8(n),n+=1,t.level=s.getUint8(n),n+=1;{const e=s.getUint8(n),i=new Uint8Array(e);n+=1;for(let t=0;t<e;t+=1)i[t]=s.getUint8(n+t);t.name=E(i),n+=e}t.type=s.getUint8(n),n+=1,t.team=s.getUint16(n,!0),n+=2,t.posX=(s.getUint16(n,!0)-32768)/2,n+=2,t.posY=(s.getUint16(n,!0)-32768)/4,n+=2,t.rot=s.getUint16(n,!0)/6553.6,n+=2,t.flag=s.getUint16(n,!0),n+=2,t.upgrades=s.getUint8(n),n+=1,e.players.push(t)}}{const t=s.getUint16(n,!0),i=new Uint8Array(t);n+=2;for(let e=0;e<t;e+=1)i[e]=s.getUint8(n+e);e.serverConfiguration=E(i),n+=t}{const t=s.getUint16(n,!0);n+=2,e.bots=[];for(let i=0;i<t;i+=1){const t={};t.id=s.getUint16(n,!0),n+=2,e.bots.push(t)}}return e},[l.BACKUP]:()=>O,[l.PING]:t=>{const e={c:5},s=new DataView(t);let n=1;return e.clock=s.getUint32(n,!0),n+=4,e.num=s.getUint32(n,!0),n+=4,e},[l.PING_RESULT]:t=>{const e={c:6},s=new DataView(t);let n=1;return e.ping=s.getUint16(n,!0),n+=2,e.playerstotal=s.getUint32(n,!0),n+=4,e.playersgame=s.getUint32(n,!0),n+=4,e},[l.ACK]:()=>b,[l.ERROR]:t=>{const e={c:8},s=new DataView(t);let n=1;return e.error=s.getUint8(n),n+=1,e},[l.COMMAND_REPLY]:t=>{const e={c:9},s=new DataView(t);let n=1;e.type=s.getUint8(n),n+=1;{const t=s.getUint16(n,!0),i=new Uint8Array(t);n+=2;for(let e=0;e<t;e+=1)i[e]=s.getUint8(n+e);e.text=E(i),n+=t}return e},[l.PLAYER_NEW]:t=>{const e={c:10},s=new DataView(t);let n=1;e.id=s.getUint16(n,!0),n+=2,e.status=s.getUint8(n),n+=1;{const t=s.getUint8(n),i=new Uint8Array(t);n+=1;for(let e=0;e<t;e+=1)i[e]=s.getUint8(n+e);e.name=E(i),n+=t}return e.type=s.getUint8(n),n+=1,e.team=s.getUint16(n,!0),n+=2,e.posX=(s.getUint16(n,!0)-32768)/2,n+=2,e.posY=(s.getUint16(n,!0)-32768)/4,n+=2,e.rot=s.getUint16(n,!0)/6553.6,n+=2,e.flag=s.getUint16(n,!0),n+=2,e.upgrades=s.getUint8(n),n+=1,e.isBot=0!==s.getUint8(n),n+=1,e},[l.PLAYER_LEAVE]:t=>{const e={c:11},s=new DataView(t);let n=1;return e.id=s.getUint16(n,!0),n+=2,e},[l.PLAYER_UPDATE]:t=>{const e={c:12},s=new DataView(t);let n=1;e.clock=s.getUint32(n,!0),n+=4,e.id=s.getUint16(n,!0),n+=2,e.keystate=s.getUint8(n),n+=1,e.upgrades=s.getUint8(n),n+=1;{const t=256*s.getUint16(n,!0);n+=2,e.posX=(t+s.getUint8(n)-8388608)/512,n+=1}{const t=256*s.getUint16(n,!0);n+=2,e.posY=(t+s.getUint8(n)-8388608)/512,n+=1}return e.rot=s.getUint16(n,!0)/6553.6,n+=2,e.speedX=(s.getUint16(n,!0)-32768)/1638.4,n+=2,e.speedY=(s.getUint16(n,!0)-32768)/1638.4,n+=2,e},[l.PLAYER_FIRE]:t=>{const e={c:13},s=new DataView(t);let n=1;e.clock=s.getUint32(n,!0),n+=4,e.id=s.getUint16(n,!0),n+=2,e.energy=s.getUint8(n)/255,n+=1,e.energyRegen=(s.getUint16(n,!0)-32768)/1e6,n+=2;{const t=s.getUint8(n);n+=1,e.projectiles=[];for(let i=0;i<t;i+=1){const t={};t.id=s.getUint16(n,!0),n+=2,t.type=s.getUint8(n),n+=1,t.posX=(s.getUint16(n,!0)-32768)/2,n+=2,t.posY=(s.getUint16(n,!0)-32768)/4,n+=2,t.speedX=(s.getUint16(n,!0)-32768)/1638.4,n+=2,t.speedY=(s.getUint16(n,!0)-32768)/1638.4,n+=2,t.accelX=(s.getUint16(n,!0)-32768)/32768,n+=2,t.accelY=(s.getUint16(n,!0)-32768)/32768,n+=2,t.maxSpeed=(s.getUint16(n,!0)-32768)/1638.4,n+=2,e.projectiles.push(t)}}return e},[l.PLAYER_HIT]:t=>{const e={c:14},s=new DataView(t);let n=1;e.id=s.getUint16(n,!0),n+=2,e.type=s.getUint8(n),n+=1,e.posX=(s.getUint16(n,!0)-32768)/2,n+=2,e.posY=(s.getUint16(n,!0)-32768)/4,n+=2,e.owner=s.getUint16(n,!0),n+=2;{const t=s.getUint8(n);n+=1,e.players=[];for(let i=0;i<t;i+=1){const t={};t.id=s.getUint16(n,!0),n+=2,t.health=s.getUint8(n)/255,n+=1,t.healthRegen=(s.getUint16(n,!0)-32768)/1e6,n+=2,e.players.push(t)}}return e},[l.PLAYER_RESPAWN]:t=>{const e={c:15},s=new DataView(t);let n=1;e.id=s.getUint16(n,!0),n+=2;{const t=256*s.getUint16(n,!0);n+=2,e.posX=(t+s.getUint8(n)-8388608)/512,n+=1}{const t=256*s.getUint16(n,!0);n+=2,e.posY=(t+s.getUint8(n)-8388608)/512,n+=1}return e.rot=s.getUint16(n,!0)/6553.6,n+=2,e.upgrades=s.getUint8(n),n+=1,e},[l.PLAYER_FLAG]:t=>{const e={c:16},s=new DataView(t);let n=1;return e.id=s.getUint16(n,!0),n+=2,e.flag=s.getUint16(n,!0),n+=2,e},[l.PLAYER_KILL]:t=>{const e={c:17},s=new DataView(t);let n=1;return e.id=s.getUint16(n,!0),n+=2,e.killer=s.getUint16(n,!0),n+=2,e.posX=(s.getUint16(n,!0)-32768)/2,n+=2,e.posY=(s.getUint16(n,!0)-32768)/4,n+=2,e},[l.PLAYER_UPGRADE]:t=>{const e={c:18},s=new DataView(t);let n=1;return e.upgrades=s.getUint16(n,!0),n+=2,e.type=s.getUint8(n),n+=1,e.speed=s.getUint8(n),n+=1,e.defense=s.getUint8(n),n+=1,e.energy=s.getUint8(n),n+=1,e.missile=s.getUint8(n),n+=1,e},[l.PLAYER_TYPE]:t=>{const e={c:19},s=new DataView(t);let n=1;return e.id=s.getUint16(n,!0),n+=2,e.type=s.getUint8(n),n+=1,e},[l.PLAYER_POWERUP]:t=>{const e={c:20},s=new DataView(t);let n=1;return e.type=s.getUint8(n),n+=1,e.duration=s.getUint32(n,!0),n+=4,e},[l.PLAYER_LEVEL]:t=>{const e={c:21},s=new DataView(t);let n=1;return e.id=s.getUint16(n,!0),n+=2,e.type=s.getUint8(n),n+=1,e.level=s.getUint8(n),n+=1,e},[l.PLAYER_RETEAM]:t=>{const e={c:22},s=new DataView(t);let n=1;{const t=s.getUint16(n,!0);n+=2,e.players=[];for(let i=0;i<t;i+=1){const t={};t.id=s.getUint16(n,!0),n+=2,t.team=s.getUint16(n,!0),n+=2,e.players.push(t)}}return e},[l.GAME_FLAG]:t=>{const e={c:30},s=new DataView(t);let n=1;e.type=s.getUint8(n),n+=1,e.flag=s.getUint8(n),n+=1,e.id=s.getUint16(n,!0),n+=2;{const t=256*s.getUint16(n,!0);n+=2,e.posX=(t+s.getUint8(n)-8388608)/512,n+=1}{const t=256*s.getUint16(n,!0);n+=2,e.posY=(t+s.getUint8(n)-8388608)/512,n+=1}return e.blueteam=s.getUint8(n),n+=1,e.redteam=s.getUint8(n),n+=1,e},[l.GAME_SPECTATE]:t=>{const e={c:31},s=new DataView(t);let n=1;return e.id=s.getUint16(n,!0),n+=2,e},[l.GAME_PLAYERSALIVE]:t=>{const e={c:32},s=new DataView(t);let n=1;return e.players=s.getUint16(n,!0),n+=2,e},[l.GAME_FIREWALL]:t=>{const e={c:33},s=new DataView(t);let n=1;return e.type=s.getUint8(n),n+=1,e.status=s.getUint8(n),n+=1,e.posX=(s.getUint16(n,!0)-32768)/2,n+=2,e.posY=(s.getUint16(n,!0)-32768)/4,n+=2,e.radius=s.getFloat32(n,!0),n+=4,e.speed=s.getFloat32(n,!0),n+=4,e},[l.EVENT_REPEL]:t=>{const e={c:40},s=new DataView(t);let n=1;e.clock=s.getUint32(n,!0),n+=4,e.id=s.getUint16(n,!0),n+=2,e.posX=(s.getUint16(n,!0)-32768)/2,n+=2,e.posY=(s.getUint16(n,!0)-32768)/4,n+=2,e.rot=s.getUint16(n,!0)/6553.6,n+=2,e.speedX=(s.getUint16(n,!0)-32768)/1638.4,n+=2,e.speedY=(s.getUint16(n,!0)-32768)/1638.4,n+=2,e.energy=s.getUint8(n)/255,n+=1,e.energyRegen=(s.getUint16(n,!0)-32768)/1e6,n+=2;{const t=s.getUint8(n);n+=1,e.players=[];for(let i=0;i<t;i+=1){const t={};t.id=s.getUint16(n,!0),n+=2,t.keystate=s.getUint8(n),n+=1,t.posX=(s.getUint16(n,!0)-32768)/2,n+=2,t.posY=(s.getUint16(n,!0)-32768)/4,n+=2,t.rot=s.getUint16(n,!0)/6553.6,n+=2,t.speedX=(s.getUint16(n,!0)-32768)/1638.4,n+=2,t.speedY=(s.getUint16(n,!0)-32768)/1638.4,n+=2,t.energy=s.getUint8(n)/255,n+=1,t.energyRegen=(s.getUint16(n,!0)-32768)/1e6,n+=2,t.playerHealth=s.getUint8(n)/255,n+=1,t.playerHealthRegen=(s.getUint16(n,!0)-32768)/1e6,n+=2,e.players.push(t)}}{const t=s.getUint8(n);n+=1,e.mobs=[];for(let i=0;i<t;i+=1){const t={};t.id=s.getUint16(n,!0),n+=2,t.type=s.getUint8(n),n+=1,t.posX=(s.getUint16(n,!0)-32768)/2,n+=2,t.posY=(s.getUint16(n,!0)-32768)/4,n+=2,t.speedX=(s.getUint16(n,!0)-32768)/1638.4,n+=2,t.speedY=(s.getUint16(n,!0)-32768)/1638.4,n+=2,t.accelX=(s.getUint16(n,!0)-32768)/32768,n+=2,t.accelY=(s.getUint16(n,!0)-32768)/32768,n+=2,t.maxSpeed=(s.getUint16(n,!0)-32768)/1638.4,n+=2,e.mobs.push(t)}}return e},[l.EVENT_BOOST]:t=>{const e={c:41},s=new DataView(t);let n=1;e.clock=s.getUint32(n,!0),n+=4,e.id=s.getUint16(n,!0),n+=2,e.boost=0!==s.getUint8(n),n+=1;{const t=256*s.getUint16(n,!0);n+=2,e.posX=(t+s.getUint8(n)-8388608)/512,n+=1}{const t=256*s.getUint16(n,!0);n+=2,e.posY=(t+s.getUint8(n)-8388608)/512,n+=1}return e.rot=s.getUint16(n,!0)/6553.6,n+=2,e.speedX=(s.getUint16(n,!0)-32768)/1638.4,n+=2,e.speedY=(s.getUint16(n,!0)-32768)/1638.4,n+=2,e.energy=s.getUint8(n)/255,n+=1,e.energyRegen=(s.getUint16(n,!0)-32768)/1e6,n+=2,e},[l.EVENT_BOUNCE]:t=>{const e={c:42},s=new DataView(t);let n=1;e.clock=s.getUint32(n,!0),n+=4,e.id=s.getUint16(n,!0),n+=2,e.keystate=s.getUint8(n),n+=1;{const t=256*s.getUint16(n,!0);n+=2,e.posX=(t+s.getUint8(n)-8388608)/512,n+=1}{const t=256*s.getUint16(n,!0);n+=2,e.posY=(t+s.getUint8(n)-8388608)/512,n+=1}return e.rot=s.getUint16(n,!0)/6553.6,n+=2,e.speedX=(s.getUint16(n,!0)-32768)/1638.4,n+=2,e.speedY=(s.getUint16(n,!0)-32768)/1638.4,n+=2,e},[l.EVENT_STEALTH]:t=>{const e={c:43},s=new DataView(t);let n=1;return e.id=s.getUint16(n,!0),n+=2,e.state=0!==s.getUint8(n),n+=1,e.energy=s.getUint8(n)/255,n+=1,e.energyRegen=(s.getUint16(n,!0)-32768)/1e6,n+=2,e},[l.EVENT_LEAVEHORIZON]:t=>{const e={c:44},s=new DataView(t);let n=1;return e.type=s.getUint8(n),n+=1,e.id=s.getUint16(n,!0),n+=2,e},[l.MOB_UPDATE]:t=>{const e={c:60},s=new DataView(t);let n=1;return e.clock=s.getUint32(n,!0),n+=4,e.id=s.getUint16(n,!0),n+=2,e.type=s.getUint8(n),n+=1,e.posX=(s.getUint16(n,!0)-32768)/2,n+=2,e.posY=(s.getUint16(n,!0)-32768)/4,n+=2,e.speedX=(s.getUint16(n,!0)-32768)/1638.4,n+=2,e.speedY=(s.getUint16(n,!0)-32768)/1638.4,n+=2,e.accelX=(s.getUint16(n,!0)-32768)/32768,n+=2,e.accelY=(s.getUint16(n,!0)-32768)/32768,n+=2,e.maxSpeed=(s.getUint16(n,!0)-32768)/1638.4,n+=2,e},[l.MOB_UPDATE_STATIONARY]:t=>{const e={c:61},s=new DataView(t);let n=1;return e.id=s.getUint16(n,!0),n+=2,e.type=s.getUint8(n),n+=1,e.posX=s.getFloat32(n,!0),n+=4,e.posY=s.getFloat32(n,!0),n+=4,e},[l.MOB_DESPAWN]:t=>{const e={c:62},s=new DataView(t);let n=1;return e.id=s.getUint16(n,!0),n+=2,e.type=s.getUint8(n),n+=1,e},[l.MOB_DESPAWN_COORDS]:t=>{const e={c:63},s=new DataView(t);let n=1;return e.id=s.getUint16(n,!0),n+=2,e.type=s.getUint8(n),n+=1,e.posX=(s.getUint16(n,!0)-32768)/2,n+=2,e.posY=(s.getUint16(n,!0)-32768)/4,n+=2,e},[l.CHAT_PUBLIC]:t=>{const e={c:70},s=new DataView(t);let n=1;e.id=s.getUint16(n,!0),n+=2;{const t=s.getUint8(n),i=new Uint8Array(t);n+=1;for(let e=0;e<t;e+=1)i[e]=s.getUint8(n+e);e.text=E(i),n+=t}return e},[l.CHAT_TEAM]:t=>{const e={c:71},s=new DataView(t);let n=1;e.id=s.getUint16(n,!0),n+=2;{const t=s.getUint8(n),i=new Uint8Array(t);n+=1;for(let e=0;e<t;e+=1)i[e]=s.getUint8(n+e);e.text=E(i),n+=t}return e},[l.CHAT_SAY]:t=>{const e={c:72},s=new DataView(t);let n=1;e.id=s.getUint16(n,!0),n+=2;{const t=s.getUint8(n),i=new Uint8Array(t);n+=1;for(let e=0;e<t;e+=1)i[e]=s.getUint8(n+e);e.text=E(i),n+=t}return e},[l.CHAT_WHISPER]:t=>{const e={c:73},s=new DataView(t);let n=1;e.from=s.getUint16(n,!0),n+=2,e.to=s.getUint16(n,!0),n+=2;{const t=s.getUint8(n),i=new Uint8Array(t);n+=1;for(let e=0;e<t;e+=1)i[e]=s.getUint8(n+e);e.text=E(i),n+=t}return e},[l.CHAT_VOTEMUTEPASSED]:t=>{const e={c:78},s=new DataView(t);let n=1;return e.id=s.getUint16(n,!0),n+=2,e},[l.CHAT_VOTEMUTED]:()=>C,[l.SCORE_UPDATE]:t=>{const e={c:80},s=new DataView(t);let n=1;return e.id=s.getUint16(n,!0),n+=2,e.score=s.getUint32(n,!0),n+=4,e.earnings=s.getUint32(n,!0),n+=4,e.upgrades=s.getUint16(n,!0),n+=2,e.totalkills=s.getUint32(n,!0),n+=4,e.totaldeaths=s.getUint32(n,!0),n+=4,e},[l.SCORE_BOARD]:t=>{const e={c:81},s=new DataView(t);let n=1;{const t=s.getUint16(n,!0);n+=2,e.data=[];for(let i=0;i<t;i+=1){const t={};t.id=s.getUint16(n,!0),n+=2,t.score=s.getUint32(n,!0),n+=4,t.level=s.getUint8(n),n+=1,e.data.push(t)}}{const t=s.getUint16(n,!0);n+=2,e.rankings=[];for(let i=0;i<t;i+=1){const t={};t.id=s.getUint16(n,!0),n+=2,t.x=s.getUint8(n),n+=1,t.y=s.getUint8(n),n+=1,e.rankings.push(t)}}return e},[l.SCORE_DETAILED]:t=>{const e={c:82},s=new DataView(t);let n=1;{const t=s.getUint16(n,!0);n+=2,e.scores=[];for(let i=0;i<t;i+=1){const t={};t.id=s.getUint16(n,!0),n+=2,t.level=s.getUint8(n),n+=1,t.score=s.getUint32(n,!0),n+=4,t.kills=s.getUint16(n,!0),n+=2,t.deaths=s.getUint16(n,!0),n+=2,t.damage=s.getFloat32(n,!0),n+=4,t.ping=s.getUint16(n,!0),n+=2,e.scores.push(t)}}return e},[l.SCORE_DETAILED_CTF]:t=>{const e={c:83},s=new DataView(t);let n=1;{const t=s.getUint16(n,!0);n+=2,e.scores=[];for(let i=0;i<t;i+=1){const t={};t.id=s.getUint16(n,!0),n+=2,t.level=s.getUint8(n),n+=1,t.captures=s.getUint16(n,!0),n+=2,t.score=s.getUint32(n,!0),n+=4,t.kills=s.getUint16(n,!0),n+=2,t.deaths=s.getUint16(n,!0),n+=2,t.damage=s.getFloat32(n,!0),n+=4,t.ping=s.getUint16(n,!0),n+=2,e.scores.push(t)}}return e},[l.SCORE_DETAILED_BTR]:t=>{const e={c:84},s=new DataView(t);let n=1;{const t=s.getUint16(n,!0);n+=2,e.scores=[];for(let i=0;i<t;i+=1){const t={};t.id=s.getUint16(n,!0),n+=2,t.level=s.getUint8(n),n+=1,t.alive=0!==s.getUint8(n),n+=1,t.wins=s.getUint16(n,!0),n+=2,t.score=s.getUint32(n,!0),n+=4,t.kills=s.getUint16(n,!0),n+=2,t.deaths=s.getUint16(n,!0),n+=2,t.damage=s.getFloat32(n,!0),n+=4,t.ping=s.getUint16(n,!0),n+=2,e.scores.push(t)}}return e},[l.SERVER_MESSAGE]:t=>{const e={c:90},s=new DataView(t);let n=1;e.type=s.getUint8(n),n+=1,e.duration=s.getUint32(n,!0),n+=4;{const t=s.getUint16(n,!0),i=new Uint8Array(t);n+=2;for(let e=0;e<t;e+=1)i[e]=s.getUint8(n+e);e.text=E(i),n+=t}return e},[l.SERVER_CUSTOM]:t=>{const e={c:91},s=new DataView(t);let n=1;e.type=s.getUint8(n),n+=1;{const t=s.getUint16(n,!0),i=new Uint8Array(t);n+=2;for(let e=0;e<t;e+=1)i[e]=s.getUint8(n+e);e.data=E(i),n+=t}return e}};const N=(t,e,s)=>{const n=new DataView(t),i=n.getUint8(0);let o=null,a=null,r=null;switch(e){case 1:o=_[i],r=d[i];break;case 0:o=M[i],r=g[i];break;default:return null}if(s&&o)a=o(t);else{if(null===r)return null;a=((t,e=0,s)=>{const n={};let i=e;0===i&&(n.c=t.getUint8(0),i+=1);for(let e=0;e<s.length;e+=1){const[o,a,r]=s[e];switch(a){case h.text:case h.textbig:{let e=0;a===h.text?(e=t.getUint8(i),i+=1):(e=t.getUint16(i,!0),i+=2);const s=new Uint8Array(e);for(let n=0;n<e;n+=1)s[n]=t.getUint8(i+n);n[o]=E(s),i+=e}break;case h.array:case h.arraysmall:{let e=0;a===h.arraysmall?(e=t.getUint8(i),i+=1):(e=t.getUint16(i,!0),i+=2),n[o]=[];for(let s=0;s<e;s+=1){const e={};for(let s=0;s<r.length;s+=1){const[n,o]=r[s];switch(o){case h.text:case h.textbig:{let s=0;o===h.text?(s=t.getUint8(i),i+=1):(s=t.getUint16(i,!0),i+=2);const a=new Uint8Array(s);for(let e=0;e<s;e+=1)a[e]=t.getUint8(i+e);e[n]=E(a),i+=s}break;case h.uint8:e[n]=t.getUint8(i),i+=1;break;case h.uint16:e[n]=t.getUint16(i,!0),i+=2;break;case h.uint24:{const s=256*t.getUint16(i,!0);i+=2,e[n]=s+t.getUint8(i),i+=1}break;case h.uint32:e[n]=t.getUint32(i,!0),i+=4;break;case h.float32:e[n]=t.getFloat32(i,!0),i+=4;break;case h.float64:e[n]=t.getFloat64(i,!0),i+=8;break;case h.boolean:e[n]=0!==t.getUint8(i),i+=1;break;case h.speed:e[n]=(t.getUint16(i,!0)-32768)/1638.4,i+=2;break;case h.accel:e[n]=(t.getUint16(i,!0)-32768)/32768,i+=2;break;case h.coordx:e[n]=(t.getUint16(i,!0)-32768)/2,i+=2;break;case h.coordy:e[n]=(t.getUint16(i,!0)-32768)/4,i+=2;break;case h.coord24:{const s=256*t.getUint16(i,!0);i+=2,e[n]=(s+t.getUint8(i)-8388608)/512,i+=1}break;case h.rotation:e[n]=t.getUint16(i,!0)/6553.6,i+=2;break;case h.regen:e[n]=(t.getUint16(i,!0)-32768)/1e6,i+=2;break;case h.healthenergy:e[n]=t.getUint8(i)/255,i+=1;break;default:throw Error()}}n[o].push(e)}}break;case h.uint8:n[o]=t.getUint8(i),i+=1;break;case h.uint16:n[o]=t.getUint16(i,!0),i+=2;break;case h.uint24:{const e=256*t.getUint16(i,!0);i+=2,n[o]=e+t.getUint8(i),i+=1}break;case h.uint32:n[o]=t.getUint32(i,!0),i+=4;break;case h.float32:n[o]=t.getFloat32(i,!0),i+=4;break;case h.float64:n[o]=t.getFloat64(i,!0),i+=8;break;case h.boolean:n[o]=0!==t.getUint8(i),i+=1;break;case h.speed:n[o]=(t.getUint16(i,!0)-32768)/1638.4,i+=2;break;case h.accel:n[o]=(t.getUint16(i,!0)-32768)/32768,i+=2;break;case h.coordx:n[o]=(t.getUint16(i,!0)-32768)/2,i+=2;break;case h.coordy:n[o]=(t.getUint16(i,!0)-32768)/4,i+=2;break;case h.coord24:{const e=256*t.getUint16(i,!0);i+=2,n[o]=(e+t.getUint8(i)-8388608)/512,i+=1}break;case h.rotation:n[o]=t.getUint16(i,!0)/6553.6,i+=2;break;case h.regen:n[o]=(t.getUint16(i,!0)-32768)/1e6,i+=2;break;case h.healthenergy:n[o]=t.getUint8(i)/255,i+=1;break;default:return null}}return n})(n,0,r)}return a};let k;var D;(D=k||(k={}))[D.UP=1]="UP",D[D.DOWN=2]="DOWN",D[D.LEFT=3]="LEFT",D[D.RIGHT=4]="RIGHT",D[D.FIRE=5]="FIRE",D[D.SPECIAL=6]="SPECIAL";Object.assign({},...Object.entries(k).map((([t,e])=>({[e]:t}))));let v;var B;let Y;var F;let V;var H;let G;var X;let K;var W;let z;var Q;let j;var q;let J;var $;let Z;var tt;let et;var st;let nt;var it;let ot;var at;let rt;var ct;let lt;var ht;let ut;var dt;let gt;var pt;let Et;var yt;let ft;var mt;let At;var Ut;(B=v||(v={}))[B.PACKET_FLOODING_DISCONNECT=1]="PACKET_FLOODING_DISCONNECT",B[B.PACKET_FLOODING_BAN=2]="PACKET_FLOODING_BAN",B[B.GLOBAL_BAN=3]="GLOBAL_BAN",B[B.UNKNOWN_ERROR=4]="UNKNOWN_ERROR",B[B.REQUIRED_INACTIVITY_AND_HEALTH_TO_RESPAWN=5]="REQUIRED_INACTIVITY_AND_HEALTH_TO_RESPAWN",B[B.AFK_DISCONNECT=6]="AFK_DISCONNECT",B[B.PLAYER_KICKED=7]="PLAYER_KICKED",B[B.INVALID_LOGIN_DATA=8]="INVALID_LOGIN_DATA",B[B.INCORRECT_PROTOCOL=9]="INCORRECT_PROTOCOL",B[B.ACCOUNT_BANNED=10]="ACCOUNT_BANNED",B[B.ALREADY_LOGGED_IN=11]="ALREADY_LOGGED_IN",B[B.FORBIDDEN_TO_CHANGE_PLANE_IN_BTR=12]="FORBIDDEN_TO_CHANGE_PLANE_IN_BTR",B[B.REQUIRED_INACTIVITY_AND_HEALTH_TO_SPECTATE=13]="REQUIRED_INACTIVITY_AND_HEALTH_TO_SPECTATE",B[B.NOT_ENOUGH_UPGRADES=20]="NOT_ENOUGH_UPGRADES",B[B.CHAT_SPAMMING=30]="CHAT_SPAMMING",B[B.FLAG_CHANGE_TOO_FAST=31]="FLAG_CHANGE_TOO_FAST",B[B.UNKNOWN_COMMAND=100]="UNKNOWN_COMMAND",(F=Y||(Y={}))[F.ALERT=1]="ALERT",F[F.INFO=2]="INFO",(H=V||(V={}))[H.CHAT=0]="CHAT",H[H.DEBUG=1]="DEBUG",(X=G||(G={}))[X.PLAYER=0]="PLAYER",X[X.MOB=1]="MOB",(W=K||(K={}))[W.PLAYER=0]="PLAYER",W[W.PREDATOR_MISSILE=1]="PREDATOR_MISSILE",W[W.GOLIATH_MISSILE=2]="GOLIATH_MISSILE",W[W.COPTER_MISSILE=3]="COPTER_MISSILE",W[W.TORNADO_MISSILE=5]="TORNADO_MISSILE",W[W.TORNADO_SMALL_MISSILE=6]="TORNADO_SMALL_MISSILE",W[W.PROWLER_MISSILE=7]="PROWLER_MISSILE",W[W.UPGRADE=4]="UPGRADE",W[W.SHIELD=8]="SHIELD",W[W.INFERNO=9]="INFERNO",W[W.FIREWALL=200]="FIREWALL",(Q=z||(z={}))[Q.EXPIRED=0]="EXPIRED",Q[Q.PICKUP=1]="PICKUP",(q=j||(j={}))[q.INFORM=0]="INFORM",q[q.LEVELUP=1]="LEVELUP",($=J||(J={}))[$.ALIVE=0]="ALIVE",$[$.INACTIVE=1]="INACTIVE",(tt=Z||(Z={}))[tt.LOST=0]="LOST",tt[tt.SPEED=1]="SPEED",tt[tt.DEFENSE=2]="DEFENSE",tt[tt.ENERGY=3]="ENERGY",tt[tt.MISSILE=4]="MISSILE",(st=et||(et={}))[st.BTR=1]="BTR",st[st.CTF=2]="CTF",(it=nt||(nt={}))[it.SHIELD=1]="SHIELD",it[it.INFERNO=2]="INFERNO",(at=ot||(ot={}))[at.BLUE=1]="BLUE",at[at.RED=2]="RED",(ct=rt||(rt={}))[ct.STATIC=1]="STATIC",ct[ct.DYNAMIC=2]="DYNAMIC",(ht=lt||(lt={}))[ht.BASE=100]="BASE",ht[ht.INCREMENT=100]="INCREMENT",ht[ht.MAX=1e3]="MAX",(dt=ut||(ut={}))[dt.INACTIVE=0]="INACTIVE",dt[dt.ACTIVE=1]="ACTIVE",(pt=gt||(gt={}))[pt.BASE=100]="BASE",pt[pt.INCREMENT=100]="INCREMENT",pt[pt.MAX=1e3]="MAX",(yt=Et||(Et={}))[yt.BASE=500]="BASE",yt[yt.INCREMENT=500]="INCREMENT",yt[yt.MAX=5e3]="MAX",(mt=ft||(ft={}))[mt.FFA=1]="FFA",mt[mt.CTF=2]="CTF",mt[mt.BTR=3]="BTR",(Ut=At||(At={}))[Ut.LOGIN=1]="LOGIN",Ut[Ut.CONNECTING=2]="CONNECTING",Ut[Ut.PLAYING=3]="PLAYING";Object.assign({},...Object.entries(At).map((([t,e])=>({[e]:t}))));const Rt={WIDTH:32768,HEIGHT:16384},wt={1:"SY",2:"TH",3:"TM",4:"TN",5:"TR",6:"TT",7:"TW",8:"TZ",9:"UA",10:"UN",11:"US",12:"UY",13:"UZ",14:"VE",15:"VN",16:"PR",17:"PT",18:"PY",19:"QA",20:"RAINBOW",21:"RO",22:"RS",23:"RU",24:"SA",25:"SE",26:"SG",27:"SI",28:"SK",29:"SM",30:"MK",31:"MO",32:"MT",33:"MX",34:"MY",35:"NG",36:"NL",37:"NO",38:"NP",39:"NZ",40:"OM",41:"PA",42:"PE",43:"JP",44:"KP",45:"KR",46:"KW",47:"KZ",48:"LB",49:"LI",50:"LK",51:"LT",52:"LU",53:"LV",54:"HN",55:"HR",56:"HU",57:"ID",58:"IE",59:"IL",60:"IM",61:"IMPERIAL",62:"IN",63:"IQ",64:"DE",65:"DK",66:"DO",67:"DZ",68:"EC",69:"EE",70:"EG",71:"ES",72:"EU",73:"BH",74:"BO",75:"BR",76:"BT",77:"BY",78:"CA",79:"CH",80:"AD",81:"AE",82:"AL",83:"AM",84:"CL",85:"AQ",86:"CN",87:"AR",88:"FI",89:"CO",90:"AT",91:"IR",92:"FR",93:"COMMUNIST",94:"AU",95:"LY",96:"IS",97:"GB",98:"CONFEDERATE",99:"AZ",100:"MA",101:"IT",102:"GE",103:"CR",104:"BA",105:"PH",106:"MC",107:"JM",108:"GR",109:"CU",110:"BD",111:"SO",112:"PK",113:"MD",114:"JO",115:"GT",116:"CY",117:"BE",118:"ZA",119:"SV",120:"PL",121:"ME",122:"JOLLY",123:"HK",124:"CZ",125:"BG"},Tt=(Object.assign({},...Object.entries(wt).map((([t,e])=>({[e]:~~t})))),{AL:"Albania",DZ:"Algeria",AD:"Andorra",AQ:"Antarctica",AR:"Argentina",AM:"Armenia",AU:"Australia",AT:"Austria",AZ:"Azerbaijan",BH:"Bahrain",BD:"Bangladesh",BY:"Belarus",BE:"Belgium",BT:"Bhutan",BO:"Bolivia",BA:"Bosnia and Herzegovina",BR:"Brazil",BG:"Bulgaria",CA:"Canada",CL:"Chile",CN:"China",CO:"Colombia",COMMUNIST:"Communist",CONFEDERATE:"Confederate",CR:"CostaRica",HR:"Croatia",CU:"Cuba",CY:"Cyprus",CZ:"Czech Republic",DK:"Denmark",DO:"Dominican Republic",KP:"DPRK",EC:"Ecuador",EG:"Egypt",SV:"ElSalvador",EE:"Estonia",EU:"European Union",FI:"Finland",FR:"France",GE:"Georgia",DE:"Germany",GR:"Greece",GT:"Guatemala",HN:"Honduras",HK:"HongKong",HU:"Hungary",IS:"Iceland",IMPERIAL:"Imperial Japan",IN:"India",ID:"Indonesia",IR:"Iran",IQ:"Iraq",IE:"Ireland",IM:"Isle of Man",IL:"Israel",IT:"Italy",JM:"Jamaica",JP:"Japan",JOLLY:"Jolly Rogers",JO:"Jordan",KZ:"Kazakhstan",KW:"Kuwait",LV:"Latvia",LB:"Lebanon",LY:"Libyan Arab Jamahiriya",LI:"Liechtenstein",LT:"Lithuania",LU:"Luxembourg",MO:"Macao",MK:"Macedonia",MY:"Malaysia",MT:"Malta",MX:"Mexico",MD:"Moldova",MC:"Monaco",ME:"Montenegro",MA:"Morocco",NP:"Nepal",NL:"Netherlands",NZ:"New Zealand",NG:"Nigeria",NO:"Norway",OM:"Oman",PK:"Pakistan",PA:"Panama",PY:"Paraguay",PE:"Peru",PH:"Philippines",PL:"Poland",PT:"Portugal",PR:"PuertoRico",QA:"Qatar",RAINBOW:"Rainbow",RO:"Romania",RU:"Russian Federation",SM:"SanMarino",SA:"Saudi Arabia",RS:"Serbia",SG:"Singapore",SK:"Slovakia",SI:"Slovenia",SO:"Somalia",ZA:"South Africa",KR:"South Korea",ES:"Spain",LK:"Sri Lanka",SE:"Sweden",CH:"Switzerland",SY:"Syrian Arab Republic",TW:"Taiwan",TZ:"Tanzania",TH:"Thailand",TT:"Trinidad and Tobago",TN:"Tunisia",TR:"Turkey",TM:"Turkmenistan",UA:"Ukraine",AE:"United Arab Emirates",GB:"United Kingdom",UN:"United Nations",US:"United States",UY:"Uruguay",UZ:"Uzbekistan",VE:"Venezuela",VN:"Vietnam"}),xt=t=>({speed:7&t,shield:(8&t)>>3,inferno:(16&t)>>4}),It=t=>({keystate:{UP:1==(1&t),DOWN:2==(2&t),LEFT:4==(4&t),RIGHT:8==(8&t)},boost:16==(16&t),strafe:32==(32&t),stealthed:64==(64&t),flagspeed:128==(128&t)});class St{static performanceNow=()=>performance.now();constructor(t=null){this.timeoutMs=t,this.start()}start(){this.startTime=St.performanceNow()}get elapsedMs(){return St.performanceNow()-this.startTime}get elapsedSeconds(){return this.elapsedMs/1e3}get elapsedMinutes(){return this.elapsedSeconds/60}get hasTimedOut(){return!!this.timeoutMs&&this.elapsedMs>this.timeoutMs}get timeoutFraction(){return this.timeoutMs?this.elapsedMs/this.timeoutMs:0}}class Pt{constructor(t){this.context=t,this.keyQueue=[],this.isWorkerInitializing=!1,this.stopwatchAfterCalculatingPath=new St,this.initPathFindingWorker()}initPathFindingWorker(){!this.isWorkerInitializing&&this.calculatingPathStopwatch&&this.calculatingPathStopwatch.elapsedMs>500&&(this.context.logger.warn("Recycling pathfindingworker after "+this.calculatingPathStopwatch.elapsedMs+" ms"),this.pathFindingWorker.terminate(),this.pathFindingWorker=null,this.calculatingPathStopwatch=null),this.pathFindingWorker||(this.isWorkerInitializing=!0,this.pathFindingWorker=Pt.createPathFindingWorker(),this.pathFindingWorker.onmessage=t=>{if("ready"===t.data)return void(this.isWorkerInitializing=!1);const e=JSON.parse(t.data);this.calculatingPathStopwatch.elapsedMs<500&&(this.path=e.path),this.calculatingPathStopwatch=null,this.stopwatchAfterCalculatingPath.start()})}get needsNewPath(){return!!!this.calculatingPathStopwatch&&this.stopwatchAfterCalculatingPath.elapsedMs>500}calcPath(t){this.pathFindingWorker.postMessage(JSON.stringify(t)),this.calculatingPathStopwatch=new St}stop(t=!1){this.path=null,this.playerToKill=null,this.autoPilotToFlag=!1,this.autoBoost=!1,this.autoFireToggledManually&&!t||(this.autoFire=!1)}isOn(){return!!(this.path||this.playerToKill||this.autoPilotToFlag||this.autoFire)}enqueueKey(t,e,s=0){this.keyQueue.push({key:t,state:e,duration:s})}eatKeyQueue(){const t=this.keyQueue;return this.keyQueue=[],t}requestTimeoutFor(t){return t.key===k.SPECIAL?this.boostTimeout?null:(this.boostTimeout=setTimeout((()=>{this.context.connection.sendKey(t.key,!t.state),this.context.botstate.boostTimeout=null}),t.duration),this.boostTimeout):this.turningTimeout?null:(this.turningTimeout=setTimeout((()=>{this.context.connection.sendKey(t.key,!t.state),this.context.botstate.turningTimeout=null}),t.duration),this.turningTimeout)}}let Lt;var _t;(_t=Lt||(Lt={}))[_t.BOT_STEERING_INSTRUCTION=0]="BOT_STEERING_INSTRUCTION",_t[_t.CHAT_NOT_POSSIBLE_BC_MUTED=1]="CHAT_NOT_POSSIBLE_BC_MUTED",_t[_t.CHAT_PLAYER_MUTED=2]="CHAT_PLAYER_MUTED",_t[_t.CHAT_RECEIVED=3]="CHAT_RECEIVED",_t[_t.CHAT_SEND=4]="CHAT_SEND",_t[_t.CONNECTION_ERROR=5]="CONNECTION_ERROR",_t[_t.CONNECTION_CLOSE=6]="CONNECTION_CLOSE",_t[_t.CRATE_NEW=7]="CRATE_NEW",_t[_t.CTF_GAME_OVER=8]="CTF_GAME_OVER",_t[_t.EACH_SECOND=9]="EACH_SECOND",_t[_t.EXPLOSION=10]="EXPLOSION",_t[_t.FLAG_UPDATE=11]="FLAG_UPDATE",_t[_t.KEYBOARD=12]="KEYBOARD",_t[_t.LOGIN=13]="LOGIN",_t[_t.LEAVE_HORIZON=14]="LEAVE_HORIZON",_t[_t.MESSAGE_TO_PLAYER=15]="MESSAGE_TO_PLAYER",_t[_t.MOB_DESPAWN=16]="MOB_DESPAWN",_t[_t.MINI_MAP=17]="MINI_MAP",_t[_t.MISSILE_UPDATE=18]="MISSILE_UPDATE",_t[_t.MOUNTAIN_HIT=19]="MOUNTAIN_HIT",_t[_t.PLAYER_BOUNCE=20]="PLAYER_BOUNCE",_t[_t.PLAYER_BOOST=21]="PLAYER_BOOST",_t[_t.PLAYER_CHANGE_FLAG=22]="PLAYER_CHANGE_FLAG",_t[_t.PLAYER_FIRE=23]="PLAYER_FIRE",_t[_t.PLAYER_HIT=24]="PLAYER_HIT",_t[_t.PLAYER_KILLED=25]="PLAYER_KILLED",_t[_t.PLAYER_LEAVE=26]="PLAYER_LEAVE",_t[_t.PLAYER_LEVEL=27]="PLAYER_LEVEL",_t[_t.PLAYER_NEW=28]="PLAYER_NEW",_t[_t.PLAYER_POWERUP=29]="PLAYER_POWERUP",_t[_t.PLAYER_REPEL=30]="PLAYER_REPEL",_t[_t.PLAYER_RESPAWN=31]="PLAYER_RESPAWN",_t[_t.PLAYER_UPDATE=32]="PLAYER_UPDATE",_t[_t.PLAYER_UPGRADE_APPLIED=33]="PLAYER_UPGRADE_APPLIED",_t[_t.PLAYER_SPECTATE=34]="PLAYER_SPECTATE",_t[_t.PLAYER_STEALTH=35]="PLAYER_STEALTH",_t[_t.PLAYER_SWITCH_TYPE=36]="PLAYER_SWITCH_TYPE",_t[_t.SERVER_ANNOUNCEMENT=37]="SERVER_ANNOUNCEMENT",_t[_t.SERVER_COMMAND_REPLY=38]="SERVER_COMMAND_REPLY",_t[_t.SERVER_CUSTOM=39]="SERVER_CUSTOM",_t[_t.SERVER_ERROR=40]="SERVER_ERROR",_t[_t.SERVER_MESSAGE=41]="SERVER_MESSAGE",_t[_t.SCORE_BOARD=42]="SCORE_BOARD",_t[_t.SCORE_DETAILED=43]="SCORE_DETAILED",_t[_t.SCORE_UPDATE=44]="SCORE_UPDATE",_t[_t.SPAM_WARING_RECEIVED=45]="SPAM_WARING_RECEIVED",_t[_t.TEAMS=46]="TEAMS",_t[_t.TICK=47]="TICK";class Ot{constructor(t){this.context=t,this.skippedFrames=0}startProcessingEventQueue(){this.handlersByType={};for(const t of this.context.handlers)for(const e of t.handles){const s=this.handlersByType[e]||[];s.push(t),this.handlersByType[e]=s}this.context.tm.setInterval((()=>this.tick()),Math.floor(16.666666666666668))}tick(){this.stopwatch||(this.stopwatch=new St,this.tickCounter=1,this.eachSecondStopwatch=new St,this.skippedFrames=0);const t=this.context.connection.getLagMs(),e=this.stopwatch.elapsedMs+t;let s=!1;if(e<16.666666666666668)s=!0;else if(e>16.666666666666668*(this.tickCounter+1))this.skippedFrames++;else{const t=this.skippedFrames+e/(16.666666666666668*this.tickCounter);for(this.context.eventQueue.pub(Lt.TICK,{frame:this.tickCounter,frameFactor:t,skippedFrames:this.skippedFrames,timeFromStart:e}),this.eachSecondStopwatch.elapsedSeconds>=1&&(this.context.eventQueue.pub(Lt.EACH_SECOND,{}),this.eachSecondStopwatch.start()),this.skippedFrames=0;;){const t=this.context.eventQueue.dequeue();if(!t)break;this.process(t)}}this.context.state.skippedFrames=this.skippedFrames,s||this.tickCounter++,this.skippedFrames>300?this.stopwatch=null:(this.skippedFrames>0||s)&&this.context.tm.setTimeout((()=>this.tick()),1)}process(t){const e=this.handlersByType[t.type]||[];for(const s of e)try{s.exec(t)}catch(e){const n=JSON.parse(JSON.stringify(e,Object.getOwnPropertyNames(e)));this.context.logger.error(`Error handling message ${t.type} with handler ${s.constructor.name}`,n)}}}class bt{constructor(t){this.context=t,this.handles=[Lt.CHAT_SEND]}exec(t){const e=t.args;this.context.connection.sendChat(e.type,e.text,e.playerId)}}class Ct{constructor(t){this.context=t,this.handles=[Lt.KEYBOARD]}exec(t){const e=t.args;this.context.connection.sendKey(e.key,e.state)}}const Mt=32768,Nt=16384,kt={MIN_X:-Mt/2,MIN_Y:-Nt/2,MAX_X:Mt/2,MAX_Y:Nt/2},Dt={MIN_X:-16352,MIN_Y:-8160,MAX_X:16352,MAX_Y:8160},vt=1,Bt=2,Yt=3,Ft={[K.PREDATOR_MISSILE]:{maxSpeed:9,baseSpeed:4.05,speedFactor:.3,infernoSpeedFactor:1,accel:.105,damage:.4,infernoDamageFactor:1,distance:1104,shape:vt,repelEnergy:197},[K.GOLIATH_MISSILE]:{maxSpeed:6,baseSpeed:2.1,speedFactor:.3,infernoSpeedFactor:1,accel:.0375,damage:1.2,infernoDamageFactor:1,distance:1076,shape:Bt,repelEnergy:260},[K.COPTER_MISSILE]:{maxSpeed:9,baseSpeed:5.7,speedFactor:.3,infernoSpeedFactor:1,accel:.14,damage:.2,infernoDamageFactor:1,distance:1161,shape:Yt,repelEnergy:155},[K.TORNADO_MISSILE]:{maxSpeed:7,baseSpeed:3.5,speedFactor:.3,infernoSpeedFactor:1,accel:.0875,damage:.4,infernoDamageFactor:1,distance:997,shape:vt,repelEnergy:186},[K.TORNADO_SMALL_MISSILE]:{maxSpeed:7,baseSpeed:3.5,speedFactor:.3,infernoSpeedFactor:1,accel:.0875,damage:.3,infernoDamageFactor:1,distance:581,shape:vt,repelEnergy:145},[K.PROWLER_MISSILE]:{maxSpeed:7,baseSpeed:2.8,speedFactor:.3,infernoSpeedFactor:1,accel:.07,damage:.45,infernoDamageFactor:1,distance:819,shape:vt,repelEnergy:168}};class Vt{constructor(t){this.context=t,this.handles=[Lt.TICK]}exec(t){const e=t.args;for(const t of this.context.state.getMissiles()){const s=Ft[t.mobType],n=t.speed.x,i=t.speed.y,o=e.frameFactor;t.speed.x+=t.accel.x*o,t.speed.y+=t.accel.y*o;const a=Math.hypot(t.speed.x,t.speed.y);a>t.maxSpeed?(t.speed.x*=t.maxSpeed/a,t.speed.y*=t.maxSpeed/a,t.speed.length=t.maxSpeed):t.speed.length=a,t.pos.x+=(n+.5*(t.speed.x-n))*o,t.pos.y+=(i+.5*(t.speed.y-i))*o,t.distance=(t.distance||0)+Math.hypot(t.speed.x,t.speed.y),(t.pos.x<kt.MIN_X||t.pos.x>kt.MAX_X||t.pos.y<kt.MIN_Y||t.pos.y>kt.MAX_Y||t.distance>=s.distance)&&this.context.state.removeMob(t.id)}}}const Ht={PREDATOR:1,GOLIATH:2,COPTER:3,TORNADO:4,PROWLER:5},Gt="fire",Xt="infernoFire",Kt="default",Wt="special",zt=(t,e,s,n,i=!1)=>({type:t,x:e,y:s,rot:n,alt:i}),Qt=(t=[],e=[])=>({[Kt]:t,[Wt]:e}),jt={[Ht.PREDATOR]:{name:"raptor",turnFactor:.065,accelFactor:.225,brakeFactor:.025,boostFactor:1.5,infernoFactor:.75,maxSpeed:5.5,minSpeed:.001,flagSpeed:5,healthRegen:.001,energyRegen:.008,fireEnergy:.6,specialEnergy:0,specialEnergyRegen:-.01,specialDelay:0,fireDelay:550,damageFactor:2,energyLight:.6,collisions:[[0,5,23],[0,-15,15],[0,-25,12]],repelEnergy:2100,[Gt]:Qt([zt(K.PREDATOR_MISSILE,0,35,0)]),[Xt]:Qt([zt(K.PREDATOR_MISSILE,-20,5,-.05),zt(K.PREDATOR_MISSILE,0,35,0),zt(K.PREDATOR_MISSILE,20,5,.05)])},[Ht.GOLIATH]:{name:"spirit",turnFactor:.04,accelFactor:.15,brakeFactor:.015,boostFactor:1,infernoFactor:.75,maxSpeed:3.5,minSpeed:.001,flagSpeed:5,healthRegen:5e-4,energyRegen:.005,fireEnergy:.9,specialEnergy:.5,specialEnergyRegen:0,specialDelay:1e3,fireDelay:300,damageFactor:1,energyLight:.9,collisions:[[0,0,35],[50,14,16],[74,26,14],[30,8,23],[63,22,15],[-50,14,16],[-74,26,14],[-30,8,23],[-63,22,15]],repelEnergy:7500,[Gt]:Qt([zt(K.GOLIATH_MISSILE,0,35,0)]),[Xt]:Qt([zt(K.GOLIATH_MISSILE,-30,0,-.05),zt(K.GOLIATH_MISSILE,0,35,0),zt(K.GOLIATH_MISSILE,30,0,.05)])},[Ht.COPTER]:{name:"mohawk",turnFactor:.07,accelFactor:.275,brakeFactor:.025,boostFactor:1,infernoFactor:.75,maxSpeed:6,minSpeed:.001,flagSpeed:5,healthRegen:.001,energyRegen:.01,fireEnergy:.3,specialEnergy:0,specialEnergyRegen:0,specialDelay:0,fireDelay:300,damageFactor:2.78,energyLight:.3,collisions:[[0,-12,15],[0,0,17],[0,13,15],[0,26,15]],repelEnergy:1800,[Gt]:Qt([zt(K.COPTER_MISSILE,15,10,0,!0)]),[Xt]:Qt([zt(K.COPTER_MISSILE,-10,5,-.05),zt(K.COPTER_MISSILE,0,10,0),zt(K.COPTER_MISSILE,10,5,.05)])},[Ht.TORNADO]:{name:"tornado",turnFactor:.055,accelFactor:.2,brakeFactor:.025,boostFactor:1,infernoFactor:.75,maxSpeed:4.5,minSpeed:.001,flagSpeed:5,healthRegen:.001,energyRegen:.006,fireEnergy:.5,specialEnergy:.9,specialEnergyRegen:0,specialDelay:0,fireDelay:500,damageFactor:5/3,energyLight:.5,collisions:[[0,8,18],[14,12,13],[-14,12,13],[0,-12,16],[0,-26,14],[0,-35,12]],repelEnergy:2400,[Gt]:Qt([zt(K.TORNADO_MISSILE,0,40,0)],[zt(K.TORNADO_SMALL_MISSILE,-15,10,-.05),zt(K.TORNADO_SMALL_MISSILE,0,40,0),zt(K.TORNADO_SMALL_MISSILE,15,10,.05)]),[Xt]:Qt([zt(K.TORNADO_MISSILE,-15,10,-.05),zt(K.TORNADO_MISSILE,0,40,0),zt(K.TORNADO_MISSILE,15,10,.05)],[zt(K.TORNADO_MISSILE,-30,20,-.06),zt(K.TORNADO_MISSILE,-20,15,-.03),zt(K.TORNADO_MISSILE,0,40,0),zt(K.TORNADO_MISSILE,20,15,.03),zt(K.TORNADO_MISSILE,30,20,.06)])},[Ht.PROWLER]:{name:"prowler",turnFactor:.055,accelFactor:.2,brakeFactor:.025,boostFactor:1,infernoFactor:.75,maxSpeed:4.5,minSpeed:.001,flagSpeed:5,healthRegen:.001,energyRegen:.006,fireEnergy:.75,specialEnergy:.6,specialEnergyRegen:0,specialDelay:1500,damageFactor:5/3,fireDelay:300,energyLight:.75,collisions:[[0,11,25],[0,-8,18],[19,20,10],[-19,20,10],[0,-20,14]],repelEnergy:2600,[Gt]:Qt([zt(K.PROWLER_MISSILE,0,35,0)]),[Xt]:Qt([zt(K.PROWLER_MISSILE,-20,0,-.05),zt(K.PROWLER_MISSILE,0,35,0),zt(K.PROWLER_MISSILE,20,0,.05)])}},qt={SPEED:{cost:[0,1,1,1,1,1],factor:[1,1.05,1.1,1.15,1.2,1.25]},DEFENSE:{cost:[0,1,1,1,1,1],factor:[1,1.05,1.1,1.15,1.2,1.25]},ENERGY:{cost:[0,1,1,1,1,1],factor:[1,1.05,1.1,1.15,1.2,1.25]},MISSILE:{cost:[0,1,1,1,1,1],factor:[1,1.05,1.1,1.15,1.2,1.25]}};class Jt{constructor(t,e=3){this.context=t,this.intervalSeconds=e,this.stopwatch=new St}log(t,...e){this.stopwatch.elapsedSeconds<this.intervalSeconds||(this.context.logger.info(t,...e),this.stopwatch.start())}}const $t=2*Math.PI;class Zt{constructor(t){this.context=t,this.handles=[Lt.TICK],this.logger=new Jt(this.context)}exec(t){const e=t.args;for(const t of this.context.state.getPlayers())t.status!==J.INACTIVE&&this.updatePlayer(t,e)}updatePlayer(t,e){const s=jt[t.type],n=t.boost?s.boostFactor:1,i=e.frameFactor;if(!isNaN(t.energyRegen)){const e=t.energyRegen*i;t.energy+=e,t.energy>1?t.energy=1:t.energy<0?t.energy=0:isNaN(t.energy)&&(t.energy=1)}t.health+=i*s.healthRegen,t.health>1?t.health=1:t.health<0&&(t.health=0),t.shieldOrInfernoTimer&&t.shieldOrInfernoTimer.hasTimedOut&&(t.shieldOrInfernoTimer=null,t.powerUps.inferno=null,t.powerUps.shield=null);let o=-999;t.strafe?(t.keystate.LEFT&&(o=t.rot-.5*Math.PI),t.keystate.RIGHT&&(o=t.rot+.5*Math.PI)):(t.keystate.LEFT||t.keystate.RIGHT)&&(t.keystate.LEFT&&(t.rot-=i*s.turnFactor),t.keystate.RIGHT&&(t.rot+=i*s.turnFactor),t.rot=(t.rot%$t+$t)%$t),t.keystate.UP?-999===o?o=t.rot:o+=Math.PI*(t.keystate.RIGHT?-.25:.25):t.keystate.DOWN&&(-999===o?o=t.rot+Math.PI:o+=Math.PI*(t.keystate.RIGHT?.25:-.25));let a=0;if(0!==t.speed.x||0!==t.speed.y||t.keystate.UP||t.keystate.DOWN||t.strafe){const e=t.speed.x,r=t.speed.y;-999!==o&&(t.speed.x+=Math.sin(o)*s.accelFactor*n*i,t.speed.y-=Math.cos(o)*s.accelFactor*n*i),a=Math.hypot(t.speed.x,t.speed.y);let c=s.maxSpeed*n*qt.SPEED.factor[t.upgrades.speed];t.powerUps.inferno&&(c*=s.infernoFactor),t.flagspeed&&(c=s.flagSpeed),a>c?(t.speed.x*=c/a,t.speed.y*=c/a):t.speed.x>s.minSpeed||t.speed.x<-s.minSpeed||t.speed.y>s.minSpeed||t.speed.y<-s.minSpeed?(t.speed.x*=1-s.brakeFactor*i,t.speed.y*=1-s.brakeFactor*i):(t.speed.x=0,t.speed.y=0),t.pos.x+=i*e+.5*(t.speed.x-e)*i*i,t.pos.y+=i*r+.5*(t.speed.y-r)*i*i}t.pos.x<Dt.MIN_X&&(t.pos.x=Dt.MIN_X),t.pos.x>Dt.MAX_X&&(t.pos.x=Dt.MAX_X),t.pos.y<Dt.MIN_Y&&(t.pos.y=Dt.MIN_Y),t.pos.y>Dt.MAX_Y&&(t.pos.y=Dt.MAX_Y)}}let te;var ee;(ee=te||(te={}))[ee.CHAT=0]="CHAT",ee[ee.SAY=1]="SAY",ee[ee.TEAM=2]="TEAM",ee[ee.WHISPER=3]="WHISPER";class se{constructor(t){this.context=t,this.handles=[Lt.SERVER_MESSAGE]}exec(t){const e=t.args;let s;switch(e.c){case l.CHAT_PUBLIC:s=te.CHAT,this.context.eventQueue.pub(Lt.CHAT_RECEIVED,{chatMessage:e.text,chatType:s,playerId:e.id});break;case l.CHAT_SAY:s=te.SAY,this.context.eventQueue.pub(Lt.CHAT_RECEIVED,{chatMessage:e.text,chatType:s,playerId:e.id});break;case l.CHAT_TEAM:s=te.TEAM,this.context.eventQueue.pub(Lt.CHAT_RECEIVED,{chatMessage:e.text,chatType:s,playerId:e.id});break;case l.CHAT_WHISPER:s=te.WHISPER,this.context.eventQueue.pub(Lt.CHAT_RECEIVED,{chatMessage:e.text,chatType:s,playerId:e.from,to:e.to});break;case l.CHAT_VOTEMUTED:this.context.eventQueue.pub(Lt.CHAT_NOT_POSSIBLE_BC_MUTED,e);break;case l.CHAT_VOTEMUTEPASSED:this.context.eventQueue.pub(Lt.CHAT_PLAYER_MUTED,e);break;case l.COMMAND_REPLY:this.context.eventQueue.pub(Lt.SERVER_COMMAND_REPLY,e);break;case l.ERROR:this.context.eventQueue.pub(Lt.SERVER_ERROR,e);break;case l.EVENT_BOOST:this.context.eventQueue.pub(Lt.PLAYER_BOOST,e);break;case l.EVENT_BOUNCE:this.context.eventQueue.pub(Lt.PLAYER_BOUNCE,e);break;case l.EVENT_LEAVEHORIZON:this.context.eventQueue.pub(Lt.LEAVE_HORIZON,e);break;case l.EVENT_REPEL:this.context.eventQueue.pub(Lt.PLAYER_REPEL,e);break;case l.EVENT_STEALTH:this.context.eventQueue.pub(Lt.PLAYER_STEALTH,e);break;case l.GAME_FLAG:this.context.eventQueue.pub(Lt.FLAG_UPDATE,e);break;case l.GAME_SPECTATE:this.context.eventQueue.pub(Lt.PLAYER_SPECTATE,e);case l.LOGIN:this.context.eventQueue.pub(Lt.LOGIN,e);break;case l.MOB_DESPAWN:this.context.eventQueue.pub(Lt.MOB_DESPAWN,e);break;case l.MOB_DESPAWN_COORDS:this.context.eventQueue.pub(Lt.MOUNTAIN_HIT,e);break;case l.MOB_UPDATE:this.context.eventQueue.pub(Lt.MISSILE_UPDATE,e);break;case l.MOB_UPDATE_STATIONARY:this.context.eventQueue.pub(Lt.CRATE_NEW,e);break;case l.PLAYER_FIRE:this.context.eventQueue.pub(Lt.PLAYER_FIRE,e);break;case l.PLAYER_FLAG:this.context.eventQueue.pub(Lt.PLAYER_CHANGE_FLAG,e);break;case l.PLAYER_HIT:this.context.eventQueue.pub(Lt.PLAYER_HIT,e);break;case l.PLAYER_KILL:this.context.eventQueue.pub(Lt.PLAYER_KILLED,e);break;case l.PLAYER_LEAVE:this.context.eventQueue.pub(Lt.PLAYER_LEAVE,e);break;case l.PLAYER_LEVEL:this.context.eventQueue.pub(Lt.PLAYER_LEVEL,e);break;case l.PLAYER_NEW:this.context.eventQueue.pub(Lt.PLAYER_NEW,e);break;case l.PLAYER_POWERUP:this.context.eventQueue.pub(Lt.PLAYER_POWERUP,e);break;case l.PLAYER_UPDATE:this.context.eventQueue.pub(Lt.PLAYER_UPDATE,e);break;case l.PLAYER_RETEAM:this.context.eventQueue.pub(Lt.TEAMS,e);break;case l.PLAYER_UPGRADE:this.context.eventQueue.pub(Lt.PLAYER_UPGRADE_APPLIED,e);break;case l.PLAYER_RESPAWN:this.context.eventQueue.pub(Lt.PLAYER_RESPAWN,e);break;case l.PLAYER_TYPE:this.context.eventQueue.pub(Lt.PLAYER_SWITCH_TYPE,e);break;case l.SERVER_CUSTOM:this.context.eventQueue.pub(Lt.SERVER_CUSTOM,e);break;case l.SERVER_MESSAGE:this.context.eventQueue.pub(Lt.SERVER_ANNOUNCEMENT,e);break;case l.SCORE_BOARD:const t=e;this.context.eventQueue.pub(Lt.SCORE_BOARD,t.data),this.context.eventQueue.pub(Lt.MINI_MAP,t.rankings);break;case l.SCORE_DETAILED:const n=e;this.context.eventQueue.pub(Lt.SCORE_DETAILED,{ffaScores:n.scores});break;case l.SCORE_DETAILED_CTF:const i=e;this.context.eventQueue.pub(Lt.SCORE_DETAILED,{ffaScores:i.scores});break;case l.SCORE_UPDATE:this.context.eventQueue.pub(Lt.SCORE_UPDATE,e)}}}const ne=2*Math.PI;class ie{constructor(t,e){if(!t&&0!==t||!e&&0!==e)if(t){const e=t;this.x=e.x,this.y=e.y}else this.x=0,this.y=0;else this.x=t,this.y=e}direction(){let t=-(Math.atan2(this.x,this.y)+Math.PI);return t<0&&(t+=ne),t>ne&&(t-=ne),t}equals(t){return!!t&&t.x===this.x&&t.y===this.y}}class oe{get pos(){return this.highResPos}set pos(t){this.highResPos=t,this.posUpdateTimer.start()}posUpdateTimer=new St;constructor(){this.speed=new ie,this.pos=new ie,this.accel=new ie}}class ae{constructor(t){this.context=t,this.handles=[Lt.CRATE_NEW]}exec(t){const e=t.args,s=new oe;s.id=e.id,s.pos=new ie(e.posX,e.posY),s.mobType=e.type,this.context.state.addMob(s)}}class re{constructor(t){this.context=t,this.handles=[Lt.FLAG_UPDATE]}exec(t){const e=t.args,s=this.context.state.getCtfTeam(e.flag);s.flagState=e.type,s.flagTakenById=e.id,s.flagPos=new ie(e.posX,e.posY),this.context.state.getCtfTeam(ot.BLUE).score=e.blueteam,this.context.state.getCtfTeam(ot.RED).score=e.redteam}}class ce{constructor(t){this.context=t,this.handles=[Lt.LEAVE_HORIZON]}exec(t){const e=t.args;let s;s=e.type===G.MOB?this.context.state.getMobById(e.id):this.context.state.getPlayerById(e.id),s&&(s.isVisibleOnScreen=!1),e.type!==G.PLAYER&&this.context.state.removeMob(e.id)}}class le{static upgradesToPowerUps(t){return t?xt(t):null}static keystateToPlayerMovements(t){return t?It(t):null}}class he{}class ue{speed=0;defense=0;energy=0;missile=0;available=0}class de extends oe{energy=1;health=1;score=0;get posFromMinimap(){return this.lowResPos}set posFromMinimap(t){this.lowResPos=t,this.lowResPosUpdateTimer.start()}lowResPosUpdateTimer=new St;constructor(){super(),this.mobType=K.PLAYER,this.upgrades=new ue,this.powerUps=new he,this.keystate={}}get mostReliablePos(){return this.posUpdateTimer.elapsedMs-this.lowResPosUpdateTimer.elapsedMs<4e3||!this.lowResPos?this.pos:this.lowResPos}setMovements(t){t?(this.boost=t.boost,this.flagspeed=t.flagspeed,this.stealthed=t.stealthed,this.strafe=t.strafe,this.keystate=t.keystate):(this.boost=!1,this.flagspeed=!1,this.stealthed=!1,this.strafe=!1,this.keystate={})}}class ge{constructor(t){this.context=t,this.handles=[Lt.LOGIN]}exec(t){const e=t.args,s=this.context.state;s.id=e.id;if(!!this.context.state.spectatingId||(s.myPlayerId=e.id),!e.players)return;s.team=e.team,this.context.gameType=ft.FFA,e.team!==ot.BLUE&&e.team!==ot.RED||(this.context.gameType=ft.CTF);let n=0;for(const t of e.players){const e=new de;n++,e.id=t.id,e.flag=t.flag,e.name=t.name,e.pos=new ie(t.posX,t.posY),e.type=t.type,e.rot=t.rot,e.status=t.status,e.team=t.team,e.ranking=n,e.health=1,e.energy=1,e.level=t.level,e.powerUps=le.upgradesToPowerUps(t.upgrades)||new he,s.addPlayer(e)}}}class pe{constructor(t){this.context=t,this.handles=[Lt.MINI_MAP]}exec(t){const e=t.args;for(const t of e){const e=this.context.state.getPlayerById(t.id);if(e)if(0===t.x&&0===t.y){const t=this.context.state.getFocusedPlayer();t&&t.stealthed&&(e.status=J.INACTIVE)}else{const r=(s=t.x,n=t.y,i=void 0,o=void 0,a=void 0,{x:128*s-Rt.WIDTH/2+64,y:(i=128*n-Rt.HEIGHT,o=-Rt.HEIGHT/2,a=Rt.HEIGHT/2,(i<=o?o:i>=a?a:i)+64)});e.posFromMinimap=new ie(r)}}var s,n,i,o,a}}class Ee{constructor(t){this.context=t,this.handles=[Lt.MISSILE_UPDATE]}exec(t){const e=t.args;let s=this.context.state.getMobById(e.id);s||(s=new oe,s.id=e.id,this.context.state.addMob(s)),s.isVisibleOnScreen=!0,s.pos=new ie(e.posX,e.posY),s.accel=new ie(e.accelX,e.accelY),s.maxSpeed=e.maxSpeed,s.speed=new ie(e.speedX,e.speedY),s.rot=s.speed.direction(),s.mobType=e.type}}class ye{constructor(t){this.context=t,this.handles=[Lt.MOB_DESPAWN]}exec(t){const e=t.args;this.context.state.removeMob(e.id)}}class fe{constructor(t){this.context=t,this.handles=[Lt.MOUNTAIN_HIT]}exec(t){const e=t.args;this.context.eventQueue.pub(Lt.EXPLOSION,{pos:new ie(e.posX,e.posY),type:e.type}),this.context.state.removeMob(e.id)}}class me{constructor(t){this.context=t,this.handles=[Lt.PLAYER_BOOST]}exec(t){const e=t.args,s=this.context.state.getPlayerById(e.id);s&&(s.boost=e.boost,s.energy=e.energy,s.energyRegen=e.energyRegen,s.pos=new ie(e.posX,e.posY),s.rot=e.rot,s.speed=new ie(e.speedX,e.speedY))}}class Ae{constructor(t){this.context=t,this.handles=[Lt.PLAYER_BOUNCE]}exec(t){const e=t.args,s=this.context.state.getPlayerById(e.id);if(!s)return;const n=le.keystateToPlayerMovements(e.keystate);s.setMovements(n),s.pos=new ie(e.posX,e.posY),s.rot=e.rot,s.speed=new ie(e.speedX,e.speedY)}}class Ue{constructor(t){this.context=t,this.handles=[Lt.PLAYER_CHANGE_FLAG]}exec(t){const e=t.args,s=this.context.state.getPlayerById(e.id);s&&(s.flag=e.flag)}}class Re{constructor(t){this.context=t,this.handles=[Lt.PLAYER_FIRE]}exec(t){const e=t.args,s=this.context.state.getPlayerById(e.id);if(s){s.energy=e.energy,s.energyRegen=e.energyRegen;for(const t of e.projectiles){const n=new oe;n.id=t.id,n.pos=new ie(t.posX,t.posY),n.accel=new ie(t.accelX,t.accelY),n.maxSpeed=t.maxSpeed,n.speed=new ie(t.speedX,t.speedY),n.mobType=t.type,n.ownerId=e.id,n.rot=n.speed.direction(),n.team=s.team,this.context.state.addMob(n)}}}}class we{constructor(t){this.context=t,this.handles=[Lt.PLAYER_HIT]}exec(t){const e=t.args;this.context.eventQueue.pub(Lt.EXPLOSION,{pos:new ie(e.posX,e.posY),type:e.type});for(const t of e.players){const e=this.context.state.getPlayerById(t.id);e&&(e.health=t.health,e.healthRegen=t.healthRegen)}this.context.state.removeMob(e.id)}}class Te{constructor(t){this.context=t,this.handles=[Lt.PLAYER_KILLED]}exec(t){const e=t.args,s=this.context.state.getPlayerById(e.id);s&&(s.status=J.INACTIVE)}}class xe{constructor(t){this.context=t,this.handles=[Lt.PLAYER_LEAVE]}exec(t){const e=t.args;this.context.state.removePlayer(e.id)}}class Ie{constructor(t){this.context=t,this.handles=[Lt.PLAYER_LEVEL]}exec(t){const e=t.args,s=this.context.state.getPlayerById(e.id);s&&(s.level=e.level,e.type===j.LEVELUP&&e.id===this.context.state.id&&this.context.eventQueue.pub(Lt.MESSAGE_TO_PLAYER,{message:`You have reached level ${s.level}!`}))}}class Se{constructor(t){this.context=t,this.handles=[Lt.PLAYER_NEW]}exec(t){const e=t.args,s=new de;s.id=e.id,s.flag=e.flag,s.name=e.name,s.pos=new ie(e.posX,e.posY),s.type=e.type,s.rot=e.rot,s.status=e.status,s.team=e.team,s.energy=1,s.health=1,s.powerUps=le.upgradesToPowerUps(e.upgrades)||new he,this.context.state.addPlayer(s)}}class Pe{constructor(t){this.context=t,this.handles=[Lt.PLAYER_POWERUP]}exec(t){const e=t.args,s=this.context.state.getFocusedPlayer();s&&(s.hasShield=e.type===nt.SHIELD,s.hasInferno=e.type===nt.INFERNO,s.shieldOrInfernoTimer=new St(e.duration))}}class Le{constructor(t){this.context=t,this.handles=[Lt.PLAYER_REPEL]}exec(t){const e=t.args,s=this.context.state.getPlayerById(e.id);s&&(s.pos=new ie(e.posX,e.posY),s.rot=e.rot,s.speed=new ie(e.speedX,e.speedY),s.energyRegen=e.energyRegen,s.energy=e.energy);for(const t of e.players){const e=this.context.state.getPlayerById(t.id);if(!e)continue;const s=le.keystateToPlayerMovements(t.keystate);e.setMovements(s),e.pos=new ie(t.posX,t.posY),e.rot=t.rot,e.speed=new ie(t.speedX,t.speedY),e.energyRegen=t.energyRegen,e.energy=t.energy,e.health=t.playerHealth,e.healthRegen=t.playerHealthRegen}for(const t of e.mobs){const n=this.context.state.getMobById(t.id);n&&(n.pos=new ie(t.posX,t.posY),n.accel=new ie(t.accelX,t.accelY),n.maxSpeed=t.maxSpeed,n.speed=new ie(t.speedX,t.speedY),n.rot=n.speed.direction(),n.mobType=t.type,n.ownerId=e.id,n.team=s.team)}}}class _e{constructor(t){this.context=t,this.handles=[Lt.PLAYER_RESPAWN]}exec(t){const e=t.args,s=this.context.state.getPlayerById(e.id);if(s&&(s.pos=new ie(e.posX,e.posY),s.rot=e.rot,s.powerUps=le.upgradesToPowerUps(e.upgrades)||new he,s.status=J.ALIVE,s.health=1,s.energy=1,e.id===this.context.state.myPlayerId)){!!this.context.state.spectatingId&&(this.context.state.spectatingId=null,this.context.state.id=this.context.state.myPlayerId)}}}class Oe{constructor(t){this.context=t,this.handles=[Lt.PLAYER_SPECTATE]}exec(t){const e=t.args;this.context.state.getPlayerById(e.id)&&(this.context.state.spectatingId=e.id)}}class be{constructor(t){this.context=t,this.handles=[Lt.PLAYER_STEALTH]}exec(t){const e=t.args,s=this.context.state.getPlayerById(e.id);s&&(s.stealthed=e.state,s.energy=e.energy,s.energyRegen=e.energyRegen)}}class Ce{constructor(t){this.context=t,this.handles=[Lt.PLAYER_SWITCH_TYPE]}exec(t){const e=t.args,s=this.context.state.getPlayerById(e.id);s&&(s.type=e.type)}}class Me{constructor(t){this.context=t,this.handles=[Lt.PLAYER_UPDATE]}exec(t){const e=t.args,s=this.context.state.getPlayerById(e.id);if(!s)return;s.isVisibleOnScreen=!0;const n=le.keystateToPlayerMovements(e.keystate);s.setMovements(n);const i=le.upgradesToPowerUps(e.upgrades);s.powerUps=i||new he,s.upgrades=s.upgrades||new ue,s.upgrades.speed=s.powerUps.speed||0,s.pos=new ie(e.posX,e.posY),s.rot=e.rot,s.speed=new ie(e.speedX,e.speedY)}}class Ne{constructor(t){this.context=t,this.handles=[Lt.PLAYER_UPGRADE_APPLIED]}exec(t){const e=this.context.state.getFocusedPlayer();if(!e)return;e.upgrades||(e.upgrades=new ue);const s=t.args,n=e.upgrades;n.available=s.upgrades,n.defense=s.defense,n.energy=s.energy,n.missile=s.missile,n.speed=s.speed}}class ke{constructor(t){this.context=t,this.handles=[Lt.SCORE_BOARD]}exec(t){const e=t.args;let s=0;for(const t of e){s++;const e=this.context.state.getPlayerById(t.id);e&&(e.score=t.score,e.level=t.level,e.ranking=s)}}}class De{constructor(t){this.context=t,this.handles=[Lt.SCORE_DETAILED]}exec(t){const e=t.args;if(e.ffaScores)for(const t of e.ffaScores){const e=this.context.state.getPlayerById(t.id);e&&(e.score=t.score,e.level=t.level,e.kills=t.kills,e.deaths=t.deaths,e.damage=t.damage,e.ping=t.ping)}else if(e.ctfScores)for(const t of e.ctfScores){const e=this.context.state.getPlayerById(t.id);e&&(e.score=t.score,e.level=t.level,e.kills=t.kills,e.deaths=t.deaths,e.damage=t.damage,e.ping=t.ping,e.captures=t.captures)}}}class ve{constructor(t){this.context=t,this.handles=[Lt.SCORE_UPDATE]}exec(t){const e=t.args,s=this.context.state.getPlayerById(e.id);s&&(s.score=e.score,s.kills=e.totalkills,s.deaths=e.totaldeaths,s.upgrades||(s.upgrades=new ue),s.upgrades.available=e.upgrades)}}class Be{constructor(t){this.context=t,this.handles=[Lt.SERVER_ANNOUNCEMENT]}exec(t){const e=t.args;this.context.logger.info("Server message: "+e.text)}}class Ye{constructor(t){this.context=t,this.handles=[Lt.SERVER_COMMAND_REPLY,Lt.CHAT_NOT_POSSIBLE_BC_MUTED]}exec(t){if(t.type===Lt.CHAT_NOT_POSSIBLE_BC_MUTED)this.context.eventQueue.pub(Lt.MESSAGE_TO_PLAYER,{message:"You have been muted."});else{const e=t.args;"Don't spam!"===e.text&&this.context.eventQueue.pub(Lt.SPAM_WARING_RECEIVED,{}),this.context.eventQueue.pub(Lt.MESSAGE_TO_PLAYER,{message:e.text})}}}class Fe{constructor(t){this.context=t,this.handles=[Lt.SERVER_CUSTOM]}exec(t){const e=t.args;if(e.type===et.CTF){const t=JSON.parse(e.data);this.context.eventQueue.pub(Lt.CTF_GAME_OVER,t)}}}class Ve{constructor(t){this.context=t,this.handles=[Lt.SERVER_ERROR]}exec(t){const e=t.args;this.context.logger.error("Server reports error: "+e.error)}}class He{constructor(t){this.context=t,this.handles=[Lt.TEAMS]}exec(t){const e=t.args;for(const t of e.players){t.id===this.context.state.myPlayerId&&(this.context.state.team=t.team);const e=this.context.state.getPlayerById(t.id);e&&(e.team=t.team)}}}class Ge{static getDefaultHandlers(t){return[new ae(t),new re(t),new ce(t),new ge(t),new pe(t),new Ee(t),new ye(t),new fe(t),new me(t),new Ae(t),new Ue(t),new Re(t),new we(t),new Te(t),new xe(t),new Ie(t),new Se(t),new Pe(t),new Le(t),new _e(t),new Oe(t),new be(t),new Ce(t),new Me(t),new Ne(t),new Ye(t),new Fe(t),new Ve(t),new se(t),new Be(t),new ke(t),new De(t),new ve(t),new He(t),new Vt(t),new Zt(t),new Ct(t),new bt(t)]}}class Xe{websocketUrl="wss://game.airmash.cc/ffa";playerName="Unknown";horizonX=2e3;horizonY=2e3;flag="jolly";logLevel="info";isDevelopment=!1;zoom=.8;useBitmaps=!0;shouldShowDebugInfo=!1}class Ke{}const We=[K.PREDATOR_MISSILE,K.GOLIATH_MISSILE,K.COPTER_MISSILE,K.TORNADO_MISSILE,K.TORNADO_SMALL_MISSILE,K.PROWLER_MISSILE],ze=[K.UPGRADE,K.SHIELD,K.INFERNO];class Qe{skippedFrames=0;players={};mobs={};teams={};explosions=[];farts=[];kills=[];rocketTrailClouds=[];constructor(){this.teams[ot.BLUE]=new Ke,this.teams[ot.RED]=new Ke}addPlayer(t){this.players[Number(t.id)]=t}removePlayer(t){delete this.players[Number(t)]}getFocusedPlayer(){return this.getPlayerById(this.id)}getPlayerById(t){return this.players[Number(t)]}getPlayerByName(t){return this.getPlayers().find((e=>e.name===t))}getPlayers(){return Object.values(this.players)}getPlayerName(t){if(!t)return"(empty)";const e=this.getPlayerById(t);return e?e.name:t+"_(left)"}addMob(t){this.mobs[Number(t.id)]=t}removeMob(t){delete this.mobs[Number(t)]}getMobById(t){return this.mobs[Number(t)]}getMissiles(){return Object.values(this.mobs).filter((t=>-1!==We.indexOf(t.mobType)))}getUpcrates(){return Object.values(this.mobs).filter((t=>-1!==ze.indexOf(t.mobType)))}getCtfTeam(t){return this.teams[t]}getOtherCtfTeam(t){const e=t===ot.BLUE?ot.RED:ot.BLUE;return this.teams[e]}purgeAfterPanic(){this.explosions.splice(0),this.kills.splice(0),this.rocketTrailClouds.splice(0)}addExplosion(t){this.explosions.push(t)}getActiveExplosions(){const t=this.explosions.filter((t=>!t.isFinished));return this.explosions=t,t}addKill(t){this.kills.push(t)}getActiveKills(){const t=this.kills.filter((t=>!t.isFinished));return this.kills=t,t}addFart(t){this.farts.push(t)}getActiveFarts(){const t=this.farts.filter((t=>!t.isFinished));return this.farts=t,t}addRocketTrailCloud(t){this.rocketTrailClouds.push(t)}getActiveRocketTrailClouds(){const t=this.rocketTrailClouds.filter((t=>!t.isFinished));return this.rocketTrailClouds=t,t}}class je{timeouts=[];intervals=[];setTimeout(t,e){const s=setTimeout((()=>{this.onTimeoutFinished(s),t()}),e);return this.timeouts.push(s),s}setInterval(t,e){const s=setInterval((()=>t()),e);return this.intervals.push(s),s}clearTimeout(t){clearTimeout(t),this.onTimeoutFinished(t)}clearInterval(t){clearInterval(t),this.onIntervalCleared(t)}clearAll(){for(const t of this.timeouts)clearTimeout(t);for(const t of this.intervals)clearInterval(t);this.timeouts=[],this.intervals=[]}onTimeoutFinished(t){this.timeouts=this.timeouts.filter((e=>e!==t))}onIntervalCleared(t){this.intervals=this.intervals.filter((e=>e!==t))}}class qe{constructor(t,e){this.key=t,this.state=e,this.lastPressed=new St}}class Je{constructor(t){this.context=t,this.keySequenceNumber=0,this.lagMs=0,this.lastReceivedMessages={},this.lastReceivedMessagesGcStopwatch=new St,this.lastSentKeyStates=[]}async init(){this.client=await this.initWebSocket(!0),await this.onInitPrimary()}sendKey(t,e){let s=this.lastSentKeyStates.find((s=>s.key===t&&s.state===e));if(s){if(s.lastPressed.elapsedMs<50)return}else s=new qe(t,e),this.lastSentKeyStates.push(s);s.lastPressed.start(),this.keySequenceNumber++;const n={c:c.KEY,key:t,seq:this.keySequenceNumber,state:e};this.send(n),this.backupClientIsConnected&&this.send(n,!0)}sendCommand(t,e){const s={c:c.COMMAND,com:t,data:e};this.send(s)}voteMute(t){const e={c:c.VOTEMUTE,id:t};this.send(e)}fetchDetailedScore(){this.send({c:c.SCOREDETAILED})}sendChat(t,e,s=null){let n;switch(t){case te.CHAT:n=c.CHAT;break;case te.SAY:n=c.SAY;break;case te.TEAM:n=c.TEAMCHAT;break;case te.WHISPER:n=c.WHISPER}const i={c:n,id:s,text:e};this.send(i)}sendScreenSize(t,e){this.send({c:c.HORIZON,horizonX:Math.ceil(t/2),horizonY:Math.ceil(e/2)})}getLagMs(){return this.lagMs}onInitPrimary(){return new Promise(((t,e)=>{this.loginPromiseResolver=t,this.context.logger.debug("Primary socket connecting");let s="none";this.context.auth&&(s=JSON.stringify({token:this.context.auth.tokens.game})),this.send({c:c.LOGIN,flag:this.context.settings.flag,horizonX:Math.ceil(this.context.settings.horizonX),horizonY:Math.ceil(this.context.settings.horizonY),name:this.context.settings.playerName,protocol:5,session:s})}))}async afterLogin(t){this.ackInterval&&this.context.tm.clearInterval(this.ackInterval),this.ackInterval=this.context.tm.setInterval((()=>{this.send({c:c.ACK},this.ackToBackup),this.ackToBackup=!this.ackToBackup}),1e3);const e=t.token;this.backupClientIsConnected&&(this.backupClient.close(),this.backupClientIsConnected=!1),this.backupClient=await this.initWebSocket(!1),this.onInitBackup(e),this.context.eventQueue.pub(Lt.SERVER_MESSAGE,t),this.loginPromiseResolver()}resetCalibration(t){this.serverClockCalibrationTimeResetStopwatch=new St,this.serverClockCalibrationTime=t,this.lagMs=0}onInitBackup(t){this.context.logger.debug("Backup socket connecting"),this.backupClientIsConnected=!0,this.send({c:c.BACKUP,token:t},!0)}initWebSocket(t){return new Promise(((e,s)=>{const n=this.context.webSocketFactory.create(this.context.settings.websocketUrl);return n.binaryType="arraybuffer",n.onopen=()=>e(n),n.onmessage=e=>{try{const s=((t,e=!0)=>N(t,0,e))(e.data);if(!s)return void this.context.logger.warn("no result",e);if(this.shouldDropMessage(s))return;if(this.calibrateTime(s),s.c===l.PING){const e=s;this.send({c:c.PONG,num:e.num},!t)}else if(s.c===l.BACKUP)this.context.logger.debug("backup client connected"),this.backupClientIsConnected=!0;else if(s.c===l.LOGIN)this.afterLogin(s);else if(s.c===l.PING_RESULT){const t=s;this.context.state.ping=t.ping,this.context.state.numPlayers=t.playersgame,this.context.state.numPlayersTotal=t.playerstotal}else this.context.eventQueue.pub(Lt.SERVER_MESSAGE,s)}catch(t){this.context.logger.error("Error receiving message",t)}},n.onerror=t=>{this.context.eventQueue.pub(Lt.CONNECTION_ERROR,t)},n.onclose=()=>{this.context.eventQueue.pub(Lt.CONNECTION_CLOSE,{isPrimary:t})},n}))}calibrateTime(t){if(!t.clock)return;const e=t.clock/100;if(!this.serverClockCalibrationTimeResetStopwatch||this.serverClockCalibrationTimeResetStopwatch.elapsedMinutes>5)return void this.resetCalibration(e);if(e<this.lastServerClock)return;this.lastServerClock=e;const s=e-this.serverClockCalibrationTime,n=this.serverClockCalibrationTimeResetStopwatch.elapsedMs-s;this.lagMs=n}shouldDropMessage(t){if(!t.id||!t.clock||t.id!==this.context.state.id)return!1;if(this.lastReceivedMessagesGcStopwatch.elapsedSeconds>5)for(const t of Object.keys(this.lastReceivedMessages))this.lastReceivedMessages[t].elapsedSeconds>1&&delete this.lastReceivedMessages[t];const e=`${t.c}_${t.clock}`;return!!this.lastReceivedMessages[e]||(this.lastReceivedMessages[e]=new St,!1)}send(t,e=!1){const s=((t,e=!0)=>S(t,1,e))(t);e?this.backupClientIsConnected&&this.backupClient.send(s):this.client&&this.client.send(s)}}class $e{}class Ze{queue=[];pub(t,e){const s=new $e;s.type=t,s.args=e,this.queue.push(s)}dequeue(){return this.queue.shift()}}class ts{constructor(t){this.context=t}clearKeys(){const t=this.context.state.getFocusedPlayer();t&&(t.keystate.DOWN&&this.context.connection.sendKey(k.DOWN,!1),t.keystate.UP&&this.context.connection.sendKey(k.UP,!1),t.keystate.LEFT&&this.context.connection.sendKey(k.LEFT,!1),t.keystate.RIGHT&&this.context.connection.sendKey(k.RIGHT,!1),this.context.connection.sendKey(k.SPECIAL,!1),this.context.connection.sendKey(k.FIRE,!1))}}var es={};es=function(){function t(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var n in s)t[n]=s[n]}return t}function e(s,n){function i(e,i,o){if("undefined"!=typeof document){"number"==typeof(o=t({},n,o)).expires&&(o.expires=new Date(Date.now()+864e5*o.expires)),o.expires&&(o.expires=o.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var a="";for(var r in o)o[r]&&(a+="; "+r,!0!==o[r]&&(a+="="+o[r].split(";")[0]));return document.cookie=e+"="+s.write(i,e)+a}}function o(t){if("undefined"!=typeof document&&(!arguments.length||t)){for(var e=document.cookie?document.cookie.split("; "):[],n={},i=0;i<e.length;i++){var o=e[i].split("="),a=o.slice(1).join("=");try{var r=decodeURIComponent(o[0]);if(n[r]=s.read(a,r),t===r)break}catch(t){}}return t?n[t]:n}}return Object.create({set:i,get:o,remove:function(e,s){i(e,"",t({},s,{expires:-1}))},withAttributes:function(s){return e(this.converter,t({},this.attributes,s))},withConverter:function(s){return e(t({},this.converter,s),this.attributes)}},{attributes:{value:Object.freeze(n)},converter:{value:Object.freeze(s)}})}return e({read:function(t){return'"'===t[0]&&(t=t.slice(1,-1)),t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(t){return encodeURIComponent(t).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})}();class ss{constructor(t){this.context=t,this.handles=[Lt.PLAYER_CHANGE_FLAG]}exec(e){const s=e.args;if(s.id!==this.context.state.id)return;const n=wt[""+s.flag];t(es).set("flag",n,{expires:365})}}class ns{constructor(t){this.context=t,this.handles=[Lt.CHAT_RECEIVED,Lt.MESSAGE_TO_PLAYER]}exec(t){if(t.type===Lt.MESSAGE_TO_PLAYER){const e=t.args;this.context.renderer.addMessageToPlayer(e.message)}else{const e=t.args,s=this.context.state.getPlayerName(e.playerId);this.context.renderer.addChat(e.playerId,s,e.chatType,e.chatMessage,e.to)}}}class is{constructor(t){this.context=t,this.handles=[Lt.CTF_GAME_OVER]}exec(t){const e=t.args;this.context.renderer.showServerMessage(Y.INFO,5e3,`Game over!<br/>The ${e.w===ot.BLUE?"blue":"red"} team has won!`)}}class os{constructor(t){this.context=t,this.handles=[Lt.EACH_SECOND]}exec(t){this.context.isBrowserVisible&&(this.context.renderer.renderMinimap(),this.context.renderer.renderPlayerList(),this.context.renderer.showPing(),this.context.renderer.showStats(),this.context.renderer.hideServerMessageAfterTimeout())}}class as{stopwatch=new St;get isFinished(){return this.stopwatch.elapsedMs>500}get size(){return.12*this.stopwatch.elapsedMs}}class rs{constructor(t){this.context=t,this.handles=[Lt.EXPLOSION]}exec(t){if(!this.context.isBrowserVisible)return;const e=t.args,s=new as;s.pos=e.pos,s.type=e.type,this.context.state.addExplosion(s)}}class cs{constructor(t){this.context=t,this.handles=[Lt.TICK]}exec(t){if(!this.context.isBrowserVisible)return;const e=1===t.args.frame;window.requestAnimationFrame((()=>this.context.renderer.renderGame(e)))}}class ls{stopwatch=new St;get isFinished(){return this.stopwatch.elapsedMs>150}get size(){return 120+.13333333333333333*this.stopwatch.elapsedMs}}class hs{constructor(t){this.context=t,this.handles=[Lt.PLAYER_REPEL]}exec(t){const e=t.args,s=new ls;s.player=this.context.state.getPlayerById(e.id),this.context.state.addFart(s)}}class us{stopwatch=new St;get isFinished(){return this.stopwatch.elapsedMs>500}get size(){return.12*this.stopwatch.elapsedMs}}class ds{constructor(t){this.context=t,this.handles=[Lt.PLAYER_KILLED]}exec(t){const e=t.args,s=new us;s.pos=new ie(e.posX,e.posY),this.context.state.addKill(s)}}class gs{constructor(t){this.spec=t,this.stopwatch=new St}get isFinished(){return this.stopwatch.elapsedMs>this.spec.cloudTimeoutMs}get opacity(){return this.stopwatch.elapsedMs<this.spec.cloudGrowMs?this.stopwatch.elapsedMs*this.spec.opacityGrowStep:Math.max(0,this.spec.opacityMax-this.stopwatch.elapsedMs*this.spec.opacityShrinkStep)}get size(){return this.stopwatch.elapsedMs<this.spec.cloudGrowMs?this.spec.sizeStart+this.stopwatch.elapsedMs*this.spec.sizeGrowStep:Math.max(0,this.spec.sizeMax-this.spec.sizeShrinkStep*this.stopwatch.elapsedMs)}}const ps={};class Es{static getFor(t){return ps[t]||(ps[t]=new Es(t)),ps[t]}opacityMax=.22;constructor(t){const e=1+(Ft[t].damage-.3)/1.8;this.cloudTimeoutMs=800*e,this.cloudGrowMs=200*e,this.opacityGrowStep=this.opacityMax/this.cloudGrowMs,this.opacityShrinkStep=this.opacityMax/(this.cloudTimeoutMs-this.cloudGrowMs),this.sizeStart=5*e,this.sizeMax=15*e,this.sizeShrinkStep=this.sizeMax/(this.cloudTimeoutMs-this.cloudGrowMs),this.sizeGrowStep=(this.sizeMax-this.sizeStart)/this.cloudGrowMs,this.spawnFreq=Math.ceil(2*e*1.2),this.distribBandwidth=Math.ceil(3*e)}}class ys{constructor(t){this.context=t,this.handles=[Lt.TICK]}exec(t){if(!this.context.isBrowserVisible)return;const e=t.args;for(const t of this.context.state.getMissiles()){const s=Es.getFor(t.mobType);if(e.frame%s.spawnFreq==0){const n=new gs(s);n.pos=new ie(t.pos);const i=Ft[t.mobType].maxSpeed,o=t.speed.y/i*s.distribBandwidth,a=t.speed.x/i*s.distribBandwidth;n.pos.x+=e.frame%(2*s.spawnFreq)==0?-o:o,n.pos.y+=e.frame%(2*s.spawnFreq)==0?a:-a,this.context.state.addRocketTrailCloud(n)}}}}class fs{constructor(t){this.context=t,this.handles=[Lt.SERVER_ANNOUNCEMENT,Lt.SERVER_ERROR]}exec(t){let e;if(t.type===Lt.SERVER_ANNOUNCEMENT)e=t.args;else{const s=t.args;switch(e={type:Y.ALERT,duration:4e3},s.error){case v.ACCOUNT_BANNED:e.text="Account is banned";break;case v.AFK_DISCONNECT:e.text="Disconnected, away too long.";break;case v.ALREADY_LOGGED_IN:e.text="You are already logged in.";break;case v.CHAT_SPAMMING:e.text="Don't spam!";break;case v.FLAG_CHANGE_TOO_FAST:e.text="Wait before changing your flag.";break;case v.FORBIDDEN_TO_CHANGE_PLANE_IN_BTR:e.text="Can't change aircraft in BTR.";break;case v.GLOBAL_BAN:e.text="You have been banned.";break;case v.INCORRECT_PROTOCOL:e.text="Your client uses an incorrect protocol version.";break;case v.INVALID_LOGIN_DATA:e.text="Invalid login data.";break;case v.NOT_ENOUGH_UPGRADES:e.text="Not enough upgrades";break;case v.PACKET_FLOODING_BAN:e.text="Banned for packet flooding.";break;case v.PACKET_FLOODING_DISCONNECT:e.text="Disconnected for packet flooding.";break;case v.PLAYER_KICKED:e.text="You have been kicked.";break;case v.REQUIRED_INACTIVITY_AND_HEALTH_TO_RESPAWN:e.text="Two seconds of inactivity and full health required to respawn.";break;case v.REQUIRED_INACTIVITY_AND_HEALTH_TO_SPECTATE:e.text="Two seconds of inactivity and full health required to spectate.";break;case v.UNKNOWN_COMMAND:e.text="Unknown command";break;case v.UNKNOWN_ERROR:e.text="Unknown error"}}this.context.renderer.showServerMessage(e.type,e.duration,e.text);const s=document.createElement("div");s.innerHTML=e.text,e.text=s.innerText,this.context.renderer.addChat(null,"Server",te.CHAT,e.text,null)}}class ms{constructor(t){this.context=t,this.handles=[Lt.PLAYER_KILLED]}exec(t){const e=t.args;if(!e.killer)return;let s="";e.killer===this.context.state.id?s=`You have destroyed ${this.context.state.getPlayerName(e.id)}`:e.id===this.context.state.id&&(s=`Destroyed by ${this.context.state.getPlayerName(e.killer)}`,this.context.renderer.renderKill()),s&&this.context.renderer.showServerMessage(Y.INFO,1e3,s)}}class As{constructor(t){this.context=t,this.handles=[Lt.PLAYER_HIT]}exec(t){t.args.players.find((t=>t.id===this.context.state.id))&&this.context.renderer.renderHit()}}class Us{constructor(t){this.context=t}detectVisibilityChange(){let t,e;void 0!==document.hidden?(t="hidden",e="visibilitychange"):void 0!==document.msHidden?(t="msHidden",e="msvisibilitychange"):void 0!==document.webkitHidden&&(t="webkitHidden",e="webkitvisibilitychange");document.addEventListener(e,(()=>{const e=!document[t];this.context.setBrowserVisibility(e)}),!1),this.context.isBrowserVisible=!document[t]}throttleZoom(){const t=new St;document.getElementById("root").addEventListener("wheel",(e=>{if(e.ctrlKey){if(t.elapsedSeconds<1)return void e.preventDefault();t.start()}}))}}class Rs{debug(t,...e){window.debug&&this.log(t,...e)}info(t,...e){this.log(t,...e)}warn(t,...e){this.log(t,...e)}error(t,...e){this.log(t,...e)}fatal(t,...e){this.log(t,...e)}log(t,...e){console.log(t,...e)}}class ws{create(t){return new WebSocket(t)}}class Ts{constructor(t){this.context=t}setClip(t){t.width=window.innerWidth+40,t.height=window.innerHeight+40,t.style.left="-20px",t.style.top="-20px";const e=this.context.settings.zoom;if(this.lastWidth!==t.width||this.lastHeight!==t.height){const s=t.width/e,n=t.height/e;this.context.connection.sendScreenSize(s,n),this.lastWidth=t.width,this.lastHeight=t.height,this.context.settings.horizonX=s/2,this.context.settings.horizonY=n/2}const s=this.context.state.getFocusedPlayer().pos,n=t.width/e/2,i=t.height/e/2;this.clipRectangle=[new ie(s.x-n,s.y-i),new ie(s.x+n,s.y+i)],this.zoom=e}isVisible(t){return this.clipRectangle[0].x<t.x&&this.clipRectangle[1].x>t.x&&this.clipRectangle[0].y<t.y&&this.clipRectangle[1].y>t.y}translate(t){return new ie((t.x-this.clipRectangle[0].x)*this.zoom,(t.y-this.clipRectangle[0].y)*this.zoom)}scale(t){return t*this.zoom}getClipRectangle(){return[new ie(this.clipRectangle[0]),new ie(this.clipRectangle[1])]}getClipSize(){return new ie(this.lastWidth,this.lastHeight)}}class xs{constructor(t,e){this.clip=t,this.context=e,this.backgroundImage=document.getElementById("map")}renderBackground(t){const e=this.clip.getClipRectangle();if(this.context.settings.useBitmaps){const s=new ie(e[1].x-e[0].x,e[1].y-e[0].y);t.drawImage(this.backgroundImage,.25*(Rt.WIDTH/2+e[0].x),.25*(Rt.HEIGHT/2+e[0].y),.25*s.x,.25*s.y,0,0,this.clip.scale(s.x),this.clip.scale(s.y))}t.fillStyle=constants.BACKGROUND_GRID_COLOR;const s=this.clip.scale(100);for(let n=e[0].y-e[0].y%s;n<e[1].y;n+=s)for(let i=e[0].x-e[0].x%s;i<e[1].x;i+=s){const e=this.clip.translate(new ie(i,n));t.fillRect(e.x,e.y,1,1)}}}class Is{constructor(t){this.context=t,this.debugPanel=document.getElementById("debugPanel")}render(){if(!this.context.settings.shouldShowDebugInfo)return;const t=this.context.connection.getLagMs().toLocaleString("en-us",{maximumFractionDigits:2,minimumFractionDigits:2}),e=this.context.state.skippedFrames.toString();this.debugPanel.innerHTML=`Lag: ${t}\nSkipped frames: ${e}\nMy id: ${this.context.state.id}\nGameType: ${this.context.gameType}`}}class Ss{constructor(t,e){this.context=t,this.clip=e}renderExplosions(t){t.fillStyle=constants.EFFECTS_EXPLOSION_COLOR;for(const e of this.context.state.getActiveExplosions()){const s=e.pos;if(s&&this.clip.isVisible(s)){const n=this.clip.translate(s);t.beginPath(),t.arc(n.x,n.y,this.clip.scale(e.size),0,2*Math.PI),t.fill()}}t.fillStyle=constants.EFFECTS_KILL_COLOR;for(const e of this.context.state.getActiveKills()){const s=e.pos;if(s&&this.clip.isVisible(s)){const n=this.clip.translate(s);t.beginPath(),t.arc(n.x,n.y,this.clip.scale(e.size),0,2*Math.PI),t.fill()}}t.fillStyle=constants.EFFECTS_FART_COLOR;for(const e of this.context.state.getActiveFarts()){if(!e.player)continue;const s=e.player.pos;if(s&&this.clip.isVisible(s)){const n=this.clip.translate(s);t.beginPath(),t.arc(n.x,n.y,this.clip.scale(e.size),0,2*Math.PI),t.fill()}}for(const e of this.context.state.getActiveRocketTrailClouds()){const s=e.pos;if(s&&this.clip.isVisible(s)){const n=e.opacity;if(0===n)continue;t.fillStyle=`rgba(${constants.EFFECTS_MISSILE_BASE_COLOR}, ${n})`;const i=this.clip.translate(s);t.beginPath();const o=this.clip.scale(e.size);t.arc(i.x,i.y,o,0,2*Math.PI),t.fill()}}}}const Ps={blue:{x:-9670,y:-1470},red:{x:8600,y:-940}};class Ls{constructor(t,e){this.context=t,this.clip=e,this.blueFlag=document.getElementById("blue-flag"),this.redFlag=document.getElementById("red-flag")}render(t){const e=this.context.state.getCtfTeam(ot.RED),s=this.context.state.getCtfTeam(ot.BLUE);this.renderFlag(e,this.redFlag,t),this.renderFlag(s,this.blueFlag,t),this.renderBase(t,Ps.blue,constants.CTF_BLUE_TEAM_COLOR),this.renderBase(t,Ps.red,constants.CTF_RED_TEAM_COLOR)}renderBase(t,e,s){const n=new ie(e.x-60,e.y-60),i=new ie(e.x+60,e.y+60);if(!this.clip.isVisible(n)&&!this.clip.isVisible(i))return;const o=this.clip.translate(e),a=this.clip.scale(120),r=a/2;t.strokeStyle=s,t.lineWidth=this.clip.scale(8),t.lineJoin="round",t.strokeRect(o.x-r,o.y-r,a,a)}renderFlag(t,e,s){let n,i=t.flagPos;if(!i)return;let o=!1;if(t.flagState===rt.DYNAMIC){const e=this.context.state.getPlayerById(t.flagTakenById);e&&(i=e.mostReliablePos,n=e.isVisibleOnScreen&&this.clip.isVisible(i),o=!0)}else n=this.clip.isVisible(i);if(n){const t=this.clip.translate(i),n=this.clip.scale(e.width),a=this.clip.scale(e.height);s.drawImage(e,0,0,e.width,e.height,t.x-n/2+(o?n/2:0),t.y-a/2-(o?a/2:0),n,a)}}}const _s=Rt.WIDTH/2,Os=Rt.HEIGHT/2;class bs{constructor(t){this.context=t,this.canvas=document.getElementById("minimap-canvas"),this.canvasContext=this.canvas.getContext("2d"),this.blueFlag=document.getElementById("blue-flag"),this.redFlag=document.getElementById("red-flag")}highlight(t){this.playerToHighlight=t}render(){this.canvasContext.clearRect(0,0,this.canvas.width,this.canvas.height);const t=this.canvas.width/Rt.WIDTH,e=this.canvas.height/Rt.HEIGHT,s=this.context.state.id;for(const n of this.context.state.getPlayers()){if(n.status===J.INACTIVE)continue;const i=new ie((n.mostReliablePos.x+_s)*t,(n.mostReliablePos.y+Os)*e);if(n.id===s)this.canvasContext.strokeStyle=constants.MINIMAP_HIGHLIGHT_COLOR,this.canvasContext.strokeRect(i.x-7.5,i.y-5,15,10);else{let t=constants.MINIMAP_FFA_PLAYER_COLOR;switch(n.team===ot.BLUE?t=constants.CTF_BLUE_TEAM_COLOR:n.team===ot.RED&&(t=constants.CTF_RED_TEAM_COLOR),n.ranking){case 1:t=constants.MINIMAP_PLAYER_1_COLOR;break;case 2:t=constants.MINIMAP_PLAYER_2_COLOR;break;case 3:t=constants.MINIMAP_PLAYER_3_COLOR}this.canvasContext.fillStyle=t,this.canvasContext.beginPath(),this.canvasContext.arc(i.x,i.y,3,0,2*Math.PI),this.canvasContext.fill(),n.id===this.playerToHighlight&&(this.canvasContext.strokeStyle=constants.MINIMAP_HIGHLIGHT_COLOR,this.canvasContext.beginPath(),this.canvasContext.arc(i.x,i.y,6,0,2*Math.PI),this.canvasContext.stroke())}}if(this.context.gameType===ft.CTF){const t=this.context.state.getCtfTeam(ot.RED),e=this.context.state.getCtfTeam(ot.BLUE);this.renderFlag(t,this.redFlag,this.canvasContext,Ps.red,constants.CTF_RED_TEAM_COLOR),this.renderFlag(e,this.blueFlag,this.canvasContext,Ps.blue,constants.CTF_BLUE_TEAM_COLOR)}}renderFlag(t,e,s,n,i){let o=t.flagPos;if(!o)return;if(t.flagState===rt.DYNAMIC){const e=this.context.state.getPlayerById(t.flagTakenById);e&&(o=e.mostReliablePos)}const a=this.canvas.width/Rt.WIDTH,r=this.canvas.height/Rt.HEIGHT,c=new ie((o.x+_s)*a,(o.y+Os)*r),l=10/e.width*e.height;if(s.drawImage(e,0,0,e.width,e.height,c.x-5,c.y-l/2,10,l),!o.equals(n)){const t=new ie((n.x+_s)*a,(n.y+Os)*r);this.canvasContext.strokeStyle=i,this.canvasContext.strokeRect(t.x-2,t.y-2,4,4)}}}class Cs{constructor(t,e){this.context=t,this.clip=e,this.missileImage=document.getElementById("missile")}renderMissiles(t){t.fillStyle=constants.MISSILE_COLOR;for(const e of this.context.state.getMissiles()){const s=e.pos;if(!s)continue;if(!this.clip.isVisible(s))continue;const n=this.clip.translate(s),i=1+(Ft[e.mobType].damage-.3)/1.8;if(this.context.settings.useBitmaps){t.translate(n.x,n.y),t.rotate(e.rot);let s=!1;this.context.gameType===ft.CTF&&e.team&&e.team===this.context.state.team&&e.ownerId!==this.context.state.id&&(t.globalAlpha=.4,s=!0);const o=this.clip.scale(this.missileImage.width*i*1),a=this.clip.scale(this.missileImage.height*i*1);t.drawImage(this.missileImage,0,0,this.missileImage.width,this.missileImage.height,-o/2,-a/2,o,a),s&&(t.globalAlpha=1),t.rotate(-e.rot),t.translate(-n.x,-n.y)}else t.beginPath(),t.arc(n.x,n.y,this.clip.scale(4*i),0,2*Math.PI),t.fill()}}}class Ms{constructor(t,e){this.clip=t,this.context=e}renderPath(t){const e=this.context.botstate.path;if(e&&e.length>0){let s=0;t.strokeStyle="orange",t.lineWidth=2,t.beginPath();for(const n of e){const e=this.clip.translate(n);0===s?t.moveTo(e.x,e.y):t.lineTo(e.x,e.y),t.stroke(),1===s&&(t.font="16px 'Courier New'",t.fillStyle="white",t.fillText("dist: "+this.context.botstate.distanceToTarget,e.x,e.y)),s++}}}}class Ns{constructor(t){this.context=t,this.listElement=document.getElementById("player-list")}render(){const t=this.context.state.getPlayers();t.sort(((t,e)=>(t.ranking||Number.MAX_SAFE_INTEGER)-(e.ranking||Number.MAX_SAFE_INTEGER)));let e=0;for(const s of t){if(s.status===J.INACTIVE&&"Server"===s.name)continue;let t,n,i,o,a,r=this.listElement.rows[e];r?(t=r.cells[0],n=r.cells[1],i=r.cells[2],o=r.cells[3],a=n.firstElementChild):(r=this.listElement.insertRow(),t=r.insertCell(),t.className="playerlist-pos",n=r.insertCell(),n.className="playerlist-flag",i=r.insertCell(),i.className="playerlist-name player-name",o=r.insertCell(),o.className="playerlist-score",a=document.createElement("img"),a.width=24,a.height=24,n.appendChild(a)),r.className=s.status===J.INACTIVE?"playerlist-player-inactive":"",s.team===ot.BLUE?r.className+=" playerlist-team-blue":s.team===ot.RED&&(r.className+=" playerlist-team-red");const c=s.ranking||e;t.innerText=`${c}. `;const l=wt[""+s.flag]||"JOLLY";a.src="flags/"+l+".png",s.level?i.innerText=`${s.name} [${s.level}]`:i.innerText=s.name,i.dataset.name=encodeURI(s.name),i.dataset.id=s.id.toString(),o.innerText=`${s.score}`,e++}for(;this.listElement.rows[e];){this.listElement.rows[e].remove()}}}class ks{constructor(t,e){this.context=t,this.clip=e,this.flagImages={},this.saysToSay=[],this.images={mohawk:document.getElementById("mohawk"),prowler:document.getElementById("prowler"),raptor:document.getElementById("raptor"),spirit:document.getElementById("spirit"),tornado:document.getElementById("tornado")}}addSay(t,e){this.saysToSay.push({playerId:t,msg:e,sw:new St})}renderPlayers(t){const e=this.clip.scale(11);t.font=e+"pt 'Tahoma'";const s=this.clip.scale(24),n=this.clip.scale(4),i=this.clip.scale(10);this.flagImages.JOLLY||this.initFlagImages();for(const o of this.context.state.getPlayers()){if(o.status===J.INACTIVE)continue;const a=o.mostReliablePos,r=a&&this.clip.isVisible(a),c=r&&!o.isVisibleOnScreen,l=r&&o.stealthed,h=o.team===this.context.state.team,u=o.type===Ht.PROWLER&&!h&&(c||l);if(!o.isVisibleOnScreen&&!u)continue;const d=this.clip.translate(a);t.translate(d.x,d.y),u?t.filter="blur(10px)":t.rotate(o.rot),this.renderAircraft(o,t,u),u?t.filter="none":(t.rotate(-o.rot),this.renderBars(t,o)),this.renderName(o,t,s,i,e,n),this.renderTextBubble(o,t),t.translate(-d.x,-d.y)}}renderTextBubble(t,e){for(const s of this.saysToSay)if(s.playerId===t.id){e.fillStyle=constants.PLAYER_SAY_BACKGROUND_COLOR;const t=e.measureText(s.msg).width,n=t/2,i=-this.clip.scale(80),o=this.clip.scale(20),a=this.clip.scale(40);e.fillRect(-n-o,i-o,t+2*o,a),e.fillStyle=constants.PLAYER_SAY_FOREGROUND_COLOR,e.fillText(s.msg,-n,i)}this.saysToSay=this.saysToSay.filter((t=>t.sw.elapsedSeconds<5))}renderName(t,e,s,n,i,o){let a=this.context.settings.useBitmaps?constants.PLAYER_NAME_COLOR:constants.PLAYER_NAME_NOBITMAP_COLOR;t.team===ot.BLUE?a=constants.PLAYER_NAME_BLUE_TEAM_COLOR:t.team===ot.RED&&(a=constants.PLAYER_NAME_RED_TEAM_COLOR),e.fillStyle=a;let r="";t.level&&(r=` [${t.level}]`);const c=`${t.ranking||"?"}. ${t.name}${r}`,l=this.context.settings.useBitmaps?s+n:0,h=e.measureText(c).width+l,u=-h/2,d=this.clip.scale(70);if(e.fillText(c,u,d),this.context.settings.useBitmaps){const n=wt[""+t.flag]||"JOLLY",a=this.flagImages[n];e.drawImage(a,0,0,24,24,u+h-s,d-s+i-o,s,s)}}renderBars(t,e){t.strokeStyle=constants.PLAYER_HEALTH_OK_COLOR,e.health<.3?t.strokeStyle=constants.PLAYER_HEALTH_DANGER_COLOR:e.health<.6&&(t.strokeStyle=constants.PLAYER_HEALTH_WARN_COLOR);const s=this.clip.scale(75);t.lineWidth=this.clip.scale(8),t.globalAlpha=e.id===this.context.state.id?.8:.5,t.beginPath(),t.arc(0,0,s,Math.PI,Math.PI+Math.PI*e.health/2),t.stroke(),t.strokeStyle=constants.PLAYER_ENERGY_COLOR,t.beginPath();const n=Math.max(.01,e.energy);if(t.arc(0,0,s,0,2*Math.PI-Math.PI*n/2,!0),t.stroke(),e.powerUps.inferno||e.powerUps.shield){t.strokeStyle=e.powerUps.shield?constants.PLAYER_SHIELD_COLOR:constants.PLAYER_INFERNO_COLOR,t.beginPath();const s=e.shieldOrInfernoTimer?Math.max(.01,1-e.shieldOrInfernoTimer.timeoutFraction):1;t.lineWidth=this.clip.scale(16);const n=this.clip.scale(63);t.arc(0,0,n,Math.PI,Math.PI+Math.PI*s),t.stroke()}t.globalAlpha=1}renderAircraft(t,e,s){const n=jt[t.type];if(s){e.fillStyle=t.team===ot.BLUE?constants.PLAYER_NOBITMAP_BLUE_TEAM_PROWLER_COLOR:t.team===ot.RED?constants.PLAYER_NOBITMAP_RED_TEAM_PROWLER_COLOR:constants.PLAYER_NOBITMAP_PROWLER_COLOR;const s=this.clip.scale(300);e.beginPath(),e.arc(0,0,s,0,2*Math.PI),e.fill()}else if(this.context.settings.useBitmaps){const s=this.images[n.name],i=1,o=this.clip.scale(s.width*i),a=this.clip.scale(s.height*i),r=o/2,c=a/2;t.stealthed&&(e.globalAlpha=.4),e.drawImage(s,0,0,s.width,s.height,-r,-c,o,a),e.globalAlpha=1}else{t.team===ot.BLUE?e.fillStyle=t.stealthed?constants.PLAYER_NOBITMAP_BLUE_TEAM_PROWLER_COLOR:constants.PLAYER_NOBITMAP_BLUE_TEAM_COLOR:t.team===ot.RED?e.fillStyle=t.stealthed?constants.PLAYER_NOBITMAP_RED_TEAM_PROWLER_COLOR:constants.PLAYER_NOBITMAP_RED_TEAM_COLOR:e.fillStyle=t.stealthed?constants.PLAYER_NOBITMAP_PROWLER_COLOR:constants.PLAYER_NOBITMAP_COLOR;const s=n.collisions;for(const t of s){const s=new ie(this.clip.scale(t[0]),this.clip.scale(t[1])),n=this.clip.scale(t[2]);e.beginPath(),e.arc(s.x,s.y,n,0,2*Math.PI),e.fill()}}}initFlagImages(){for(const t of Object.keys(Tt))this.flagImages[t]=document.getElementById(`flag-${t}`)}}class Ds{constructor(t){this.context=t,this.scoreElement=document.getElementById("stats-score"),this.upgradesElement=document.getElementById("stats-upgrades"),this.killsElement=document.getElementById("stats-kills"),this.deathsElement=document.getElementById("stats-deaths"),this.upgrSpeedElement=document.getElementById("stats-speed"),this.upgrDefenseElement=document.getElementById("stats-defense"),this.upgrEnergyElement=document.getElementById("stats-energy"),this.upgrMissileElement=document.getElementById("stats-missile"),this.ctfInfo=document.getElementById("ctf-info"),this.blueScore=document.getElementById("blue-score"),this.redScore=document.getElementById("red-score"),this.blueFlagLocation=document.getElementById("blue-flag-location"),this.redFlagLocation=document.getElementById("red-flag-location")}toString(t){return 0===t||t?""+t:""}render(){const t=this.context.state.getFocusedPlayer();if(!t)return;this.scoreElement.innerText=this.toString(t.score),this.killsElement.innerText=this.toString(t.kills),this.deathsElement.innerText=this.toString(t.deaths);const e=t.upgrades||new ue;if(this.upgradesElement.innerText=this.toString(e.available),this.upgrDefenseElement.innerText=this.toString(e.defense),this.upgrEnergyElement.innerText=this.toString(e.energy),this.upgrMissileElement.innerText=this.toString(e.missile),this.upgrSpeedElement.innerText=this.toString(e.speed),this.context.gameType===ft.CTF){"block"!==this.ctfInfo.style.display&&(this.ctfInfo.style.display="block");const t=this.context.state.getCtfTeam(ot.BLUE),e=this.context.state.getCtfTeam(ot.RED),s=t.score?t.score:0,n=e.score?e.score:0;this.blueScore.innerText=this.toString(s),this.redScore.innerText=this.toString(n);let i="?";if(t.flagState===rt.DYNAMIC){i=`taken by ${this.context.state.getPlayerName(t.flagTakenById)}`}else i=t.flagPos.equals(Ps.blue)?"home":"abandoned";this.blueFlagLocation.innerText=i;let o="?";if(e.flagState===rt.DYNAMIC){o=`taken by ${this.context.state.getPlayerName(e.flagTakenById)}`}else o=e.flagPos.equals(Ps.red)?"home":"abandoned";this.redFlagLocation.innerText=o}}}const vs=Math.PI/4;class Bs{constructor(t,e){this.context=t,this.clip=e,this.logger=new Jt(t)}renderUpcrates(t){for(const e of this.context.state.getUpcrates()){const s=e.pos;if(!s||!this.clip.isVisible(s))continue;let n=constants.UPCRATES_UPGRADE_CRATE_COLOR;switch(e.mobType){case K.INFERNO:n=constants.UPCRATES_RAMPAGE_CRATE_COLOR;break;case K.SHIELD:n=constants.UPCRATES_SHIELD_CRATE_COLOR}const i=this.clip.translate(s);t.translate(i.x,i.y),t.rotate(vs),t.beginPath(),t.fillStyle=n;const o=this.clip.scale(12),a=this.clip.scale(24);t.rect(-o,-o,a,a),t.fill(),t.strokeStyle=constants.UPCRATES_BORDER_COLOR,t.stroke(),t.rotate(-vs),t.translate(-i.x,-i.y)}}}const Ys=[[1009,-2308,108],[1241,-2490,60],[1157,-2379,84],[622,-2126,48],[669,-2187,72],[-392,-1669,132],[-273,-1746,60],[-252,-1504,120],[1553,-2016,48],[1637,-1972,60],[1736,-1922,60],[2150,-2406,72],[2238,-2318,108],[2364,-2391,72],[2491,-2682,72],[2596,-2671,108],[-150,-3147,48],[-155,-3044,84],[-427,-3600,48],[-259,-2982,60],[-379,-3529,72],[-665,-3052,60],[20,-1816,60],[127,-1799,60],[263,-2572,48],[405,-2570,108],[851,-4183,120],[754,-3971,108],[1757,-5065,132],[1169,-4453,108],[2054,-5244,108],[1631,-4901,108],[2305,-5281,108],[1007,-4281,96],[2766,-5202,96],[2927,-5204,84],[3206,-5218,36],[3099,-5193,72],[1417,-4726,120],[2844,-1513,60],[3206,-1464,120],[2881,-1403,108],[3804,-2025,84],[4116,-1778,108],[3715,-1508,72],[4247,-1126,72],[3860,268,60],[4334,-1011,132],[3849,349,72],[3956,490,96],[4073,667,108],[3583,-864,96],[4135,836,120],[4785,-743,120],[4993,-839,108],[5224,-482,84],[5235,-1238,132],[5419,-1346,72],[6075,-5099,96],[5767,-4953,108],[5896,-4967,108],[5384,-4642,108],[5704,-4857,108],[5563,-4697,108],[5406,-4470,132],[5352,-3964,108],[5309,-3665,132],[5247,-3464,108],[5300,-3121,108],[3524,-3340,132],[3661,-3589,108],[7236,-1376,72],[7624,-1610,96],[7403,-1555,84],[7514,-1568,108],[3660,-2705,108],[3374,-2813,96],[7347,-1447,108],[7236,-775,60],[7207,-631,108],[7303,-468,108],[7262,-1263,108],[7404,-350,120],[7589,-305,108],[7741,-1589,120],[7949,-1594,120],[8152,-1599,132],[8378,-1602,144],[7873,-321,72],[8543,-1661,84],[7790,-259,120],[8675,-1573,120],[8163,-245,84],[8329,-311,84],[8275,-229,120],[8447,-277,120],[8824,-1447,108],[7221,-1140,60],[8924,-1273,108],[6844,-950,120],[8949,-1060,132],[8904,-920,96],[8582,-338,84],[8963,-803,120],[8680,-322,108],[8811,-449,108],[8910,-610,108],[6855,114,96],[6971,241,120],[6852,656,60],[6980,706,108],[6946,939,120],[6027,-560,72],[7521,425,48],[7599,389,60],[5863,-431,108],[9392,262,108],[7521,512,72],[9807,1027,60],[9554,237,120],[9346,392,144],[9789,1142,84],[9747,-532,96],[8591,347,72],[9951,-509,120],[9308,2417,60],[10185,-522,108],[10330,2147,72],[9350,2480,84],[10503,2124,108],[12500,2628,60],[13188,2864,60],[12637,2659,84],[13262,2899,60],[13777,5168,60],[15709,6399,48],[13539,5664,60],[15660,6474,48],[13743,5248,84],[15482,6600,48],[15591,6525,36],[13487,5738,84],[15407,6702,72],[8171,-2568,60],[16001,6015,72],[16017,6110,48],[6496,-1491,60],[6626,-1480,84],[6190,-1022,96],[8325,-2615,120],[8222,-2412,120],[9204,-2288,108],[9279,-2216,120],[10375,-1558,96],[10309,-1421,108],[10247,-1216,144],[10079,-2310,108],[10320,-2330,120],[10942,-2963,108],[10807,-2778,132],[12989,-1929,72],[12613,-1181,48],[12559,-1120,60],[11642,-1900,84],[11558,-1692,108],[11509,-1479,60],[12559,-2673,96],[12446,-2487,120],[12375,-2303,108],[10363,-3514,84],[10290,-3340,108],[10162,-3207,84],[9003,-3048,108],[9161,-3119,72],[14550,-3462,108],[14407,-3335,108],[14366,-4493,108],[14477,-4437,120],[15305,-4230,108],[15481,-4283,108],[15349,-5009,48],[11874,-4879,72],[15453,-4984,84],[11907,-4742,96],[12440,-4278,60],[11980,-4582,108],[12131,-4387,132],[15681,-4973,120],[12591,-4252,96],[12777,-4244,108],[12969,-4227,108],[15897,-5071,108],[13204,-4228,120],[11592,-5261,84],[12743,-4826,48],[10102,-5078,84],[12854,-4782,108],[10191,-5033,84],[10523,-5133,120],[10336,-4977,132],[10667,-5250,96],[9665,-6403,84],[10798,-5379,60],[9670,-5547,108],[9834,-6369,120],[9864,-5572,132],[11362,-3957,108],[11162,-3830,120],[8922,-6173,120],[9003,-5368,60],[8453,-6153,72],[8954,-5229,108],[8905,-5072,96],[8704,-3873,108],[8578,-6105,96],[8508,-3710,84],[8614,-5400,60],[8788,-4922,132],[8936,-3905,72],[9701,-4613,108],[6973,-4776,72],[7016,-4674,108],[9124,-3853,108],[7253,-4648,96],[6602,-4591,72],[8510,-5322,108],[6687,-3810,84],[9525,-4492,132],[7461,-4705,108],[9280,-3812,96],[6467,-2811,36],[6842,-3820,96],[6483,-2725,72],[7675,-4864,132],[6991,-2885,108],[6610,-2664,108],[6822,-2736,108],[6763,-4582,108],[6509,-2490,108],[7216,-3865,132],[7018,-3708,120],[2254,-3301,96],[6378,-2310,96],[7197,-2857,108],[2609,-3483,60],[2449,-3385,108],[4585,-2889,84],[4470,-2768,96],[4083,-4033,108],[1568,-2869,48],[4336,-4105,144],[1977,-1678,60],[1412,-3642,60],[1570,-2792,72],[1932,-1586,72],[1310,-3547,72],[3611,1391,120],[3558,2174,108],[3431,1563,108],[3142,2813,84],[3330,2296,132],[3001,2818,72],[3703,2044,48],[2872,3863,108],[3125,2942,132],[2841,4018,132],[2402,5140,72],[2511,5167,96],[-14607,-5112,108],[-14430,-5180,108],[-14197,-5222,144],[-14895,-4703,60],[-14797,-4728,48],[-14697,-4739,48],[-13919,-5281,132],[-13646,-5170,84],[-13400,-5068,144],[-13099,-5108,132],[-12824,-5092,108],[-12631,-5044,108],[-12427,-4914,108],[-12270,-4816,84],[-11772,-4983,84],[-11940,-4867,108],[-12091,-4699,108],[-12270,-4529,84],[-12460,-4396,108],[-13058,-4252,108],[-12894,-4096,84],[-12738,-4077,84],[-13546,-4341,48],[-13428,-4299,108],[-14679,-4192,84],[-14368,-4308,84],[-14495,-4133,132],[-12072,-3824,96],[-11904,-3648,120],[-11654,-3569,84],[-11648,-3357,108],[-11420,-3359,108],[-11296,-3135,84],[-10782,-2838,96],[-11410,-3039,36],[-10581,-2773,132],[-11118,-5114,96],[-10675,-5079,108],[-10205,-4890,96],[-11543,-4164,96],[-11287,-4244,60],[-10018,-4747,120],[-9278,419,60],[-9341,470,60],[-9180,496,96],[-11365,-4131,120],[-9353,0,72],[-8975,528,120],[-9413,89,108],[-8230,770,48],[-9231,17,84],[-6808,1667,60],[-6694,1622,96],[-8285,855,72],[-6793,1796,96],[-6865,1935,60],[-7043,2222,72],[-7083,2368,72],[-7103,2533,84],[-7099,2721,96],[-7178,2874,48],[-6964,3110,84],[-6246,4191,72],[-6735,3446,48],[-6722,3537,84],[-6396,3388,108],[-6787,3140,108],[-6227,4488,84],[-6281,3953,72],[-6530,3576,132],[-6147,3994,132],[-6141,4292,144],[-6377,5578,84],[-6152,4569,108],[-6222,4769,84],[-6266,4956,72],[-6233,5414,108],[-6347,5646,84],[-6400,6066,84],[-6411,6261,96],[-6565,7043,72],[-6377,6415,108],[-6440,6614,84],[-5944,1954,60],[-6001,2039,96],[-6467,7070,108],[-4963,3608,72],[-4776,3510,48],[-5785,1998,132],[-3708,3449,72],[-3790,3582,108],[-4031,3697,84],[-4859,3634,120],[-3850,3730,120],[-4689,4605,108],[-3492,2892,72],[-4507,4483,72],[-4829,2745,108],[-4435,4273,108],[-3383,2930,108],[-4888,2821,108],[-5372,5172,60],[-5036,2981,108],[-9895,-1942,120],[-9371,-2159,72],[-9995,-1773,108],[-5280,5218,108],[-5079,5183,108],[-5149,3079,72],[-9695,-2048,120],[-5063,5374,108],[-9504,-2059,120],[-8948,-2140,84],[-9262,-2081,132],[-9068,-2071,120],[-8861,-2045,132],[-8654,-2083,120],[-8473,-2048,120],[-8283,-1965,120],[-8182,-1863,108],[-10037,-1579,108],[-10063,-1365,108],[-10074,-1190,108],[-8167,-1225,60],[-8188,-1087,96],[-9975,-1022,108],[-9835,-910,120],[-9709,-848,120],[-9532,-792,120],[-9348,-779,120],[-9131,-784,132],[-8754,-795,84],[-8587,-797,120],[-8424,-856,108],[-8246,-921,108],[-8153,-1701,84],[-6447,-2137,72],[-8153,-1591,60],[-7694,-1393,120],[-6541,-2030,84],[-7135,-1547,84],[-5885,-2958,72],[-7171,-1440,96],[-5620,-3123,72],[-6631,-1866,96],[-5882,-3696,96],[-5716,-2944,108],[-5949,-3528,60],[-6869,-4052,96],[-7081,-2673,60],[-6725,-4069,72],[-10487,-2295,60],[-7032,-2749,72],[-10769,-3817,72],[-6607,-4081,60],[-10849,-1824,84],[-10479,-2146,108],[-7003,-2611,108],[-10749,-1511,72],[-10697,-1953,120],[-10848,-1330,108],[-10912,-1220,60],[-9843,-2685,84],[-10823,-3717,84],[-9697,-2713,72],[-10080,-3431,48],[-10648,-3844,108],[-9530,-2695,120],[-2387,-6791,108],[-8465,-5037,84],[-2550,-6627,108],[-9325,-2822,84],[-10140,-3346,96],[-8461,-4908,108],[8116,-1076,96],[8115,-940,96],[-2503,-6359,168],[-9062,-1580,96],[8120,-790,96],[-9065,-1444,96],[-2615,-6159,120],[-2744,-5943,132],[-3713,-4955,108],[-9061,-1292,96],[-1551,-4718,60],[5251,-6249,60],[5192,-6181,48],[-2898,-5732,108],[-1705,-4629,96],[1618,-7035,60],[-3829,-4776,108],[-2851,-5589,132],[-2974,-5399,132],[-3952,-4568,108],[-4135,-4368,132],[-3428,-5104,132],[-3167,-5254,108],[-3049,-6916,120],[-3097,-6722,108],[-3190,-6493,120],[-3318,-6284,132],[-4672,-5861,132],[-4480,-5668,120],[-4294,-5548,108],[-3433,-6072,120],[-3568,-5881,120],[-3736,-5698,144],[-3978,-7517,108],[-3956,-5572,120],[-4103,-5400,120],[-4281,-5240,120],[-4409,-5034,120],[-4475,-4808,108],[-2777,-7546,120],[-2542,-7502,108],[-2398,-7364,108],[-2350,-7151,108],[-2315,-6976,96],[-3749,-7488,120],[-2995,-7596,144],[-3253,-7558,132],[-3468,-7472,120],[-5028,-6473,120],[-3604,-7301,132],[-3678,-7078,132],[-3835,-6826,132],[-3935,-6595,120],[-5214,-7381,120],[-4065,-6416,132],[-4174,-6231,84],[-4556,-6940,120],[-4663,-6781,120],[-4748,-6548,156],[-4847,-6257,132],[-4806,-6016,108],[-4950,-7410,168],[-5470,-7251,156],[-5637,-7038,120],[-5593,-6819,120],[-5406,-6727,120],[-5263,-6580,120],[-4636,-7476,120],[-4399,-7496,108],[-6769,-7571,108],[-6853,-7377,108],[-8273,-7231,60],[-4182,-7512,108],[-7525,-5855,108],[-7495,-6329,60],[-7297,-6946,108],[-8148,-7137,84],[-7030,-7301,84]];class Fs{constructor(t,e){this.clip=t,this.context=e;const s=document.getElementById("mountain-medium"),n=document.getElementById("mountain-large"),i=[];i.push(document.getElementById("mountain-regular-a")),i.push(document.getElementById("mountain-regular-b")),i.push(document.getElementById("mountain-regular-c"));const o=document.getElementById("mountain-small"),a=document.getElementById("mountain-smaller"),r=document.getElementById("mountain-mini");let c=0;this.wallImages={};for(const t of Ys){const e=t[2];let l;l=e>=132?n:e>=120?s:e>=108?i[c%i.length]:e>=84?o:e>=60?a:r,t[3]=c,this.wallImages[c]=l,c++}}renderWalls(t){for(const e of Ys){const s=new ie(e[0],e[1]),n=e[2],i=new ie(s.x-n,s.y-n),o=new ie(s.x+n,s.y+n);if(this.clip.isVisible(i)||this.clip.isVisible(o)){const i=this.clip.translate(s);if(this.context.settings.useBitmaps){const s=1.4*this.clip.scale(n),o=e[3],a=this.wallImages[o];t.drawImage(a,0,0,a.width,a.height,i.x-s,i.y-s,2*s,2*s)}else{const e=this.clip.scale(n);t.fillStyle=constants.WALLS_NOBITMAP_COLOR,t.beginPath(),t.arc(i.x,i.y,e,0,2*Math.PI),t.fill()}}}}}class Vs{constructor(t){this.context=t,this.ignoredPlayers=[],this.getUiElements(),this.periodicLogger=new Jt(t),this.clip=new Ts(t),this.backgroundRenderer=new xs(this.clip,t),this.wallsRenderer=new Fs(this.clip,t),this.flagRenderer=new Ls(t,this.clip),this.upcratesRenderer=new Bs(t,this.clip),this.playersRenderer=new ks(t,this.clip),this.missilesRenderer=new Cs(t,this.clip),this.explosionsRenderer=new Ss(t,this.clip),this.minimapRenderer=new bs(t),this.playerListRenderer=new Ns(t),this.statsRenderer=new Ds(t),this.debugInfoRenderer=new Is(t),this.pathRenderer=new Ms(this.clip,t)}addMessageToPlayer(t){this.chatBox.innerHTML+=`<div class="chat chat-warning">${t}</div>`,this.chatBox.scrollTop=this.chatBox.scrollHeight}addChat(t,e,s,n,i){if(-1===this.ignoredPlayers.indexOf(t))if(e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;"),n=n.replace(/</g,"&lt;").replace(/>/g,"&gt;"),s===te.SAY)this.playersRenderer.addSay(t,n);else{let o="",a="";if(s===te.TEAM)o="chat-team",a=" =&gt; team";else if(s===te.WHISPER)if(o="chat-whisper",t===this.context.state.myPlayerId){a=" =&gt; "+this.context.state.getPlayerName(i)}else a=" =&gt; me";const r=encodeURI(e);this.chatBox.innerHTML+=`<div class="chat ${o}"><strong class="player-name" data-name="${r}" data-id="${t}">${e}${a}</strong>: ${n}</div>`,this.chatBox.scrollTop=this.chatBox.scrollHeight}}showServerMessage(t,e,s){this.serverMessageStopwatch=new St(e),this.serverMessage.innerHTML=s}hideServerMessageAfterTimeout(){this.serverMessageStopwatch&&this.serverMessageStopwatch.hasTimedOut&&(this.serverMessage.innerHTML="",this.serverMessageStopwatch=null)}showStats(){this.statsRenderer.render()}showPing(){this.pingElement.innerText=this.context.state.ping+" ms"}highlightPlayerOnMinimap(t){this.minimapRenderer.highlight(t)}ignorePlayer(t){-1===this.ignoredPlayers.indexOf(t)&&t!==this.context.state.id&&this.ignoredPlayers.push(t)}unignorePlayer(t){this.ignoredPlayers=this.ignoredPlayers.filter((e=>e!==t))}renderMinimap(){this.minimapRenderer.render()}renderPlayerList(){this.playerListRenderer.render()}renderHit(){this.canvas.className="shake-hit",this.stopShaking()}renderKill(){this.canvas.className="shake-kill",this.stopShaking()}renderGame(t){if(t&&this.context.state.purgeAfterPanic(),!this.context.state.getFocusedPlayer())return;const e=this.canvasContext;this.clip.setClip(this.canvas),this.backgroundRenderer.renderBackground(e),this.wallsRenderer.renderWalls(e),this.pathRenderer.renderPath(e),this.upcratesRenderer.renderUpcrates(e),this.playersRenderer.renderPlayers(e),this.missilesRenderer.renderMissiles(e),this.explosionsRenderer.renderExplosions(e),this.context.gameType===ft.CTF&&this.flagRenderer.render(e),this.debugInfoRenderer.render()}getUiElements(){this.canvas=document.getElementById("canvas"),this.canvasContext=this.canvas.getContext("2d"),this.chatBox=document.getElementById("chat"),this.serverMessage=document.getElementById("server-message"),this.pingElement=document.getElementById("stats-ping")}stopShaking(){this.shakeTimeout&&this.context.tm.clearTimeout(this.shakeTimeout),this.shakeTimeout=this.context.tm.setTimeout((()=>this.canvas.className=""),1e3)}}class Hs{constructor(t){this.context=t;document.getElementById("select-raptor").onclick=()=>this.selectAircraft("1");document.getElementById("select-spirit").onclick=()=>this.selectAircraft("2");document.getElementById("select-mohawk").onclick=()=>this.selectAircraft("3");document.getElementById("select-tornado").onclick=()=>this.selectAircraft("4");document.getElementById("select-prowler").onclick=()=>this.selectAircraft("5")}selectAircraft(t){this.context.connection.sendCommand("respawn",t)}}class Gs{constructor(t){this.context=t;document.getElementById("select-speed").onclick=()=>this.applyUpgrade("1");document.getElementById("select-defense").onclick=()=>this.applyUpgrade("2");document.getElementById("select-energy").onclick=()=>this.applyUpgrade("3");document.getElementById("select-missile").onclick=()=>this.applyUpgrade("4");document.getElementById("drop-upgrade").onclick=()=>this.dropUpgrade()}applyUpgrade(t){this.context.connection.sendCommand("upgrade",t)}dropUpgrade(){this.context.connection.sendCommand("upgrades","drop")}}class Xs{constructor(t){this.context=t,this.commandRegex=/^\/(\w+)(?:\s(.+))?$/,this.input=document.getElementById("chat-input-textbox"),this.input.addEventListener("blur",(()=>this.hide())),this.hide();document.getElementById("input-instruction").addEventListener("click",(()=>this.showAndFocus()))}showAndFocus(){this.input.style.display="block",this.input.focus()}hide(){this.input.style.display="none"}startChat(t){this.showAndFocus(),this.input.value=t}isChatInputFocused(){return"block"===this.input.style.display.toLowerCase()}submit(){const t=this.input.value;if(t){this.input.value="";const e=this.commandRegex.exec(t);if(e){const t=e[1],s=e[2];if("t"===t)this.context.eventQueue.pub(Lt.CHAT_SEND,{text:s,type:te.TEAM});else if("s"===t)this.context.eventQueue.pub(Lt.CHAT_SEND,{text:s,type:te.SAY});else if("w"===t){const t=this.context.state.getPlayers();let e;t.sort(((t,e)=>e.name.length-t.name.length));for(const n of t)if(s.startsWith(n.name)){e=n;break}if(e){const t=s.substr(e.name.length+1);this.context.eventQueue.pub(Lt.CHAT_SEND,{playerId:e.id,text:t,type:te.WHISPER})}else this.context.eventQueue.pub(Lt.MESSAGE_TO_PLAYER,{message:"Unknown player, message not sent."})}else this.context.connection.sendCommand(t,s||"")}else this.context.eventQueue.pub(Lt.CHAT_SEND,{text:t,type:te.CHAT});this.hide()}}}class Ks{constructor(t,e,s,n,i,o,a,r){this.context=t,this.chatInput=e,this.applyUpgrades=s,this.dropFlag=n,this.autoFire=i,this.spectate=o,this.aircraftSelection=a,this.playerDropdownMenu=r,document.addEventListener("keydown",(t=>this.onKey(t,!0))),document.addEventListener("keyup",(t=>this.onKey(t,!1)));const c=document.getElementById("canvas");c.addEventListener("mousedown",(t=>this.onMouseFire(t,!0))),c.addEventListener("mouseup",(t=>this.onMouseFire(t,!1)));const l=document.getElementById("chat"),h=document.getElementById("player-list");l.addEventListener("mouseup",(t=>this.onMouseUpInChatOrPlayerList(t,!1))),l.addEventListener("contextmenu",(t=>this.onMouseUpInChatOrPlayerList(t,!0))),h.addEventListener("mouseup",(t=>this.onMouseUpInChatOrPlayerList(t,!1))),h.addEventListener("contextmenu",(t=>this.onMouseUpInChatOrPlayerList(t,!0)))}onMouseUpInChatOrPlayerList(t,e){if(!this.context.isActive)return;const s=t.target;if(!s.className||-1===s.className.indexOf("player-name"))return void this.playerDropdownMenu.hide();if(!e&&2===t.button)return;const n=s.dataset.name,i=s.dataset.id;this.playerDropdownMenu.show(t.x,t.y,i,n),t.preventDefault(),t.stopPropagation()}onMouseFire(t,e){this.context.isActive&&(this.context.eventQueue.pub(Lt.KEYBOARD,{key:k.FIRE,state:e}),this.playerDropdownMenu.hide())}onKey(t,e){if(!this.context.isActive)return;if(this.chatInput.isChatInputFocused())return void(e&&(27===t.keyCode&&this.chatInput.hide(),13===t.keyCode&&this.chatInput.submit()));let s,n=!1;switch(t.keyCode){case 16:case 17:s=k.SPECIAL;break;case 32:s=k.FIRE;break;case 65:case 37:n=!0,s=k.LEFT;break;case 87:case 38:n=!0,s=k.UP;break;case 68:case 39:n=!0,s=k.RIGHT;break;case 83:case 40:n=!0,s=k.DOWN;break;case 13:e&&this.chatInput.showAndFocus();break;case 86:e&&this.spectate.spectate();break;case 88:e&&this.applyUpgrades.dropUpgrade();break;case 89:e&&this.dropFlag.dropFlag();break;case 90:e&&this.autoFire.toggleAutoFire();break;case 49:case 50:case 51:case 52:e&&this.applyUpgrades.applyUpgrade(""+(t.keyCode-48));break;case 112:case 113:case 114:case 115:case 116:n=!0,e&&this.aircraftSelection.selectAircraft(""+(t.keyCode-111))}s&&!t.repeat&&(this.context.botstate.stop(),this.context.eventQueue.pub(Lt.KEYBOARD,{key:s,state:e})),n&&(t.stopPropagation(),t.preventDefault())}}class Ws{constructor(t,e,s){this.context=t,this.chatInput=e,this.renderer=s,this.menu=document.getElementById("player-context-menu"),this.menuTitle=document.getElementById("menu-title"),this.menuStats=document.getElementById("menu-stats");const n=this.menu.getElementsByClassName("menu-item");for(const t of n)t.addEventListener("click",(()=>this.onMenuItemClicked(t)))}show(t,e,s,n){this.menu.style.left=t+"px",this.menu.style.top=e+"px",this.menu.style.display="block",this.currentId=Number(s),this.currentName=decodeURI(n);const i=this.context.state.getPlayerById(Number(s));this.menuTitle.innerText=this.currentName,this.menuStats.innerText="Kills: "+i.kills+"; Deaths: "+i.deaths+"\nDamage: "+i.damage+"; Ping: "+i.ping+(this.context.gameType===ft.CTF?"\nCaptures: "+(i.captures??0):"")}hide(){this.menu.style.display="none"}onMenuItemClicked(t){this.hide();const e=this.context.state.getPlayerById(this.currentId);if(e&&"Server"!==e.name)switch(t.id){case"menu-flag":this.context.connection.sendCommand("flag",wt[""+e.flag]);break;case"menu-whisper":this.chatInput.startChat(`/w ${this.currentName} `);break;case"menu-ignore":this.renderer.ignorePlayer(e.id),this.renderer.addMessageToPlayer("Player chats will be ignored for player "+e.name);break;case"menu-unignore":this.renderer.unignorePlayer(e.id),this.renderer.addMessageToPlayer("Removed player from the ignore list.");break;case"menu-votemute":this.context.connection.voteMute(e.id),this.renderer.addMessageToPlayer("You have voted to mute player "+e.name);break;case"menu-locate":this.renderer.highlightPlayerOnMinimap(e.id);break;case"menu-spectate":this.context.state.spectatingId||this.context.connection.sendCommand("spectate","-3"),this.context.connection.sendCommand("spectate",e.id+"");break;case"menu-kill":this.context.botstate.playerToKill=e.id}}}class zs{constructor(t){this.context=t,this.handles=[Lt.EACH_SECOND]}exec(t){this.context.state.spectatingId&&this.context.connection.sendKey(k.SPECIAL,!0)}}class Qs{constructor(t){this.context=t;document.getElementById("drop-flag").onclick=()=>this.dropFlag()}dropFlag(){this.context.connection.sendCommand("drop","")}}class js{constructor(t){this.context=t;document.getElementById("auto-fire").onclick=()=>this.toggleAutoFire()}toggleAutoFire(){this.context.botstate.autoFire=!this.context.botstate.autoFire,this.context.botstate.autoFireToggledManually=this.context.botstate.autoFire}}class qs{constructor(t){this.context=t,this.handles=[Lt.TICK],this.timer=new St,this.wasAutoFiring=!1}exec(t){(this.wasAutoFiring||this.context.botstate.autoFire)&&(this.timer.elapsedMs<250||(this.timer.start(),this.context.connection.sendKey(k.FIRE,this.context.botstate.autoFire),this.wasAutoFiring=this.context.botstate.autoFire))}}class Js{constructor(t){this.context=t;document.getElementById("spectate").onclick=()=>this.spectate()}spectate(){this.context.connection.sendCommand("spectate","-3")}}class $s{constructor(t){this.context=t;document.getElementById("switch-sides").onclick=()=>this.switch()}switch(){if(this.timer&&this.timer.elapsedSeconds>5)return this.showMessage("Switch failed, giving up."),void(this.timer=null);this.timer||(this.timer=new St);const t=this.context;return t.botstate.isOn()?(this.showMessage("Switching, stopping automatic activity..."),t.botstate.stop(!0),void t.tm.setTimeout((()=>this.switch()),2e3)):t.state.spectatingId?(this.timer=null,this.showMessage("Switching..."),t.connection.sendCommand("switch",""),void t.tm.setTimeout((()=>{this.showMessage("Switching, respawning...");const e=t.state.getPlayerById(t.state.myPlayerId);t.connection.sendCommand("respawn",e.type.toString())}),500)):(this.showMessage("Switching, entering spec mode..."),t.connection.sendCommand("spectate","-3"),void t.tm.setTimeout((()=>this.switch()),500+this.timer.elapsedMs/4))}showMessage(t){const e={text:t,duration:1e3};this.context.eventQueue.pub(Lt.SERVER_ANNOUNCEMENT,e)}}class Zs{static getAngleDiff(t,e){return Math.atan2(Math.sin(e-t),Math.cos(e-t))}static getTargetRotation(t,e){let s=Math.atan2(e.x-t.x,t.y-e.y);return s<0&&(s+=2*Math.PI),s}}class tn{constructor(t,e,s){this.context=t,this.me=e,this.locationToFace=s}execute(){if(this.context.botstate.turningTimeout)return;const t=this.locationToFace,e=Zs.getTargetRotation(this.me.pos,t),s=Zs.getAngleDiff(this.me.rot,e),n=Math.abs(s);let i,o;s>0?(i=k.RIGHT,o=k.LEFT):(i=k.LEFT,o=k.RIGHT);const a=16.666666666666668*(n/jt[this.me.type].turnFactor);this.context.botstate.enqueueKey(i,!0,a),this.context.botstate.enqueueKey(o,!1)}}class en{static getDelta(t,e){if(!t||!e)return null;const s=e.x-t.x,n=e.y-t.y;return{diffX:s,diffY:n,distance:Math.sqrt(s*s+n*n)}}}class sn{static predictPosition(t,e,s){if(!e||!t)return t;const n=s/16.666666666666668;return{x:t.x+e.x*n,y:t.y+e.y*n}}}class nn{constructor(t,e,s,n=300,i=!0){this.context=t,this.me=e,this.posToGoTo=s,this.closeness=n,this.backupIfTooClose=i}finish(t,e){return this.context.botstate.path=null,this.context.botstate.enqueueKey(k.UP,!1),this.backupIfTooClose&&this.context.botstate.enqueueKey(k.DOWN,!0),{isClose:t,distance:e}}execute(t,e=600){const{distance:s}=en.getDelta(this.me.pos,this.posToGoTo);if(this.context.botstate.distanceToTarget=Math.round(s),s<50)return this.finish(!0,s);if(this.context.botstate.initPathFindingWorker(),this.context.botstate.needsNewPath){const e=[];for(const s of this.context.state.getPlayers())s.id!==this.me.id&&s.id!==this.context.botstate.playerToKill&&e.push(sn.predictPosition(s.mostReliablePos,s.speed,t));for(const s of this.context.state.getMissiles())s.team!==this.me.team&&e.push(sn.predictPosition(s.pos,s.speed,t));this.context.botstate.calcPath({pos1:this.me.pos,pos2:this.posToGoTo,aircraftType:this.me.type,pointsToAvoid:e})}if(!this.context.botstate.path)return{isClose:!1,distance:s};const n=this.context.botstate.path,i=this.nextStep(n,t);if(!i)return this.finish(!0,s);new tn(this.context,this.me,i).execute();const o=s<this.closeness;return o?this.finish(!0,s):(this.context.botstate.enqueueKey(k.UP,!0),this.me.type===Ht.PREDATOR&&(this.context.botstate.autoBoost=s>e),{isClose:o,distance:s})}nextStep(t,e){const s=t[0];if(!s)return null;const{distance:n}=en.getDelta(this.me.mostReliablePos,s),i=e/16.666666666666668;return n>3*(Math.sqrt(Math.pow(this.me.speed.y,2)+Math.pow(this.me.speed.x,2))*i)?(this.context.botstate.path=t.slice(1),s):this.nextStep(t.slice(1),e)}}class on{constructor(t){this.context=t,this.handles=[Lt.TICK],this.timer=new St(250),this.timer.start()}exec(t){this.timer.hasTimedOut&&(this.context.botstate.autoPilotToFlag?this.autoPilot():this.context.botstate.playerToKill&&this.followPlayer(),this.doSteering(),this.timer.start())}autoPilot(){const t=this.context.state.getOtherCtfTeam(this.context.state.team);if(!t)return;const e=this.context.state.getFocusedPlayer();let s=t.flagPos;if(t.flagState===rt.DYNAMIC)if(t.flagTakenById===this.context.state.myPlayerId)s=this.context.state.team===ot.BLUE?Ps.blue:Ps.red;else{const e=this.context.state.getPlayerById(t.flagTakenById);e&&(s=e.mostReliablePos)}new nn(this.context,e,s,10,!1).execute(this.timer.elapsedMs)}followPlayer(){const t=this.context.state.getPlayerById(this.context.botstate.playerToKill);if(!t)return void(this.context.botstate.playerToKill=null);if(t.status!==J.ALIVE)return;const e=this.context.state.getFocusedPlayer(),s=t.mostReliablePos,n=new nn(this.context,e,s),{isClose:i,distance:o}=n.execute(this.timer.elapsedMs,1e3);if(i){new tn(this.context,e,s).execute()}this.context.botstate.autoFire=o<1e3}doSteering(){const t=this.context.botstate.eatKeyQueue(),e=[k.UP,k.DOWN,k.LEFT,k.RIGHT,k.FIRE,k.SPECIAL];for(const s of e)for(let e=t.length-1;e>=0;e--){const n=t[e];if(n.key===s){if(n.duration>0){this.context.botstate.requestTimeoutFor(n)&&this.context.connection.sendKey(n.key,n.state)}else this.context.connection.sendKey(n.key,n.state);break}}}}class an{constructor(t){this.context=t;document.getElementById("fly-to-flag").onclick=()=>this.autoPilotToFlag()}autoPilotToFlag(){this.context.botstate.autoPilotToFlag=!this.context.botstate.autoPilotToFlag}}class rn{constructor(t){this.context=t,this.handles=[Lt.TICK],this.timer=new St,this.wasAutoBoosting=!1}exec(t){if(!this.wasAutoBoosting&&!this.context.botstate.autoBoost)return;if(this.timer.elapsedMs<1e3)return;const e=this.context.state.getOtherCtfTeam(this.context.state.team);e&&e.flagTakenById===this.context.state.myPlayerId||(this.timer.start(),this.context.connection.sendKey(k.SPECIAL,this.context.botstate.autoBoost),this.wasAutoBoosting=this.context.botstate.autoBoost)}}var cn;cn=i("7we3r");class ln{}class hn{}class un{}class dn{addLocalServerUrl(t){}async getServerInfo(){let e;try{const s=(await t(cn).get("https://data.airmash.online/games?main=1&_="+Date.now())).data;s.data=JSON.parse(s.data),e=s}catch(t){e=await this.getFallbackData()}return this.addLocalServerUrl(e),e}async getFallbackData(){const e=(await t(cn).get("https://raw.githubusercontent.com/airmash-refugees/airmash-games/master/games.txt?_="+Date.now())).data.split("\n"),s=new un;s.country="?",s.protocol=1,s.data=[];for(const t of e){const e=t.split("|");let n=s.data.find((t=>t.name===e[0]));n||(n=new hn,n.name=e[0],n.id=e[0],n.games=[],s.data.push(n));const i=new ln;i.name=e[3],i.nameShort=e[4],i.host=e[5],i.path=e[6],n.games.push(i)}return s}}class gn{lastUrl="styles/default/";async loadStyle(e){const s=await t(cn).get(e+"constants.json?"+timestamp);window.constants=s.data;const n=document.querySelectorAll("img");for(const t of n)t.src=t.src.replace(this.lastUrl,e);const i=document.getElementById("ui-styling");i.href=i.href.replace(this.lastUrl,e),this.lastUrl=e}}class pn{constructor(t){this.context=t,this.loginButton=document.getElementById("loginButton"),this.loginSelector=document.getElementById("loginselector"),this.overlay=document.getElementById("overlay"),this.loginMessage=document.getElementById("loginMessage"),this.orgLoginMessageText=this.loginMessage.innerHTML,this.orgLoginButtonText=this.loginButton.value,this.loginButton.addEventListener("click",(()=>{!!this.context.auth?this.logout():(this.overlay.style.display="block",this.loginSelector.style.display="block")})),this.overlay.addEventListener("click",(()=>this.finish()));const e=document.querySelectorAll(".loginbutton");for(const t of e){const e=t.getAttribute("data-provider");t.addEventListener("click",(()=>this.loginPopup(Number(e))))}this.loadPreviousLoginData()}async loadPreviousLoginData(){try{const t=localStorage.getItem("auth-data");if(t){const e=JSON.parse(t);this.context.auth=e}}catch(t){this.context.logger.error("Auth data could not be loaded",t)}this.toggleLoginMessage()}toggleLoginMessage(){!!this.context.auth?(this.loginButton.value="Log out",this.loginMessage.innerHTML=`Logged in as ${this.context.auth.loginName}`):(this.loginButton.value=this.orgLoginButtonText,this.loginMessage.innerHTML=this.orgLoginMessageText)}finish(){this.overlay.style.display="none",this.loginSelector.style.display="none"}getRandomToken(t){let e=window.crypto.getRandomValues(new Uint32Array(1))[0].toString(16);return t-e.length>0&&(e+=this.getRandomToken(t-e.length)),e.substr(0,t)}loginPopup(t){window.addEventListener("message",(t=>this.receiveLoginMessage(t)),{once:!0}),this.usedProvider=t,this.loginToken=this.getRandomToken(32);const e=`https://login.airmash.online/login?provider=${t}&nonce=${this.loginToken}&origin=${window.origin}`,s=4===t?900:400,n=5===t?800:600;this.openLoginWindow(e,"Login",s,n)}openLoginWindow(t,e,s,n){const i=window.screenLeft?window.screenLeft:window.screenX,o=window.screenTop?window.screenTop:window.screenY,a=(window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width)/2-s/2+i,r=(window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height)/2-n/2+o;window.open(t,e,"width="+s+", height="+n+", top="+r+", left="+a)}receiveLoginMessage(t){"https://login.airmash.online"===t.origin?t.data.provider===this.usedProvider?t.data.nonce===this.loginToken?(this.loginToken=null,this.usedProvider=null,this.loginSuccess({identityProvider:t.data.provider,loginName:t.data.loginname,tokens:t.data.tokens})):this.context.logger.error("nonce does not match: "+t.data.nonce):this.context.logger.error("identity provider does not match: "+t.data.provider):this.context.logger.error("bad origin for login message: "+t.origin)}loginSuccess(t){this.context.auth=t,localStorage.setItem("auth-data",JSON.stringify(t)),this.toggleLoginMessage(),this.finish()}logout(){localStorage.removeItem("auth-data"),this.context.auth=null,this.toggleLoginMessage()}}Pt.createPathFindingWorker=()=>new Worker("browser-worker.js?v="+timestamp);new class{constructor(t){this.context=t,this.serverGamesRepository=new dn,this.stylesRepository=new gn,this.nameInput=document.getElementById("playerName"),this.styleSelect=document.getElementById("styleSelect"),this.zoomSelect=document.getElementById("zoomSelect"),this.thirdPartyLogin=new pn(t)}async run(){this.doBackground(),await this.populateServerList(),this.loadAllFlags(),this.fillInPrevSettings(),this.loadConstantsPromise=this.stylesRepository.loadStyle("styles/default/"),this.styleSelect.addEventListener("change",(()=>{"no-bitmaps"!==this.styleSelect.value&&(this.loadConstantsPromise=this.stylesRepository.loadStyle(this.styleSelect.value))}))}fillInPrevSettings(){const e=t(es).get("settings");if(!e)return;const s=JSON.parse(e);this.nameInput.value=s.playerName,this.select(this.zoomSelect,s.zoom.toString()),s.useBitmaps||(this.styleSelect.options[1].selected=!0)}select(t,e){for(const s of t.options)if(s.value===e){s.selected=!0;break}}async startGame(e){this.context.settings.playerName=this.nameInput.value||"Unknown",this.context.settings.websocketUrl=e,this.context.settings.zoom=Number(this.zoomSelect.value)||1,this.context.settings.useBitmaps="no-bitmaps"!==this.styleSelect.value,this.context.settings.horizonX=window.innerWidth/2,this.context.settings.horizonY=window.innerHeight/2,t(es).set("settings",JSON.stringify(this.context.settings),{expires:365}),document.getElementById("nameAndGame").style.display="none",document.getElementById("chat").style.display="block",document.getElementById("chat-input").style.display="block",document.getElementById("aircraftSelection").style.display="block",document.getElementById("stats").style.display="block",document.getElementById("upgradeSelection").style.display="block",document.getElementById("actionButtons").style.display="block",document.getElementById("minimap").style.display="block",document.getElementById("player-list").style.display="block",document.getElementById("server-message").style.display="block",location.href.indexOf("debug")>-1&&(document.getElementById("debugPanel").style.display="block",this.context.settings.shouldShowDebugInfo=!0),await this.loadConstantsPromise,window.document.body.style.backgroundImage="inherit",this.context.start(),window.gameContext=this.context}async populateServerList(){const e=await this.serverGamesRepository.getServerInfo(),s=t(es).get("flag")||e.country;this.context.settings.flag=s;const n=document.getElementById("games"),i=document.createElement("table");i.innerHTML="<tr><th>Region</th><th>Game</th><th>Players online</th><th></th></tr>",n.append(i);for(const t of e.data)for(const e of t.games){const s=document.createElement("tr");i.append(s);const n=document.createElement("td");s.append(n),n.innerText=t.name,n.className="region";const o=document.createElement("td");s.append(o),o.innerText=e.name,o.className="game-name";const a=document.createElement("td");s.append(a),a.innerText=e.players||0===e.players?e.players.toString():"?",a.className="num-players";const r=document.createElement("td");s.append(r);const c=document.createElement("input");r.append(c),r.className="start-button",c.type="button",c.value="Start";let l="wss";0===e.type&&(l="ws");const h=`${l}://${e.host}/${e.path}`;c.onclick=()=>this.startGame(h)}}loadAllFlags(){for(const t of Object.keys(Tt)){const e=document.createElement("img");e.src=`flags/${t}.png`,e.style.display="none",e.id=`flag-${t}`,document.body.appendChild(e)}}doBackground(){const t=document.getElementById("map");window.document.body.style.backgroundImage=`url(${t.src})`,window.document.body.style.backgroundSize="cover"}}(new class{renderer=new Vs(this);botstate=new Pt(this);chatInput=new Xs(this);aircraftSelection=new Hs(this);upgradeSelection=new Gs(this);dropFlag=new Qs(this);autofire=new js(this);spectate=new Js(this);autoPilotToFlag=new an(this);switchSides=new $s(this);playerDropdownMenu=new Ws(this,this.chatInput,this.renderer);browserInitialization=new Us(this);browserVisibilityHandler=new ts(this);keyboardInput=new Ks(this,this.chatInput,this.upgradeSelection,this.dropFlag,this.autofire,this.spectate,this.aircraftSelection,this.playerDropdownMenu);constructor(){this.browserInitialization.detectVisibilityChange(),this.browserInitialization.throttleZoom(),this.logger=new Rs,this.webSocketFactory=new ws,this.settings=new Xe,this.eventQueue=new Ze,this.tm=new je,this.processor=new Ot(this),this.state=new Qe,this.connection=new Je(this),this.handlers=[...Ge.getDefaultHandlers(this),new rs(this),new ds(this),new hs(this),new cs(this),new ns(this),new os(this),new fs(this),new is(this),new ms(this),new As(this),new ss(this),new ys(this),new zs(this),new qs(this),new rn(this),new on(this)]}async start(){this.logger.info("Initializing app"),this.processor.startProcessingEventQueue(),await this.connection.init(),this.isActive=!0,this.logger.info("Initialization finished")}setBrowserVisibility(t){this.isBrowserVisible=t,t||this.browserVisibilityHandler.clearKeys()}}).run();
//# sourceMappingURL=index.4da44ead.js.map
