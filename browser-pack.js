!function(e){var t={};function n(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(s,i,function(t){return e[t]}.bind(null,i));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=36)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.CHAT_NOT_POSSIBLE_BC_MUTED=0]="CHAT_NOT_POSSIBLE_BC_MUTED",e[e.CHAT_PLAYER_MUTED=1]="CHAT_PLAYER_MUTED",e[e.CHAT_RECEIVED=2]="CHAT_RECEIVED",e[e.CHAT_SEND=3]="CHAT_SEND",e[e.CONNECTION_ERROR=4]="CONNECTION_ERROR",e[e.CONNECTION_CLOSE=5]="CONNECTION_CLOSE",e[e.CRATE_NEW=6]="CRATE_NEW",e[e.CTF_GAME_OVER=7]="CTF_GAME_OVER",e[e.EACH_SECOND=8]="EACH_SECOND",e[e.EXPLOSION=9]="EXPLOSION",e[e.FLAG_UPDATE=10]="FLAG_UPDATE",e[e.KEYBOARD=11]="KEYBOARD",e[e.LOGIN=12]="LOGIN",e[e.LEAVE_HORIZON=13]="LEAVE_HORIZON",e[e.MESSAGE_TO_PLAYER=14]="MESSAGE_TO_PLAYER",e[e.MOB_DESPAWN=15]="MOB_DESPAWN",e[e.MINI_MAP=16]="MINI_MAP",e[e.MISSILE_UPDATE=17]="MISSILE_UPDATE",e[e.MOUNTAIN_HIT=18]="MOUNTAIN_HIT",e[e.PLAYER_BOUNCE=19]="PLAYER_BOUNCE",e[e.PLAYER_BOOST=20]="PLAYER_BOOST",e[e.PLAYER_CHANGE_FLAG=21]="PLAYER_CHANGE_FLAG",e[e.PLAYER_FIRE=22]="PLAYER_FIRE",e[e.PLAYER_HIT=23]="PLAYER_HIT",e[e.PLAYER_KILLED=24]="PLAYER_KILLED",e[e.PLAYER_LEAVE=25]="PLAYER_LEAVE",e[e.PLAYER_LEVEL=26]="PLAYER_LEVEL",e[e.PLAYER_NEW=27]="PLAYER_NEW",e[e.PLAYER_POWERUP=28]="PLAYER_POWERUP",e[e.PLAYER_REPEL=29]="PLAYER_REPEL",e[e.PLAYER_RESPAWN=30]="PLAYER_RESPAWN",e[e.PLAYER_UPDATE=31]="PLAYER_UPDATE",e[e.PLAYER_UPGRADE_APPLIED=32]="PLAYER_UPGRADE_APPLIED",e[e.PLAYER_STEALTH=33]="PLAYER_STEALTH",e[e.PLAYER_SWITCH_TYPE=34]="PLAYER_SWITCH_TYPE",e[e.SERVER_ANNOUNCEMENT=35]="SERVER_ANNOUNCEMENT",e[e.SERVER_COMMAND_REPLY=36]="SERVER_COMMAND_REPLY",e[e.SERVER_CUSTOM=37]="SERVER_CUSTOM",e[e.SERVER_ERROR=38]="SERVER_ERROR",e[e.SERVER_MESSAGE=39]="SERVER_MESSAGE",e[e.SCORE_BOARD=40]="SCORE_BOARD",e[e.SCORE_DETAILED=41]="SCORE_DETAILED",e[e.SCORE_UPDATE=42]="SCORE_UPDATE",e[e.SPAM_WARING_RECEIVED=43]="SPAM_WARING_RECEIVED",e[e.TEAMS=44]="TEAMS",e[e.TICK=45]="TICK"}(t.Events||(t.Events={}))},function(e,t,n){"use strict";function s(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}var i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const r=i(n(43));t.ClientPackets=r;const o=i(n(44));t.ServerPackets=o,s(n(21));var a=n(7);t.CLIENT_PACKETS=a.default;var c=n(8);t.SERVER_PACKETS=c.default;var l=n(15);t.CLIENT_SCHEMAS=l.default;var u=n(16);t.SERVER_SCHEMAS=u.default,s(n(22)),s(n(23)),s(n(49)),s(n(17)),s(n(9)),s(n(50)),s(n(5)),s(n(51)),s(n(52))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=2*Math.PI;t.Pos=class{constructor(e,t){if(!e&&0!==e||!t&&0!==t)if(e){const t=e;this.x=t.x,this.y=t.y}else this.x=0,this.y=0;else this.x=e,this.y=t}direction(){let e=-(Math.atan2(this.x,this.y)+Math.PI);return e<0&&(e+=s),e>s&&(e-=s),e}equals(e){return!!e&&e.x===this.x&&e.y===this.y}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(e=null){this.timeoutMs=e,this.start()}start(){this.startTime=s.performanceNow()}get elapsedMs(){return s.performanceNow()-this.startTime}get elapsedSeconds(){return this.elapsedMs/1e3}get elapsedMinutes(){return this.elapsedSeconds/60}get hasTimedOut(){return!!this.timeoutMs&&this.elapsedMs>this.timeoutMs}get timeoutFraction(){return this.timeoutMs?this.elapsedMs/this.timeoutMs:0}}t.StopWatch=s,s.performanceNow=()=>performance.now()},function(e,t,n){"use strict";var s=n(28),i=n(138),r=Object.prototype.toString;function o(e){return"[object Array]"===r.call(e)}function a(e){return null!==e&&"object"==typeof e}function c(e){return"[object Function]"===r.call(e)}function l(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),o(e))for(var n=0,s=e.length;n<s;n++)t.call(null,e[n],n,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}e.exports={isArray:o,isArrayBuffer:function(e){return"[object ArrayBuffer]"===r.call(e)},isBuffer:i,isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:a,isUndefined:function(e){return void 0===e},isDate:function(e){return"[object Date]"===r.call(e)},isFile:function(e){return"[object File]"===r.call(e)},isBlob:function(e){return"[object Blob]"===r.call(e)},isFunction:c,isStream:function(e){return a(e)&&c(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:l,merge:function e(){var t={};function n(n,s){"object"==typeof t[s]&&"object"==typeof n?t[s]=e(t[s],n):t[s]=n}for(var s=0,i=arguments.length;s<i;s++)l(arguments[s],n);return t},deepMerge:function e(){var t={};function n(n,s){"object"==typeof t[s]&&"object"==typeof n?t[s]=e(t[s],n):t[s]="object"==typeof n?e({},n):n}for(var s=0,i=arguments.length;s<i;s++)l(arguments[s],n);return t},extend:function(e,t,n){return l(t,(function(t,i){e[i]=n&&"function"==typeof t?s(t,n):t})),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(21);t.encodeUTF8=e=>{let t=0;const n=new Uint8Array(4*e.length);for(let i=0;i!==e.length;i+=1){let r=e.charCodeAt(i);if(r<128)n[t++]=r;else{if(r<2048)n[t++]=r>>6|192;else{if(r>55295&&r<56320){if(++i>=e.length)throw new s.StringEncodeError("UTF-8 encode: incomplete surrogate pair");const o=e.charCodeAt(i);if(o<56320||o>57343)throw new s.StringEncodeError(`UTF-8 encode: second surrogate character 0x${o.toString(16)} at index ${i} out of range`);r=65536+((1023&r)<<10)+(1023&o),n[t++]=r>>18|240,n[t++]=r>>12&63|128}else n[t++]=r>>12|224;n[t++]=r>>6&63|128}n[t++]=63&r|128}}return n.subarray(0,t)};t.decodeUTF8=e=>{let t=0,n="";for(;t<e.length;){let i=e[t++];if(i>127)if(i>191&&i<224){if(t>=e.length)throw new s.StringDecodeError("UTF-8 decode: incomplete 2-byte sequence");i=(31&i)<<6|63&e[t++]}else if(i>223&&i<240){if(t+1>=e.length)throw new s.StringDecodeError("UTF-8 decode: incomplete 3-byte sequence");i=(15&i)<<12|(63&e[t++])<<6|63&e[t++]}else{if(!(i>239&&i<248))throw new s.StringDecodeError(`UTF-8 decode: unknown multibyte start 0x${i.toString(16)} at index ${t-1}`);if(t+2>=e.length)throw new s.StringDecodeError("UTF-8 decode: incomplete 4-byte sequence");i=(7&i)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++]}if(i<=65535)n+=String.fromCharCode(i);else{if(!(i<=1114111))throw new s.StringDecodeError(`UTF-8 decode: code point 0x${i.toString(16)} exceeds UTF-16 reach`);i-=65536,n+=String.fromCharCode(i>>10|55296),n+=String.fromCharCode(1023&i|56320)}}return n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1);t.Decoder=class{static upgradesToPowerUps(e){return e?s.decodeUpgrades(e):null}static keystateToPlayerMovements(e){return e?s.decodeKeystate(e):null}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={LOGIN:0,BACKUP:1,HORIZON:2,ACK:5,PONG:6,KEY:10,COMMAND:11,SCOREDETAILED:12,CHAT:20,WHISPER:21,SAY:22,TEAMCHAT:23,VOTEMUTE:24,LOCALPING:255}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={LOGIN:0,BACKUP:1,PING:5,PING_RESULT:6,ACK:7,ERROR:8,COMMAND_REPLY:9,PLAYER_NEW:10,PLAYER_LEAVE:11,PLAYER_UPDATE:12,PLAYER_FIRE:13,PLAYER_HIT:14,PLAYER_RESPAWN:15,PLAYER_FLAG:16,PLAYER_KILL:17,PLAYER_UPGRADE:18,PLAYER_TYPE:19,PLAYER_POWERUP:20,PLAYER_LEVEL:21,PLAYER_RETEAM:22,GAME_FLAG:30,GAME_SPECTATE:31,GAME_PLAYERSALIVE:32,GAME_FIREWALL:33,EVENT_REPEL:40,EVENT_BOOST:41,EVENT_BOUNCE:42,EVENT_STEALTH:43,EVENT_LEAVEHORIZON:44,MOB_UPDATE:60,MOB_UPDATE_STATIONARY:61,MOB_DESPAWN:62,MOB_DESPAWN_COORDS:63,CHAT_PUBLIC:70,CHAT_TEAM:71,CHAT_SAY:72,CHAT_WHISPER:73,CHAT_VOTEMUTEPASSED:78,CHAT_VOTEMUTED:79,SCORE_UPDATE:80,SCORE_BOARD:81,SCORE_DETAILED:82,SCORE_DETAILED_CTF:83,SCORE_DETAILED_BTR:84,SERVER_MESSAGE:90,SERVER_CUSTOM:91}},function(e,t,n){"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.text=1]="text",e[e.textbig=2]="textbig",e[e.arraysmall=4]="arraysmall",e[e.array=3]="array",e[e.uint8=5]="uint8",e[e.uint16=6]="uint16",e[e.uint24=7]="uint24",e[e.uint32=8]="uint32",e[e.float32=9]="float32",e[e.float64=10]="float64",e[e.boolean=11]="boolean",e[e.speed=12]="speed",e[e.accel=13]="accel",e[e.coordx=14]="coordx",e[e.coordy=15]="coordy",e[e.coord24=16]="coord24",e[e.rotation=17]="rotation",e[e.healthenergy=18]="healthenergy",e[e.regen=19]="regen"}(s=t.DATA_TYPES||(t.DATA_TYPES={}));t.DATA_TYPE_SIZE_BITS={[s.text]:2048,[s.textbig]:524296,[s.arraysmall]:8,[s.array]:16,[s.uint8]:8,[s.uint16]:16,[s.uint24]:24,[s.uint32]:32,[s.float32]:64,[s.float64]:64,[s.boolean]:8,[s.speed]:16,[s.accel]:16,[s.coordx]:16,[s.coordy]:16,[s.coord24]:24,[s.rotation]:16,[s.healthenergy]:8,[s.regen]:16}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.CHAT=0]="CHAT",e[e.SAY=1]="SAY",e[e.TEAM=2]="TEAM",e[e.WHISPER=3]="WHISPER"}(t.CHAT_TYPE||(t.CHAT_TYPE={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PowerUps=class{}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Upgrades=class{constructor(){this.speed=0,this.defense=0,this.energy=0,this.missile=0,this.available=0}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1);t.PROJECTILES_SHAPES={REGULAR:1,FAT:2,SMALL:3},t.PROJECTILES_COLLISIONS={[t.PROJECTILES_SHAPES.REGULAR]:[[0,3,3],[0,9,3],[0,15,3]],[t.PROJECTILES_SHAPES.FAT]:[[0,4,4],[0,12,4],[0,20,4]],[t.PROJECTILES_SHAPES.SMALL]:[[0,2,2],[0,6,2],[0,10,2]]},t.PROJECTILES_EXTRA_SPEED_TO_DAMAGE_FACTOR=1/45,t.PROJECTILES_SPECS={[s.MOB_TYPES.PREDATOR_MISSILE]:{maxSpeed:9,baseSpeed:4.05,speedFactor:.3,infernoSpeedFactor:1,accel:.105,damage:.4,infernoDamageFactor:1,distance:1104,shape:t.PROJECTILES_SHAPES.REGULAR,repelEnergy:197},[s.MOB_TYPES.GOLIATH_MISSILE]:{maxSpeed:6,baseSpeed:2.1,speedFactor:.3,infernoSpeedFactor:1,accel:.0375,damage:1.2,infernoDamageFactor:1,distance:1076,shape:t.PROJECTILES_SHAPES.FAT,repelEnergy:260},[s.MOB_TYPES.COPTER_MISSILE]:{maxSpeed:9,baseSpeed:5.7,speedFactor:.3,infernoSpeedFactor:1,accel:.14,damage:.2,infernoDamageFactor:1,distance:1161,shape:t.PROJECTILES_SHAPES.SMALL,repelEnergy:155},[s.MOB_TYPES.TORNADO_MISSILE]:{maxSpeed:7,baseSpeed:3.5,speedFactor:.3,infernoSpeedFactor:1,accel:.0875,damage:.4,infernoDamageFactor:1,distance:997,shape:t.PROJECTILES_SHAPES.REGULAR,repelEnergy:186},[s.MOB_TYPES.TORNADO_SMALL_MISSILE]:{maxSpeed:7,baseSpeed:3.5,speedFactor:.3,infernoSpeedFactor:1,accel:.0875,damage:.3,infernoDamageFactor:1,distance:581,shape:t.PROJECTILES_SHAPES.REGULAR,repelEnergy:145},[s.MOB_TYPES.PROWLER_MISSILE]:{maxSpeed:7,baseSpeed:2.8,speedFactor:.3,infernoSpeedFactor:1,accel:.07,damage:.45,infernoDamageFactor:1,distance:819,shape:t.PROJECTILES_SHAPES.REGULAR,repelEnergy:168}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),i=n(2);t.Mob=class{constructor(){this.posUpdateTimer=new s.StopWatch,this.speed=new i.Pos,this.pos=new i.Pos,this.accel=new i.Pos}get pos(){return this.highResPos}set pos(e){this.highResPos=e,this.posUpdateTimer.start()}}},function(e,t,n){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(n(7)),r=n(9);t.default={[i.default.LOGIN]:[["protocol",r.DATA_TYPES.uint8],["name",r.DATA_TYPES.text],["session",r.DATA_TYPES.text],["horizonX",r.DATA_TYPES.uint16],["horizonY",r.DATA_TYPES.uint16],["flag",r.DATA_TYPES.text]],[i.default.BACKUP]:[["token",r.DATA_TYPES.text]],[i.default.HORIZON]:[["horizonX",r.DATA_TYPES.uint16],["horizonY",r.DATA_TYPES.uint16]],[i.default.ACK]:[],[i.default.PONG]:[["num",r.DATA_TYPES.uint32]],[i.default.KEY]:[["seq",r.DATA_TYPES.uint32],["key",r.DATA_TYPES.uint8],["state",r.DATA_TYPES.boolean]],[i.default.COMMAND]:[["com",r.DATA_TYPES.text],["data",r.DATA_TYPES.text]],[i.default.SCOREDETAILED]:[],[i.default.CHAT]:[["text",r.DATA_TYPES.text]],[i.default.WHISPER]:[["id",r.DATA_TYPES.uint16],["text",r.DATA_TYPES.text]],[i.default.SAY]:[["text",r.DATA_TYPES.text]],[i.default.TEAMCHAT]:[["text",r.DATA_TYPES.text]],[i.default.VOTEMUTE]:[["id",r.DATA_TYPES.uint16]],[i.default.LOCALPING]:[["auth",r.DATA_TYPES.uint32]]}},function(e,t,n){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(n(8)),r=n(9);t.default={[i.default.LOGIN]:[["success",r.DATA_TYPES.boolean],["id",r.DATA_TYPES.uint16],["team",r.DATA_TYPES.uint16],["clock",r.DATA_TYPES.uint32],["token",r.DATA_TYPES.text],["type",r.DATA_TYPES.uint8],["room",r.DATA_TYPES.text],["players",r.DATA_TYPES.array,[["id",r.DATA_TYPES.uint16],["status",r.DATA_TYPES.uint8],["level",r.DATA_TYPES.uint8],["name",r.DATA_TYPES.text],["type",r.DATA_TYPES.uint8],["team",r.DATA_TYPES.uint16],["posX",r.DATA_TYPES.coordx],["posY",r.DATA_TYPES.coordy],["rot",r.DATA_TYPES.rotation],["flag",r.DATA_TYPES.uint16],["upgrades",r.DATA_TYPES.uint8]]]],[i.default.BACKUP]:[],[i.default.PING]:[["clock",r.DATA_TYPES.uint32],["num",r.DATA_TYPES.uint32]],[i.default.PING_RESULT]:[["ping",r.DATA_TYPES.uint16],["playerstotal",r.DATA_TYPES.uint32],["playersgame",r.DATA_TYPES.uint32]],[i.default.ACK]:[],[i.default.ERROR]:[["error",r.DATA_TYPES.uint8]],[i.default.COMMAND_REPLY]:[["type",r.DATA_TYPES.uint8],["text",r.DATA_TYPES.textbig]],[i.default.PLAYER_NEW]:[["id",r.DATA_TYPES.uint16],["status",r.DATA_TYPES.uint8],["name",r.DATA_TYPES.text],["type",r.DATA_TYPES.uint8],["team",r.DATA_TYPES.uint16],["posX",r.DATA_TYPES.coordx],["posY",r.DATA_TYPES.coordy],["rot",r.DATA_TYPES.rotation],["flag",r.DATA_TYPES.uint16],["upgrades",r.DATA_TYPES.uint8]],[i.default.PLAYER_LEAVE]:[["id",r.DATA_TYPES.uint16]],[i.default.PLAYER_UPDATE]:[["clock",r.DATA_TYPES.uint32],["id",r.DATA_TYPES.uint16],["keystate",r.DATA_TYPES.uint8],["upgrades",r.DATA_TYPES.uint8],["posX",r.DATA_TYPES.coord24],["posY",r.DATA_TYPES.coord24],["rot",r.DATA_TYPES.rotation],["speedX",r.DATA_TYPES.speed],["speedY",r.DATA_TYPES.speed]],[i.default.PLAYER_FIRE]:[["clock",r.DATA_TYPES.uint32],["id",r.DATA_TYPES.uint16],["energy",r.DATA_TYPES.healthenergy],["energyRegen",r.DATA_TYPES.regen],["projectiles",r.DATA_TYPES.arraysmall,[["id",r.DATA_TYPES.uint16],["type",r.DATA_TYPES.uint8],["posX",r.DATA_TYPES.coordx],["posY",r.DATA_TYPES.coordy],["speedX",r.DATA_TYPES.speed],["speedY",r.DATA_TYPES.speed],["accelX",r.DATA_TYPES.accel],["accelY",r.DATA_TYPES.accel],["maxSpeed",r.DATA_TYPES.speed]]]],[i.default.PLAYER_RESPAWN]:[["id",r.DATA_TYPES.uint16],["posX",r.DATA_TYPES.coord24],["posY",r.DATA_TYPES.coord24],["rot",r.DATA_TYPES.rotation],["upgrades",r.DATA_TYPES.uint8]],[i.default.PLAYER_FLAG]:[["id",r.DATA_TYPES.uint16],["flag",r.DATA_TYPES.uint16]],[i.default.PLAYER_HIT]:[["id",r.DATA_TYPES.uint16],["type",r.DATA_TYPES.uint8],["posX",r.DATA_TYPES.coordx],["posY",r.DATA_TYPES.coordy],["owner",r.DATA_TYPES.uint16],["players",r.DATA_TYPES.arraysmall,[["id",r.DATA_TYPES.uint16],["health",r.DATA_TYPES.healthenergy],["healthRegen",r.DATA_TYPES.regen]]]],[i.default.PLAYER_KILL]:[["id",r.DATA_TYPES.uint16],["killer",r.DATA_TYPES.uint16],["posX",r.DATA_TYPES.coordx],["posY",r.DATA_TYPES.coordy]],[i.default.PLAYER_UPGRADE]:[["upgrades",r.DATA_TYPES.uint16],["type",r.DATA_TYPES.uint8],["speed",r.DATA_TYPES.uint8],["defense",r.DATA_TYPES.uint8],["energy",r.DATA_TYPES.uint8],["missile",r.DATA_TYPES.uint8]],[i.default.PLAYER_TYPE]:[["id",r.DATA_TYPES.uint16],["type",r.DATA_TYPES.uint8]],[i.default.PLAYER_POWERUP]:[["type",r.DATA_TYPES.uint8],["duration",r.DATA_TYPES.uint32]],[i.default.PLAYER_LEVEL]:[["id",r.DATA_TYPES.uint16],["type",r.DATA_TYPES.uint8],["level",r.DATA_TYPES.uint8]],[i.default.PLAYER_RETEAM]:[["players",r.DATA_TYPES.array,[["id",r.DATA_TYPES.uint16],["team",r.DATA_TYPES.uint16]]]],[i.default.GAME_FLAG]:[["type",r.DATA_TYPES.uint8],["flag",r.DATA_TYPES.uint8],["id",r.DATA_TYPES.uint16],["posX",r.DATA_TYPES.coord24],["posY",r.DATA_TYPES.coord24],["blueteam",r.DATA_TYPES.uint8],["redteam",r.DATA_TYPES.uint8]],[i.default.GAME_SPECTATE]:[["id",r.DATA_TYPES.uint16]],[i.default.GAME_PLAYERSALIVE]:[["players",r.DATA_TYPES.uint16]],[i.default.GAME_FIREWALL]:[["type",r.DATA_TYPES.uint8],["status",r.DATA_TYPES.uint8],["posX",r.DATA_TYPES.coordx],["posY",r.DATA_TYPES.coordy],["radius",r.DATA_TYPES.float32],["speed",r.DATA_TYPES.float32]],[i.default.EVENT_REPEL]:[["clock",r.DATA_TYPES.uint32],["id",r.DATA_TYPES.uint16],["posX",r.DATA_TYPES.coordx],["posY",r.DATA_TYPES.coordy],["rot",r.DATA_TYPES.rotation],["speedX",r.DATA_TYPES.speed],["speedY",r.DATA_TYPES.speed],["energy",r.DATA_TYPES.healthenergy],["energyRegen",r.DATA_TYPES.regen],["players",r.DATA_TYPES.arraysmall,[["id",r.DATA_TYPES.uint16],["keystate",r.DATA_TYPES.uint8],["posX",r.DATA_TYPES.coordx],["posY",r.DATA_TYPES.coordy],["rot",r.DATA_TYPES.rotation],["speedX",r.DATA_TYPES.speed],["speedY",r.DATA_TYPES.speed],["energy",r.DATA_TYPES.healthenergy],["energyRegen",r.DATA_TYPES.regen],["playerHealth",r.DATA_TYPES.healthenergy],["playerHealthRegen",r.DATA_TYPES.regen]]],["mobs",r.DATA_TYPES.arraysmall,[["id",r.DATA_TYPES.uint16],["type",r.DATA_TYPES.uint8],["posX",r.DATA_TYPES.coordx],["posY",r.DATA_TYPES.coordy],["speedX",r.DATA_TYPES.speed],["speedY",r.DATA_TYPES.speed],["accelX",r.DATA_TYPES.accel],["accelY",r.DATA_TYPES.accel],["maxSpeed",r.DATA_TYPES.speed]]]],[i.default.EVENT_BOOST]:[["clock",r.DATA_TYPES.uint32],["id",r.DATA_TYPES.uint16],["boost",r.DATA_TYPES.boolean],["posX",r.DATA_TYPES.coord24],["posY",r.DATA_TYPES.coord24],["rot",r.DATA_TYPES.rotation],["speedX",r.DATA_TYPES.speed],["speedY",r.DATA_TYPES.speed],["energy",r.DATA_TYPES.healthenergy],["energyRegen",r.DATA_TYPES.regen]],[i.default.EVENT_BOUNCE]:[["clock",r.DATA_TYPES.uint32],["id",r.DATA_TYPES.uint16],["keystate",r.DATA_TYPES.uint8],["posX",r.DATA_TYPES.coord24],["posY",r.DATA_TYPES.coord24],["rot",r.DATA_TYPES.rotation],["speedX",r.DATA_TYPES.speed],["speedY",r.DATA_TYPES.speed]],[i.default.EVENT_STEALTH]:[["id",r.DATA_TYPES.uint16],["state",r.DATA_TYPES.boolean],["energy",r.DATA_TYPES.healthenergy],["energyRegen",r.DATA_TYPES.regen]],[i.default.EVENT_LEAVEHORIZON]:[["type",r.DATA_TYPES.uint8],["id",r.DATA_TYPES.uint16]],[i.default.MOB_UPDATE]:[["clock",r.DATA_TYPES.uint32],["id",r.DATA_TYPES.uint16],["type",r.DATA_TYPES.uint8],["posX",r.DATA_TYPES.coordx],["posY",r.DATA_TYPES.coordy],["speedX",r.DATA_TYPES.speed],["speedY",r.DATA_TYPES.speed],["accelX",r.DATA_TYPES.accel],["accelY",r.DATA_TYPES.accel],["maxSpeed",r.DATA_TYPES.speed]],[i.default.MOB_UPDATE_STATIONARY]:[["id",r.DATA_TYPES.uint16],["type",r.DATA_TYPES.uint8],["posX",r.DATA_TYPES.float32],["posY",r.DATA_TYPES.float32]],[i.default.MOB_DESPAWN]:[["id",r.DATA_TYPES.uint16],["type",r.DATA_TYPES.uint8]],[i.default.MOB_DESPAWN_COORDS]:[["id",r.DATA_TYPES.uint16],["type",r.DATA_TYPES.uint8],["posX",r.DATA_TYPES.coordx],["posY",r.DATA_TYPES.coordy]],[i.default.SCORE_UPDATE]:[["id",r.DATA_TYPES.uint16],["score",r.DATA_TYPES.uint32],["earnings",r.DATA_TYPES.uint32],["upgrades",r.DATA_TYPES.uint16],["totalkills",r.DATA_TYPES.uint32],["totaldeaths",r.DATA_TYPES.uint32]],[i.default.SCORE_BOARD]:[["data",r.DATA_TYPES.array,[["id",r.DATA_TYPES.uint16],["score",r.DATA_TYPES.uint32],["level",r.DATA_TYPES.uint8]]],["rankings",r.DATA_TYPES.array,[["id",r.DATA_TYPES.uint16],["x",r.DATA_TYPES.uint8],["y",r.DATA_TYPES.uint8]]]],[i.default.SCORE_DETAILED]:[["scores",r.DATA_TYPES.array,[["id",r.DATA_TYPES.uint16],["level",r.DATA_TYPES.uint8],["score",r.DATA_TYPES.uint32],["kills",r.DATA_TYPES.uint16],["deaths",r.DATA_TYPES.uint16],["damage",r.DATA_TYPES.float32],["ping",r.DATA_TYPES.uint16]]]],[i.default.SCORE_DETAILED_CTF]:[["scores",r.DATA_TYPES.array,[["id",r.DATA_TYPES.uint16],["level",r.DATA_TYPES.uint8],["captures",r.DATA_TYPES.uint16],["score",r.DATA_TYPES.uint32],["kills",r.DATA_TYPES.uint16],["deaths",r.DATA_TYPES.uint16],["damage",r.DATA_TYPES.float32],["ping",r.DATA_TYPES.uint16]]]],[i.default.SCORE_DETAILED_BTR]:[["scores",r.DATA_TYPES.array,[["id",r.DATA_TYPES.uint16],["level",r.DATA_TYPES.uint8],["alive",r.DATA_TYPES.boolean],["wins",r.DATA_TYPES.uint16],["score",r.DATA_TYPES.uint32],["kills",r.DATA_TYPES.uint16],["deaths",r.DATA_TYPES.uint16],["damage",r.DATA_TYPES.float32],["ping",r.DATA_TYPES.uint16]]]],[i.default.CHAT_TEAM]:[["id",r.DATA_TYPES.uint16],["text",r.DATA_TYPES.text]],[i.default.CHAT_PUBLIC]:[["id",r.DATA_TYPES.uint16],["text",r.DATA_TYPES.text]],[i.default.CHAT_SAY]:[["id",r.DATA_TYPES.uint16],["text",r.DATA_TYPES.text]],[i.default.CHAT_WHISPER]:[["from",r.DATA_TYPES.uint16],["to",r.DATA_TYPES.uint16],["text",r.DATA_TYPES.text]],[i.default.CHAT_VOTEMUTEPASSED]:[["id",r.DATA_TYPES.uint16]],[i.default.CHAT_VOTEMUTED]:[],[i.default.SERVER_MESSAGE]:[["type",r.DATA_TYPES.uint8],["duration",r.DATA_TYPES.uint32],["text",r.DATA_TYPES.textbig]],[i.default.SERVER_CUSTOM]:[["type",r.DATA_TYPES.uint8],["data",r.DATA_TYPES.textbig]]}},function(e,t,n){"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.PACKET_FLOODING_DISCONNECT=1]="PACKET_FLOODING_DISCONNECT",e[e.PACKET_FLOODING_BAN=2]="PACKET_FLOODING_BAN",e[e.GLOBAL_BAN=3]="GLOBAL_BAN",e[e.UNKNOWN_ERROR=4]="UNKNOWN_ERROR",e[e.REQUIRED_INACTIVITY_AND_HEALTH_TO_RESPAWN=5]="REQUIRED_INACTIVITY_AND_HEALTH_TO_RESPAWN",e[e.AFK_DISCONNECT=6]="AFK_DISCONNECT",e[e.PLAYER_KICKED=7]="PLAYER_KICKED",e[e.INVALID_LOGIN_DATA=8]="INVALID_LOGIN_DATA",e[e.INCORRECT_PROTOCOL=9]="INCORRECT_PROTOCOL",e[e.ACCOUNT_BANNED=10]="ACCOUNT_BANNED",e[e.ALREADY_LOGGED_IN=11]="ALREADY_LOGGED_IN",e[e.FORBIDDEN_TO_CHANGE_PLANE_IN_BTR=12]="FORBIDDEN_TO_CHANGE_PLANE_IN_BTR",e[e.REQUIRED_INACTIVITY_AND_HEALTH_TO_SPECTATE=13]="REQUIRED_INACTIVITY_AND_HEALTH_TO_SPECTATE",e[e.NOT_ENOUGH_UPGRADES=20]="NOT_ENOUGH_UPGRADES",e[e.CHAT_SPAMMING=30]="CHAT_SPAMMING",e[e.FLAG_CHANGE_TOO_FAST=31]="FLAG_CHANGE_TOO_FAST",e[e.UNKNOWN_COMMAND=100]="UNKNOWN_COMMAND"}(t.SERVER_ERRORS||(t.SERVER_ERRORS={})),function(e){e[e.ALERT=1]="ALERT",e[e.INFO=2]="INFO"}(t.SERVER_MESSAGE_TYPES||(t.SERVER_MESSAGE_TYPES={})),function(e){e[e.CHAT=0]="CHAT",e[e.DEBUG=1]="DEBUG"}(t.COMMAND_REPLY_TYPES||(t.COMMAND_REPLY_TYPES={})),function(e){e[e.PLAYER=0]="PLAYER",e[e.MOB=1]="MOB"}(t.LEAVE_HORIZON_TYPES||(t.LEAVE_HORIZON_TYPES={})),function(e){e[e.PLAYER=0]="PLAYER",e[e.PREDATOR_MISSILE=1]="PREDATOR_MISSILE",e[e.GOLIATH_MISSILE=2]="GOLIATH_MISSILE",e[e.COPTER_MISSILE=3]="COPTER_MISSILE",e[e.TORNADO_MISSILE=5]="TORNADO_MISSILE",e[e.TORNADO_SMALL_MISSILE=6]="TORNADO_SMALL_MISSILE",e[e.PROWLER_MISSILE=7]="PROWLER_MISSILE",e[e.UPGRADE=4]="UPGRADE",e[e.SHIELD=8]="SHIELD",e[e.INFERNO=9]="INFERNO",e[e.FIREWALL=200]="FIREWALL"}(t.MOB_TYPES||(t.MOB_TYPES={})),function(e){e[e.EXPIRED=0]="EXPIRED",e[e.PICKUP=1]="PICKUP"}(t.MOB_DESPAWN_TYPES||(t.MOB_DESPAWN_TYPES={})),function(e){e[e.INFORM=0]="INFORM",e[e.LEVELUP=1]="LEVELUP"}(t.PLAYER_LEVEL_UPDATE_TYPES||(t.PLAYER_LEVEL_UPDATE_TYPES={})),function(e){e[e.ALIVE=0]="ALIVE",e[e.INACTIVE=1]="INACTIVE"}(t.PLAYER_STATUS||(t.PLAYER_STATUS={})),function(e){e[e.LOST=0]="LOST",e[e.SPEED=1]="SPEED",e[e.DEFENSE=2]="DEFENSE",e[e.ENERGY=3]="ENERGY",e[e.MISSILE=4]="MISSILE"}(t.PLAYER_UPGRADE_TYPES||(t.PLAYER_UPGRADE_TYPES={})),function(e){e[e.CTF=2]="CTF",e[e.BTR=1]="BTR"}(t.SERVER_CUSTOM_TYPES||(t.SERVER_CUSTOM_TYPES={})),function(e){e[e.SHIELD=1]="SHIELD",e[e.INFERNO=2]="INFERNO"}(t.PLAYER_POWERUP_TYPES||(t.PLAYER_POWERUP_TYPES={})),function(e){e[e.BLUE=1]="BLUE",e[e.RED=2]="RED"}(t.CTF_TEAMS||(t.CTF_TEAMS={})),function(e){e[e.STATIC=1]="STATIC",e[e.DYNAMIC=2]="DYNAMIC"}(t.CTF_FLAG_STATE||(t.CTF_FLAG_STATE={})),function(e){e[e.BASE=100]="BASE",e[e.INCREMENT=100]="INCREMENT",e[e.MAX=1e3]="MAX"}(t.CTF_CAPTURE_BOUNTY||(t.CTF_CAPTURE_BOUNTY={})),function(e){e[e.INACTIVE=0]="INACTIVE",e[e.ACTIVE=1]="ACTIVE"}(t.BTR_FIREWALL_STATUS||(t.BTR_FIREWALL_STATUS={})),function(e){e[e.BASE=100]="BASE",e[e.INCREMENT=100]="INCREMENT",e[e.MAX=1e3]="MAX"}(t.CTF_WIN_BOUNTY||(t.CTF_WIN_BOUNTY={})),function(e){e[e.BASE=500]="BASE",e[e.INCREMENT=500]="INCREMENT",e[e.MAX=5e3]="MAX"}(t.BTR_WIN_BOUNTY||(t.BTR_WIN_BOUNTY={})),function(e){e[e.FFA=1]="FFA",e[e.CTF=2]="CTF",e[e.BTR=3]="BTR"}(t.GAME_TYPES||(t.GAME_TYPES={})),function(e){e[e.LOGIN=1]="LOGIN",e[e.CONNECTING=2]="CONNECTING",e[e.PLAYING=3]="PLAYING"}(s=t.GAME_STATE_CODES||(t.GAME_STATE_CODES={})),t.GAME_STATE_NAMES=Object.assign({},...Object.entries(s).map(([e,t])=>({[t]:e}))),t.MAP_SIZE={WIDTH:32768,HEIGHT:16384}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3);t.PeriodicLogger=class{constructor(e,t=3){this.context=e,this.intervalSeconds=t,this.stopwatch=new s.StopWatch}log(e,...t){this.stopwatch.elapsedSeconds<this.intervalSeconds||(this.context.logger.info(e,...t),this.stopwatch.start())}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(2);t.FLAG_DEFAULT_POSITION={blue:new s.Pos({x:-9670,y:-1470}),red:new s.Pos({x:8600,y:-940})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MAP_SIZE={WIDTH:32768,HEIGHT:16384,HALF_WIDTH:16384,HALF_HEIGHT:8192},t.MAP_COORDS={MIN_X:-t.MAP_SIZE.WIDTH/2,MIN_Y:-t.MAP_SIZE.HEIGHT/2,MAX_X:t.MAP_SIZE.WIDTH/2,MAX_Y:t.MAP_SIZE.HEIGHT/2},t.PLAYERS_POSITION={MIN_X:-16352,MIN_Y:-8160,MAX_X:16352,MAX_Y:8160}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(e=""){this.name=this.constructor.name,this.message=e}}t.ProtocolError=s;t.StringEncodeError=class extends s{};t.StringDecodeError=class extends s{}},function(e,t,n){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(n(15)),r=s(n(16)),o=n(9),a=n(5),c=s(n(45)),l=s(n(46)),u=new class{constructor(){this.storage=[]}last(){return this.storage.length>0?this.storage[this.storage.length-1]:null}put(e){this.storage.push(e)}shift(){return this.storage.shift()}flush(){this.storage=[]}},d=(e,t)=>{let n=0;for(let s=0;s<t.length;s+=1){const[i,r,c]=t[s],l=e[i];switch(r){case o.DATA_TYPES.text:case o.DATA_TYPES.textbig:u.put(a.encodeUTF8(l)),r===o.DATA_TYPES.textbig?n+=2:n+=1,n+=u.last().length;break;case o.DATA_TYPES.array:case o.DATA_TYPES.arraysmall:r===o.DATA_TYPES.array?n+=2:n+=1;for(let e=0;e<l.length;e+=1)n+=d(l[e],c);break;case o.DATA_TYPES.uint8:case o.DATA_TYPES.boolean:case o.DATA_TYPES.healthenergy:n+=1;break;case o.DATA_TYPES.uint16:case o.DATA_TYPES.speed:case o.DATA_TYPES.accel:case o.DATA_TYPES.coordx:case o.DATA_TYPES.coordy:case o.DATA_TYPES.rotation:case o.DATA_TYPES.regen:n+=2;break;case o.DATA_TYPES.uint24:case o.DATA_TYPES.coord24:n+=3;break;case o.DATA_TYPES.uint32:case o.DATA_TYPES.float32:n+=4;break;case o.DATA_TYPES.float64:n+=8}}return n},E=(e,t,n,s)=>{let i=t;1===i&&e.setUint8(0,n.c);for(let t=0;t<s.length;t+=1){const[r,a,c]=s[t],l=n[r];switch(a){case o.DATA_TYPES.text:case o.DATA_TYPES.textbig:{const t=u.shift();a===o.DATA_TYPES.textbig?(e.setUint16(i,t.length,!0),i+=2):(e.setUint8(i,t.length),i+=1);for(let n=0;n<t.length;n+=1)e.setUint8(i+n,t[n]);i+=t.length}break;case o.DATA_TYPES.array:case o.DATA_TYPES.arraysmall:a===o.DATA_TYPES.array?(e.setUint16(i,l.length,!0),i+=2):(e.setUint8(i,l.length),i+=1);for(let t=0;t<l.length;t+=1)i=E(e,i,l[t],c);break;case o.DATA_TYPES.uint8:e.setUint8(i,l),i+=1;break;case o.DATA_TYPES.healthenergy:e.setUint8(i,255*l),i+=1;break;case o.DATA_TYPES.uint16:e.setUint16(i,l,!0),i+=2;break;case o.DATA_TYPES.regen:e.setUint16(i,1e6*l+32768,!0),i+=2;break;case o.DATA_TYPES.rotation:e.setUint16(i,6553.6*l,!0),i+=2;break;case o.DATA_TYPES.coordy:e.setUint16(i,4*l+32768,!0),i+=2;break;case o.DATA_TYPES.coordx:e.setUint16(i,2*l+32768,!0),i+=2;break;case o.DATA_TYPES.accel:e.setUint16(i,32768*l+32768,!0),i+=2;break;case o.DATA_TYPES.speed:e.setUint16(i,1638.4*l+32768,!0),i+=2;break;case o.DATA_TYPES.uint24:{const t=l%256,n=(l-t)/256;e.setUint16(i,n,!0),i+=2,e.setUint8(i,t),i+=1}break;case o.DATA_TYPES.coord24:{const t=512*l+8388608,n=t%256,s=(t-n)/256;e.setUint16(i,s,!0),i+=2,e.setUint8(i,n),i+=1}break;case o.DATA_TYPES.uint32:e.setUint32(i,l,!0),i+=4;break;case o.DATA_TYPES.float32:e.setFloat32(i,l,!0),i+=4;break;case o.DATA_TYPES.float64:e.setFloat64(i,l,!0),i+=8;break;case o.DATA_TYPES.boolean:e.setUint8(i,!1===l?0:1),i+=1}}return i},h=(e,t,n)=>{u.flush();const s=e.c;let o=null,a=null;switch(t){case 1:a=c.default[s],o=i.default[s];break;case 0:a=l.default[s],o=r.default[s];break;default:return null}if(null===o)return null;let h=null;if(n&&a)h=a(e);else{let t=null,n=0;n=1+d(e,o),h=new ArrayBuffer(n),t=new DataView(h),E(t,1,e,o)}return h};t.marshalClientMessage=(e,t=!0)=>h(e,1,t);t.marshalServerMessage=(e,t=!0)=>h(e,0,t)},function(e,t,n){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(n(15)),r=s(n(16)),o=n(5),a=n(9),c=s(n(47)),l=s(n(48)),u=(e,t,n)=>{const s=new DataView(e),u=s.getUint8(0);let d=null,E=null,h=null;switch(t){case 1:d=c.default[u],h=i.default[u];break;case 0:d=l.default[u],h=r.default[u];break;default:return null}if(n&&d)E=d(e);else{if(null===h)return null;E=((e,t=0,n)=>{const s={};let i=t;0===i&&(s.c=e.getUint8(0),i+=1);for(let t=0;t<n.length;t+=1){const[r,c,l]=n[t];switch(c){case a.DATA_TYPES.text:case a.DATA_TYPES.textbig:{let t=0;c===a.DATA_TYPES.text?(t=e.getUint8(i),i+=1):(t=e.getUint16(i,!0),i+=2);const n=new Uint8Array(t);for(let s=0;s<t;s+=1)n[s]=e.getUint8(i+s);s[r]=o.decodeUTF8(n),i+=t}break;case a.DATA_TYPES.array:case a.DATA_TYPES.arraysmall:{let t=0;c===a.DATA_TYPES.arraysmall?(t=e.getUint8(i),i+=1):(t=e.getUint16(i,!0),i+=2),s[r]=[];for(let n=0;n<t;n+=1){const t={};for(let n=0;n<l.length;n+=1){const[s,r]=l[n];switch(r){case a.DATA_TYPES.text:case a.DATA_TYPES.textbig:{let n=0;r===a.DATA_TYPES.text?(n=e.getUint8(i),i+=1):(n=e.getUint16(i,!0),i+=2);const c=new Uint8Array(n);for(let t=0;t<n;t+=1)c[t]=e.getUint8(i+t);t[s]=o.decodeUTF8(c),i+=n}break;case a.DATA_TYPES.uint8:t[s]=e.getUint8(i),i+=1;break;case a.DATA_TYPES.uint16:t[s]=e.getUint16(i,!0),i+=2;break;case a.DATA_TYPES.uint24:{const n=256*e.getUint16(i,!0);i+=2,t[s]=n+e.getUint8(i),i+=1}break;case a.DATA_TYPES.uint32:t[s]=e.getUint32(i,!0),i+=4;break;case a.DATA_TYPES.float32:t[s]=e.getFloat32(i,!0),i+=4;break;case a.DATA_TYPES.float64:t[s]=e.getFloat64(i,!0),i+=8;break;case a.DATA_TYPES.boolean:t[s]=0!==e.getUint8(i),i+=1;break;case a.DATA_TYPES.speed:t[s]=(e.getUint16(i,!0)-32768)/1638.4,i+=2;break;case a.DATA_TYPES.accel:t[s]=(e.getUint16(i,!0)-32768)/32768,i+=2;break;case a.DATA_TYPES.coordx:t[s]=(e.getUint16(i,!0)-32768)/2,i+=2;break;case a.DATA_TYPES.coordy:t[s]=(e.getUint16(i,!0)-32768)/4,i+=2;break;case a.DATA_TYPES.coord24:{const n=256*e.getUint16(i,!0);i+=2,t[s]=(n+e.getUint8(i)-8388608)/512,i+=1}break;case a.DATA_TYPES.rotation:t[s]=e.getUint16(i,!0)/6553.6,i+=2;break;case a.DATA_TYPES.regen:t[s]=(e.getUint16(i,!0)-32768)/1e6,i+=2;break;case a.DATA_TYPES.healthenergy:t[s]=e.getUint8(i)/255,i+=1;break;default:throw Error()}}s[r].push(t)}}break;case a.DATA_TYPES.uint8:s[r]=e.getUint8(i),i+=1;break;case a.DATA_TYPES.uint16:s[r]=e.getUint16(i,!0),i+=2;break;case a.DATA_TYPES.uint24:{const t=256*e.getUint16(i,!0);i+=2,s[r]=t+e.getUint8(i),i+=1}break;case a.DATA_TYPES.uint32:s[r]=e.getUint32(i,!0),i+=4;break;case a.DATA_TYPES.float32:s[r]=e.getFloat32(i,!0),i+=4;break;case a.DATA_TYPES.float64:s[r]=e.getFloat64(i,!0),i+=8;break;case a.DATA_TYPES.boolean:s[r]=0!==e.getUint8(i),i+=1;break;case a.DATA_TYPES.speed:s[r]=(e.getUint16(i,!0)-32768)/1638.4,i+=2;break;case a.DATA_TYPES.accel:s[r]=(e.getUint16(i,!0)-32768)/32768,i+=2;break;case a.DATA_TYPES.coordx:s[r]=(e.getUint16(i,!0)-32768)/2,i+=2;break;case a.DATA_TYPES.coordy:s[r]=(e.getUint16(i,!0)-32768)/4,i+=2;break;case a.DATA_TYPES.coord24:{const t=256*e.getUint16(i,!0);i+=2,s[r]=(t+e.getUint8(i)-8388608)/512,i+=1}break;case a.DATA_TYPES.rotation:s[r]=e.getUint16(i,!0)/6553.6,i+=2;break;case a.DATA_TYPES.regen:s[r]=(e.getUint16(i,!0)-32768)/1e6,i+=2;break;case a.DATA_TYPES.healthenergy:s[r]=e.getUint8(i)/255,i+=1;break;default:return null}}return s})(s,0,h)}return E};t.unmarshalClientMessage=(e,t=!0)=>u(e,1,t);t.unmarshalServerMessage=(e,t=!0)=>u(e,0,t)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1);t.SHIPS_TYPES={PREDATOR:1,GOLIATH:2,COPTER:3,TORNADO:4,PROWLER:5},t.SHIPS_FIRE_MODES={FIRE:"fire",INFERNO:"infernoFire"},t.SHIPS_FIRE_TYPES={DEFAULT:"default",SPECIAL:"special"},t.SHIPS_ENCLOSE_RADIUS={PREDATOR:32,GOLIATH:88,COPTER:34,TORNADO:38,PROWLER:36};const i=(e,t,n,s,i=!1)=>({type:e,x:t,y:n,rot:s,alt:i}),r=(e=[],n=[])=>({[t.SHIPS_FIRE_TYPES.DEFAULT]:e,[t.SHIPS_FIRE_TYPES.SPECIAL]:n});t.SHIPS_SPECS={[t.SHIPS_TYPES.PREDATOR]:{name:"raptor",turnFactor:.065,accelFactor:.225,brakeFactor:.025,boostFactor:1.5,infernoFactor:.75,maxSpeed:5.5,minSpeed:.001,flagSpeed:5,healthRegen:.001,energyRegen:.008,fireEnergy:.6,specialEnergy:0,specialEnergyRegen:-.01,specialDelay:0,fireDelay:550,damageFactor:2,energyLight:.6,collisions:[[0,5,23],[0,-15,15],[0,-25,12]],repelEnergy:2100,[t.SHIPS_FIRE_MODES.FIRE]:r([i(s.MOB_TYPES.PREDATOR_MISSILE,0,35,0)]),[t.SHIPS_FIRE_MODES.INFERNO]:r([i(s.MOB_TYPES.PREDATOR_MISSILE,-20,5,-.05),i(s.MOB_TYPES.PREDATOR_MISSILE,0,35,0),i(s.MOB_TYPES.PREDATOR_MISSILE,20,5,.05)])},[t.SHIPS_TYPES.GOLIATH]:{name:"spirit",turnFactor:.04,accelFactor:.15,brakeFactor:.015,boostFactor:1,infernoFactor:.75,maxSpeed:3.5,minSpeed:.001,flagSpeed:5,healthRegen:5e-4,energyRegen:.005,fireEnergy:.9,specialEnergy:.5,specialEnergyRegen:0,specialDelay:1e3,fireDelay:300,damageFactor:1,energyLight:.9,collisions:[[0,0,35],[50,14,16],[74,26,14],[30,8,23],[63,22,15],[-50,14,16],[-74,26,14],[-30,8,23],[-63,22,15]],repelEnergy:7500,[t.SHIPS_FIRE_MODES.FIRE]:r([i(s.MOB_TYPES.GOLIATH_MISSILE,0,35,0)]),[t.SHIPS_FIRE_MODES.INFERNO]:r([i(s.MOB_TYPES.GOLIATH_MISSILE,-30,0,-.05),i(s.MOB_TYPES.GOLIATH_MISSILE,0,35,0),i(s.MOB_TYPES.GOLIATH_MISSILE,30,0,.05)])},[t.SHIPS_TYPES.COPTER]:{name:"mohawk",turnFactor:.07,accelFactor:.275,brakeFactor:.025,boostFactor:1,infernoFactor:.75,maxSpeed:6,minSpeed:.001,flagSpeed:5,healthRegen:.001,energyRegen:.01,fireEnergy:.3,specialEnergy:0,specialEnergyRegen:0,specialDelay:0,fireDelay:300,damageFactor:2.78,energyLight:.3,collisions:[[0,-12,15],[0,0,17],[0,13,15],[0,26,15]],repelEnergy:1800,[t.SHIPS_FIRE_MODES.FIRE]:r([i(s.MOB_TYPES.COPTER_MISSILE,15,10,0,!0)]),[t.SHIPS_FIRE_MODES.INFERNO]:r([i(s.MOB_TYPES.COPTER_MISSILE,-10,5,-.05),i(s.MOB_TYPES.COPTER_MISSILE,0,10,0),i(s.MOB_TYPES.COPTER_MISSILE,10,5,.05)])},[t.SHIPS_TYPES.TORNADO]:{name:"tornado",turnFactor:.055,accelFactor:.2,brakeFactor:.025,boostFactor:1,infernoFactor:.75,maxSpeed:4.5,minSpeed:.001,flagSpeed:5,healthRegen:.001,energyRegen:.006,fireEnergy:.5,specialEnergy:.9,specialEnergyRegen:0,specialDelay:0,fireDelay:500,damageFactor:5/3,energyLight:.5,collisions:[[0,8,18],[14,12,13],[-14,12,13],[0,-12,16],[0,-26,14],[0,-35,12]],repelEnergy:2400,[t.SHIPS_FIRE_MODES.FIRE]:r([i(s.MOB_TYPES.TORNADO_MISSILE,0,40,0)],[i(s.MOB_TYPES.TORNADO_SMALL_MISSILE,-15,10,-.05),i(s.MOB_TYPES.TORNADO_SMALL_MISSILE,0,40,0),i(s.MOB_TYPES.TORNADO_SMALL_MISSILE,15,10,.05)]),[t.SHIPS_FIRE_MODES.INFERNO]:r([i(s.MOB_TYPES.TORNADO_MISSILE,-15,10,-.05),i(s.MOB_TYPES.TORNADO_MISSILE,0,40,0),i(s.MOB_TYPES.TORNADO_MISSILE,15,10,.05)],[i(s.MOB_TYPES.TORNADO_MISSILE,-30,20,-.06),i(s.MOB_TYPES.TORNADO_MISSILE,-20,15,-.03),i(s.MOB_TYPES.TORNADO_MISSILE,0,40,0),i(s.MOB_TYPES.TORNADO_MISSILE,20,15,.03),i(s.MOB_TYPES.TORNADO_MISSILE,30,20,.06)])},[t.SHIPS_TYPES.PROWLER]:{name:"prowler",turnFactor:.055,accelFactor:.2,brakeFactor:.025,boostFactor:1,infernoFactor:.75,maxSpeed:4.5,minSpeed:.001,flagSpeed:5,healthRegen:.001,energyRegen:.006,fireEnergy:.75,specialEnergy:.6,specialEnergyRegen:0,specialDelay:1500,damageFactor:5/3,fireDelay:300,energyLight:.75,collisions:[[0,11,25],[0,-8,18],[19,20,10],[-19,20,10],[0,-20,14]],repelEnergy:2600,[t.SHIPS_FIRE_MODES.FIRE]:r([i(s.MOB_TYPES.PROWLER_MISSILE,0,35,0)]),[t.SHIPS_FIRE_MODES.INFERNO]:r([i(s.MOB_TYPES.PROWLER_MISSILE,-20,0,-.05),i(s.MOB_TYPES.PROWLER_MISSILE,0,35,0),i(s.MOB_TYPES.PROWLER_MISSILE,20,0,.05)])}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),i=n(3),r=n(14),o=n(11),a=n(12),c=4e3;class l extends r.Mob{constructor(){super(),this.energy=1,this.health=1,this.score=0,this.lowResPosUpdateTimer=new i.StopWatch,this.mobType=s.MOB_TYPES.PLAYER,this.upgrades=new a.Upgrades,this.powerUps=new o.PowerUps,this.keystate={}}get posFromMinimap(){return this.lowResPos}set posFromMinimap(e){this.lowResPos=e,this.lowResPosUpdateTimer.start()}get mostReliablePos(){return this.posUpdateTimer.elapsedMs-this.lowResPosUpdateTimer.elapsedMs<c||!this.lowResPos?this.pos:this.lowResPos}setMovements(e){e?(this.boost=e.boost,this.flagspeed=e.flagspeed,this.stealthed=e.stealthed,this.strafe=e.strafe,this.keystate=e.keystate):(this.boost=!1,this.flagspeed=!1,this.stealthed=!1,this.strafe=!1,this.keystate={})}}t.Player=l},function(e,t,n){var s,i;
/*!
 * JavaScript Cookie v2.2.1
 * https://github.com/js-cookie/js-cookie
 *
 * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
 * Released under the MIT license
 */!function(r){if(void 0===(i="function"==typeof(s=r)?s.call(t,n,t,e):s)||(e.exports=i),!0,e.exports=r(),!!0){var o=window.Cookies,a=window.Cookies=r();a.noConflict=function(){return window.Cookies=o,a}}}((function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var s in n)t[s]=n[s]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function n(s){function i(){}function r(t,n,r){if("undefined"!=typeof document){"number"==typeof(r=e({path:"/"},i.defaults,r)).expires&&(r.expires=new Date(1*new Date+864e5*r.expires)),r.expires=r.expires?r.expires.toUTCString():"";try{var o=JSON.stringify(n);/^[\{\[]/.test(o)&&(n=o)}catch(e){}n=s.write?s.write(n,t):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var a="";for(var c in r)r[c]&&(a+="; "+c,!0!==r[c]&&(a+="="+r[c].split(";")[0]));return document.cookie=t+"="+n+a}}function o(e,n){if("undefined"!=typeof document){for(var i={},r=document.cookie?document.cookie.split("; "):[],o=0;o<r.length;o++){var a=r[o].split("="),c=a.slice(1).join("=");n||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var l=t(a[0]);if(c=(s.read||s)(c,l)||t(c),n)try{c=JSON.parse(c)}catch(e){}if(i[l]=c,e===l)break}catch(e){}}return e?i[e]:i}}return i.set=r,i.get=function(e){return o(e,!1)},i.getJSON=function(e){return o(e,!0)},i.remove=function(t,n){r(t,"",e(n,{expires:-1}))},i.defaults={},i.withConverter=n,i}((function(){}))}))},function(e,t,n){e.exports=n(137)},function(e,t,n){"use strict";e.exports=function(e,t){return function(){for(var n=new Array(arguments.length),s=0;s<n.length;s++)n[s]=arguments[s];return e.apply(t,n)}}},function(e,t,n){"use strict";var s=n(4);function i(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,n){if(!t)return e;var r;if(n)r=n(t);else if(s.isURLSearchParams(t))r=t.toString();else{var o=[];s.forEach(t,(function(e,t){null!=e&&(s.isArray(e)?t+="[]":e=[e],s.forEach(e,(function(e){s.isDate(e)?e=e.toISOString():s.isObject(e)&&(e=JSON.stringify(e)),o.push(i(t)+"="+i(e))})))})),r=o.join("&")}if(r){var a=e.indexOf("#");-1!==a&&(e=e.slice(0,a)),e+=(-1===e.indexOf("?")?"?":"&")+r}return e}},function(e,t,n){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},function(e,t,n){"use strict";(function(t){var s=n(4),i=n(144),r={"Content-Type":"application/x-www-form-urlencoded"};function o(e,t){!s.isUndefined(e)&&s.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var a,c={adapter:(void 0!==t&&"[object process]"===Object.prototype.toString.call(t)?a=n(32):"undefined"!=typeof XMLHttpRequest&&(a=n(32)),a),transformRequest:[function(e,t){return i(t,"Accept"),i(t,"Content-Type"),s.isFormData(e)||s.isArrayBuffer(e)||s.isBuffer(e)||s.isStream(e)||s.isFile(e)||s.isBlob(e)?e:s.isArrayBufferView(e)?e.buffer:s.isURLSearchParams(e)?(o(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):s.isObject(e)?(o(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return e>=200&&e<300}};c.headers={common:{Accept:"application/json, text/plain, */*"}},s.forEach(["delete","get","head"],(function(e){c.headers[e]={}})),s.forEach(["post","put","patch"],(function(e){c.headers[e]=s.merge(r)})),e.exports=c}).call(this,n(143))},function(e,t,n){"use strict";var s=n(4),i=n(145),r=n(29),o=n(147),a=n(148),c=n(33);e.exports=function(e){return new Promise((function(t,l){var u=e.data,d=e.headers;s.isFormData(u)&&delete d["Content-Type"];var E=new XMLHttpRequest;if(e.auth){var h=e.auth.username||"",A=e.auth.password||"";d.Authorization="Basic "+btoa(h+":"+A)}if(E.open(e.method.toUpperCase(),r(e.url,e.params,e.paramsSerializer),!0),E.timeout=e.timeout,E.onreadystatechange=function(){if(E&&4===E.readyState&&(0!==E.status||E.responseURL&&0===E.responseURL.indexOf("file:"))){var n="getAllResponseHeaders"in E?o(E.getAllResponseHeaders()):null,s={data:e.responseType&&"text"!==e.responseType?E.response:E.responseText,status:E.status,statusText:E.statusText,headers:n,config:e,request:E};i(t,l,s),E=null}},E.onabort=function(){E&&(l(c("Request aborted",e,"ECONNABORTED",E)),E=null)},E.onerror=function(){l(c("Network Error",e,null,E)),E=null},E.ontimeout=function(){l(c("timeout of "+e.timeout+"ms exceeded",e,"ECONNABORTED",E)),E=null},s.isStandardBrowserEnv()){var T=n(149),p=(e.withCredentials||a(e.url))&&e.xsrfCookieName?T.read(e.xsrfCookieName):void 0;p&&(d[e.xsrfHeaderName]=p)}if("setRequestHeader"in E&&s.forEach(d,(function(e,t){void 0===u&&"content-type"===t.toLowerCase()?delete d[t]:E.setRequestHeader(t,e)})),e.withCredentials&&(E.withCredentials=!0),e.responseType)try{E.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&E.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&E.upload&&E.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){E&&(E.abort(),l(e),E=null)})),void 0===u&&(u=null),E.send(u)}))}},function(e,t,n){"use strict";var s=n(146);e.exports=function(e,t,n,i,r){var o=new Error(e);return s(o,t,n,i,r)}},function(e,t,n){"use strict";var s=n(4);e.exports=function(e,t){t=t||{};var n={};return s.forEach(["url","method","params","data"],(function(e){void 0!==t[e]&&(n[e]=t[e])})),s.forEach(["headers","auth","proxy"],(function(i){s.isObject(t[i])?n[i]=s.deepMerge(e[i],t[i]):void 0!==t[i]?n[i]=t[i]:s.isObject(e[i])?n[i]=s.deepMerge(e[i]):void 0!==e[i]&&(n[i]=e[i])})),s.forEach(["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","maxContentLength","validateStatus","maxRedirects","httpAgent","httpsAgent","cancelToken","socketPath"],(function(s){void 0!==t[s]?n[s]=t[s]:void 0!==e[s]&&(n[s]=e[s])})),n}},function(e,t,n){"use strict";function s(e){this.message=e}s.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},s.prototype.__CANCEL__=!0,e.exports=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(37);new(n(135).LandingPage)(new s.BrowserContext).run()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(38),i=n(39),r=n(88),o=n(89),a=n(91),c=n(92),l=n(93),u=n(95),d=n(96),E=n(97),h=n(98),A=n(99),T=n(100),p=n(102),_=n(103),g=n(105),S=n(107),f=n(110),P=n(111),y=n(112),R=n(113),U=n(114),m=n(115),O=n(116),I=n(130),D=n(131),M=n(132),w=n(133),Y=n(134);t.BrowserContext=class{constructor(){this.renderer=new O.Renderer(this),this.chatInput=new M.ChatInput(this),this.aircraftSelection=new I.AircraftSelection(this),this.upgradeSelection=new D.ApplyUpgrades(this),this.playerDropdownMenu=new Y.PlayerDropDownMenu(this,this.chatInput,this.renderer),this.browserInitialization=new R.BrowserInitialization(this),this.browserVisibilityHandler=new u.BrowserVisibilityHandler(this),this.keyboardInput=new w.KeyboardAndMouseInput(this,this.chatInput,this.upgradeSelection,this.aircraftSelection,this.playerDropdownMenu),this.browserInitialization.detectVisibilityChange(),this.browserInitialization.throttleZoom(),this.logger=new U.BrowserLogger,this.webSocketFactory=new m.BrowserWebSocketFactory,this.settings=new r.Settings,this.eventQueue=new l.EventQueue,this.tm=new a.TimerManager,this.processor=new s.EventQueueProcessor(this),this.state=new o.State,this.connection=new c.Connection(this),this.handlers=[...i.HandlerCollections.getDefaultHandlers(this),new T.ExplosionVisualizationHandler(this),new g.KillVisualizationHandler(this),new _.GoliFartVisualizationHandler(this),new p.GameRenderHandler(this),new E.ChatRenderHandler(this),new A.EachSecondRenderHandler(this),new f.ServerAnnouncementRenderHandler(this),new h.CtfGameOverRenderHandler(this),new P.ShakeAndShowMessageOnKillHandler(this),new y.ShakeOnHitHandler(this),new d.FlagCookieHandler(this),new S.MissileChemtrailHandler(this)]}async start(){this.logger.info("Initializing app"),this.processor.startProcessingEventQueue(),await this.connection.init(),this.isActive=!0,this.logger.info("Initialization finished")}setBrowserVisibility(e){this.isBrowserVisible=e,e||this.browserVisibilityHandler.clearKeys()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0),i=n(3),r=1e3/60,o=300;t.EventQueueProcessor=class{constructor(e){this.context=e,this.skippedFrames=0}startProcessingEventQueue(){this.handlersByType={};for(const e of this.context.handlers)for(const t of e.handles){const n=this.handlersByType[t]||[];n.push(e),this.handlersByType[t]=n}this.context.tm.setInterval(()=>this.tick(),Math.floor(r))}tick(){this.stopwatch||(this.stopwatch=new i.StopWatch,this.tickCounter=1,this.eachSecondStopwatch=new i.StopWatch,this.skippedFrames=0);const e=this.context.connection.getLagMs(),t=this.stopwatch.elapsedMs+e;let n=!1;if(t<r)n=!0;else if(t>r*(this.tickCounter+1))this.skippedFrames++;else{const e=this.skippedFrames+t/(r*this.tickCounter);for(this.context.eventQueue.pub(s.Events.TICK,{frame:this.tickCounter,frameFactor:e,skippedFrames:this.skippedFrames,timeFromStart:t}),this.eachSecondStopwatch.elapsedSeconds>=1&&(this.context.eventQueue.pub(s.Events.EACH_SECOND,{}),this.eachSecondStopwatch.start()),this.skippedFrames=0;;){const e=this.context.eventQueue.dequeue();if(!e)break;this.process(e)}}this.context.state.skippedFrames=this.skippedFrames,n||this.tickCounter++,this.skippedFrames>o?this.stopwatch=null:(this.skippedFrames>0||n)&&this.context.tm.setTimeout(()=>this.tick(),1)}process(e){const t=this.handlersByType[e.type]||[];for(const n of t)try{n.exec(e)}catch(t){const s=JSON.parse(JSON.stringify(t,Object.getOwnPropertyNames(t)));this.context.logger.error(`Error handling message ${e.type} with handler ${n.constructor.name}`,s)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(40),i=n(41),r=n(42),o=n(53),a=n(55),c=n(56),l=n(57),u=n(58),d=n(59),E=n(60),h=n(61),A=n(62),T=n(63),p=n(64),_=n(65),g=n(66),S=n(67),f=n(68),P=n(69),y=n(70),R=n(71),U=n(72),m=n(73),O=n(74),I=n(75),D=n(76),M=n(77),w=n(78),Y=n(79),L=n(80),C=n(81),x=n(82),b=n(83),v=n(84),N=n(85),B=n(86),k=n(87);t.HandlerCollections=class{static getDefaultHandlers(e){return[new c.CrateNewHandler(e),new l.FlagUpdateHandler(e),new u.LeaveHorizonHandler(e),new d.LoginHandler(e),new E.MiniMapHandler(e),new h.MissileUpdateHandler(e),new A.MobDespawnHandler(e),new T.MountainHitHandler(e),new p.PlayerBoostHandler(e),new _.PlayerBounceHandler(e),new g.PlayerChangeFlagHandler(e),new S.PlayerFireHandler(e),new f.PlayerHitHandler(e),new P.PlayerKilledHandler(e),new y.PlayerLeaveHandler(e),new R.PlayerLevelHandler(e),new U.PlayerNewHandler(e),new m.PlayerPowerupHandler(e),new O.PlayerRepelHandler(e),new I.PlayerRespawnHandler(e),new D.PlayerStealthHandler(e),new M.PlayerSwitchTypeHandler(e),new w.PlayerUpdateHandler(e),new Y.PlayerUpgradeAppliedHandler(e),new v.ServerCommandReplyHandler(e),new N.ServerCustomHandler(e),new B.ServerErrorHandler(e),new a.ServerMessageHandler(e),new b.ServerAnnouncementHandler(e),new L.ScoreBoardHandler(e),new C.ScoreDetailedHandler(e),new x.ScoreUpdateHandler(e),new k.TeamsHandler(e),new r.MissileMaintenanceHandler(e),new o.PlayerMaintenanceHandler(e),new i.KeyboardMessageHandler(e),new s.ChatSendHandler(e)]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0);t.ChatSendHandler=class{constructor(e){this.context=e,this.handles=[s.Events.CHAT_SEND]}exec(e){const t=e.args;this.context.connection.sendChat(t.type,t.text,t.playerId)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0);t.KeyboardMessageHandler=class{constructor(e){this.context=e,this.handles=[s.Events.KEYBOARD]}exec(e){const t=e.args;this.context.connection.sendKey(t.key,t.state)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(20),i=n(13),r=n(0);t.MissileMaintenanceHandler=class{constructor(e){this.context=e,this.handles=[r.Events.TICK]}exec(e){const t=e.args;for(const e of this.context.state.getMissiles()){const n=i.PROJECTILES_SPECS[e.mobType],r=e.speed.x,o=e.speed.y,a=t.frameFactor;e.speed.x+=e.accel.x*a,e.speed.y+=e.accel.y*a;const c=Math.hypot(e.speed.x,e.speed.y);c>e.maxSpeed?(e.speed.x*=e.maxSpeed/c,e.speed.y*=e.maxSpeed/c,e.speed.length=e.maxSpeed):e.speed.length=c,e.pos.x+=(r+.5*(e.speed.x-r))*a,e.pos.y+=(o+.5*(e.speed.y-o))*a,e.distance=(e.distance||0)+Math.hypot(e.speed.x,e.speed.y),(e.pos.x<s.MAP_COORDS.MIN_X||e.pos.x>s.MAP_COORDS.MAX_X||e.pos.y<s.MAP_COORDS.MIN_Y||e.pos.y>s.MAP_COORDS.MAX_Y||e.distance>=n.distance)&&this.context.state.removeMob(e.id)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(n(7)),r=n(5);t.default={[i.default.LOGIN]:e=>{const t=r.encodeUTF8(e.name),n=r.encodeUTF8(e.session),s=r.encodeUTF8(e.flag),i=new ArrayBuffer(9+t.length+n.length+s.length),o=new DataView(i);let a=0;o.setUint8(a,e.c),a+=1,o.setUint8(a,e.protocol),a+=1,o.setUint8(a,t.length),a+=1;for(let e=0;e<t.length;e+=1)o.setUint8(a+e,t[e]);a+=t.length,o.setUint8(a,n.length),a+=1;for(let e=0;e<n.length;e+=1)o.setUint8(a+e,n[e]);a+=n.length,o.setUint16(a,e.horizonX,!0),a+=2,o.setUint16(a,e.horizonY,!0),a+=2,o.setUint8(a,s.length),a+=1;for(let e=0;e<s.length;e+=1)o.setUint8(a+e,s[e]);return i},[i.default.BACKUP]:e=>{const t=r.encodeUTF8(e.token),n=new ArrayBuffer(2+t.length),s=new DataView(n);let i=0;s.setUint8(i,e.c),i+=1,s.setUint8(i,t.length),i+=1;for(let e=0;e<t.length;e+=1)s.setUint8(i+e,t[e]);return n},[i.default.HORIZON]:e=>{const t=new ArrayBuffer(5),n=new DataView(t);let s=0;return n.setUint8(s,e.c),s+=1,n.setUint16(s,e.horizonX,!0),s+=2,n.setUint16(s,e.horizonY,!0),s+=2,t},[i.default.ACK]:e=>{const t=new ArrayBuffer(1);return new DataView(t).setUint8(0,e.c),t},[i.default.PONG]:e=>{const t=new ArrayBuffer(5),n=new DataView(t);let s=0;return n.setUint8(s,e.c),s+=1,n.setUint32(s,e.num,!0),s+=4,t},[i.default.KEY]:e=>{const t=new ArrayBuffer(7),n=new DataView(t);let s=0;return n.setUint8(s,e.c),s+=1,n.setUint32(s,e.seq,!0),s+=4,n.setUint8(s,e.key),s+=1,n.setUint8(s,!1===e.state?0:1),s+=1,t},[i.default.COMMAND]:e=>{const t=r.encodeUTF8(e.com),n=r.encodeUTF8(e.data),s=new ArrayBuffer(3+t.length+n.length),i=new DataView(s);let o=0;i.setUint8(o,e.c),o+=1,i.setUint8(o,t.length),o+=1;for(let e=0;e<t.length;e+=1)i.setUint8(o+e,t[e]);o+=t.length,i.setUint8(o,n.length),o+=1;for(let e=0;e<n.length;e+=1)i.setUint8(o+e,n[e]);return s},[i.default.SCOREDETAILED]:e=>{const t=new ArrayBuffer(1);return new DataView(t).setUint8(0,e.c),t},[i.default.CHAT]:e=>{const t=r.encodeUTF8(e.text),n=new ArrayBuffer(2+t.length),s=new DataView(n);let i=0;s.setUint8(i,e.c),i+=1,s.setUint8(i,t.length),i+=1;for(let e=0;e<t.length;e+=1)s.setUint8(i+e,t[e]);return n},[i.default.WHISPER]:e=>{const t=r.encodeUTF8(e.text),n=new ArrayBuffer(4+t.length),s=new DataView(n);let i=0;s.setUint8(i,e.c),i+=1,s.setUint16(i,e.id,!0),i+=2,s.setUint8(i,t.length),i+=1;for(let e=0;e<t.length;e+=1)s.setUint8(i+e,t[e]);return n},[i.default.SAY]:e=>{const t=r.encodeUTF8(e.text),n=new ArrayBuffer(2+t.length),s=new DataView(n);let i=0;s.setUint8(i,e.c),i+=1,s.setUint8(i,t.length),i+=1;for(let e=0;e<t.length;e+=1)s.setUint8(i+e,t[e]);return n},[i.default.TEAMCHAT]:e=>{const t=r.encodeUTF8(e.text),n=new ArrayBuffer(2+t.length),s=new DataView(n);let i=0;s.setUint8(i,e.c),i+=1,s.setUint8(i,t.length),i+=1;for(let e=0;e<t.length;e+=1)s.setUint8(i+e,t[e]);return n},[i.default.VOTEMUTE]:e=>{const t=new ArrayBuffer(3),n=new DataView(t);let s=0;return n.setUint8(s,e.c),s+=1,n.setUint16(s,e.id,!0),s+=2,t},[i.default.LOCALPING]:e=>{const t=new ArrayBuffer(5),n=new DataView(t);let s=0;return n.setUint8(s,e.c),s+=1,n.setUint32(s,e.auth,!0),s+=4,t}}},function(e,t,n){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(n(8)),r=n(5);t.default={[i.default.LOGIN]:e=>{const t=[];let n=0,s=0;for(let i=0;i<e.players.length;i+=1)s+=17,t[n]=r.encodeUTF8(e.players[i].name),s+=t[n].length,n+=1;const i=r.encodeUTF8(e.token),o=r.encodeUTF8(e.room),a=new ArrayBuffer(15+i.length+o.length+s),c=new DataView(a);let l=0;n=0,c.setUint8(l,e.c),l+=1,c.setUint8(l,!1===e.success?0:1),l+=1,c.setUint16(l,e.id,!0),l+=2,c.setUint16(l,e.team,!0),l+=2,c.setUint32(l,e.clock,!0),l+=4,c.setUint8(l,i.length),l+=1;for(let e=0;e<i.length;e+=1)c.setUint8(l+e,i[e]);l+=i.length,c.setUint8(l,e.type),l+=1,c.setUint8(l,o.length),l+=1;for(let e=0;e<o.length;e+=1)c.setUint8(l+e,o[e]);l+=o.length;{const{players:s}=e;c.setUint16(l,s.length,!0),l+=2;for(let e=0;e<s.length;e+=1){c.setUint16(l,s[e].id,!0),l+=2,c.setUint8(l,s[e].status),l+=1,c.setUint8(l,s[e].level),l+=1,c.setUint8(l,t[n].length),l+=1;for(let e=0;e<t[n].length;e+=1)c.setUint8(l+e,t[n][e]);l+=t[n].length,n+=1,c.setUint8(l,s[e].type),l+=1,c.setUint16(l,s[e].team,!0),l+=2,c.setUint16(l,2*s[e].posX+32768,!0),l+=2,c.setUint16(l,4*s[e].posY+32768,!0),l+=2,c.setUint16(l,6553.6*s[e].rot,!0),l+=2,c.setUint16(l,s[e].flag,!0),l+=2,c.setUint8(l,s[e].upgrades),l+=1}}return a},[i.default.BACKUP]:e=>{const t=new ArrayBuffer(1);return new DataView(t).setUint8(0,e.c),t},[i.default.PING]:e=>{const t=new ArrayBuffer(9),n=new DataView(t);let s=0;return n.setUint8(s,e.c),s+=1,n.setUint32(s,e.clock,!0),s+=4,n.setUint32(s,e.num,!0),s+=4,t},[i.default.PING_RESULT]:e=>{const t=new ArrayBuffer(11),n=new DataView(t);let s=0;return n.setUint8(s,e.c),s+=1,n.setUint16(s,e.ping,!0),s+=2,n.setUint32(s,e.playerstotal,!0),s+=4,n.setUint32(s,e.playersgame,!0),s+=4,t},[i.default.ACK]:e=>{const t=new ArrayBuffer(1);return new DataView(t).setUint8(0,e.c),t},[i.default.ERROR]:e=>{const t=new ArrayBuffer(2),n=new DataView(t);let s=0;return n.setUint8(s,e.c),s+=1,n.setUint8(s,e.error),s+=1,t},[i.default.COMMAND_REPLY]:e=>{const t=r.encodeUTF8(e.text),n=new ArrayBuffer(4+t.length),s=new DataView(n);let i=0;s.setUint8(i,e.c),i+=1,s.setUint8(i,e.type),i+=1,s.setUint16(i,t.length,!0),i+=2;for(let e=0;e<t.length;e+=1)s.setUint8(i+e,t[e]);return n},[i.default.PLAYER_NEW]:e=>{const t=r.encodeUTF8(e.name),n=new ArrayBuffer(17+t.length),s=new DataView(n);let i=0;s.setUint8(i,e.c),i+=1,s.setUint16(i,e.id,!0),i+=2,s.setUint8(i,e.status),i+=1,s.setUint8(i,t.length),i+=1;for(let e=0;e<t.length;e+=1)s.setUint8(i+e,t[e]);return i+=t.length,s.setUint8(i,e.type),i+=1,s.setUint16(i,e.team,!0),i+=2,s.setUint16(i,2*e.posX+32768,!0),i+=2,s.setUint16(i,4*e.posY+32768,!0),i+=2,s.setUint16(i,6553.6*e.rot,!0),i+=2,s.setUint16(i,e.flag,!0),i+=2,s.setUint8(i,e.upgrades),i+=1,n},[i.default.PLAYER_LEAVE]:e=>{const t=new ArrayBuffer(3),n=new DataView(t);let s=0;return n.setUint8(s,e.c),s+=1,n.setUint16(s,e.id,!0),s+=2,t},[i.default.PLAYER_UPDATE]:e=>{const t=new ArrayBuffer(21),n=new DataView(t);let s=0;n.setUint8(s,e.c),s+=1,n.setUint32(s,e.clock,!0),s+=4,n.setUint16(s,e.id,!0),s+=2,n.setUint8(s,e.keystate),s+=1,n.setUint8(s,e.upgrades),s+=1;{const t=512*e.posX+8388608,i=t%256,r=(t-i)/256;n.setUint16(s,r,!0),s+=2,n.setUint8(s,i),s+=1}{const t=512*e.posY+8388608,i=t%256,r=(t-i)/256;n.setUint16(s,r,!0),s+=2,n.setUint8(s,i),s+=1}return n.setUint16(s,6553.6*e.rot,!0),s+=2,n.setUint16(s,1638.4*e.speedX+32768,!0),s+=2,n.setUint16(s,1638.4*e.speedY+32768,!0),s+=2,t},[i.default.PLAYER_FIRE]:e=>{let t=0;for(let n=0;n<e.projectiles.length;n+=1)t+=17;const n=new ArrayBuffer(11+t),s=new DataView(n);let i=0;s.setUint8(i,e.c),i+=1,s.setUint32(i,e.clock,!0),i+=4,s.setUint16(i,e.id,!0),i+=2,s.setUint8(i,255*e.energy),i+=1,s.setUint16(i,1e6*e.energyRegen+32768,!0),i+=2;{const{projectiles:t}=e;s.setUint8(i,t.length),i+=1;for(let e=0;e<t.length;e+=1)s.setUint16(i,t[e].id,!0),i+=2,s.setUint8(i,t[e].type),i+=1,s.setUint16(i,2*t[e].posX+32768,!0),i+=2,s.setUint16(i,4*t[e].posY+32768,!0),i+=2,s.setUint16(i,1638.4*t[e].speedX+32768,!0),i+=2,s.setUint16(i,1638.4*t[e].speedY+32768,!0),i+=2,s.setUint16(i,32768*t[e].accelX+32768,!0),i+=2,s.setUint16(i,32768*t[e].accelY+32768,!0),i+=2,s.setUint16(i,1638.4*t[e].maxSpeed+32768,!0),i+=2}return n},[i.default.PLAYER_HIT]:e=>{let t=0;for(let n=0;n<e.players.length;n+=1)t+=5;const n=new ArrayBuffer(11+t),s=new DataView(n);let i=0;s.setUint8(i,e.c),i+=1,s.setUint16(i,e.id,!0),i+=2,s.setUint8(i,e.type),i+=1,s.setUint16(i,2*e.posX+32768,!0),i+=2,s.setUint16(i,4*e.posY+32768,!0),i+=2,s.setUint16(i,e.owner,!0),i+=2;{const{players:t}=e;s.setUint8(i,t.length),i+=1;for(let e=0;e<t.length;e+=1)s.setUint16(i,t[e].id,!0),i+=2,s.setUint8(i,255*t[e].health),i+=1,s.setUint16(i,1e6*t[e].healthRegen+32768,!0),i+=2}return n},[i.default.PLAYER_RESPAWN]:e=>{const t=new ArrayBuffer(12),n=new DataView(t);let s=0;n.setUint8(s,e.c),s+=1,n.setUint16(s,e.id,!0),s+=2;{const t=512*e.posX+8388608,i=t%256,r=(t-i)/256;n.setUint16(s,r,!0),s+=2,n.setUint8(s,i),s+=1}{const t=512*e.posY+8388608,i=t%256,r=(t-i)/256;n.setUint16(s,r,!0),s+=2,n.setUint8(s,i),s+=1}return n.setUint16(s,6553.6*e.rot,!0),s+=2,n.setUint8(s,e.upgrades),s+=1,t},[i.default.PLAYER_FLAG]:e=>{const t=new ArrayBuffer(5),n=new DataView(t);let s=0;return n.setUint8(s,e.c),s+=1,n.setUint16(s,e.id,!0),s+=2,n.setUint16(s,e.flag,!0),s+=2,t},[i.default.PLAYER_KILL]:e=>{const t=new ArrayBuffer(9),n=new DataView(t);let s=0;return n.setUint8(s,e.c),s+=1,n.setUint16(s,e.id,!0),s+=2,n.setUint16(s,e.killer,!0),s+=2,n.setUint16(s,2*e.posX+32768,!0),s+=2,n.setUint16(s,4*e.posY+32768,!0),s+=2,t},[i.default.PLAYER_UPGRADE]:e=>{const t=new ArrayBuffer(8),n=new DataView(t);let s=0;return n.setUint8(s,e.c),s+=1,n.setUint16(s,e.upgrades,!0),s+=2,n.setUint8(s,e.type),s+=1,n.setUint8(s,e.speed),s+=1,n.setUint8(s,e.defense),s+=1,n.setUint8(s,e.energy),s+=1,n.setUint8(s,e.missile),s+=1,t},[i.default.PLAYER_TYPE]:e=>{const t=new ArrayBuffer(4),n=new DataView(t);let s=0;return n.setUint8(s,e.c),s+=1,n.setUint16(s,e.id,!0),s+=2,n.setUint8(s,e.type),s+=1,t},[i.default.PLAYER_POWERUP]:e=>{const t=new ArrayBuffer(6),n=new DataView(t);let s=0;return n.setUint8(s,e.c),s+=1,n.setUint8(s,e.type),s+=1,n.setUint32(s,e.duration,!0),s+=4,t},[i.default.PLAYER_LEVEL]:e=>{const t=new ArrayBuffer(5),n=new DataView(t);let s=0;return n.setUint8(s,e.c),s+=1,n.setUint16(s,e.id,!0),s+=2,n.setUint8(s,e.type),s+=1,n.setUint8(s,e.level),s+=1,t},[i.default.PLAYER_RETEAM]:e=>{let t=0;for(let n=0;n<e.players.length;n+=1)t+=4;const n=new ArrayBuffer(3+t),s=new DataView(n);let i=0;s.setUint8(i,e.c),i+=1;{const{players:t}=e;s.setUint16(i,t.length,!0),i+=2;for(let e=0;e<t.length;e+=1)s.setUint16(i,t[e].id,!0),i+=2,s.setUint16(i,t[e].team,!0),i+=2}return n},[i.default.GAME_FLAG]:e=>{const t=new ArrayBuffer(13),n=new DataView(t);let s=0;n.setUint8(s,e.c),s+=1,n.setUint8(s,e.type),s+=1,n.setUint8(s,e.flag),s+=1,n.setUint16(s,e.id,!0),s+=2;{const t=512*e.posX+8388608,i=t%256,r=(t-i)/256;n.setUint16(s,r,!0),s+=2,n.setUint8(s,i),s+=1}{const t=512*e.posY+8388608,i=t%256,r=(t-i)/256;n.setUint16(s,r,!0),s+=2,n.setUint8(s,i),s+=1}return n.setUint8(s,e.blueteam),s+=1,n.setUint8(s,e.redteam),s+=1,t},[i.default.GAME_SPECTATE]:e=>{const t=new ArrayBuffer(3),n=new DataView(t);let s=0;return n.setUint8(s,e.c),s+=1,n.setUint16(s,e.id,!0),s+=2,t},[i.default.GAME_PLAYERSALIVE]:e=>{const t=new ArrayBuffer(3),n=new DataView(t);let s=0;return n.setUint8(s,e.c),s+=1,n.setUint16(s,e.players,!0),s+=2,t},[i.default.GAME_FIREWALL]:e=>{const t=new ArrayBuffer(15),n=new DataView(t);let s=0;return n.setUint8(s,e.c),s+=1,n.setUint8(s,e.type),s+=1,n.setUint8(s,e.status),s+=1,n.setUint16(s,2*e.posX+32768,!0),s+=2,n.setUint16(s,4*e.posY+32768,!0),s+=2,n.setFloat32(s,e.radius,!0),s+=4,n.setFloat32(s,e.speed,!0),s+=4,t},[i.default.EVENT_REPEL]:e=>{let t=0;for(let n=0;n<e.players.length;n+=1)t+=19;for(let n=0;n<e.mobs.length;n+=1)t+=17;const n=new ArrayBuffer(22+t),s=new DataView(n);let i=0;s.setUint8(i,e.c),i+=1,s.setUint32(i,e.clock,!0),i+=4,s.setUint16(i,e.id,!0),i+=2,s.setUint16(i,2*e.posX+32768,!0),i+=2,s.setUint16(i,4*e.posY+32768,!0),i+=2,s.setUint16(i,6553.6*e.rot,!0),i+=2,s.setUint16(i,1638.4*e.speedX+32768,!0),i+=2,s.setUint16(i,1638.4*e.speedY+32768,!0),i+=2,s.setUint8(i,255*e.energy),i+=1,s.setUint16(i,1e6*e.energyRegen+32768,!0),i+=2;{const{players:t}=e;s.setUint8(i,t.length),i+=1;for(let e=0;e<t.length;e+=1)s.setUint16(i,t[e].id,!0),i+=2,s.setUint8(i,t[e].keystate),i+=1,s.setUint16(i,2*t[e].posX+32768,!0),i+=2,s.setUint16(i,4*t[e].posY+32768,!0),i+=2,s.setUint16(i,6553.6*t[e].rot,!0),i+=2,s.setUint16(i,1638.4*t[e].speedX+32768,!0),i+=2,s.setUint16(i,1638.4*t[e].speedY+32768,!0),i+=2,s.setUint8(i,255*t[e].energy),i+=1,s.setUint16(i,1e6*t[e].energyRegen+32768,!0),i+=2,s.setUint8(i,255*t[e].playerHealth),i+=1,s.setUint16(i,1e6*t[e].playerHealthRegen+32768,!0),i+=2}{const{mobs:t}=e;s.setUint8(i,t.length),i+=1;for(let e=0;e<t.length;e+=1)s.setUint16(i,t[e].id,!0),i+=2,s.setUint8(i,t[e].type),i+=1,s.setUint16(i,2*t[e].posX+32768,!0),i+=2,s.setUint16(i,4*t[e].posY+32768,!0),i+=2,s.setUint16(i,1638.4*t[e].speedX+32768,!0),i+=2,s.setUint16(i,1638.4*t[e].speedY+32768,!0),i+=2,s.setUint16(i,32768*t[e].accelX+32768,!0),i+=2,s.setUint16(i,32768*t[e].accelY+32768,!0),i+=2,s.setUint16(i,1638.4*t[e].maxSpeed+32768,!0),i+=2}return n},[i.default.EVENT_BOOST]:e=>{const t=new ArrayBuffer(23),n=new DataView(t);let s=0;n.setUint8(s,e.c),s+=1,n.setUint32(s,e.clock,!0),s+=4,n.setUint16(s,e.id,!0),s+=2,n.setUint8(s,!1===e.boost?0:1),s+=1;{const t=512*e.posX+8388608,i=t%256,r=(t-i)/256;n.setUint16(s,r,!0),s+=2,n.setUint8(s,i),s+=1}{const t=512*e.posY+8388608,i=t%256,r=(t-i)/256;n.setUint16(s,r,!0),s+=2,n.setUint8(s,i),s+=1}return n.setUint16(s,6553.6*e.rot,!0),s+=2,n.setUint16(s,1638.4*e.speedX+32768,!0),s+=2,n.setUint16(s,1638.4*e.speedY+32768,!0),s+=2,n.setUint8(s,255*e.energy),s+=1,n.setUint16(s,1e6*e.energyRegen+32768,!0),s+=2,t},[i.default.EVENT_BOUNCE]:e=>{const t=new ArrayBuffer(20),n=new DataView(t);let s=0;n.setUint8(s,e.c),s+=1,n.setUint32(s,e.clock,!0),s+=4,n.setUint16(s,e.id,!0),s+=2,n.setUint8(s,e.keystate),s+=1;{const t=512*e.posX+8388608,i=t%256,r=(t-i)/256;n.setUint16(s,r,!0),s+=2,n.setUint8(s,i),s+=1}{const t=512*e.posY+8388608,i=t%256,r=(t-i)/256;n.setUint16(s,r,!0),s+=2,n.setUint8(s,i),s+=1}return n.setUint16(s,6553.6*e.rot,!0),s+=2,n.setUint16(s,1638.4*e.speedX+32768,!0),s+=2,n.setUint16(s,1638.4*e.speedY+32768,!0),s+=2,t},[i.default.EVENT_STEALTH]:e=>{const t=new ArrayBuffer(7),n=new DataView(t);let s=0;return n.setUint8(s,e.c),s+=1,n.setUint16(s,e.id,!0),s+=2,n.setUint8(s,!1===e.state?0:1),s+=1,n.setUint8(s,255*e.energy),s+=1,n.setUint16(s,1e6*e.energyRegen+32768,!0),s+=2,t},[i.default.EVENT_LEAVEHORIZON]:e=>{const t=new ArrayBuffer(4),n=new DataView(t);let s=0;return n.setUint8(s,e.c),s+=1,n.setUint8(s,e.type),s+=1,n.setUint16(s,e.id,!0),s+=2,t},[i.default.MOB_UPDATE]:e=>{const t=new ArrayBuffer(22),n=new DataView(t);let s=0;return n.setUint8(s,e.c),s+=1,n.setUint32(s,e.clock,!0),s+=4,n.setUint16(s,e.id,!0),s+=2,n.setUint8(s,e.type),s+=1,n.setUint16(s,2*e.posX+32768,!0),s+=2,n.setUint16(s,4*e.posY+32768,!0),s+=2,n.setUint16(s,1638.4*e.speedX+32768,!0),s+=2,n.setUint16(s,1638.4*e.speedY+32768,!0),s+=2,n.setUint16(s,32768*e.accelX+32768,!0),s+=2,n.setUint16(s,32768*e.accelY+32768,!0),s+=2,n.setUint16(s,1638.4*e.maxSpeed+32768,!0),s+=2,t},[i.default.MOB_UPDATE_STATIONARY]:e=>{const t=new ArrayBuffer(12),n=new DataView(t);let s=0;return n.setUint8(s,e.c),s+=1,n.setUint16(s,e.id,!0),s+=2,n.setUint8(s,e.type),s+=1,n.setFloat32(s,e.posX,!0),s+=4,n.setFloat32(s,e.posY,!0),s+=4,t},[i.default.MOB_DESPAWN]:e=>{const t=new ArrayBuffer(4),n=new DataView(t);let s=0;return n.setUint8(s,e.c),s+=1,n.setUint16(s,e.id,!0),s+=2,n.setUint8(s,e.type),s+=1,t},[i.default.MOB_DESPAWN_COORDS]:e=>{const t=new ArrayBuffer(8),n=new DataView(t);let s=0;return n.setUint8(s,e.c),s+=1,n.setUint16(s,e.id,!0),s+=2,n.setUint8(s,e.type),s+=1,n.setUint16(s,2*e.posX+32768,!0),s+=2,n.setUint16(s,4*e.posY+32768,!0),s+=2,t},[i.default.CHAT_PUBLIC]:e=>{const t=r.encodeUTF8(e.text),n=new ArrayBuffer(4+t.length),s=new DataView(n);let i=0;s.setUint8(i,e.c),i+=1,s.setUint16(i,e.id,!0),i+=2,s.setUint8(i,t.length),i+=1;for(let e=0;e<t.length;e+=1)s.setUint8(i+e,t[e]);return n},[i.default.CHAT_TEAM]:e=>{const t=r.encodeUTF8(e.text),n=new ArrayBuffer(4+t.length),s=new DataView(n);let i=0;s.setUint8(i,e.c),i+=1,s.setUint16(i,e.id,!0),i+=2,s.setUint8(i,t.length),i+=1;for(let e=0;e<t.length;e+=1)s.setUint8(i+e,t[e]);return n},[i.default.CHAT_SAY]:e=>{const t=r.encodeUTF8(e.text),n=new ArrayBuffer(4+t.length),s=new DataView(n);let i=0;s.setUint8(i,e.c),i+=1,s.setUint16(i,e.id,!0),i+=2,s.setUint8(i,t.length),i+=1;for(let e=0;e<t.length;e+=1)s.setUint8(i+e,t[e]);return n},[i.default.CHAT_WHISPER]:e=>{const t=r.encodeUTF8(e.text),n=new ArrayBuffer(6+t.length),s=new DataView(n);let i=0;s.setUint8(i,e.c),i+=1,s.setUint16(i,e.from,!0),i+=2,s.setUint16(i,e.to,!0),i+=2,s.setUint8(i,t.length),i+=1;for(let e=0;e<t.length;e+=1)s.setUint8(i+e,t[e]);return n},[i.default.CHAT_VOTEMUTEPASSED]:e=>{const t=new ArrayBuffer(3),n=new DataView(t);let s=0;return n.setUint8(s,e.c),s+=1,n.setUint16(s,e.id,!0),s+=2,t},[i.default.CHAT_VOTEMUTED]:e=>{const t=new ArrayBuffer(1);return new DataView(t).setUint8(0,e.c),t},[i.default.SCORE_UPDATE]:e=>{const t=new ArrayBuffer(21),n=new DataView(t);let s=0;return n.setUint8(s,e.c),s+=1,n.setUint16(s,e.id,!0),s+=2,n.setUint32(s,e.score,!0),s+=4,n.setUint32(s,e.earnings,!0),s+=4,n.setUint16(s,e.upgrades,!0),s+=2,n.setUint32(s,e.totalkills,!0),s+=4,n.setUint32(s,e.totaldeaths,!0),s+=4,t},[i.default.SCORE_BOARD]:e=>{let t=0;for(let n=0;n<e.data.length;n+=1)t+=7;for(let n=0;n<e.rankings.length;n+=1)t+=4;const n=new ArrayBuffer(5+t),s=new DataView(n);let i=0;s.setUint8(i,e.c),i+=1;{const{data:t}=e;s.setUint16(i,t.length,!0),i+=2;for(let e=0;e<t.length;e+=1)s.setUint16(i,t[e].id,!0),i+=2,s.setUint32(i,t[e].score,!0),i+=4,s.setUint8(i,t[e].level),i+=1}{const{rankings:t}=e;s.setUint16(i,t.length,!0),i+=2;for(let e=0;e<t.length;e+=1)s.setUint16(i,t[e].id,!0),i+=2,s.setUint8(i,t[e].x),i+=1,s.setUint8(i,t[e].y),i+=1}return n},[i.default.SCORE_DETAILED]:e=>{let t=0;for(let n=0;n<e.scores.length;n+=1)t+=17;const n=new ArrayBuffer(3+t),s=new DataView(n);let i=0;s.setUint8(i,e.c),i+=1;{const{scores:t}=e;s.setUint16(i,t.length,!0),i+=2;for(let e=0;e<t.length;e+=1)s.setUint16(i,t[e].id,!0),i+=2,s.setUint8(i,t[e].level),i+=1,s.setUint32(i,t[e].score,!0),i+=4,s.setUint16(i,t[e].kills,!0),i+=2,s.setUint16(i,t[e].deaths,!0),i+=2,s.setFloat32(i,t[e].damage,!0),i+=4,s.setUint16(i,t[e].ping,!0),i+=2}return n},[i.default.SCORE_DETAILED_CTF]:e=>{let t=0;for(let n=0;n<e.scores.length;n+=1)t+=19;const n=new ArrayBuffer(3+t),s=new DataView(n);let i=0;s.setUint8(i,e.c),i+=1;{const{scores:t}=e;s.setUint16(i,t.length,!0),i+=2;for(let e=0;e<t.length;e+=1)s.setUint16(i,t[e].id,!0),i+=2,s.setUint8(i,t[e].level),i+=1,s.setUint16(i,t[e].captures,!0),i+=2,s.setUint32(i,t[e].score,!0),i+=4,s.setUint16(i,t[e].kills,!0),i+=2,s.setUint16(i,t[e].deaths,!0),i+=2,s.setFloat32(i,t[e].damage,!0),i+=4,s.setUint16(i,t[e].ping,!0),i+=2}return n},[i.default.SCORE_DETAILED_BTR]:e=>{let t=0;for(let n=0;n<e.scores.length;n+=1)t+=20;const n=new ArrayBuffer(3+t),s=new DataView(n);let i=0;s.setUint8(i,e.c),i+=1;{const{scores:t}=e;s.setUint16(i,t.length,!0),i+=2;for(let e=0;e<t.length;e+=1)s.setUint16(i,t[e].id,!0),i+=2,s.setUint8(i,t[e].level),i+=1,s.setUint8(i,!1===t[e].alive?0:1),i+=1,s.setUint16(i,t[e].wins,!0),i+=2,s.setUint32(i,t[e].score,!0),i+=4,s.setUint16(i,t[e].kills,!0),i+=2,s.setUint16(i,t[e].deaths,!0),i+=2,s.setFloat32(i,t[e].damage,!0),i+=4,s.setUint16(i,t[e].ping,!0),i+=2}return n},[i.default.SERVER_MESSAGE]:e=>{const t=r.encodeUTF8(e.text),n=new ArrayBuffer(8+t.length),s=new DataView(n);let i=0;s.setUint8(i,e.c),i+=1,s.setUint8(i,e.type),i+=1,s.setUint32(i,e.duration,!0),i+=4,s.setUint16(i,t.length,!0),i+=2;for(let e=0;e<t.length;e+=1)s.setUint8(i+e,t[e]);return n},[i.default.SERVER_CUSTOM]:e=>{const t=r.encodeUTF8(e.data),n=new ArrayBuffer(4+t.length),s=new DataView(n);let i=0;s.setUint8(i,e.c),i+=1,s.setUint8(i,e.type),i+=1,s.setUint16(i,t.length,!0),i+=2;for(let e=0;e<t.length;e+=1)s.setUint8(i+e,t[e]);return n}}},function(e,t,n){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(n(7)),r=n(5);t.default={[i.default.LOGIN]:e=>{const t={c:0},n=new DataView(e);let s=1;t.protocol=n.getUint8(s),s+=1;{const e=n.getUint8(s),i=new Uint8Array(e);s+=1;for(let t=0;t<e;t+=1)i[t]=n.getUint8(s+t);t.name=r.decodeUTF8(i),s+=e}{const e=n.getUint8(s),i=new Uint8Array(e);s+=1;for(let t=0;t<e;t+=1)i[t]=n.getUint8(s+t);t.session=r.decodeUTF8(i),s+=e}t.horizonX=n.getUint16(s,!0),s+=2,t.horizonY=n.getUint16(s,!0),s+=2;{const e=n.getUint8(s),i=new Uint8Array(e);s+=1;for(let t=0;t<e;t+=1)i[t]=n.getUint8(s+t);t.flag=r.decodeUTF8(i),s+=e}return t},[i.default.BACKUP]:e=>{const t={c:1},n=new DataView(e);let s=1;{const e=n.getUint8(s),i=new Uint8Array(e);s+=1;for(let t=0;t<e;t+=1)i[t]=n.getUint8(s+t);t.token=r.decodeUTF8(i),s+=e}return t},[i.default.HORIZON]:e=>{const t={c:2},n=new DataView(e);let s=1;return t.horizonX=n.getUint16(s,!0),s+=2,t.horizonY=n.getUint16(s,!0),s+=2,t},[i.default.ACK]:()=>({c:5}),[i.default.PONG]:e=>{const t={c:6},n=new DataView(e);let s=1;return t.num=n.getUint32(s,!0),s+=4,t},[i.default.KEY]:e=>{const t={c:10},n=new DataView(e);let s=1;return t.seq=n.getUint32(s,!0),s+=4,t.key=n.getUint8(s),s+=1,t.state=0!==n.getUint8(s),s+=1,t},[i.default.COMMAND]:e=>{const t={c:11},n=new DataView(e);let s=1;{const e=n.getUint8(s),i=new Uint8Array(e);s+=1;for(let t=0;t<e;t+=1)i[t]=n.getUint8(s+t);t.com=r.decodeUTF8(i),s+=e}{const e=n.getUint8(s),i=new Uint8Array(e);s+=1;for(let t=0;t<e;t+=1)i[t]=n.getUint8(s+t);t.data=r.decodeUTF8(i),s+=e}return t},[i.default.SCOREDETAILED]:()=>({c:12}),[i.default.CHAT]:e=>{const t={c:20},n=new DataView(e);let s=1;{const e=n.getUint8(s),i=new Uint8Array(e);s+=1;for(let t=0;t<e;t+=1)i[t]=n.getUint8(s+t);t.text=r.decodeUTF8(i),s+=e}return t},[i.default.WHISPER]:e=>{const t={c:21},n=new DataView(e);let s=1;t.id=n.getUint16(s,!0),s+=2;{const e=n.getUint8(s),i=new Uint8Array(e);s+=1;for(let t=0;t<e;t+=1)i[t]=n.getUint8(s+t);t.text=r.decodeUTF8(i),s+=e}return t},[i.default.SAY]:e=>{const t={c:22},n=new DataView(e);let s=1;{const e=n.getUint8(s),i=new Uint8Array(e);s+=1;for(let t=0;t<e;t+=1)i[t]=n.getUint8(s+t);t.text=r.decodeUTF8(i),s+=e}return t},[i.default.TEAMCHAT]:e=>{const t={c:23},n=new DataView(e);let s=1;{const e=n.getUint8(s),i=new Uint8Array(e);s+=1;for(let t=0;t<e;t+=1)i[t]=n.getUint8(s+t);t.text=r.decodeUTF8(i),s+=e}return t},[i.default.VOTEMUTE]:e=>{const t={c:24},n=new DataView(e);let s=1;return t.id=n.getUint16(s,!0),s+=2,t},[i.default.LOCALPING]:e=>{const t={c:255},n=new DataView(e);let s=1;return t.auth=n.getUint32(s,!0),s+=4,t}}},function(e,t,n){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(n(8)),r=n(5);t.default={[i.default.LOGIN]:e=>{const t={c:0},n=new DataView(e);let s=1;t.success=0!==n.getUint8(s),s+=1,t.id=n.getUint16(s,!0),s+=2,t.team=n.getUint16(s,!0),s+=2,t.clock=n.getUint32(s,!0),s+=4;{const e=n.getUint8(s),i=new Uint8Array(e);s+=1;for(let t=0;t<e;t+=1)i[t]=n.getUint8(s+t);t.token=r.decodeUTF8(i),s+=e}t.type=n.getUint8(s),s+=1;{const e=n.getUint8(s),i=new Uint8Array(e);s+=1;for(let t=0;t<e;t+=1)i[t]=n.getUint8(s+t);t.room=r.decodeUTF8(i),s+=e}{const e=n.getUint16(s,!0);s+=2,t.players=[];for(let i=0;i<e;i+=1){const e={};e.id=n.getUint16(s,!0),s+=2,e.status=n.getUint8(s),s+=1,e.level=n.getUint8(s),s+=1;{const t=n.getUint8(s),i=new Uint8Array(t);s+=1;for(let e=0;e<t;e+=1)i[e]=n.getUint8(s+e);e.name=r.decodeUTF8(i),s+=t}e.type=n.getUint8(s),s+=1,e.team=n.getUint16(s,!0),s+=2,e.posX=(n.getUint16(s,!0)-32768)/2,s+=2,e.posY=(n.getUint16(s,!0)-32768)/4,s+=2,e.rot=n.getUint16(s,!0)/6553.6,s+=2,e.flag=n.getUint16(s,!0),s+=2,e.upgrades=n.getUint8(s),s+=1,t.players.push(e)}}return t},[i.default.BACKUP]:()=>({c:1}),[i.default.PING]:e=>{const t={c:5},n=new DataView(e);let s=1;return t.clock=n.getUint32(s,!0),s+=4,t.num=n.getUint32(s,!0),s+=4,t},[i.default.PING_RESULT]:e=>{const t={c:6},n=new DataView(e);let s=1;return t.ping=n.getUint16(s,!0),s+=2,t.playerstotal=n.getUint32(s,!0),s+=4,t.playersgame=n.getUint32(s,!0),s+=4,t},[i.default.ACK]:()=>({c:7}),[i.default.ERROR]:e=>{const t={c:8},n=new DataView(e);let s=1;return t.error=n.getUint8(s),s+=1,t},[i.default.COMMAND_REPLY]:e=>{const t={c:9},n=new DataView(e);let s=1;t.type=n.getUint8(s),s+=1;{const e=n.getUint16(s,!0),i=new Uint8Array(e);s+=2;for(let t=0;t<e;t+=1)i[t]=n.getUint8(s+t);t.text=r.decodeUTF8(i),s+=e}return t},[i.default.PLAYER_NEW]:e=>{const t={c:10},n=new DataView(e);let s=1;t.id=n.getUint16(s,!0),s+=2,t.status=n.getUint8(s),s+=1;{const e=n.getUint8(s),i=new Uint8Array(e);s+=1;for(let t=0;t<e;t+=1)i[t]=n.getUint8(s+t);t.name=r.decodeUTF8(i),s+=e}return t.type=n.getUint8(s),s+=1,t.team=n.getUint16(s,!0),s+=2,t.posX=(n.getUint16(s,!0)-32768)/2,s+=2,t.posY=(n.getUint16(s,!0)-32768)/4,s+=2,t.rot=n.getUint16(s,!0)/6553.6,s+=2,t.flag=n.getUint16(s,!0),s+=2,t.upgrades=n.getUint8(s),s+=1,t},[i.default.PLAYER_LEAVE]:e=>{const t={c:11},n=new DataView(e);let s=1;return t.id=n.getUint16(s,!0),s+=2,t},[i.default.PLAYER_UPDATE]:e=>{const t={c:12},n=new DataView(e);let s=1;t.clock=n.getUint32(s,!0),s+=4,t.id=n.getUint16(s,!0),s+=2,t.keystate=n.getUint8(s),s+=1,t.upgrades=n.getUint8(s),s+=1;{const e=256*n.getUint16(s,!0);s+=2,t.posX=(e+n.getUint8(s)-8388608)/512,s+=1}{const e=256*n.getUint16(s,!0);s+=2,t.posY=(e+n.getUint8(s)-8388608)/512,s+=1}return t.rot=n.getUint16(s,!0)/6553.6,s+=2,t.speedX=(n.getUint16(s,!0)-32768)/1638.4,s+=2,t.speedY=(n.getUint16(s,!0)-32768)/1638.4,s+=2,t},[i.default.PLAYER_FIRE]:e=>{const t={c:13},n=new DataView(e);let s=1;t.clock=n.getUint32(s,!0),s+=4,t.id=n.getUint16(s,!0),s+=2,t.energy=n.getUint8(s)/255,s+=1,t.energyRegen=(n.getUint16(s,!0)-32768)/1e6,s+=2;{const e=n.getUint8(s);s+=1,t.projectiles=[];for(let i=0;i<e;i+=1){const e={};e.id=n.getUint16(s,!0),s+=2,e.type=n.getUint8(s),s+=1,e.posX=(n.getUint16(s,!0)-32768)/2,s+=2,e.posY=(n.getUint16(s,!0)-32768)/4,s+=2,e.speedX=(n.getUint16(s,!0)-32768)/1638.4,s+=2,e.speedY=(n.getUint16(s,!0)-32768)/1638.4,s+=2,e.accelX=(n.getUint16(s,!0)-32768)/32768,s+=2,e.accelY=(n.getUint16(s,!0)-32768)/32768,s+=2,e.maxSpeed=(n.getUint16(s,!0)-32768)/1638.4,s+=2,t.projectiles.push(e)}}return t},[i.default.PLAYER_HIT]:e=>{const t={c:14},n=new DataView(e);let s=1;t.id=n.getUint16(s,!0),s+=2,t.type=n.getUint8(s),s+=1,t.posX=(n.getUint16(s,!0)-32768)/2,s+=2,t.posY=(n.getUint16(s,!0)-32768)/4,s+=2,t.owner=n.getUint16(s,!0),s+=2;{const e=n.getUint8(s);s+=1,t.players=[];for(let i=0;i<e;i+=1){const e={};e.id=n.getUint16(s,!0),s+=2,e.health=n.getUint8(s)/255,s+=1,e.healthRegen=(n.getUint16(s,!0)-32768)/1e6,s+=2,t.players.push(e)}}return t},[i.default.PLAYER_RESPAWN]:e=>{const t={c:15},n=new DataView(e);let s=1;t.id=n.getUint16(s,!0),s+=2;{const e=256*n.getUint16(s,!0);s+=2,t.posX=(e+n.getUint8(s)-8388608)/512,s+=1}{const e=256*n.getUint16(s,!0);s+=2,t.posY=(e+n.getUint8(s)-8388608)/512,s+=1}return t.rot=n.getUint16(s,!0)/6553.6,s+=2,t.upgrades=n.getUint8(s),s+=1,t},[i.default.PLAYER_FLAG]:e=>{const t={c:16},n=new DataView(e);let s=1;return t.id=n.getUint16(s,!0),s+=2,t.flag=n.getUint16(s,!0),s+=2,t},[i.default.PLAYER_KILL]:e=>{const t={c:17},n=new DataView(e);let s=1;return t.id=n.getUint16(s,!0),s+=2,t.killer=n.getUint16(s,!0),s+=2,t.posX=(n.getUint16(s,!0)-32768)/2,s+=2,t.posY=(n.getUint16(s,!0)-32768)/4,s+=2,t},[i.default.PLAYER_UPGRADE]:e=>{const t={c:18},n=new DataView(e);let s=1;return t.upgrades=n.getUint16(s,!0),s+=2,t.type=n.getUint8(s),s+=1,t.speed=n.getUint8(s),s+=1,t.defense=n.getUint8(s),s+=1,t.energy=n.getUint8(s),s+=1,t.missile=n.getUint8(s),s+=1,t},[i.default.PLAYER_TYPE]:e=>{const t={c:19},n=new DataView(e);let s=1;return t.id=n.getUint16(s,!0),s+=2,t.type=n.getUint8(s),s+=1,t},[i.default.PLAYER_POWERUP]:e=>{const t={c:20},n=new DataView(e);let s=1;return t.type=n.getUint8(s),s+=1,t.duration=n.getUint32(s,!0),s+=4,t},[i.default.PLAYER_LEVEL]:e=>{const t={c:21},n=new DataView(e);let s=1;return t.id=n.getUint16(s,!0),s+=2,t.type=n.getUint8(s),s+=1,t.level=n.getUint8(s),s+=1,t},[i.default.PLAYER_RETEAM]:e=>{const t={c:22},n=new DataView(e);let s=1;{const e=n.getUint16(s,!0);s+=2,t.players=[];for(let i=0;i<e;i+=1){const e={};e.id=n.getUint16(s,!0),s+=2,e.team=n.getUint16(s,!0),s+=2,t.players.push(e)}}return t},[i.default.GAME_FLAG]:e=>{const t={c:30},n=new DataView(e);let s=1;t.type=n.getUint8(s),s+=1,t.flag=n.getUint8(s),s+=1,t.id=n.getUint16(s,!0),s+=2;{const e=256*n.getUint16(s,!0);s+=2,t.posX=(e+n.getUint8(s)-8388608)/512,s+=1}{const e=256*n.getUint16(s,!0);s+=2,t.posY=(e+n.getUint8(s)-8388608)/512,s+=1}return t.blueteam=n.getUint8(s),s+=1,t.redteam=n.getUint8(s),s+=1,t},[i.default.GAME_SPECTATE]:e=>{const t={c:31},n=new DataView(e);let s=1;return t.id=n.getUint16(s,!0),s+=2,t},[i.default.GAME_PLAYERSALIVE]:e=>{const t={c:32},n=new DataView(e);let s=1;return t.players=n.getUint16(s,!0),s+=2,t},[i.default.GAME_FIREWALL]:e=>{const t={c:33},n=new DataView(e);let s=1;return t.type=n.getUint8(s),s+=1,t.status=n.getUint8(s),s+=1,t.posX=(n.getUint16(s,!0)-32768)/2,s+=2,t.posY=(n.getUint16(s,!0)-32768)/4,s+=2,t.radius=n.getFloat32(s,!0),s+=4,t.speed=n.getFloat32(s,!0),s+=4,t},[i.default.EVENT_REPEL]:e=>{const t={c:40},n=new DataView(e);let s=1;t.clock=n.getUint32(s,!0),s+=4,t.id=n.getUint16(s,!0),s+=2,t.posX=(n.getUint16(s,!0)-32768)/2,s+=2,t.posY=(n.getUint16(s,!0)-32768)/4,s+=2,t.rot=n.getUint16(s,!0)/6553.6,s+=2,t.speedX=(n.getUint16(s,!0)-32768)/1638.4,s+=2,t.speedY=(n.getUint16(s,!0)-32768)/1638.4,s+=2,t.energy=n.getUint8(s)/255,s+=1,t.energyRegen=(n.getUint16(s,!0)-32768)/1e6,s+=2;{const e=n.getUint8(s);s+=1,t.players=[];for(let i=0;i<e;i+=1){const e={};e.id=n.getUint16(s,!0),s+=2,e.keystate=n.getUint8(s),s+=1,e.posX=(n.getUint16(s,!0)-32768)/2,s+=2,e.posY=(n.getUint16(s,!0)-32768)/4,s+=2,e.rot=n.getUint16(s,!0)/6553.6,s+=2,e.speedX=(n.getUint16(s,!0)-32768)/1638.4,s+=2,e.speedY=(n.getUint16(s,!0)-32768)/1638.4,s+=2,e.energy=n.getUint8(s)/255,s+=1,e.energyRegen=(n.getUint16(s,!0)-32768)/1e6,s+=2,e.playerHealth=n.getUint8(s)/255,s+=1,e.playerHealthRegen=(n.getUint16(s,!0)-32768)/1e6,s+=2,t.players.push(e)}}{const e=n.getUint8(s);s+=1,t.mobs=[];for(let i=0;i<e;i+=1){const e={};e.id=n.getUint16(s,!0),s+=2,e.type=n.getUint8(s),s+=1,e.posX=(n.getUint16(s,!0)-32768)/2,s+=2,e.posY=(n.getUint16(s,!0)-32768)/4,s+=2,e.speedX=(n.getUint16(s,!0)-32768)/1638.4,s+=2,e.speedY=(n.getUint16(s,!0)-32768)/1638.4,s+=2,e.accelX=(n.getUint16(s,!0)-32768)/32768,s+=2,e.accelY=(n.getUint16(s,!0)-32768)/32768,s+=2,e.maxSpeed=(n.getUint16(s,!0)-32768)/1638.4,s+=2,t.mobs.push(e)}}return t},[i.default.EVENT_BOOST]:e=>{const t={c:41},n=new DataView(e);let s=1;t.clock=n.getUint32(s,!0),s+=4,t.id=n.getUint16(s,!0),s+=2,t.boost=0!==n.getUint8(s),s+=1;{const e=256*n.getUint16(s,!0);s+=2,t.posX=(e+n.getUint8(s)-8388608)/512,s+=1}{const e=256*n.getUint16(s,!0);s+=2,t.posY=(e+n.getUint8(s)-8388608)/512,s+=1}return t.rot=n.getUint16(s,!0)/6553.6,s+=2,t.speedX=(n.getUint16(s,!0)-32768)/1638.4,s+=2,t.speedY=(n.getUint16(s,!0)-32768)/1638.4,s+=2,t.energy=n.getUint8(s)/255,s+=1,t.energyRegen=(n.getUint16(s,!0)-32768)/1e6,s+=2,t},[i.default.EVENT_BOUNCE]:e=>{const t={c:42},n=new DataView(e);let s=1;t.clock=n.getUint32(s,!0),s+=4,t.id=n.getUint16(s,!0),s+=2,t.keystate=n.getUint8(s),s+=1;{const e=256*n.getUint16(s,!0);s+=2,t.posX=(e+n.getUint8(s)-8388608)/512,s+=1}{const e=256*n.getUint16(s,!0);s+=2,t.posY=(e+n.getUint8(s)-8388608)/512,s+=1}return t.rot=n.getUint16(s,!0)/6553.6,s+=2,t.speedX=(n.getUint16(s,!0)-32768)/1638.4,s+=2,t.speedY=(n.getUint16(s,!0)-32768)/1638.4,s+=2,t},[i.default.EVENT_STEALTH]:e=>{const t={c:43},n=new DataView(e);let s=1;return t.id=n.getUint16(s,!0),s+=2,t.state=0!==n.getUint8(s),s+=1,t.energy=n.getUint8(s)/255,s+=1,t.energyRegen=(n.getUint16(s,!0)-32768)/1e6,s+=2,t},[i.default.EVENT_LEAVEHORIZON]:e=>{const t={c:44},n=new DataView(e);let s=1;return t.type=n.getUint8(s),s+=1,t.id=n.getUint16(s,!0),s+=2,t},[i.default.MOB_UPDATE]:e=>{const t={c:60},n=new DataView(e);let s=1;return t.clock=n.getUint32(s,!0),s+=4,t.id=n.getUint16(s,!0),s+=2,t.type=n.getUint8(s),s+=1,t.posX=(n.getUint16(s,!0)-32768)/2,s+=2,t.posY=(n.getUint16(s,!0)-32768)/4,s+=2,t.speedX=(n.getUint16(s,!0)-32768)/1638.4,s+=2,t.speedY=(n.getUint16(s,!0)-32768)/1638.4,s+=2,t.accelX=(n.getUint16(s,!0)-32768)/32768,s+=2,t.accelY=(n.getUint16(s,!0)-32768)/32768,s+=2,t.maxSpeed=(n.getUint16(s,!0)-32768)/1638.4,s+=2,t},[i.default.MOB_UPDATE_STATIONARY]:e=>{const t={c:61},n=new DataView(e);let s=1;return t.id=n.getUint16(s,!0),s+=2,t.type=n.getUint8(s),s+=1,t.posX=n.getFloat32(s,!0),s+=4,t.posY=n.getFloat32(s,!0),s+=4,t},[i.default.MOB_DESPAWN]:e=>{const t={c:62},n=new DataView(e);let s=1;return t.id=n.getUint16(s,!0),s+=2,t.type=n.getUint8(s),s+=1,t},[i.default.MOB_DESPAWN_COORDS]:e=>{const t={c:63},n=new DataView(e);let s=1;return t.id=n.getUint16(s,!0),s+=2,t.type=n.getUint8(s),s+=1,t.posX=(n.getUint16(s,!0)-32768)/2,s+=2,t.posY=(n.getUint16(s,!0)-32768)/4,s+=2,t},[i.default.CHAT_PUBLIC]:e=>{const t={c:70},n=new DataView(e);let s=1;t.id=n.getUint16(s,!0),s+=2;{const e=n.getUint8(s),i=new Uint8Array(e);s+=1;for(let t=0;t<e;t+=1)i[t]=n.getUint8(s+t);t.text=r.decodeUTF8(i),s+=e}return t},[i.default.CHAT_TEAM]:e=>{const t={c:71},n=new DataView(e);let s=1;t.id=n.getUint16(s,!0),s+=2;{const e=n.getUint8(s),i=new Uint8Array(e);s+=1;for(let t=0;t<e;t+=1)i[t]=n.getUint8(s+t);t.text=r.decodeUTF8(i),s+=e}return t},[i.default.CHAT_SAY]:e=>{const t={c:72},n=new DataView(e);let s=1;t.id=n.getUint16(s,!0),s+=2;{const e=n.getUint8(s),i=new Uint8Array(e);s+=1;for(let t=0;t<e;t+=1)i[t]=n.getUint8(s+t);t.text=r.decodeUTF8(i),s+=e}return t},[i.default.CHAT_WHISPER]:e=>{const t={c:73},n=new DataView(e);let s=1;t.from=n.getUint16(s,!0),s+=2,t.to=n.getUint16(s,!0),s+=2;{const e=n.getUint8(s),i=new Uint8Array(e);s+=1;for(let t=0;t<e;t+=1)i[t]=n.getUint8(s+t);t.text=r.decodeUTF8(i),s+=e}return t},[i.default.CHAT_VOTEMUTEPASSED]:e=>{const t={c:78},n=new DataView(e);let s=1;return t.id=n.getUint16(s,!0),s+=2,t},[i.default.CHAT_VOTEMUTED]:()=>({c:79}),[i.default.SCORE_UPDATE]:e=>{const t={c:80},n=new DataView(e);let s=1;return t.id=n.getUint16(s,!0),s+=2,t.score=n.getUint32(s,!0),s+=4,t.earnings=n.getUint32(s,!0),s+=4,t.upgrades=n.getUint16(s,!0),s+=2,t.totalkills=n.getUint32(s,!0),s+=4,t.totaldeaths=n.getUint32(s,!0),s+=4,t},[i.default.SCORE_BOARD]:e=>{const t={c:81},n=new DataView(e);let s=1;{const e=n.getUint16(s,!0);s+=2,t.data=[];for(let i=0;i<e;i+=1){const e={};e.id=n.getUint16(s,!0),s+=2,e.score=n.getUint32(s,!0),s+=4,e.level=n.getUint8(s),s+=1,t.data.push(e)}}{const e=n.getUint16(s,!0);s+=2,t.rankings=[];for(let i=0;i<e;i+=1){const e={};e.id=n.getUint16(s,!0),s+=2,e.x=n.getUint8(s),s+=1,e.y=n.getUint8(s),s+=1,t.rankings.push(e)}}return t},[i.default.SCORE_DETAILED]:e=>{const t={c:82},n=new DataView(e);let s=1;{const e=n.getUint16(s,!0);s+=2,t.scores=[];for(let i=0;i<e;i+=1){const e={};e.id=n.getUint16(s,!0),s+=2,e.level=n.getUint8(s),s+=1,e.score=n.getUint32(s,!0),s+=4,e.kills=n.getUint16(s,!0),s+=2,e.deaths=n.getUint16(s,!0),s+=2,e.damage=n.getFloat32(s,!0),s+=4,e.ping=n.getUint16(s,!0),s+=2,t.scores.push(e)}}return t},[i.default.SCORE_DETAILED_CTF]:e=>{const t={c:83},n=new DataView(e);let s=1;{const e=n.getUint16(s,!0);s+=2,t.scores=[];for(let i=0;i<e;i+=1){const e={};e.id=n.getUint16(s,!0),s+=2,e.level=n.getUint8(s),s+=1,e.captures=n.getUint16(s,!0),s+=2,e.score=n.getUint32(s,!0),s+=4,e.kills=n.getUint16(s,!0),s+=2,e.deaths=n.getUint16(s,!0),s+=2,e.damage=n.getFloat32(s,!0),s+=4,e.ping=n.getUint16(s,!0),s+=2,t.scores.push(e)}}return t},[i.default.SCORE_DETAILED_BTR]:e=>{const t={c:84},n=new DataView(e);let s=1;{const e=n.getUint16(s,!0);s+=2,t.scores=[];for(let i=0;i<e;i+=1){const e={};e.id=n.getUint16(s,!0),s+=2,e.level=n.getUint8(s),s+=1,e.alive=0!==n.getUint8(s),s+=1,e.wins=n.getUint16(s,!0),s+=2,e.score=n.getUint32(s,!0),s+=4,e.kills=n.getUint16(s,!0),s+=2,e.deaths=n.getUint16(s,!0),s+=2,e.damage=n.getFloat32(s,!0),s+=4,e.ping=n.getUint16(s,!0),s+=2,t.scores.push(e)}}return t},[i.default.SERVER_MESSAGE]:e=>{const t={c:90},n=new DataView(e);let s=1;t.type=n.getUint8(s),s+=1,t.duration=n.getUint32(s,!0),s+=4;{const e=n.getUint16(s,!0),i=new Uint8Array(e);s+=2;for(let t=0;t<e;t+=1)i[t]=n.getUint8(s+t);t.text=r.decodeUTF8(i),s+=e}return t},[i.default.SERVER_CUSTOM]:e=>{const t={c:91},n=new DataView(e);let s=1;t.type=n.getUint8(s),s+=1;{const e=n.getUint16(s,!0),i=new Uint8Array(e);s+=2;for(let t=0;t<e;t+=1)i[t]=n.getUint8(s+t);t.data=r.decodeUTF8(i),s+=e}return t}}},function(e,t,n){"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UP=1]="UP",e[e.DOWN=2]="DOWN",e[e.LEFT=3]="LEFT",e[e.RIGHT=4]="RIGHT",e[e.FIRE=5]="FIRE",e[e.SPECIAL=6]="SPECIAL"}(s=t.KEY_CODES||(t.KEY_CODES={})),t.KEY_NAMES=Object.assign({},...Object.entries(s).map(([e,t])=>({[t]:e})))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s={1:"SY",2:"TH",3:"TM",4:"TN",5:"TR",6:"TT",7:"TW",8:"TZ",9:"UA",10:"UN",11:"US",12:"UY",13:"UZ",14:"VE",15:"VN",16:"PR",17:"PT",18:"PY",19:"QA",20:"RAINBOW",21:"RO",22:"RS",23:"RU",24:"SA",25:"SE",26:"SG",27:"SI",28:"SK",29:"SM",30:"MK",31:"MO",32:"MT",33:"MX",34:"MY",35:"NG",36:"NL",37:"NO",38:"NP",39:"NZ",40:"OM",41:"PA",42:"PE",43:"JP",44:"KP",45:"KR",46:"KW",47:"KZ",48:"LB",49:"LI",50:"LK",51:"LT",52:"LU",53:"LV",54:"HN",55:"HR",56:"HU",57:"ID",58:"IE",59:"IL",60:"IM",61:"IMPERIAL",62:"IN",63:"IQ",64:"DE",65:"DK",66:"DO",67:"DZ",68:"EC",69:"EE",70:"EG",71:"ES",72:"EU",73:"BH",74:"BO",75:"BR",76:"BT",77:"BY",78:"CA",79:"CH",80:"AD",81:"AE",82:"AL",83:"AM",84:"CL",85:"AQ",86:"CN",87:"AR",88:"FI",89:"CO",90:"AT",91:"IR",92:"FR",93:"COMMUNIST",94:"AU",95:"LY",96:"IS",97:"GB",98:"CONFEDERATE",99:"AZ",100:"MA",101:"IT",102:"GE",103:"CR",104:"BA",105:"PH",106:"MC",107:"JM",108:"GR",109:"CU",110:"BD",111:"SO",112:"PK",113:"MD",114:"JO",115:"GT",116:"CY",117:"BE",118:"ZA",119:"SV",120:"PL",121:"ME",122:"JOLLY",123:"HK",124:"CZ",125:"BG"};t.FLAGS_CODE_TO_ISO=s;const i=Object.assign({},...Object.entries(s).map(([e,t])=>({[t]:~~e})));t.FLAGS_ISO_TO_CODE=i;t.COUNTRY_NAMES={AL:"Albania",DZ:"Algeria",AD:"Andorra",AQ:"Antarctica",AR:"Argentina",AM:"Armenia",AU:"Australia",AT:"Austria",AZ:"Azerbaijan",BH:"Bahrain",BD:"Bangladesh",BY:"Belarus",BE:"Belgium",BT:"Bhutan",BO:"Bolivia",BA:"Bosnia and Herzegovina",BR:"Brazil",BG:"Bulgaria",CA:"Canada",CL:"Chile",CN:"China",CO:"Colombia",COMMUNIST:"Communist",CONFEDERATE:"Confederate",CR:"CostaRica",HR:"Croatia",CU:"Cuba",CY:"Cyprus",CZ:"Czech Republic",DK:"Denmark",DO:"Dominican Republic",KP:"DPRK",EC:"Ecuador",EG:"Egypt",SV:"ElSalvador",EE:"Estonia",EU:"European Union",FI:"Finland",FR:"France",GE:"Georgia",DE:"Germany",GR:"Greece",GT:"Guatemala",HN:"Honduras",HK:"HongKong",HU:"Hungary",IS:"Iceland",IMPERIAL:"Imperial Japan",IN:"India",ID:"Indonesia",IR:"Iran",IQ:"Iraq",IE:"Ireland",IM:"Isle of Man",IL:"Israel",IT:"Italy",JM:"Jamaica",JP:"Japan",JOLLY:"Jolly Rogers",JO:"Jordan",KZ:"Kazakhstan",KW:"Kuwait",LV:"Latvia",LB:"Lebanon",LY:"Libyan Arab Jamahiriya",LI:"Liechtenstein",LT:"Lithuania",LU:"Luxembourg",MO:"Macao",MK:"Macedonia",MY:"Malaysia",MT:"Malta",MX:"Mexico",MD:"Moldova",MC:"Monaco",ME:"Montenegro",MA:"Morocco",NP:"Nepal",NL:"Netherlands",NZ:"New Zealand",NG:"Nigeria",NO:"Norway",OM:"Oman",PK:"Pakistan",PA:"Panama",PY:"Paraguay",PE:"Peru",PH:"Philippines",PL:"Poland",PT:"Portugal",PR:"PuertoRico",QA:"Qatar",RAINBOW:"Rainbow",RO:"Romania",RU:"Russian Federation",SM:"SanMarino",SA:"Saudi Arabia",RS:"Serbia",SG:"Singapore",SK:"Slovakia",SI:"Slovenia",SO:"Somalia",ZA:"South Africa",KR:"South Korea",ES:"Spain",LK:"Sri Lanka",SE:"Sweden",CH:"Switzerland",SY:"Syrian Arab Republic",TW:"Taiwan",TZ:"Tanzania",TH:"Thailand",TT:"Trinidad and Tobago",TN:"Tunisia",TR:"Turkey",TM:"Turkmenistan",UA:"Ukraine",AE:"United Arab Emirates",GB:"United Kingdom",UN:"United Nations",US:"United States",UY:"Uruguay",UZ:"Uzbekistan",VE:"Venezuela",VN:"Vietnam"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(17),i=(e,t,n)=>e<=t?t:e>=n?n:e;t.levelToBouty=e=>((e-1)/.0111)**2,t.decodeMinimapCoords=(e,t)=>({x:128*e-s.MAP_SIZE.WIDTH/2+64,y:i(128*t-s.MAP_SIZE.HEIGHT,-s.MAP_SIZE.HEIGHT/2,s.MAP_SIZE.HEIGHT/2)+64}),t.decodeUpgrades=e=>{return{speed:7&e,shield:(8&e)>>3,inferno:(16&e)>>4}},t.decodeKeystate=e=>({keystate:{UP:1==(1&e),DOWN:2==(2&e),LEFT:4==(4&e),RIGHT:8==(8&e)},boost:16==(16&e),strafe:32==(32&e),stealthed:64==(64&e),flagspeed:128==(128&e)}),t.default=t.levelToBouty},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encodeUpgrades=(e,t,n)=>7&e|t<<3|n<<4,t.encodeKeystate=(e,t,n,s,i)=>{const r=!0===e.DOWN?1:0;return 0|(!0===e.UP?1:0)<<0|(!0===e.UP?0:r)<<1|(!0===e.LEFT?1:0)<<2|(!0===e.RIGHT?1:0)<<3|(!0===t?1:0)<<4|(!0===n?1:0)<<5|(!0===s?1:0)<<6|(!0===i?1:0)<<7}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(20),i=n(24),r=n(54),o=n(1),a=n(0),c=n(18);t.PI_X2=2*Math.PI;t.PlayerMaintenanceHandler=class{constructor(e){this.context=e,this.handles=[a.Events.TICK],this.logger=new c.PeriodicLogger(this.context)}exec(e){const t=e.args;for(const e of this.context.state.getPlayers())e.status!==o.PLAYER_STATUS.INACTIVE&&this.updatePlayer(e,t)}updatePlayer(e,n){const o=i.SHIPS_SPECS[e.type],a=e.boost?o.boostFactor:1,c=n.frameFactor;if(!isNaN(e.energyRegen)){const t=e.energyRegen*c;e.energy+=t,e.energy>1?e.energy=1:e.energy<0?e.energy=0:isNaN(e.energy)&&(e.energy=1)}e.health+=c*o.healthRegen,e.health>1?e.health=1:e.health<0&&(e.health=0),e.shieldOrInfernoTimer&&e.shieldOrInfernoTimer.hasTimedOut&&(e.shieldOrInfernoTimer=null,e.powerUps.inferno=null,e.powerUps.shield=null);let l=-999;e.strafe?(e.keystate.LEFT&&(l=e.rot-.5*Math.PI),e.keystate.RIGHT&&(l=e.rot+.5*Math.PI)):(e.keystate.LEFT||e.keystate.RIGHT)&&(e.keystate.LEFT&&(e.rot-=c*o.turnFactor),e.keystate.RIGHT&&(e.rot+=c*o.turnFactor),e.rot=(e.rot%t.PI_X2+t.PI_X2)%t.PI_X2),e.keystate.UP?-999===l?l=e.rot:l+=Math.PI*(e.keystate.RIGHT?-.25:.25):e.keystate.DOWN&&(-999===l?l=e.rot+Math.PI:l+=Math.PI*(e.keystate.RIGHT?.25:-.25));let u=0;if(0!==e.speed.x||0!==e.speed.y||e.keystate.UP||e.keystate.DOWN||e.strafe){const t=e.speed.x,n=e.speed.y;-999!==l&&(e.speed.x+=Math.sin(l)*o.accelFactor*a*c,e.speed.y-=Math.cos(l)*o.accelFactor*a*c),u=Math.hypot(e.speed.x,e.speed.y);let s=o.maxSpeed*a*r.UPGRADES_SPECS.SPEED.factor[e.upgrades.speed];e.powerUps.inferno&&(s*=o.infernoFactor),e.flagspeed&&(s=o.flagSpeed),u>s?(e.speed.x*=s/u,e.speed.y*=s/u):e.speed.x>o.minSpeed||e.speed.x<-o.minSpeed||e.speed.y>o.minSpeed||e.speed.y<-o.minSpeed?(e.speed.x*=1-o.brakeFactor*c,e.speed.y*=1-o.brakeFactor*c):(e.speed.x=0,e.speed.y=0),e.pos.x+=c*t+.5*(e.speed.x-t)*c*c,e.pos.y+=c*n+.5*(e.speed.y-n)*c*c}e.pos.x<s.PLAYERS_POSITION.MIN_X&&(e.pos.x=s.PLAYERS_POSITION.MIN_X),e.pos.x>s.PLAYERS_POSITION.MAX_X&&(e.pos.x=s.PLAYERS_POSITION.MAX_X),e.pos.y<s.PLAYERS_POSITION.MIN_Y&&(e.pos.y=s.PLAYERS_POSITION.MIN_Y),e.pos.y>s.PLAYERS_POSITION.MAX_Y&&(e.pos.y=s.PLAYERS_POSITION.MAX_Y)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.UPGRADES_DEFAULT_MIN_CHANCE=.3,t.UPGRADES_DEFAULT_MAX_CHANCE=.8,t.UPGRADES_MIN_VICTIM_SCORE_TO_DROP=26,t.UPGRADES_TYPES={1:"SPEED",2:"DEFENSE",3:"ENERGY",4:"MISSILE"},t.UPGRADES_START_AMOUNT=0,t.UPGRADES_SPECS={SPEED:{cost:[0,1,1,1,1,1],factor:[1,1.05,1.1,1.15,1.2,1.25]},DEFENSE:{cost:[0,1,1,1,1,1],factor:[1,1.05,1.1,1.15,1.2,1.25]},ENERGY:{cost:[0,1,1,1,1,1],factor:[1,1.05,1.1,1.15,1.2,1.25]},MISSILE:{cost:[0,1,1,1,1,1],factor:[1,1.05,1.1,1.15,1.2,1.25]}},t.UPGRADES_ACTION_TYPE={LOST:0,SPEED:1,DEFENSE:2,ENERGY:3,MISSILE:4}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(10),i=n(1),r=n(0);t.ServerMessageHandler=class{constructor(e){this.context=e,this.handles=[r.Events.SERVER_MESSAGE]}exec(e){const t=e.args;let n;switch(t.c){case i.SERVER_PACKETS.CHAT_PUBLIC:n=s.CHAT_TYPE.CHAT,this.context.eventQueue.pub(r.Events.CHAT_RECEIVED,{chatMessage:t.text,chatType:n,playerId:t.id});break;case i.SERVER_PACKETS.CHAT_SAY:n=s.CHAT_TYPE.SAY,this.context.eventQueue.pub(r.Events.CHAT_RECEIVED,{chatMessage:t.text,chatType:n,playerId:t.id});break;case i.SERVER_PACKETS.CHAT_TEAM:n=s.CHAT_TYPE.TEAM,this.context.eventQueue.pub(r.Events.CHAT_RECEIVED,{chatMessage:t.text,chatType:n,playerId:t.id});break;case i.SERVER_PACKETS.CHAT_WHISPER:n=s.CHAT_TYPE.WHISPER,this.context.eventQueue.pub(r.Events.CHAT_RECEIVED,{chatMessage:t.text,chatType:n,playerId:t.from,to:t.to});break;case i.SERVER_PACKETS.CHAT_VOTEMUTED:this.context.eventQueue.pub(r.Events.CHAT_NOT_POSSIBLE_BC_MUTED,t);break;case i.SERVER_PACKETS.CHAT_VOTEMUTEPASSED:this.context.eventQueue.pub(r.Events.CHAT_PLAYER_MUTED,t);break;case i.SERVER_PACKETS.COMMAND_REPLY:this.context.eventQueue.pub(r.Events.SERVER_COMMAND_REPLY,t);break;case i.SERVER_PACKETS.ERROR:this.context.eventQueue.pub(r.Events.SERVER_ERROR,t);break;case i.SERVER_PACKETS.EVENT_BOOST:this.context.eventQueue.pub(r.Events.PLAYER_BOOST,t);break;case i.SERVER_PACKETS.EVENT_BOUNCE:this.context.eventQueue.pub(r.Events.PLAYER_BOUNCE,t);break;case i.SERVER_PACKETS.EVENT_LEAVEHORIZON:this.context.eventQueue.pub(r.Events.LEAVE_HORIZON,t);break;case i.SERVER_PACKETS.EVENT_REPEL:this.context.eventQueue.pub(r.Events.PLAYER_REPEL,t);break;case i.SERVER_PACKETS.EVENT_STEALTH:this.context.eventQueue.pub(r.Events.PLAYER_STEALTH,t);break;case i.SERVER_PACKETS.GAME_FLAG:this.context.eventQueue.pub(r.Events.FLAG_UPDATE,t);break;case i.SERVER_PACKETS.LOGIN:this.context.eventQueue.pub(r.Events.LOGIN,t);break;case i.SERVER_PACKETS.MOB_DESPAWN:this.context.eventQueue.pub(r.Events.MOB_DESPAWN,t);break;case i.SERVER_PACKETS.MOB_DESPAWN_COORDS:this.context.eventQueue.pub(r.Events.MOUNTAIN_HIT,t);break;case i.SERVER_PACKETS.MOB_UPDATE:this.context.eventQueue.pub(r.Events.MISSILE_UPDATE,t);break;case i.SERVER_PACKETS.MOB_UPDATE_STATIONARY:this.context.eventQueue.pub(r.Events.CRATE_NEW,t);break;case i.SERVER_PACKETS.PLAYER_FIRE:this.context.eventQueue.pub(r.Events.PLAYER_FIRE,t);break;case i.SERVER_PACKETS.PLAYER_FLAG:this.context.eventQueue.pub(r.Events.PLAYER_CHANGE_FLAG,t);break;case i.SERVER_PACKETS.PLAYER_HIT:this.context.eventQueue.pub(r.Events.PLAYER_HIT,t);break;case i.SERVER_PACKETS.PLAYER_KILL:this.context.eventQueue.pub(r.Events.PLAYER_KILLED,t);break;case i.SERVER_PACKETS.PLAYER_LEAVE:this.context.eventQueue.pub(r.Events.PLAYER_LEAVE,t);break;case i.SERVER_PACKETS.PLAYER_LEVEL:this.context.eventQueue.pub(r.Events.PLAYER_LEVEL,t);break;case i.SERVER_PACKETS.PLAYER_NEW:this.context.eventQueue.pub(r.Events.PLAYER_NEW,t);break;case i.SERVER_PACKETS.PLAYER_POWERUP:this.context.eventQueue.pub(r.Events.PLAYER_POWERUP,t);break;case i.SERVER_PACKETS.PLAYER_UPDATE:this.context.eventQueue.pub(r.Events.PLAYER_UPDATE,t);break;case i.SERVER_PACKETS.PLAYER_RETEAM:this.context.eventQueue.pub(r.Events.TEAMS,t);break;case i.SERVER_PACKETS.PLAYER_UPGRADE:this.context.eventQueue.pub(r.Events.PLAYER_UPGRADE_APPLIED,t);break;case i.SERVER_PACKETS.PLAYER_RESPAWN:this.context.eventQueue.pub(r.Events.PLAYER_RESPAWN,t);break;case i.SERVER_PACKETS.PLAYER_TYPE:this.context.eventQueue.pub(r.Events.PLAYER_SWITCH_TYPE,t);break;case i.SERVER_PACKETS.SERVER_CUSTOM:this.context.eventQueue.pub(r.Events.SERVER_CUSTOM,t);break;case i.SERVER_PACKETS.SERVER_MESSAGE:this.context.eventQueue.pub(r.Events.SERVER_ANNOUNCEMENT,t);break;case i.SERVER_PACKETS.SCORE_BOARD:const e=t;this.context.eventQueue.pub(r.Events.SCORE_BOARD,e.data),this.context.eventQueue.pub(r.Events.MINI_MAP,e.rankings);break;case i.SERVER_PACKETS.SCORE_DETAILED:const o=t;this.context.eventQueue.pub(r.Events.SCORE_DETAILED,{ffaScores:o.scores});break;case i.SERVER_PACKETS.SCORE_DETAILED_CTF:const a=t;this.context.eventQueue.pub(r.Events.SCORE_DETAILED,{ffaScores:a.scores});break;case i.SERVER_PACKETS.SCORE_UPDATE:this.context.eventQueue.pub(r.Events.SCORE_UPDATE,t)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0),i=n(14),r=n(2);t.CrateNewHandler=class{constructor(e){this.context=e,this.handles=[s.Events.CRATE_NEW]}exec(e){const t=e.args,n=new i.Mob;n.id=t.id,n.pos=new r.Pos(t.posX,t.posY),n.mobType=t.type,this.context.state.addMob(n)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),i=n(0),r=n(2);t.FlagUpdateHandler=class{constructor(e){this.context=e,this.handles=[i.Events.FLAG_UPDATE]}exec(e){const t=e.args,n=this.context.state.getCtfTeam(t.flag);n.flagState=t.type,n.flagTakenById=t.id,n.flagPos=new r.Pos(t.posX,t.posY),this.context.state.getCtfTeam(s.CTF_TEAMS.BLUE).score=t.blueteam,this.context.state.getCtfTeam(s.CTF_TEAMS.RED).score=t.redteam}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(17),i=n(0);t.LeaveHorizonHandler=class{constructor(e){this.context=e,this.handles=[i.Events.LEAVE_HORIZON]}exec(e){const t=e.args;let n;n=t.type===s.LEAVE_HORIZON_TYPES.MOB?this.context.state.getMobById(t.id):this.context.state.getPlayerById(t.id),n&&(n.isVisibleOnScreen=!1),t.type!==s.LEAVE_HORIZON_TYPES.PLAYER&&this.context.state.removeMob(t.id)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),i=n(0),r=n(6),o=n(25),a=n(2),c=n(11);t.LoginHandler=class{constructor(e){this.context=e,this.handles=[i.Events.LOGIN]}exec(e){const t=e.args,n=this.context.state;n.id=t.id,n.team=t.team,this.context.gameType=s.GAME_TYPES.FFA,t.team!==s.CTF_TEAMS.BLUE&&t.team!==s.CTF_TEAMS.RED||(this.context.gameType=s.GAME_TYPES.CTF);let i=0;for(const e of t.players){const t=new o.Player;i++,t.id=e.id,t.flag=e.flag,t.name=e.name,t.pos=new a.Pos(e.posX,e.posY),t.type=e.type,t.rot=e.rot,t.status=e.status,t.team=e.team,t.ranking=i,t.health=1,t.energy=1,t.level=e.level,t.powerUps=r.Decoder.upgradesToPowerUps(e.upgrades)||new c.PowerUps,n.addPlayer(t)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),i=n(0),r=n(2);t.MiniMapHandler=class{constructor(e){this.context=e,this.handles=[i.Events.MINI_MAP]}exec(e){const t=e.args;for(const e of t){const t=this.context.state.getPlayerById(e.id);if(t)if(0===e.x&&0===e.y)this.context.state.getMe().stealthed||(t.status=s.PLAYER_STATUS.INACTIVE);else{const n=s.decodeMinimapCoords(e.x,e.y);t.posFromMinimap=new r.Pos(n)}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0),i=n(14),r=n(2);t.MissileUpdateHandler=class{constructor(e){this.context=e,this.handles=[s.Events.MISSILE_UPDATE]}exec(e){const t=e.args;let n=this.context.state.getMobById(t.id);n||(n=new i.Mob,n.id=t.id,this.context.state.addMob(n)),n.isVisibleOnScreen=!0,n.pos=new r.Pos(t.posX,t.posY),n.accel=new r.Pos(t.accelX,t.accelY),n.maxSpeed=t.maxSpeed,n.speed=new r.Pos(t.speedX,t.speedY),n.rot=n.speed.direction(),n.mobType=t.type}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0);t.MobDespawnHandler=class{constructor(e){this.context=e,this.handles=[s.Events.MOB_DESPAWN]}exec(e){const t=e.args;this.context.state.removeMob(t.id)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0),i=n(2);t.MountainHitHandler=class{constructor(e){this.context=e,this.handles=[s.Events.MOUNTAIN_HIT]}exec(e){const t=e.args;this.context.eventQueue.pub(s.Events.EXPLOSION,{pos:new i.Pos(t.posX,t.posY),type:t.type}),this.context.state.removeMob(t.id)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0),i=n(2);t.PlayerBoostHandler=class{constructor(e){this.context=e,this.handles=[s.Events.PLAYER_BOOST]}exec(e){const t=e.args,n=this.context.state.getPlayerById(t.id);n&&(n.boost=t.boost,n.energy=t.energy,n.energyRegen=t.energyRegen,n.pos=new i.Pos(t.posX,t.posY),n.rot=t.rot,n.speed=new i.Pos(t.speedX,t.speedY))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0),i=n(6),r=n(2);t.PlayerBounceHandler=class{constructor(e){this.context=e,this.handles=[s.Events.PLAYER_BOUNCE]}exec(e){const t=e.args,n=this.context.state.getPlayerById(t.id);if(!n)return;const s=i.Decoder.keystateToPlayerMovements(t.keystate);n.setMovements(s),n.pos=new r.Pos(t.posX,t.posY),n.rot=t.rot,n.speed=new r.Pos(t.speedX,t.speedY)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0);t.PlayerChangeFlagHandler=class{constructor(e){this.context=e,this.handles=[s.Events.PLAYER_CHANGE_FLAG]}exec(e){const t=e.args,n=this.context.state.getPlayerById(t.id);n&&(n.flag=t.flag)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0),i=n(14),r=n(2);t.PlayerFireHandler=class{constructor(e){this.context=e,this.handles=[s.Events.PLAYER_FIRE]}exec(e){const t=e.args,n=this.context.state.getPlayerById(t.id);if(n){n.energy=t.energy,n.energyRegen=t.energyRegen;for(const e of t.projectiles){const s=new i.Mob;s.id=e.id,s.pos=new r.Pos(e.posX,e.posY),s.accel=new r.Pos(e.accelX,e.accelY),s.maxSpeed=e.maxSpeed,s.speed=new r.Pos(e.speedX,e.speedY),s.mobType=e.type,s.ownerId=t.id,s.rot=s.speed.direction(),s.team=n.team,this.context.state.addMob(s)}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0),i=n(2);t.PlayerHitHandler=class{constructor(e){this.context=e,this.handles=[s.Events.PLAYER_HIT]}exec(e){const t=e.args;this.context.eventQueue.pub(s.Events.EXPLOSION,{pos:new i.Pos(t.posX,t.posY),type:t.type});for(const e of t.players){const t=this.context.state.getPlayerById(e.id);t&&(t.health=e.health,t.healthRegen=e.healthRegen)}this.context.state.removeMob(t.id)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),i=n(0);t.PlayerKilledHandler=class{constructor(e){this.context=e,this.handles=[i.Events.PLAYER_KILLED]}exec(e){const t=e.args,n=this.context.state.getPlayerById(t.id);n&&(n.status=s.PLAYER_STATUS.INACTIVE)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0);t.PlayerLeaveHandler=class{constructor(e){this.context=e,this.handles=[s.Events.PLAYER_LEAVE]}exec(e){const t=e.args;this.context.state.removePlayer(t.id)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),i=n(0);t.PlayerLevelHandler=class{constructor(e){this.context=e,this.handles=[i.Events.PLAYER_LEVEL]}exec(e){const t=e.args,n=this.context.state.getPlayerById(t.id);n&&(n.level=t.level,t.type===s.PLAYER_LEVEL_UPDATE_TYPES.LEVELUP&&t.id===this.context.state.id&&this.context.eventQueue.pub(i.Events.MESSAGE_TO_PLAYER,{message:`You have reached level ${n.level}!`}))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0),i=n(6),r=n(25),o=n(2),a=n(11);t.PlayerNewHandler=class{constructor(e){this.context=e,this.handles=[s.Events.PLAYER_NEW]}exec(e){const t=e.args,n=new r.Player;n.id=t.id,n.flag=t.flag,n.name=t.name,n.pos=new o.Pos(t.posX,t.posY),n.type=t.type,n.rot=t.rot,n.status=t.status,n.team=t.team,n.energy=1,n.health=1,n.powerUps=i.Decoder.upgradesToPowerUps(t.upgrades)||new a.PowerUps,this.context.state.addPlayer(n)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),i=n(0),r=n(3);t.PlayerPowerupHandler=class{constructor(e){this.context=e,this.handles=[i.Events.PLAYER_POWERUP]}exec(e){const t=e.args,n=this.context.state.getMe();n&&(n.hasShield=t.type===s.PLAYER_POWERUP_TYPES.SHIELD,n.hasInferno=t.type===s.PLAYER_POWERUP_TYPES.INFERNO,n.shieldOrInfernoTimer=new r.StopWatch(t.duration))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0),i=n(6),r=n(2);t.PlayerRepelHandler=class{constructor(e){this.context=e,this.handles=[s.Events.PLAYER_REPEL]}exec(e){const t=e.args,n=this.context.state.getPlayerById(t.id);n&&(n.pos=new r.Pos(t.posX,t.posY),n.rot=t.rot,n.speed=new r.Pos(t.speedX,t.speedY),n.energyRegen=t.energyRegen,n.energy=t.energy);for(const e of t.players){const t=this.context.state.getPlayerById(e.id);if(!t)continue;const n=i.Decoder.keystateToPlayerMovements(e.keystate);t.setMovements(n),t.pos=new r.Pos(e.posX,e.posY),t.rot=e.rot,t.speed=new r.Pos(e.speedX,e.speedY),t.energyRegen=e.energyRegen,t.energy=e.energy,t.health=e.playerHealth,t.healthRegen=e.playerHealthRegen}for(const e of t.mobs){const s=this.context.state.getMobById(e.id);s&&(s.pos=new r.Pos(e.posX,e.posY),s.accel=new r.Pos(e.accelX,e.accelY),s.maxSpeed=e.maxSpeed,s.speed=new r.Pos(e.speedX,e.speedY),s.rot=s.speed.direction(),s.mobType=e.type,s.ownerId=t.id,s.team=n.team)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),i=n(0),r=n(6),o=n(2),a=n(11);t.PlayerRespawnHandler=class{constructor(e){this.context=e,this.handles=[i.Events.PLAYER_RESPAWN]}exec(e){const t=e.args,n=this.context.state.getPlayerById(t.id);n&&(n.pos=new o.Pos(t.posX,t.posY),n.rot=t.rot,n.powerUps=r.Decoder.upgradesToPowerUps(t.upgrades)||new a.PowerUps,n.status=s.PLAYER_STATUS.ALIVE,n.health=1,n.energy=1)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0);t.PlayerStealthHandler=class{constructor(e){this.context=e,this.handles=[s.Events.PLAYER_STEALTH]}exec(e){const t=e.args,n=this.context.state.getPlayerById(t.id);n&&(n.stealthed=t.state,n.energy=t.energy,n.energyRegen=t.energyRegen)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0);t.PlayerSwitchTypeHandler=class{constructor(e){this.context=e,this.handles=[s.Events.PLAYER_SWITCH_TYPE]}exec(e){const t=e.args,n=this.context.state.getPlayerById(t.id);n&&(n.type=t.type)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0),i=n(6),r=n(2),o=n(11),a=n(12);t.PlayerUpdateHandler=class{constructor(e){this.context=e,this.handles=[s.Events.PLAYER_UPDATE]}exec(e){const t=e.args,n=this.context.state.getPlayerById(t.id);if(!n)return;n.isVisibleOnScreen=!0;const s=i.Decoder.keystateToPlayerMovements(t.keystate);n.setMovements(s);const c=i.Decoder.upgradesToPowerUps(t.upgrades);n.powerUps=c||new o.PowerUps,n.upgrades=n.upgrades||new a.Upgrades,n.upgrades.speed=n.powerUps.speed||0,n.pos=new r.Pos(t.posX,t.posY),n.rot=t.rot,n.speed=new r.Pos(t.speedX,t.speedY)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0),i=n(12);t.PlayerUpgradeAppliedHandler=class{constructor(e){this.context=e,this.handles=[s.Events.PLAYER_UPGRADE_APPLIED]}exec(e){const t=this.context.state.getMe();if(!t)return;t.upgrades||(t.upgrades=new i.Upgrades);const n=e.args,s=t.upgrades;s.available=n.upgrades,s.defense=n.defense,s.energy=n.energy,s.missile=n.missile,s.speed=n.speed}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0);t.ScoreBoardHandler=class{constructor(e){this.context=e,this.handles=[s.Events.SCORE_BOARD]}exec(e){const t=e.args;let n=0;for(const e of t){n++;const t=this.context.state.getPlayerById(e.id);t&&(t.score=e.score,t.level=e.level,t.ranking=n)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0);t.ScoreDetailedHandler=class{constructor(e){this.context=e,this.handles=[s.Events.SCORE_DETAILED]}exec(e){const t=e.args;if(t.ffaScores)for(const e of t.ffaScores){const t=this.context.state.getPlayerById(e.id);t&&(t.score=e.score,t.level=e.level,t.kills=e.kills,t.deaths=e.deaths,t.damage=e.damage,t.ping=e.ping)}else if(t.ctfScores)for(const e of t.ctfScores){const t=this.context.state.getPlayerById(e.id);t&&(t.score=e.score,t.level=e.level,t.kills=e.kills,t.deaths=e.deaths,t.damage=e.damage,t.ping=e.ping,t.captures=e.captures)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0),i=n(12);t.ScoreUpdateHandler=class{constructor(e){this.context=e,this.handles=[s.Events.SCORE_UPDATE]}exec(e){const t=e.args,n=this.context.state.getPlayerById(t.id);n&&(n.score=t.score,n.kills=t.totalkills,n.deaths=t.totaldeaths,n.upgrades||(n.upgrades=new i.Upgrades),n.upgrades.available=t.upgrades)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0);t.ServerAnnouncementHandler=class{constructor(e){this.context=e,this.handles=[s.Events.SERVER_ANNOUNCEMENT]}exec(e){const t=e.args;this.context.logger.info("Server message: "+t.text)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0);t.ServerCommandReplyHandler=class{constructor(e){this.context=e,this.handles=[s.Events.SERVER_COMMAND_REPLY,s.Events.CHAT_NOT_POSSIBLE_BC_MUTED]}exec(e){if(e.type===s.Events.CHAT_NOT_POSSIBLE_BC_MUTED)this.context.eventQueue.pub(s.Events.MESSAGE_TO_PLAYER,{message:"You have been muted."});else{const t=e.args;"Don't spam!"===t.text&&this.context.eventQueue.pub(s.Events.SPAM_WARING_RECEIVED,{}),this.context.eventQueue.pub(s.Events.MESSAGE_TO_PLAYER,{message:t.text})}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),i=n(0);t.ServerCustomHandler=class{constructor(e){this.context=e,this.handles=[i.Events.SERVER_CUSTOM]}exec(e){const t=e.args;if(t.type===s.SERVER_CUSTOM_TYPES.CTF){const e=JSON.parse(t.data);this.context.eventQueue.pub(i.Events.CTF_GAME_OVER,e)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0);t.ServerErrorHandler=class{constructor(e){this.context=e,this.handles=[s.Events.SERVER_ERROR]}exec(e){const t=e.args;this.context.logger.error("Server reports error: "+t.error)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0);t.TeamsHandler=class{constructor(e){this.context=e,this.handles=[s.Events.TEAMS]}exec(e){const t=e.args;for(const e of t.players){e.id===this.context.state.id&&(this.context.state.team=e.team);const t=this.context.state.getPlayerById(e.id);t&&(t.team=e.team)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Settings=class{constructor(){this.websocketUrl="wss://eu.airmash.online/ffa2",this.playerName="Unknown",this.horizonX=2e3,this.horizonY=2e3,this.flag="jolly",this.logLevel="info",this.isDevelopment=!1,this.zoom=.8,this.useBitmaps=!0,this.shouldShowDebugInfo=!1}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),i=n(90),r=[s.MOB_TYPES.PREDATOR_MISSILE,s.MOB_TYPES.GOLIATH_MISSILE,s.MOB_TYPES.COPTER_MISSILE,s.MOB_TYPES.TORNADO_MISSILE,s.MOB_TYPES.TORNADO_SMALL_MISSILE,s.MOB_TYPES.PROWLER_MISSILE],o=[s.MOB_TYPES.UPGRADE,s.MOB_TYPES.SHIELD,s.MOB_TYPES.INFERNO];t.State=class{constructor(){this.skippedFrames=0,this.players={},this.mobs={},this.teams={},this.explosions=[],this.farts=[],this.kills=[],this.rocketTrailClouds=[],this.teams[s.CTF_TEAMS.BLUE]=new i.CtfTeam,this.teams[s.CTF_TEAMS.RED]=new i.CtfTeam}addPlayer(e){this.players[Number(e.id)]=e}removePlayer(e){delete this.players[Number(e)]}getMe(){return this.getPlayerById(this.id)}getPlayerById(e){return this.players[Number(e)]}getPlayerByName(e){return this.getPlayers().find(t=>t.name===e)}getPlayers(){return Object.values(this.players)}getPlayerName(e){if(!e)return"(empty)";const t=this.getPlayerById(e);return t?t.name:e+"_(left)"}addMob(e){this.mobs[Number(e.id)]=e}removeMob(e){delete this.mobs[Number(e)]}getMobById(e){return this.mobs[Number(e)]}getMissiles(){return Object.values(this.mobs).filter(e=>-1!==r.indexOf(e.mobType))}getUpcrates(){return Object.values(this.mobs).filter(e=>-1!==o.indexOf(e.mobType))}getCtfTeam(e){return this.teams[e]}getOtherCtfTeam(e){const t=e===s.CTF_TEAMS.BLUE?s.CTF_TEAMS.RED:s.CTF_TEAMS.BLUE;return this.teams[t]}purgeAfterPanic(){this.explosions.splice(0),this.kills.splice(0),this.rocketTrailClouds.splice(0)}addExplosion(e){this.explosions.push(e)}getActiveExplosions(){const e=this.explosions.filter(e=>!e.isFinished);return this.explosions=e,e}addKill(e){this.kills.push(e)}getActiveKills(){const e=this.kills.filter(e=>!e.isFinished);return this.kills=e,e}addFart(e){this.farts.push(e)}getActiveFarts(){const e=this.farts.filter(e=>!e.isFinished);return this.farts=e,e}addRocketTrailCloud(e){this.rocketTrailClouds.push(e)}getActiveRocketTrailClouds(){const e=this.rocketTrailClouds.filter(e=>!e.isFinished);return this.rocketTrailClouds=e,e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CtfTeam=class{}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TimerManager=class{constructor(){this.timeouts=[],this.intervals=[]}setTimeout(e,t){const n=setTimeout(()=>{this.onTimeoutFinished(n),e()},t);return this.timeouts.push(n),n}setInterval(e,t){const n=setInterval(()=>e(),t);return this.intervals.push(n),n}clearTimeout(e){clearTimeout(e),this.onTimeoutFinished(e)}clearInterval(e){clearInterval(e),this.onIntervalCleared(e)}clearAll(){for(const e of this.timeouts)clearTimeout(e);for(const e of this.intervals)clearInterval(e);this.timeouts=[],this.intervals=[]}onTimeoutFinished(e){this.timeouts=this.timeouts.filter(t=>t!==e)}onIntervalCleared(e){this.intervals=this.intervals.filter(t=>t!==e)}}},function(e,t,n){"use strict";var s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(10),o=s(n(22)),a=i(n(7)),c=i(n(8)),l=s(n(23)),u=n(0),d=n(3);t.Connection=class{constructor(e){this.context=e,this.keySequenceNumber=0,this.lagMs=0,this.lastReceivedMessages={},this.lastReceivedMessagesGcStopwatch=new d.StopWatch}async init(){this.client=await this.initWebSocket(!0),await this.onInitPrimary()}sendKey(e,t){this.keySequenceNumber++;const n={c:a.default.KEY,key:e,seq:this.keySequenceNumber,state:t};this.send(n),this.backupClientIsConnected&&this.send(n,!0)}sendCommand(e,t){const n={c:a.default.COMMAND,com:e,data:t};this.send(n)}voteMute(e){const t={c:a.default.VOTEMUTE,id:e};this.send(t)}fetchDetailedScore(){this.send({c:a.default.SCOREDETAILED})}sendChat(e,t,n=null){let s;switch(e){case r.CHAT_TYPE.CHAT:s=a.default.CHAT;break;case r.CHAT_TYPE.SAY:s=a.default.SAY;break;case r.CHAT_TYPE.TEAM:s=a.default.TEAMCHAT;break;case r.CHAT_TYPE.WHISPER:s=a.default.WHISPER}const i={c:s,id:n,text:t};this.send(i)}sendScreenSize(e,t){this.send({c:a.default.HORIZON,horizonX:Math.ceil(e/2),horizonY:Math.ceil(t/2)})}getLagMs(){return this.lagMs}onInitPrimary(){return new Promise((e,t)=>{this.loginPromiseResolver=e,this.context.logger.debug("Primary socket connecting");let n="none";this.context.auth&&(n=JSON.stringify({token:this.context.auth.tokens.game})),this.send({c:a.default.LOGIN,flag:this.context.settings.flag,horizonX:Math.ceil(this.context.settings.horizonX),horizonY:Math.ceil(this.context.settings.horizonY),name:this.context.settings.playerName,protocol:5,session:n})})}async afterLogin(e){this.ackInterval&&this.context.tm.clearInterval(this.ackInterval),this.ackInterval=this.context.tm.setInterval(()=>{this.send({c:a.default.ACK},this.ackToBackup),this.ackToBackup=!this.ackToBackup},1e3);const t=e.token;this.backupClientIsConnected&&(this.backupClient.close(),this.backupClientIsConnected=!1),this.backupClient=await this.initWebSocket(!1),this.onInitBackup(t),this.context.eventQueue.pub(u.Events.SERVER_MESSAGE,e),this.loginPromiseResolver()}resetCalibration(e){this.serverClockCalibrationTimeResetStopwatch=new d.StopWatch,this.serverClockCalibrationTime=e,this.lagMs=0}onInitBackup(e){this.context.logger.debug("Backup socket connecting"),this.backupClientIsConnected=!0,this.send({c:a.default.BACKUP,token:e},!0)}initWebSocket(e){return new Promise((t,n)=>{const s=this.context.webSocketFactory.create(this.context.settings.websocketUrl);return s.binaryType="arraybuffer",s.onopen=()=>t(s),s.onmessage=t=>{try{const n=l.unmarshalServerMessage(t.data);if(!n)return void this.context.logger.warn("no result",t);if(this.shouldDropMessage(n))return;if(this.calibrateTime(n),n.c===c.default.PING){const t=n;this.send({c:a.default.PONG,num:t.num},!e)}else if(n.c===c.default.BACKUP)this.context.logger.debug("backup client connected"),this.backupClientIsConnected=!0;else if(n.c===c.default.LOGIN)this.afterLogin(n);else if(n.c===c.default.PING_RESULT){const e=n;this.context.state.ping=e.ping,this.context.state.numPlayers=e.playersgame,this.context.state.numPlayersTotal=e.playerstotal}else this.context.eventQueue.pub(u.Events.SERVER_MESSAGE,n)}catch(e){this.context.logger.error("Error receiving message",e)}},s.onerror=e=>{this.context.eventQueue.pub(u.Events.CONNECTION_ERROR,e)},s.onclose=()=>{this.context.eventQueue.pub(u.Events.CONNECTION_CLOSE,{isPrimary:e})},s})}calibrateTime(e){if(!e.clock)return;const t=e.clock/100;if(!this.serverClockCalibrationTimeResetStopwatch||this.serverClockCalibrationTimeResetStopwatch.elapsedMinutes>5)return void this.resetCalibration(t);if(t<this.lastServerClock)return;this.lastServerClock=t;const n=t-this.serverClockCalibrationTime,s=this.serverClockCalibrationTimeResetStopwatch.elapsedMs-n;this.lagMs=s}shouldDropMessage(e){if(!e.id||!e.clock||e.id!==this.context.state.id)return!1;if(this.lastReceivedMessagesGcStopwatch.elapsedSeconds>5)for(const e of Object.keys(this.lastReceivedMessages))this.lastReceivedMessages[e].elapsedSeconds>1&&delete this.lastReceivedMessages[e];const t=`${e.c}_${e.clock}`;return!!this.lastReceivedMessages[t]||(this.lastReceivedMessages[t]=new d.StopWatch,!1)}send(e,t=!1){const n=o.marshalClientMessage(e);t?this.backupClientIsConnected&&this.backupClient.send(n):this.client&&this.client.send(n)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(94);t.EventQueue=class{constructor(){this.queue=[]}pub(e,t){const n=new s.EventMessage;n.type=e,n.args=t,this.queue.push(n)}dequeue(){return this.queue.shift()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.EventMessage=class{}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1);t.BrowserVisibilityHandler=class{constructor(e){this.context=e}clearKeys(){const e=this.context.state.getMe();e&&(e.keystate.DOWN&&this.context.connection.sendKey(s.KEY_CODES.DOWN,!1),e.keystate.UP&&this.context.connection.sendKey(s.KEY_CODES.UP,!1),e.keystate.LEFT&&this.context.connection.sendKey(s.KEY_CODES.LEFT,!1),e.keystate.RIGHT&&this.context.connection.sendKey(s.KEY_CODES.RIGHT,!1),this.context.connection.sendKey(s.KEY_CODES.SPECIAL,!1),this.context.connection.sendKey(s.KEY_CODES.FIRE,!1))}}},function(e,t,n){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(n(26)),r=n(1),o=n(0);t.FlagCookieHandler=class{constructor(e){this.context=e,this.handles=[o.Events.PLAYER_CHANGE_FLAG]}exec(e){const t=e.args;if(t.id!==this.context.state.id)return;const n=r.FLAGS_CODE_TO_ISO[""+t.flag];i.default.set("flag",n,{expires:365})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0);t.ChatRenderHandler=class{constructor(e){this.context=e,this.handles=[s.Events.CHAT_RECEIVED,s.Events.MESSAGE_TO_PLAYER]}exec(e){if(e.type===s.Events.MESSAGE_TO_PLAYER){const t=e.args;this.context.renderer.addMessageToPlayer(t.message)}else{const t=e.args,n=this.context.state.getPlayerName(t.playerId);this.context.renderer.addChat(t.playerId,n,t.chatType,t.chatMessage,t.to)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),i=n(0);t.CtfGameOverRenderHandler=class{constructor(e){this.context=e,this.handles=[i.Events.CTF_GAME_OVER]}exec(e){const t=e.args;this.context.renderer.showServerMessage(s.SERVER_MESSAGE_TYPES.INFO,5e3,`Game over!<br/>The ${t.w===s.CTF_TEAMS.BLUE?"blue":"red"} team has won!`)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0);t.EachSecondRenderHandler=class{constructor(e){this.context=e,this.handles=[s.Events.EACH_SECOND]}exec(e){this.context.isBrowserVisible&&(this.context.renderer.renderMinimap(),this.context.renderer.renderPlayerList(),this.context.renderer.showPing(),this.context.renderer.showStats(),this.context.renderer.hideServerMessageAfterTimeout(),this.context.connection.fetchDetailedScore())}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0),i=n(101);t.ExplosionVisualizationHandler=class{constructor(e){this.context=e,this.handles=[s.Events.EXPLOSION]}exec(e){if(!this.context.isBrowserVisible)return;const t=e.args,n=new i.ExplosionVisual;n.pos=t.pos,n.type=t.type,this.context.state.addExplosion(n)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),i=500,r=60/i;t.ExplosionVisual=class{constructor(){this.stopwatch=new s.StopWatch}get isFinished(){return this.stopwatch.elapsedMs>i}get size(){return this.stopwatch.elapsedMs*r}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0);t.GameRenderHandler=class{constructor(e){this.context=e,this.handles=[s.Events.TICK]}exec(e){if(!this.context.isBrowserVisible)return;const t=1===e.args.frame;window.requestAnimationFrame(()=>this.context.renderer.renderGame(t))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0),i=n(104);t.GoliFartVisualizationHandler=class{constructor(e){this.context=e,this.handles=[s.Events.PLAYER_REPEL]}exec(e){const t=e.args,n=new i.GoliFartVisual;n.player=this.context.state.getPlayerById(t.id),this.context.state.addFart(n)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),i=150,r=120,o=(140-r)/i;t.GoliFartVisual=class{constructor(){this.stopwatch=new s.StopWatch}get isFinished(){return this.stopwatch.elapsedMs>i}get size(){return r+this.stopwatch.elapsedMs*o}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0),i=n(106),r=n(2);t.KillVisualizationHandler=class{constructor(e){this.context=e,this.handles=[s.Events.PLAYER_KILLED]}exec(e){const t=e.args,n=new i.KillVisual;n.pos=new r.Pos(t.posX,t.posY),this.context.state.addKill(n)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),i=500,r=60/i;t.KillVisual=class{constructor(){this.stopwatch=new s.StopWatch}get isFinished(){return this.stopwatch.elapsedMs>i}get size(){return this.stopwatch.elapsedMs*r}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(13),i=n(0),r=n(108),o=n(109),a=n(2);t.MissileChemtrailHandler=class{constructor(e){this.context=e,this.handles=[i.Events.TICK]}exec(e){if(!this.context.isBrowserVisible)return;const t=e.args;for(const e of this.context.state.getMissiles()){const n=o.CloudVisualSpec.getFor(e.mobType);if(t.frame%n.spawnFreq==0){const i=new r.CloudVisual(n);i.pos=new a.Pos(e.pos);const o=s.PROJECTILES_SPECS[e.mobType].maxSpeed,c=e.speed.y/o*n.distribBandwidth,l=e.speed.x/o*n.distribBandwidth;i.pos.x+=t.frame%(2*n.spawnFreq)==0?-c:c,i.pos.y+=t.frame%(2*n.spawnFreq)==0?l:-l,this.context.state.addRocketTrailCloud(i)}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3);t.CloudVisual=class{constructor(e){this.spec=e,this.stopwatch=new s.StopWatch}get isFinished(){return this.stopwatch.elapsedMs>this.spec.cloudTimeoutMs}get opacity(){return this.stopwatch.elapsedMs<this.spec.cloudGrowMs?this.stopwatch.elapsedMs*this.spec.opacityGrowStep:Math.max(0,this.spec.opacityMax-this.stopwatch.elapsedMs*this.spec.opacityShrinkStep)}get size(){return this.stopwatch.elapsedMs<this.spec.cloudGrowMs?this.spec.sizeStart+this.stopwatch.elapsedMs*this.spec.sizeGrowStep:Math.max(0,this.spec.sizeMax-this.spec.sizeShrinkStep*this.stopwatch.elapsedMs)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(13),i={};class r{constructor(e){this.opacityMax=.22;const t=1+(s.PROJECTILES_SPECS[e].damage-.3)/1.8;this.cloudTimeoutMs=800*t,this.cloudGrowMs=200*t,this.opacityGrowStep=this.opacityMax/this.cloudGrowMs,this.opacityShrinkStep=this.opacityMax/(this.cloudTimeoutMs-this.cloudGrowMs),this.sizeStart=5*t,this.sizeMax=15*t,this.sizeShrinkStep=this.sizeMax/(this.cloudTimeoutMs-this.cloudGrowMs),this.sizeGrowStep=(this.sizeMax-this.sizeStart)/this.cloudGrowMs,this.spawnFreq=Math.ceil(2*t*1.2),this.distribBandwidth=Math.ceil(3*t)}static getFor(e){return i[e]||(i[e]=new r(e)),i[e]}}t.CloudVisualSpec=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(10),i=n(1),r=n(0);t.ServerAnnouncementRenderHandler=class{constructor(e){this.context=e,this.handles=[r.Events.SERVER_ANNOUNCEMENT,r.Events.SERVER_ERROR]}exec(e){let t;if(e.type===r.Events.SERVER_ANNOUNCEMENT)t=e.args;else{const n=e.args;switch(t={type:i.SERVER_MESSAGE_TYPES.ALERT,duration:4e3},n.error){case i.SERVER_ERRORS.ACCOUNT_BANNED:t.text="Account is banned";break;case i.SERVER_ERRORS.AFK_DISCONNECT:t.text="Disconnected, away too long.";break;case i.SERVER_ERRORS.ALREADY_LOGGED_IN:t.text="You are already logged in.";break;case i.SERVER_ERRORS.CHAT_SPAMMING:t.text="Don't spam!";break;case i.SERVER_ERRORS.FLAG_CHANGE_TOO_FAST:t.text="Wait before changing your flag.";break;case i.SERVER_ERRORS.FORBIDDEN_TO_CHANGE_PLANE_IN_BTR:t.text="Can't change aircraft in BTR.";break;case i.SERVER_ERRORS.GLOBAL_BAN:t.text="You have been banned.";break;case i.SERVER_ERRORS.INCORRECT_PROTOCOL:t.text="Your client uses an incorrect protocol version.";break;case i.SERVER_ERRORS.INVALID_LOGIN_DATA:t.text="Invalid login data.";break;case i.SERVER_ERRORS.NOT_ENOUGH_UPGRADES:t.text="Not enough upgrades";break;case i.SERVER_ERRORS.PACKET_FLOODING_BAN:t.text="Banned for packet flooding.";break;case i.SERVER_ERRORS.PACKET_FLOODING_DISCONNECT:t.text="Disconnected for packet flooding.";break;case i.SERVER_ERRORS.PLAYER_KICKED:t.text="You have been kicked.";break;case i.SERVER_ERRORS.REQUIRED_INACTIVITY_AND_HEALTH_TO_RESPAWN:t.text="Two seconds of inactivity and full health required to respawn.";break;case i.SERVER_ERRORS.REQUIRED_INACTIVITY_AND_HEALTH_TO_SPECTATE:t.text="Tow seconds of inactivity and full health required to spectate.";break;case i.SERVER_ERRORS.UNKNOWN_COMMAND:t.text="Unknown command";break;case i.SERVER_ERRORS.UNKNOWN_ERROR:t.text="Unknown error"}}this.context.renderer.showServerMessage(t.type,t.duration,t.text);const n=document.createElement("div");n.innerHTML=t.text,t.text=n.innerText,this.context.renderer.addChat(null,"Server",s.CHAT_TYPE.CHAT,t.text,null)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),i=n(0),r=1e3;t.ShakeAndShowMessageOnKillHandler=class{constructor(e){this.context=e,this.handles=[i.Events.PLAYER_KILLED]}exec(e){const t=e.args;if(!t.killer)return;let n="";t.killer===this.context.state.id?n=`You have destroyed ${this.context.state.getPlayerName(t.id)}`:t.id===this.context.state.id&&(n=`Destroyed by ${this.context.state.getPlayerName(t.killer)}`,this.context.renderer.renderKill()),n&&this.context.renderer.showServerMessage(s.SERVER_MESSAGE_TYPES.INFO,r,n)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0);t.ShakeOnHitHandler=class{constructor(e){this.context=e,this.handles=[s.Events.PLAYER_HIT]}exec(e){e.args.players.find(e=>e.id===this.context.state.id)&&this.context.renderer.renderHit()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3);t.BrowserInitialization=class{constructor(e){this.context=e}detectVisibilityChange(){let e,t;void 0!==document.hidden?(e="hidden",t="visibilitychange"):void 0!==document.msHidden?(e="msHidden",t="msvisibilitychange"):void 0!==document.webkitHidden&&(e="webkitHidden",t="webkitvisibilitychange");document.addEventListener(t,()=>{const t=!document[e];this.context.setBrowserVisibility(t)},!1),this.context.isBrowserVisible=!document[e]}throttleZoom(){const e=new s.StopWatch;document.getElementById("root").addEventListener("wheel",t=>{if(t.ctrlKey){if(e.elapsedSeconds<1)return void t.preventDefault();e.start()}})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BrowserLogger=class{debug(e,...t){window.debug&&this.log(e,...t)}info(e,...t){this.log(e,...t)}warn(e,...t){this.log(e,...t)}error(e,...t){this.log(e,...t)}fatal(e,...t){this.log(e,...t)}log(e,...t){console.log(e,...t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BrowserWebSocketFactory=class{create(e){return new WebSocket(e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(10),i=n(1),r=n(18),o=n(3),a=n(117),c=n(118),l=n(119),u=n(120),d=n(121),E=n(122),h=n(123),A=n(124),T=n(125),p=n(126),_=n(127),g=n(128);t.Renderer=class{constructor(e){this.context=e,this.ignoredPlayers=[],this.getUiElements(),this.periodicLogger=new r.PeriodicLogger(e),this.clip=new a.ClippedView(e),this.backgroundRenderer=new c.BackgroundRenderer(this.clip,e),this.wallsRenderer=new g.WallsRenderer(this.clip,e),this.flagRenderer=new d.FlagRenderer(e,this.clip),this.upcratesRenderer=new _.UpcratesRenderer(e,this.clip),this.playersRenderer=new T.PlayersRenderer(e,this.clip),this.missilesRenderer=new h.MissilesRenderer(e,this.clip),this.explosionsRenderer=new u.EffectsRenderer(e,this.clip),this.minimapRenderer=new E.MinimapRenderer(e),this.playerListRenderer=new A.PlayerListRenderer(e),this.statsRenderer=new p.StatsRenderer(e),this.debugInfoRenderer=new l.DebugInfoRenderer(e)}addMessageToPlayer(e){this.chatBox.innerHTML+=`<div class="chat chat-warning">${e}</div>`,this.chatBox.scrollTop=this.chatBox.scrollHeight}addChat(e,t,n,i,r){if(-1===this.ignoredPlayers.indexOf(e))if(t=t.replace(/</g,"&lt;").replace(/>/g,"&gt;"),i=i.replace(/</g,"&lt;").replace(/>/g,"&gt;"),n===s.CHAT_TYPE.SAY)this.playersRenderer.addSay(e,i);else{let o="",a="";if(n===s.CHAT_TYPE.TEAM)o="chat-team",a=" =&gt; team";else if(n===s.CHAT_TYPE.WHISPER)if(o="chat-whisper",e===this.context.state.id){a=" =&gt; "+this.context.state.getPlayerName(r)}else a=" =&gt; me";const c=encodeURI(t);this.chatBox.innerHTML+=`<div class="chat ${o}"><strong class="player-name" `+`data-name="${c}" data-id="${e}">`+`${t}${a}</strong>: ${i}</div>`,this.chatBox.scrollTop=this.chatBox.scrollHeight}}showServerMessage(e,t,n){this.serverMessageStopwatch=new o.StopWatch(t),this.serverMessage.innerHTML=n}hideServerMessageAfterTimeout(){this.serverMessageStopwatch&&this.serverMessageStopwatch.hasTimedOut&&(this.serverMessage.innerHTML="",this.serverMessageStopwatch=null)}showStats(){this.statsRenderer.render()}showPing(){this.pingElement.innerText=this.context.state.ping+" ms"}highlightPlayerOnMinimap(e){this.minimapRenderer.highlight(e)}ignorePlayer(e){-1===this.ignoredPlayers.indexOf(e)&&e!==this.context.state.id&&this.ignoredPlayers.push(e)}unignorePlayer(e){this.ignoredPlayers=this.ignoredPlayers.filter(t=>t!==e)}renderMinimap(){this.minimapRenderer.render()}renderPlayerList(){this.playerListRenderer.render()}renderHit(){this.canvas.className="shake-hit",this.stopShaking()}renderKill(){this.canvas.className="shake-kill",this.stopShaking()}renderGame(e){if(e&&this.context.state.purgeAfterPanic(),!this.context.state.getMe())return;const t=this.canvasContext;this.clip.setClip(this.canvas),this.backgroundRenderer.renderBackground(t),this.wallsRenderer.renderWalls(t),this.upcratesRenderer.renderUpcrates(t),this.playersRenderer.renderPlayers(t),this.missilesRenderer.renderMissiles(t),this.explosionsRenderer.renderExplosions(t),this.context.gameType===i.GAME_TYPES.CTF&&this.flagRenderer.render(t),this.debugInfoRenderer.render()}getUiElements(){this.canvas=document.getElementById("canvas"),this.canvasContext=this.canvas.getContext("2d"),this.chatBox=document.getElementById("chat"),this.serverMessage=document.getElementById("server-message"),this.pingElement=document.getElementById("stats-ping")}stopShaking(){this.shakeTimeout&&this.context.tm.clearTimeout(this.shakeTimeout),this.shakeTimeout=this.context.tm.setTimeout(()=>this.canvas.className="",1e3)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(2),i="-20px",r=40;t.ClippedView=class{constructor(e){this.context=e}setClip(e){e.width=window.innerWidth+r,e.height=window.innerHeight+r,e.style.left=i,e.style.top=i;const t=this.context.settings.zoom;if(this.lastWidth!==e.width||this.lastHeight!==e.height){const n=e.width/t,s=e.height/t;this.context.connection.sendScreenSize(n,s),this.lastWidth=e.width,this.lastHeight=e.height,this.context.settings.horizonX=n/2,this.context.settings.horizonY=s/2}const n=this.context.state.getMe().pos,o=e.width/t/2,a=e.height/t/2;this.clipRectangle=[new s.Pos(n.x-o,n.y-a),new s.Pos(n.x+o,n.y+a)],this.zoom=t}isVisible(e){return this.clipRectangle[0].x<e.x&&this.clipRectangle[1].x>e.x&&this.clipRectangle[0].y<e.y&&this.clipRectangle[1].y>e.y}translate(e){return new s.Pos((e.x-this.clipRectangle[0].x)*this.zoom,(e.y-this.clipRectangle[0].y)*this.zoom)}scale(e){return e*this.zoom}getClipRectangle(){return[new s.Pos(this.clipRectangle[0]),new s.Pos(this.clipRectangle[1])]}getClipSize(){return new s.Pos(this.lastWidth,this.lastHeight)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),i=n(2),r=100,o=.25;t.BackgroundRenderer=class{constructor(e,t){this.clip=e,this.context=t,this.backgroundImage=document.getElementById("map")}renderBackground(e){const t=this.clip.getClipRectangle();if(this.context.settings.useBitmaps){const n=new i.Pos(t[1].x-t[0].x,t[1].y-t[0].y);e.drawImage(this.backgroundImage,(s.MAP_SIZE.WIDTH/2+t[0].x)*o,(s.MAP_SIZE.HEIGHT/2+t[0].y)*o,n.x*o,n.y*o,0,0,this.clip.scale(n.x),this.clip.scale(n.y))}e.fillStyle=constants.BACKGROUND_GRID_COLOR;const n=this.clip.scale(r);for(let s=t[0].y-t[0].y%n;s<t[1].y;s+=n)for(let r=t[0].x-t[0].x%n;r<t[1].x;r+=n){const t=this.clip.translate(new i.Pos(r,s));e.fillRect(t.x,t.y,1,1)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DebugInfoRenderer=class{constructor(e){this.context=e,this.lagInMsElement=document.getElementById("lag-in-ms"),this.skippedFramesElement=document.getElementById("skipped-frames")}render(){if(!this.context.settings.shouldShowDebugInfo)return;const e=this.context.connection.getLagMs();this.lagInMsElement.innerText=e.toLocaleString("en-us",{maximumFractionDigits:2,minimumFractionDigits:2}),this.skippedFramesElement.innerText=this.context.state.skippedFrames.toString()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.EffectsRenderer=class{constructor(e,t){this.context=e,this.clip=t}renderExplosions(e){e.fillStyle=constants.EFFECTS_EXPLOSION_COLOR;for(const t of this.context.state.getActiveExplosions()){const n=t.pos;if(n&&this.clip.isVisible(n)){const s=this.clip.translate(n);e.beginPath(),e.arc(s.x,s.y,this.clip.scale(t.size),0,2*Math.PI),e.fill()}}e.fillStyle=constants.EFFECTS_KILL_COLOR;for(const t of this.context.state.getActiveKills()){const n=t.pos;if(n&&this.clip.isVisible(n)){const s=this.clip.translate(n);e.beginPath(),e.arc(s.x,s.y,this.clip.scale(t.size),0,2*Math.PI),e.fill()}}e.fillStyle=constants.EFFECTS_FART_COLOR;for(const t of this.context.state.getActiveFarts()){if(!t.player)continue;const n=t.player.pos;if(n&&this.clip.isVisible(n)){const s=this.clip.translate(n);e.beginPath(),e.arc(s.x,s.y,this.clip.scale(t.size),0,2*Math.PI),e.fill()}}for(const t of this.context.state.getActiveRocketTrailClouds()){const n=t.pos;if(n&&this.clip.isVisible(n)){const s=t.opacity;if(0===s)continue;e.fillStyle=`rgba(${constants.EFFECTS_MISSILE_BASE_COLOR}, ${s})`;const i=this.clip.translate(n);e.beginPath();const r=this.clip.scale(t.size);e.arc(i.x,i.y,r,0,2*Math.PI),e.fill()}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(19),i=n(1),r=n(2),o=120,a=o/2,c=8;t.FlagRenderer=class{constructor(e,t){this.context=e,this.clip=t,this.blueFlag=document.getElementById("blue-flag"),this.redFlag=document.getElementById("red-flag")}render(e){const t=this.context.state.getCtfTeam(i.CTF_TEAMS.RED),n=this.context.state.getCtfTeam(i.CTF_TEAMS.BLUE);this.renderFlag(t,this.redFlag,e),this.renderFlag(n,this.blueFlag,e),this.renderBase(e,s.FLAG_DEFAULT_POSITION.blue,constants.CTF_BLUE_TEAM_COLOR),this.renderBase(e,s.FLAG_DEFAULT_POSITION.red,constants.CTF_RED_TEAM_COLOR)}renderBase(e,t,n){const s=new r.Pos(t.x-a,t.y-a),i=new r.Pos(t.x+a,t.y+a);if(!this.clip.isVisible(s)&&!this.clip.isVisible(i))return;const l=this.clip.translate(t),u=this.clip.scale(o),d=u/2;e.strokeStyle=n,e.lineWidth=this.clip.scale(c),e.lineJoin="round",e.strokeRect(l.x-d,l.y-d,u,u)}renderFlag(e,t,n){let s,r=e.flagPos;if(!r)return;let o=!1;if(e.flagState===i.CTF_FLAG_STATE.DYNAMIC){const t=this.context.state.getPlayerById(e.flagTakenById);t&&(r=t.mostReliablePos,s=t.isVisibleOnScreen&&this.clip.isVisible(r),o=!0)}else s=this.clip.isVisible(r);if(s){const e=this.clip.translate(r),s=this.clip.scale(t.width),i=this.clip.scale(t.height);n.drawImage(t,0,0,t.width,t.height,e.x-s/2+(o?s/2:0),e.y-i/2-(o?i/2:0),s,i)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(19),i=n(1),r=n(2),o=3,a=15,c=10,l=i.MAP_SIZE.WIDTH/2,u=i.MAP_SIZE.HEIGHT/2,d=4,E=10,h=2*o;t.MinimapRenderer=class{constructor(e){this.context=e,this.canvas=document.getElementById("minimap-canvas"),this.canvasContext=this.canvas.getContext("2d"),this.blueFlag=document.getElementById("blue-flag"),this.redFlag=document.getElementById("red-flag")}highlight(e){this.playerToHighlight=e}render(){this.canvasContext.clearRect(0,0,this.canvas.width,this.canvas.height);const e=this.canvas.width/i.MAP_SIZE.WIDTH,t=this.canvas.height/i.MAP_SIZE.HEIGHT,n=this.context.state.id;for(const s of this.context.state.getPlayers()){if(s.status===i.PLAYER_STATUS.INACTIVE)continue;const d=new r.Pos((s.mostReliablePos.x+l)*e,(s.mostReliablePos.y+u)*t);if(s.id===n)this.canvasContext.strokeStyle=constants.MINIMAP_HIGHLIGHT_COLOR,this.canvasContext.strokeRect(d.x-a/2,d.y-c/2,a,c);else{let e=constants.MINIMAP_FFA_PLAYER_COLOR;switch(s.team===i.CTF_TEAMS.BLUE?e=constants.CTF_BLUE_TEAM_COLOR:s.team===i.CTF_TEAMS.RED&&(e=constants.CTF_RED_TEAM_COLOR),s.ranking){case 1:e=constants.MINIMAP_PLAYER_1_COLOR;break;case 2:e=constants.MINIMAP_PLAYER_2_COLOR;break;case 3:e=constants.MINIMAP_PLAYER_3_COLOR}this.canvasContext.fillStyle=e,this.canvasContext.beginPath(),this.canvasContext.arc(d.x,d.y,o,0,2*Math.PI),this.canvasContext.fill(),s.id===this.playerToHighlight&&(this.canvasContext.strokeStyle=constants.MINIMAP_HIGHLIGHT_COLOR,this.canvasContext.beginPath(),this.canvasContext.arc(d.x,d.y,h,0,2*Math.PI),this.canvasContext.stroke())}}if(this.context.gameType===i.GAME_TYPES.CTF){const e=this.context.state.getCtfTeam(i.CTF_TEAMS.RED),t=this.context.state.getCtfTeam(i.CTF_TEAMS.BLUE);this.renderFlag(e,this.redFlag,this.canvasContext,s.FLAG_DEFAULT_POSITION.red,constants.CTF_RED_TEAM_COLOR),this.renderFlag(t,this.blueFlag,this.canvasContext,s.FLAG_DEFAULT_POSITION.blue,constants.CTF_BLUE_TEAM_COLOR)}}renderFlag(e,t,n,s,o){let a=e.flagPos;if(!a)return;if(e.flagState===i.CTF_FLAG_STATE.DYNAMIC){const t=this.context.state.getPlayerById(e.flagTakenById);t&&(a=t.mostReliablePos)}const c=this.canvas.width/i.MAP_SIZE.WIDTH,h=this.canvas.height/i.MAP_SIZE.HEIGHT,A=new r.Pos((a.x+l)*c,(a.y+u)*h),T=E/t.width*t.height;if(n.drawImage(t,0,0,t.width,t.height,A.x-E/2,A.y-T/2,E,T),!a.equals(s)){const e=new r.Pos((s.x+l)*c,(s.y+u)*h);this.canvasContext.strokeStyle=o,this.canvasContext.strokeRect(e.x-d/2,e.y-d/2,d,d)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(13),i=n(1),r=1;t.MissilesRenderer=class{constructor(e,t){this.context=e,this.clip=t,this.missileImage=document.getElementById("missile")}renderMissiles(e){e.fillStyle=constants.MISSILE_COLOR;for(const t of this.context.state.getMissiles()){const n=t.pos;if(!n)continue;if(!this.clip.isVisible(n))continue;const o=this.clip.translate(n),a=1+(s.PROJECTILES_SPECS[t.mobType].damage-.3)/1.8;if(this.context.settings.useBitmaps){e.translate(o.x,o.y),e.rotate(t.rot);let n=!1;this.context.gameType===i.GAME_TYPES.CTF&&t.team&&t.team===this.context.state.team&&t.ownerId!==this.context.state.id&&(e.globalAlpha=.4,n=!0);const s=this.clip.scale(this.missileImage.width*a*r),c=this.clip.scale(this.missileImage.height*a*r);e.drawImage(this.missileImage,0,0,this.missileImage.width,this.missileImage.height,-s/2,-c/2,s,c),n&&(e.globalAlpha=1),e.rotate(-t.rot),e.translate(-o.x,-o.y)}else e.beginPath(),e.arc(o.x,o.y,this.clip.scale(4*a),0,2*Math.PI),e.fill()}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1);t.PlayerListRenderer=class{constructor(e){this.context=e,this.listElement=document.getElementById("player-list")}render(){const e=this.context.state.getPlayers();e.sort((e,t)=>{return(e.ranking||Number.MAX_SAFE_INTEGER)-(t.ranking||Number.MAX_SAFE_INTEGER)});let t=0;for(const n of e){if(n.status===s.PLAYER_STATUS.INACTIVE&&"Server"===n.name)continue;let e,i,r,o,a,c=this.listElement.rows[t];c?(e=c.cells[0],i=c.cells[1],r=c.cells[2],o=c.cells[3],a=i.firstElementChild):(c=this.listElement.insertRow(),e=c.insertCell(),e.className="playerlist-pos",i=c.insertCell(),i.className="playerlist-flag",r=c.insertCell(),r.className="playerlist-name player-name",o=c.insertCell(),o.className="playerlist-score",a=document.createElement("img"),a.width=24,a.height=24,i.appendChild(a)),c.className=n.status===s.PLAYER_STATUS.INACTIVE?"playerlist-player-inactive":"",n.team===s.CTF_TEAMS.BLUE?c.className+=" playerlist-team-blue":n.team===s.CTF_TEAMS.RED&&(c.className+=" playerlist-team-red");const l=n.ranking||t;e.innerText=`${l}. `;const u=s.FLAGS_CODE_TO_ISO[""+n.flag]||"JOLLY";a.src="flags/"+u+".png",n.level?r.innerText=`${n.name} [${n.level}]`:r.innerText=n.name,r.dataset.name=encodeURI(n.name),r.dataset.id=n.id.toString(),o.innerText=`${n.score}`,t++}for(;this.listElement.rows[t];){this.listElement.rows[t].remove()}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(24),i=n(1),r=n(3),o=n(2),a=75,c=8,l=2*c,u=a-c/2-l/2,d=24,E=10,h=11,A=4,T=20,p=40,_=5,g=80;t.PlayersRenderer=class{constructor(e,t){this.context=e,this.clip=t,this.flagImages={},this.saysToSay=[],this.images={mohawk:document.getElementById("mohawk"),prowler:document.getElementById("prowler"),raptor:document.getElementById("raptor"),spirit:document.getElementById("spirit"),tornado:document.getElementById("tornado")}}addSay(e,t){this.saysToSay.push({playerId:e,msg:t,sw:new r.StopWatch})}renderPlayers(e){const t=this.clip.scale(h);e.font=t+"pt 'Tahoma'";const n=this.clip.scale(d),s=this.clip.scale(A),r=this.clip.scale(E);this.flagImages.JOLLY||this.initFlagImages();for(const o of this.context.state.getPlayers()){if(o.status!==i.PLAYER_STATUS.ALIVE||!o.isVisibleOnScreen)continue;const a=o.mostReliablePos;if(!a||!this.clip.isVisible(a))continue;const c=this.clip.translate(a);e.translate(c.x,c.y),e.rotate(o.rot),this.renderAircraft(o,e),e.rotate(-o.rot),this.renderBars(e,o),this.renderName(o,e,n,r,t,s),this.renderTextBubble(o,e),e.translate(-c.x,-c.y)}}renderTextBubble(e,t){for(const n of this.saysToSay)if(n.playerId===e.id){t.fillStyle=constants.PLAYER_SAY_BACKGROUND_COLOR;const e=t.measureText(n.msg).width,s=e/2,i=-this.clip.scale(g),r=this.clip.scale(T),o=this.clip.scale(p);t.fillRect(-s-r,i-r,e+2*r,o),t.fillStyle=constants.PLAYER_SAY_FOREGROUND_COLOR,t.fillText(n.msg,-s,i)}this.saysToSay=this.saysToSay.filter(e=>e.sw.elapsedSeconds<_)}renderName(e,t,n,s,r,o){let a=this.context.settings.useBitmaps?constants.PLAYER_NAME_COLOR:constants.PLAYER_NAME_NOBITMAP_COLOR;e.team===i.CTF_TEAMS.BLUE?a=constants.PLAYER_NAME_BLUE_TEAM_COLOR:e.team===i.CTF_TEAMS.RED&&(a=constants.PLAYER_NAME_RED_TEAM_COLOR),t.fillStyle=a;let c="";e.level&&(c=` [${e.level}]`);const l=`${e.ranking||"?"}. ${e.name}${c}`,u=this.context.settings.useBitmaps?n+s:0,E=t.measureText(l).width+u,h=-E/2,A=this.clip.scale(70);if(t.fillText(l,h,A),this.context.settings.useBitmaps){const s=i.FLAGS_CODE_TO_ISO[""+e.flag]||"JOLLY",a=this.flagImages[s];t.drawImage(a,0,0,d,d,h+E-n,A-n+r-o,n,n)}const T=this.clip.scale(20);t.fillStyle=constants.PLAYER_STATS_COLOR;const p=`Score: ${e.score}; ping: ${e.ping||"?"} ms`;t.fillText(p,h,A+T)}renderBars(e,t){e.strokeStyle=constants.PLAYER_HEALTH_OK_COLOR,t.health<.3?e.strokeStyle=constants.PLAYER_HEALTH_DANGER_COLOR:t.health<.6&&(e.strokeStyle=constants.PLAYER_HEALTH_WARN_COLOR);const n=this.clip.scale(a);e.lineWidth=this.clip.scale(c),e.globalAlpha=t.id===this.context.state.id?.8:.5,e.beginPath(),e.arc(0,0,n,Math.PI,Math.PI+Math.PI*t.health/2),e.stroke(),e.strokeStyle=constants.PLAYER_ENERGY_COLOR,e.beginPath();const s=Math.max(.01,t.energy);if(e.arc(0,0,n,0,2*Math.PI-Math.PI*s/2,!0),e.stroke(),t.powerUps.inferno||t.powerUps.shield){e.strokeStyle=t.powerUps.shield?constants.PLAYER_SHIELD_COLOR:constants.PLAYER_INFERNO_COLOR,e.beginPath();const n=t.shieldOrInfernoTimer?Math.max(.01,1-t.shieldOrInfernoTimer.timeoutFraction):1;e.lineWidth=this.clip.scale(l);const s=this.clip.scale(u);e.arc(0,0,s,Math.PI,Math.PI+Math.PI*n),e.stroke()}e.globalAlpha=1}renderAircraft(e,t){const n=s.SHIPS_SPECS[e.type];if(this.context.settings.useBitmaps){const s=this.images[n.name],i=1,r=this.clip.scale(s.width*i),o=this.clip.scale(s.height*i),a=r/2,c=o/2;e.stealthed&&(t.globalAlpha=.4),t.drawImage(s,0,0,s.width,s.height,-a,-c,r,o),t.globalAlpha=1}else{e.team===i.CTF_TEAMS.BLUE?t.fillStyle=e.stealthed?constants.PLAYER_NOBITMAP_BLUE_TEAM_PROWLER_COLOR:constants.PLAYER_NOBITMAP_BLUE_TEAM_COLOR:e.team===i.CTF_TEAMS.RED?t.fillStyle=e.stealthed?constants.PLAYER_NOBITMAP_RED_TEAM_PROWLER_COLOR:constants.PLAYER_NOBITMAP_RED_TEAM_COLOR:t.fillStyle=e.stealthed?constants.PLAYER_NOBITMAP_PROWLER_COLOR:constants.PLAYER_NOBITMAP_COLOR;const s=n.collisions;for(const e of s){const n=new o.Pos(this.clip.scale(e[0]),this.clip.scale(e[1])),s=this.clip.scale(e[2]);t.beginPath(),t.arc(n.x,n.y,s,0,2*Math.PI),t.fill()}}}initFlagImages(){for(const e of Object.keys(i.COUNTRY_NAMES))this.flagImages[e]=document.getElementById(`flag-${e}`)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(19),i=n(1),r=n(12);t.StatsRenderer=class{constructor(e){this.context=e,this.scoreElement=document.getElementById("stats-score"),this.upgradesElement=document.getElementById("stats-upgrades"),this.killsElement=document.getElementById("stats-kills"),this.deathsElement=document.getElementById("stats-deaths"),this.upgrSpeedElement=document.getElementById("stats-speed"),this.upgrDefenseElement=document.getElementById("stats-defense"),this.upgrEnergyElement=document.getElementById("stats-energy"),this.upgrMissileElement=document.getElementById("stats-missile"),this.ctfInfo=document.getElementById("ctf-info"),this.blueScore=document.getElementById("blue-score"),this.redScore=document.getElementById("red-score"),this.blueFlagLocation=document.getElementById("blue-flag-location"),this.redFlagLocation=document.getElementById("red-flag-location")}render(){const e=this.context.state.getMe();if(!e)return;this.scoreElement.innerText=""+e.score,this.killsElement.innerText=""+e.kills,this.deathsElement.innerText=""+e.deaths;const t=e.upgrades||new r.Upgrades;this.upgradesElement.innerText=""+t.available,this.upgrDefenseElement.innerText=""+t.defense,this.upgrEnergyElement.innerText=""+t.energy,this.upgrMissileElement.innerText=""+t.missile,this.upgrSpeedElement.innerText=""+t.speed,this.context.gameType===i.GAME_TYPES.CTF&&"block"!==this.ctfInfo.style.display&&(this.ctfInfo.style.display="block");const n=this.context.state.getCtfTeam(i.CTF_TEAMS.BLUE),o=this.context.state.getCtfTeam(i.CTF_TEAMS.RED),a=n.score?n.score:0,c=o.score?o.score:0;this.blueScore.innerText=""+a,this.redScore.innerText=""+c;let l="?";if(n.flagState===i.CTF_FLAG_STATE.DYNAMIC){l=`taken by ${this.context.state.getPlayerName(n.flagTakenById)}`}else l=s.FLAG_DEFAULT_POSITION.blue.equals(n.flagPos)?"home":"abandoned";this.blueFlagLocation.innerText=l;let u="?";if(o.flagState===i.CTF_FLAG_STATE.DYNAMIC){u=`taken by ${this.context.state.getPlayerName(o.flagTakenById)}`}else u=s.FLAG_DEFAULT_POSITION.red.equals(o.flagPos)?"home":"abandoned";this.redFlagLocation.innerText=u}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),i=n(18),r=12,o=2*r,a=Math.PI/4;t.UpcratesRenderer=class{constructor(e,t){this.context=e,this.clip=t,this.logger=new i.PeriodicLogger(e)}renderUpcrates(e){for(const t of this.context.state.getUpcrates()){const n=t.pos;if(!n||!this.clip.isVisible(n))continue;let i=constants.UPCRATES_UPGRADE_CRATE_COLOR;switch(t.mobType){case s.MOB_TYPES.INFERNO:i=constants.UPCRATES_RAMPAGE_CRATE_COLOR;break;case s.MOB_TYPES.SHIELD:i=constants.UPCRATES_SHIELD_CRATE_COLOR}const c=this.clip.translate(n);e.translate(c.x,c.y),e.rotate(a),e.beginPath(),e.fillStyle=i;const l=this.clip.scale(r),u=this.clip.scale(o);e.rect(-l,-l,u,u),e.fill(),e.fillStyle=constants.UPCRATES_BORDER_COLOR,e.stroke(),e.rotate(-a),e.translate(-c.x,-c.y)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(129),i=n(2),r=1.4,o=132,a=120,c=108,l=84,u=60;t.WallsRenderer=class{constructor(e,t){this.clip=e,this.context=t;const n=document.getElementById("mountain-medium"),i=document.getElementById("mountain-large"),r=[];r.push(document.getElementById("mountain-regular-a")),r.push(document.getElementById("mountain-regular-b")),r.push(document.getElementById("mountain-regular-c"));const d=document.getElementById("mountain-small"),E=document.getElementById("mountain-smaller"),h=document.getElementById("mountain-mini");let A=0;this.wallImages={};for(const e of s.abWalls){const t=e[2];let s;s=t>=o?i:t>=a?n:t>=c?r[A%r.length]:t>=l?d:t>=u?E:h,e[3]=A,this.wallImages[A]=s,A++}}renderWalls(e){for(const t of s.abWalls){const n=new i.Pos(t[0],t[1]),s=t[2],o=new i.Pos(n.x-s,n.y-s),a=new i.Pos(n.x+s,n.y+s);if(this.clip.isVisible(o)||this.clip.isVisible(a)){const i=this.clip.translate(n);if(this.context.settings.useBitmaps){const n=this.clip.scale(s)*r,o=t[3],a=this.wallImages[o];e.drawImage(a,0,0,a.width,a.height,i.x-n,i.y-n,2*n,2*n)}else{const t=this.clip.scale(s);e.fillStyle=constants.WALLS_NOBITMAP_COLOR,e.beginPath(),e.arc(i.x,i.y,t,0,2*Math.PI),e.fill()}}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.abWalls=[[1009,-2308,108],[1241,-2490,60],[1157,-2379,84],[622,-2126,48],[669,-2187,72],[-392,-1669,132],[-273,-1746,60],[-252,-1504,120],[1553,-2016,48],[1637,-1972,60],[1736,-1922,60],[2150,-2406,72],[2238,-2318,108],[2364,-2391,72],[2491,-2682,72],[2596,-2671,108],[-150,-3147,48],[-155,-3044,84],[-427,-3600,48],[-259,-2982,60],[-379,-3529,72],[-665,-3052,60],[20,-1816,60],[127,-1799,60],[263,-2572,48],[405,-2570,108],[851,-4183,120],[754,-3971,108],[1757,-5065,132],[1169,-4453,108],[2054,-5244,108],[1631,-4901,108],[2305,-5281,108],[1007,-4281,96],[2766,-5202,96],[2927,-5204,84],[3206,-5218,36],[3099,-5193,72],[1417,-4726,120],[2844,-1513,60],[3206,-1464,120],[2881,-1403,108],[3804,-2025,84],[4116,-1778,108],[3715,-1508,72],[4247,-1126,72],[3860,268,60],[4334,-1011,132],[3849,349,72],[3956,490,96],[4073,667,108],[3583,-864,96],[4135,836,120],[4785,-743,120],[4993,-839,108],[5224,-482,84],[5235,-1238,132],[5419,-1346,72],[6075,-5099,96],[5767,-4953,108],[5896,-4967,108],[5384,-4642,108],[5704,-4857,108],[5563,-4697,108],[5406,-4470,132],[5352,-3964,108],[5309,-3665,132],[5247,-3464,108],[5300,-3121,108],[3524,-3340,132],[3661,-3589,108],[7236,-1376,72],[7624,-1610,96],[7403,-1555,84],[7514,-1568,108],[3660,-2705,108],[3374,-2813,96],[7347,-1447,108],[7236,-775,60],[7207,-631,108],[7303,-468,108],[7262,-1263,108],[7404,-350,120],[7589,-305,108],[7741,-1589,120],[7949,-1594,120],[8152,-1599,132],[8378,-1602,144],[7873,-321,72],[8543,-1661,84],[7790,-259,120],[8675,-1573,120],[8163,-245,84],[8329,-311,84],[8275,-229,120],[8447,-277,120],[8824,-1447,108],[7221,-1140,60],[8924,-1273,108],[6844,-950,120],[8949,-1060,132],[8904,-920,96],[8582,-338,84],[8963,-803,120],[8680,-322,108],[8811,-449,108],[8910,-610,108],[6855,114,96],[6971,241,120],[6852,656,60],[6980,706,108],[6946,939,120],[6027,-560,72],[7521,425,48],[7599,389,60],[5863,-431,108],[9392,262,108],[7521,512,72],[9807,1027,60],[9554,237,120],[9346,392,144],[9789,1142,84],[9747,-532,96],[8591,347,72],[9951,-509,120],[9308,2417,60],[10185,-522,108],[10330,2147,72],[9350,2480,84],[10503,2124,108],[12500,2628,60],[13188,2864,60],[12637,2659,84],[13262,2899,60],[13777,5168,60],[15709,6399,48],[13539,5664,60],[15660,6474,48],[13743,5248,84],[15482,6600,48],[15591,6525,36],[13487,5738,84],[15407,6702,72],[8171,-2568,60],[16001,6015,72],[16017,6110,48],[6496,-1491,60],[6626,-1480,84],[6190,-1022,96],[8325,-2615,120],[8222,-2412,120],[9204,-2288,108],[9279,-2216,120],[10375,-1558,96],[10309,-1421,108],[10247,-1216,144],[10079,-2310,108],[10320,-2330,120],[10942,-2963,108],[10807,-2778,132],[12989,-1929,72],[12613,-1181,48],[12559,-1120,60],[11642,-1900,84],[11558,-1692,108],[11509,-1479,60],[12559,-2673,96],[12446,-2487,120],[12375,-2303,108],[10363,-3514,84],[10290,-3340,108],[10162,-3207,84],[9003,-3048,108],[9161,-3119,72],[14550,-3462,108],[14407,-3335,108],[14366,-4493,108],[14477,-4437,120],[15305,-4230,108],[15481,-4283,108],[15349,-5009,48],[11874,-4879,72],[15453,-4984,84],[11907,-4742,96],[12440,-4278,60],[11980,-4582,108],[12131,-4387,132],[15681,-4973,120],[12591,-4252,96],[12777,-4244,108],[12969,-4227,108],[15897,-5071,108],[13204,-4228,120],[11592,-5261,84],[12743,-4826,48],[10102,-5078,84],[12854,-4782,108],[10191,-5033,84],[10523,-5133,120],[10336,-4977,132],[10667,-5250,96],[9665,-6403,84],[10798,-5379,60],[9670,-5547,108],[9834,-6369,120],[9864,-5572,132],[11362,-3957,108],[11162,-3830,120],[8922,-6173,120],[9003,-5368,60],[8453,-6153,72],[8954,-5229,108],[8905,-5072,96],[8704,-3873,108],[8578,-6105,96],[8508,-3710,84],[8614,-5400,60],[8788,-4922,132],[8936,-3905,72],[9701,-4613,108],[6973,-4776,72],[7016,-4674,108],[9124,-3853,108],[7253,-4648,96],[6602,-4591,72],[8510,-5322,108],[6687,-3810,84],[9525,-4492,132],[7461,-4705,108],[9280,-3812,96],[6467,-2811,36],[6842,-3820,96],[6483,-2725,72],[7675,-4864,132],[6991,-2885,108],[6610,-2664,108],[6822,-2736,108],[6763,-4582,108],[6509,-2490,108],[7216,-3865,132],[7018,-3708,120],[2254,-3301,96],[6378,-2310,96],[7197,-2857,108],[2609,-3483,60],[2449,-3385,108],[4585,-2889,84],[4470,-2768,96],[4083,-4033,108],[1568,-2869,48],[4336,-4105,144],[1977,-1678,60],[1412,-3642,60],[1570,-2792,72],[1932,-1586,72],[1310,-3547,72],[3611,1391,120],[3558,2174,108],[3431,1563,108],[3142,2813,84],[3330,2296,132],[3001,2818,72],[3703,2044,48],[2872,3863,108],[3125,2942,132],[2841,4018,132],[2402,5140,72],[2511,5167,96],[-14607,-5112,108],[-14430,-5180,108],[-14197,-5222,144],[-14895,-4703,60],[-14797,-4728,48],[-14697,-4739,48],[-13919,-5281,132],[-13646,-5170,84],[-13400,-5068,144],[-13099,-5108,132],[-12824,-5092,108],[-12631,-5044,108],[-12427,-4914,108],[-12270,-4816,84],[-11772,-4983,84],[-11940,-4867,108],[-12091,-4699,108],[-12270,-4529,84],[-12460,-4396,108],[-13058,-4252,108],[-12894,-4096,84],[-12738,-4077,84],[-13546,-4341,48],[-13428,-4299,108],[-14679,-4192,84],[-14368,-4308,84],[-14495,-4133,132],[-12072,-3824,96],[-11904,-3648,120],[-11654,-3569,84],[-11648,-3357,108],[-11420,-3359,108],[-11296,-3135,84],[-10782,-2838,96],[-11410,-3039,36],[-10581,-2773,132],[-11118,-5114,96],[-10675,-5079,108],[-10205,-4890,96],[-11543,-4164,96],[-11287,-4244,60],[-10018,-4747,120],[-9278,419,60],[-9341,470,60],[-9180,496,96],[-11365,-4131,120],[-9353,0,72],[-8975,528,120],[-9413,89,108],[-8230,770,48],[-9231,17,84],[-6808,1667,60],[-6694,1622,96],[-8285,855,72],[-6793,1796,96],[-6865,1935,60],[-7043,2222,72],[-7083,2368,72],[-7103,2533,84],[-7099,2721,96],[-7178,2874,48],[-6964,3110,84],[-6246,4191,72],[-6735,3446,48],[-6722,3537,84],[-6396,3388,108],[-6787,3140,108],[-6227,4488,84],[-6281,3953,72],[-6530,3576,132],[-6147,3994,132],[-6141,4292,144],[-6377,5578,84],[-6152,4569,108],[-6222,4769,84],[-6266,4956,72],[-6233,5414,108],[-6347,5646,84],[-6400,6066,84],[-6411,6261,96],[-6565,7043,72],[-6377,6415,108],[-6440,6614,84],[-5944,1954,60],[-6001,2039,96],[-6467,7070,108],[-4963,3608,72],[-4776,3510,48],[-5785,1998,132],[-3708,3449,72],[-3790,3582,108],[-4031,3697,84],[-4859,3634,120],[-3850,3730,120],[-4689,4605,108],[-3492,2892,72],[-4507,4483,72],[-4829,2745,108],[-4435,4273,108],[-3383,2930,108],[-4888,2821,108],[-5372,5172,60],[-5036,2981,108],[-9895,-1942,120],[-9371,-2159,72],[-9995,-1773,108],[-5280,5218,108],[-5079,5183,108],[-5149,3079,72],[-9695,-2048,120],[-5063,5374,108],[-9504,-2059,120],[-8948,-2140,84],[-9262,-2081,132],[-9068,-2071,120],[-8861,-2045,132],[-8654,-2083,120],[-8473,-2048,120],[-8283,-1965,120],[-8182,-1863,108],[-10037,-1579,108],[-10063,-1365,108],[-10074,-1190,108],[-8167,-1225,60],[-8188,-1087,96],[-9975,-1022,108],[-9835,-910,120],[-9709,-848,120],[-9532,-792,120],[-9348,-779,120],[-9131,-784,132],[-8754,-795,84],[-8587,-797,120],[-8424,-856,108],[-8246,-921,108],[-8153,-1701,84],[-6447,-2137,72],[-8153,-1591,60],[-7694,-1393,120],[-6541,-2030,84],[-7135,-1547,84],[-5885,-2958,72],[-7171,-1440,96],[-5620,-3123,72],[-6631,-1866,96],[-5882,-3696,96],[-5716,-2944,108],[-5949,-3528,60],[-6869,-4052,96],[-7081,-2673,60],[-6725,-4069,72],[-10487,-2295,60],[-7032,-2749,72],[-10769,-3817,72],[-6607,-4081,60],[-10849,-1824,84],[-10479,-2146,108],[-7003,-2611,108],[-10749,-1511,72],[-10697,-1953,120],[-10848,-1330,108],[-10912,-1220,60],[-9843,-2685,84],[-10823,-3717,84],[-9697,-2713,72],[-10080,-3431,48],[-10648,-3844,108],[-9530,-2695,120],[-2387,-6791,108],[-8465,-5037,84],[-2550,-6627,108],[-9325,-2822,84],[-10140,-3346,96],[-8461,-4908,108],[8116,-1076,96],[8115,-940,96],[-2503,-6359,168],[-9062,-1580,96],[8120,-790,96],[-9065,-1444,96],[-2615,-6159,120],[-2744,-5943,132],[-3713,-4955,108],[-9061,-1292,96],[-1551,-4718,60],[5251,-6249,60],[5192,-6181,48],[-2898,-5732,108],[-1705,-4629,96],[1618,-7035,60],[-3829,-4776,108],[-2851,-5589,132],[-2974,-5399,132],[-3952,-4568,108],[-4135,-4368,132],[-3428,-5104,132],[-3167,-5254,108],[-3049,-6916,120],[-3097,-6722,108],[-3190,-6493,120],[-3318,-6284,132],[-4672,-5861,132],[-4480,-5668,120],[-4294,-5548,108],[-3433,-6072,120],[-3568,-5881,120],[-3736,-5698,144],[-3978,-7517,108],[-3956,-5572,120],[-4103,-5400,120],[-4281,-5240,120],[-4409,-5034,120],[-4475,-4808,108],[-2777,-7546,120],[-2542,-7502,108],[-2398,-7364,108],[-2350,-7151,108],[-2315,-6976,96],[-3749,-7488,120],[-2995,-7596,144],[-3253,-7558,132],[-3468,-7472,120],[-5028,-6473,120],[-3604,-7301,132],[-3678,-7078,132],[-3835,-6826,132],[-3935,-6595,120],[-5214,-7381,120],[-4065,-6416,132],[-4174,-6231,84],[-4556,-6940,120],[-4663,-6781,120],[-4748,-6548,156],[-4847,-6257,132],[-4806,-6016,108],[-4950,-7410,168],[-5470,-7251,156],[-5637,-7038,120],[-5593,-6819,120],[-5406,-6727,120],[-5263,-6580,120],[-4636,-7476,120],[-4399,-7496,108],[-6769,-7571,108],[-6853,-7377,108],[-8273,-7231,60],[-4182,-7512,108],[-7525,-5855,108],[-7495,-6329,60],[-7297,-6946,108],[-8148,-7137,84],[-7030,-7301,84]]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AircraftSelection=class{constructor(e){this.context=e,document.getElementById("select-raptor").onclick=()=>this.selectAircraft("1"),document.getElementById("select-spirit").onclick=()=>this.selectAircraft("2"),document.getElementById("select-mohawk").onclick=()=>this.selectAircraft("3"),document.getElementById("select-tornado").onclick=()=>this.selectAircraft("4"),document.getElementById("select-prowler").onclick=()=>this.selectAircraft("5")}selectAircraft(e){this.context.connection.sendCommand("respawn",e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ApplyUpgrades=class{constructor(e){this.context=e,document.getElementById("select-speed").onclick=()=>this.applyUpgrade("1"),document.getElementById("select-defense").onclick=()=>this.applyUpgrade("2"),document.getElementById("select-energy").onclick=()=>this.applyUpgrade("3"),document.getElementById("select-missile").onclick=()=>this.applyUpgrade("4"),document.getElementById("drop-upgrade").onclick=()=>this.dropUpgrade()}applyUpgrade(e){this.context.connection.sendCommand("upgrade",e)}dropUpgrade(){this.context.connection.sendCommand("upgrades","drop")}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(10),i=n(0);t.ChatInput=class{constructor(e){this.context=e,this.commandRegex=/^\/(\w+)(?:\s(.+))?$/,this.input=document.getElementById("chat-input-textbox"),this.input.addEventListener("blur",()=>this.hide()),this.hide(),document.getElementById("input-instruction").addEventListener("click",()=>this.showAndFocus())}showAndFocus(){this.input.style.display="block",this.input.focus()}hide(){this.input.style.display="none"}startChat(e){this.showAndFocus(),this.input.value=e}isChatInputFocused(){return"block"===this.input.style.display.toLowerCase()}submit(){const e=this.input.value;if(e){this.input.value="";const t=this.commandRegex.exec(e);if(t){const e=t[1],n=t[2];if("t"===e)this.context.eventQueue.pub(i.Events.CHAT_SEND,{text:n,type:s.CHAT_TYPE.TEAM});else if("s"===e)this.context.eventQueue.pub(i.Events.CHAT_SEND,{text:n,type:s.CHAT_TYPE.SAY});else if("w"===e){const e=this.context.state.getPlayers();let t;e.sort((e,t)=>t.name.length-e.name.length);for(const s of e)if(n.startsWith(s.name)){t=s;break}if(t){const e=n.substr(t.name.length+1);this.context.eventQueue.pub(i.Events.CHAT_SEND,{playerId:t.id,text:e,type:s.CHAT_TYPE.WHISPER})}else this.context.eventQueue.pub(i.Events.MESSAGE_TO_PLAYER,{message:"Unknown player, message not sent."})}else this.context.connection.sendCommand(e,n||"")}else this.context.eventQueue.pub(i.Events.CHAT_SEND,{text:e,type:s.CHAT_TYPE.CHAT});this.hide()}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),i=n(0);t.KeyboardAndMouseInput=class{constructor(e,t,n,s,i){this.context=e,this.chatInput=t,this.applyUpgrades=n,this.aircraftSelection=s,this.playerDropdownMenu=i,document.addEventListener("keydown",e=>this.onKey(e,!0)),document.addEventListener("keyup",e=>this.onKey(e,!1));const r=document.getElementById("canvas");r.addEventListener("mousedown",e=>this.onMouseFire(e,!0)),r.addEventListener("mouseup",e=>this.onMouseFire(e,!1));const o=document.getElementById("chat"),a=document.getElementById("player-list");o.addEventListener("mouseup",e=>this.onMouseUpInChatOrPlayerList(e,!1)),o.addEventListener("contextmenu",e=>this.onMouseUpInChatOrPlayerList(e,!0)),a.addEventListener("mouseup",e=>this.onMouseUpInChatOrPlayerList(e,!1)),a.addEventListener("contextmenu",e=>this.onMouseUpInChatOrPlayerList(e,!0))}onMouseUpInChatOrPlayerList(e,t){if(!this.context.isActive)return;const n=e.target;if(!n.className||-1===n.className.indexOf("player-name"))return void this.playerDropdownMenu.hide();if(!t&&2===e.button)return;const s=n.dataset.name,i=n.dataset.id;this.playerDropdownMenu.show(e.x,e.y,i,s),e.preventDefault(),e.stopPropagation()}onMouseFire(e,t){this.context.isActive&&(this.context.eventQueue.pub(i.Events.KEYBOARD,{key:s.KEY_CODES.FIRE,state:t}),this.playerDropdownMenu.hide())}onKey(e,t){if(!this.context.isActive)return;if(this.chatInput.isChatInputFocused())return void(t&&(27===e.keyCode&&this.chatInput.hide(),13===e.keyCode&&this.chatInput.submit()));let n,r=!1;switch(e.keyCode){case 16:case 17:n=s.KEY_CODES.SPECIAL;break;case 32:n=s.KEY_CODES.FIRE;break;case 65:case 37:r=!0,n=s.KEY_CODES.LEFT;break;case 87:case 38:r=!0,n=s.KEY_CODES.UP;break;case 68:case 39:r=!0,n=s.KEY_CODES.RIGHT;break;case 83:case 40:r=!0,n=s.KEY_CODES.DOWN;break;case 13:t&&this.chatInput.showAndFocus();break;case 88:t&&this.applyUpgrades.dropUpgrade();break;case 49:case 50:case 51:case 52:t&&this.applyUpgrades.applyUpgrade(""+(e.keyCode-48));break;case 112:case 113:case 114:case 115:case 116:r=!0,t&&this.aircraftSelection.selectAircraft(""+(e.keyCode-111))}n&&this.context.eventQueue.pub(i.Events.KEYBOARD,{key:n,state:t}),r&&(e.stopPropagation(),e.preventDefault())}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1);t.PlayerDropDownMenu=class{constructor(e,t,n){this.context=e,this.chatInput=t,this.renderer=n,this.menu=document.getElementById("player-context-menu"),this.menuTitle=document.getElementById("menu-title"),this.menuStats=document.getElementById("menu-stats");const s=this.menu.getElementsByClassName("menu-item");for(const e of s)e.addEventListener("click",()=>this.onMenuItemClicked(e))}show(e,t,n,i){var r;this.menu.style.left=e+"px",this.menu.style.top=t+"px",this.menu.style.display="block",this.currentId=Number(n),this.currentName=decodeURI(i);const o=this.context.state.getPlayerById(Number(n));this.menuTitle.innerText=this.currentName,this.menuStats.innerText="Kills: "+o.kills+"; Deaths: "+o.deaths+"\nDamage: "+o.damage+"; Ping: "+o.ping+(this.context.gameType===s.GAME_TYPES.CTF?"\nCaptures: "+(null!=(r=o.captures)?r:0):"")}hide(){this.menu.style.display="none"}onMenuItemClicked(e){this.hide();const t=this.context.state.getPlayerById(this.currentId);if(t&&"Server"!==t.name)switch(e.id){case"menu-flag":this.context.connection.sendCommand("flag",s.FLAGS_CODE_TO_ISO[""+t.flag]);break;case"menu-whisper":this.chatInput.startChat(`/w ${this.currentName} `);break;case"menu-ignore":this.renderer.ignorePlayer(t.id),this.renderer.addMessageToPlayer("Player chats will be ignored for player "+t.name);break;case"menu-unignore":this.renderer.unignorePlayer(t.id),this.renderer.addMessageToPlayer("Removed player from the ignore list.");break;case"menu-votemute":this.context.connection.voteMute(t.id),this.renderer.addMessageToPlayer("You have voted to mute player "+t.name);break;case"menu-locate":this.renderer.highlightPlayerOnMinimap(t.id)}}}},function(e,t,n){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(n(26)),r=n(1),o=n(136),a=n(157),c=n(158);t.LandingPage=class{constructor(e){this.context=e,this.serverGamesRepository=new o.ServerGamesRepository,this.stylesRepository=new a.StylesRepository,this.nameInput=document.getElementById("playerName"),this.styleSelect=document.getElementById("styleSelect"),this.zoomSelect=document.getElementById("zoomSelect"),this.thirdPartyLogin=new c.ThirdPartyLogin(e)}async run(){this.doBackground(),await this.populateServerList(),this.loadAllFlags(),this.fillInPrevSettings(),this.loadConstantsPromise=this.stylesRepository.loadStyle("styles/default/"),this.styleSelect.addEventListener("change",()=>{"no-bitmaps"!==this.styleSelect.value&&(this.loadConstantsPromise=this.stylesRepository.loadStyle(this.styleSelect.value))})}fillInPrevSettings(){const e=i.default.get("settings");if(!e)return;const t=JSON.parse(e);this.nameInput.value=t.playerName,this.select(this.zoomSelect,t.zoom.toString()),t.useBitmaps||(this.styleSelect.options[1].selected=!0)}select(e,t){for(const n of e.options)if(n.value===t){n.selected=!0;break}}async startGame(e){this.context.settings.playerName=this.nameInput.value||"Unknown",this.context.settings.websocketUrl=e,this.context.settings.zoom=Number(this.zoomSelect.value)||1,this.context.settings.useBitmaps="no-bitmaps"!==this.styleSelect.value,this.context.settings.horizonX=window.innerWidth/2,this.context.settings.horizonY=window.innerHeight/2,i.default.set("settings",JSON.stringify(this.context.settings),{expires:365}),document.getElementById("nameAndGame").style.display="none",document.getElementById("chat").style.display="block",document.getElementById("chat-input").style.display="block",document.getElementById("aircraftSelection").style.display="block",document.getElementById("stats").style.display="block",document.getElementById("upgradeSelection").style.display="block",document.getElementById("minimap").style.display="block",document.getElementById("player-list").style.display="block",document.getElementById("server-message").style.display="block",location.href.indexOf("debug")>-1&&(document.getElementById("debugPanel").style.display="block",this.context.settings.shouldShowDebugInfo=!0),await this.loadConstantsPromise,window.document.body.style.backgroundImage="inherit",this.context.start()}async populateServerList(){const e=await this.serverGamesRepository.getServerInfo(),t=i.default.get("flag")||e.country;this.context.settings.flag=t;const n=document.getElementById("games"),s=document.createElement("table");s.innerHTML="<tr><th>Region</th><th>Game</th><th>Players online</th><th></th></tr>",n.append(s),location.href.indexOf("127.0.0.1")>-1&&e.data.unshift({games:[{host:"127.0.0.1:3501",id:"local",name:"Local",nameShort:"local",path:"ffa",players:0,type:0}],id:"local",name:"Local"});for(const t of e.data)for(const e of t.games){const n=document.createElement("tr");s.append(n);const i=document.createElement("td");n.append(i),i.innerText=t.name,i.className="region";const r=document.createElement("td");n.append(r),r.innerText=e.name,r.className="game-name";const o=document.createElement("td");n.append(o),o.innerText=e.players||0===e.players?e.players.toString():"?",o.className="num-players";const a=document.createElement("td");n.append(a);const c=document.createElement("input");a.append(c),a.className="start-button",c.type="button",c.value="Start";let l="wss";0===e.type&&(l="ws");const u=`${l}://${e.host}/${e.path}`;c.onclick=()=>this.startGame(u)}}loadAllFlags(){for(const e of Object.keys(r.COUNTRY_NAMES)){const t=document.createElement("img");t.src=`flags/${e}.png`,t.style.display="none",t.id=`flag-${e}`,document.body.appendChild(t)}}doBackground(){const e=document.getElementById("map");window.document.body.style.backgroundImage=`url(${e.src})`,window.document.body.style.backgroundSize="cover"}}},function(e,t,n){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(n(27)),r=n(154),o=n(155),a=n(156),c="https://data.airmash.online/games?main=1&_=",l="https://raw.githubusercontent.com/airmash-refugees/airmash-games/master/games.txt?_=";t.ServerGamesRepository=class{async getServerInfo(){try{const e=(await i.default.get(c+Date.now)).data;return e.data=JSON.parse(e.data),e}catch(e){const t=(await(await i.default.get(l+Date.now))).data.split("\n"),n=new a.ServerRegionInfoDto;n.country="?",n.protocol=1,n.data=[];for(const e of t){const t=e.split("|");let s=n.data.find(e=>e.name===t[0]);s||(s=new o.ServerRegion,s.name=t[0],s.id=t[0],s.games=[],n.data.push(s));const i=new r.GameEndpoint;i.name=t[3],i.nameShort=t[4],i.host=t[5],i.path=t[6],s.games.push(i)}return n}}}},function(e,t,n){"use strict";var s=n(4),i=n(28),r=n(139),o=n(34);function a(e){var t=new r(e),n=i(r.prototype.request,t);return s.extend(n,r.prototype,t),s.extend(n,t),n}var c=a(n(31));c.Axios=r,c.create=function(e){return a(o(c.defaults,e))},c.Cancel=n(35),c.CancelToken=n(152),c.isCancel=n(30),c.all=function(e){return Promise.all(e)},c.spread=n(153),e.exports=c,e.exports.default=c},function(e,t){
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
e.exports=function(e){return null!=e&&null!=e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}},function(e,t,n){"use strict";var s=n(4),i=n(29),r=n(140),o=n(141),a=n(34);function c(e){this.defaults=e,this.interceptors={request:new r,response:new r}}c.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=a(this.defaults,e)).method=e.method?e.method.toLowerCase():"get";var t=[o,void 0],n=Promise.resolve(e);for(this.interceptors.request.forEach((function(e){t.unshift(e.fulfilled,e.rejected)})),this.interceptors.response.forEach((function(e){t.push(e.fulfilled,e.rejected)}));t.length;)n=n.then(t.shift(),t.shift());return n},c.prototype.getUri=function(e){return e=a(this.defaults,e),i(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},s.forEach(["delete","get","head","options"],(function(e){c.prototype[e]=function(t,n){return this.request(s.merge(n||{},{method:e,url:t}))}})),s.forEach(["post","put","patch"],(function(e){c.prototype[e]=function(t,n,i){return this.request(s.merge(i||{},{method:e,url:t,data:n}))}})),e.exports=c},function(e,t,n){"use strict";var s=n(4);function i(){this.handlers=[]}i.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},i.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},i.prototype.forEach=function(e){s.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=i},function(e,t,n){"use strict";var s=n(4),i=n(142),r=n(30),o=n(31),a=n(150),c=n(151);function l(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function(e){return l(e),e.baseURL&&!a(e.url)&&(e.url=c(e.baseURL,e.url)),e.headers=e.headers||{},e.data=i(e.data,e.headers,e.transformRequest),e.headers=s.merge(e.headers.common||{},e.headers[e.method]||{},e.headers||{}),s.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||o.adapter)(e).then((function(t){return l(e),t.data=i(t.data,t.headers,e.transformResponse),t}),(function(t){return r(t)||(l(e),t&&t.response&&(t.response.data=i(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},function(e,t,n){"use strict";var s=n(4);e.exports=function(e,t,n){return s.forEach(n,(function(n){e=n(e,t)})),e}},function(e,t){var n,s,i=e.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===r||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:r}catch(e){n=r}try{s="function"==typeof clearTimeout?clearTimeout:o}catch(e){s=o}}();var c,l=[],u=!1,d=-1;function E(){u&&c&&(u=!1,c.length?l=c.concat(l):d=-1,l.length&&h())}function h(){if(!u){var e=a(E);u=!0;for(var t=l.length;t;){for(c=l,l=[];++d<t;)c&&c[d].run();d=-1,t=l.length}c=null,u=!1,function(e){if(s===clearTimeout)return clearTimeout(e);if((s===o||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(e);try{s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}(e)}}function A(e,t){this.fun=e,this.array=t}function T(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new A(e,t)),1!==l.length||u||a(h)},A.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=T,i.addListener=T,i.once=T,i.off=T,i.removeListener=T,i.removeAllListeners=T,i.emit=T,i.prependListener=T,i.prependOnceListener=T,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";var s=n(4);e.exports=function(e,t){s.forEach(e,(function(n,s){s!==t&&s.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[s])}))}},function(e,t,n){"use strict";var s=n(33);e.exports=function(e,t,n){var i=n.config.validateStatus;!i||i(n.status)?e(n):t(s("Request failed with status code "+n.status,n.config,null,n.request,n))}},function(e,t,n){"use strict";e.exports=function(e,t,n,s,i){return e.config=t,n&&(e.code=n),e.request=s,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}},function(e,t,n){"use strict";var s=n(4),i=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,n,r,o={};return e?(s.forEach(e.split("\n"),(function(e){if(r=e.indexOf(":"),t=s.trim(e.substr(0,r)).toLowerCase(),n=s.trim(e.substr(r+1)),t){if(o[t]&&i.indexOf(t)>=0)return;o[t]="set-cookie"===t?(o[t]?o[t]:[]).concat([n]):o[t]?o[t]+", "+n:n}})),o):o}},function(e,t,n){"use strict";var s=n(4);e.exports=s.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function i(e){var s=e;return t&&(n.setAttribute("href",s),s=n.href),n.setAttribute("href",s),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=i(window.location.href),function(t){var n=s.isString(t)?i(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0}},function(e,t,n){"use strict";var s=n(4);e.exports=s.isStandardBrowserEnv()?{write:function(e,t,n,i,r,o){var a=[];a.push(e+"="+encodeURIComponent(t)),s.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),s.isString(i)&&a.push("path="+i),s.isString(r)&&a.push("domain="+r),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(e,t,n){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t,n){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},function(e,t,n){"use strict";var s=n(35);function i(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;e((function(e){n.reason||(n.reason=new s(e),t(n.reason))}))}i.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},i.source=function(){var e;return{token:new i((function(t){e=t})),cancel:e}},e.exports=i},function(e,t,n){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.GameEndpoint=class{}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ServerRegion=class{}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ServerRegionInfoDto=class{}},function(e,t,n){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(n(27));t.StylesRepository=class{constructor(){this.lastUrl="styles/default/"}async loadStyle(e){const t=await i.default.get(e+"constants.json");window.constants=t.data;const n=document.querySelectorAll("img");for(const t of n)t.src=t.src.replace(this.lastUrl,e);const s=document.getElementById("ui-styling");s.href=s.href.replace(this.lastUrl,e),this.lastUrl=e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s="https://login.airmash.online",i="auth-data";t.ThirdPartyLogin=class{constructor(e){this.context=e,this.loginButton=document.getElementById("loginButton"),this.loginSelector=document.getElementById("loginselector"),this.overlay=document.getElementById("overlay"),this.loginMessage=document.getElementById("loginMessage"),this.orgLoginMessageText=this.loginMessage.innerHTML,this.orgLoginButtonText=this.loginButton.value,this.loginButton.addEventListener("click",()=>{!!this.context.auth?this.logout():(this.overlay.style.display="block",this.loginSelector.style.display="block")}),this.overlay.addEventListener("click",()=>this.finish());const t=document.querySelectorAll(".loginbutton");for(const e of t){const t=e.getAttribute("data-provider");e.addEventListener("click",()=>this.loginPopup(Number(t)))}this.loadPreviousLoginData()}async loadPreviousLoginData(){try{const e=localStorage.getItem(i);if(e){const t=JSON.parse(e);this.context.auth=t}}catch(e){this.context.logger.error("Auth data could not be loaded",e)}this.toggleLoginMessage()}toggleLoginMessage(){!!this.context.auth?(this.loginButton.value="Log out",this.loginMessage.innerHTML=`Logged in as ${this.context.auth.loginName}`):(this.loginButton.value=this.orgLoginButtonText,this.loginMessage.innerHTML=this.orgLoginMessageText)}finish(){this.overlay.style.display="none",this.loginSelector.style.display="none"}getRandomToken(e){let t=window.crypto.getRandomValues(new Uint32Array(1))[0].toString(16);return e-t.length>0&&(t+=this.getRandomToken(e-t.length)),t.substr(0,e)}loginPopup(e){window.addEventListener("message",e=>this.receiveLoginMessage(e),{once:!0}),this.usedProvider=e,this.loginToken=this.getRandomToken(32);const t=`${s}/login?provider=${e}&nonce=${this.loginToken}&origin=${window.origin}`,n=4===e?900:400,i=5===e?800:600;this.openLoginWindow(t,"Login",n,i)}openLoginWindow(e,t,n,s){const i=window.screenLeft?window.screenLeft:window.screenX,r=window.screenTop?window.screenTop:window.screenY,o=(window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width)/2-n/2+i,a=(window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height)/2-s/2+r;window.open(e,t,"width="+n+", height="+s+", top="+a+", left="+o)}receiveLoginMessage(e){e.origin===s?e.data.provider===this.usedProvider?e.data.nonce===this.loginToken?(this.loginToken=null,this.usedProvider=null,this.loginSuccess({identityProvider:e.data.provider,loginName:e.data.loginname,tokens:e.data.tokens})):this.context.logger.error("nonce does not match: "+e.data.nonce):this.context.logger.error("identity provider does not match: "+e.data.provider):this.context.logger.error("bad origin for login message: "+e.origin)}loginSuccess(e){this.context.auth=e,localStorage.setItem(i,JSON.stringify(e)),this.toggleLoginMessage(),this.finish()}logout(){localStorage.removeItem(i),this.context.auth=null,this.toggleLoginMessage()}}}]);