!function(t){var e={};function i(s){if(e[s])return e[s].exports;var a=e[s]={i:s,l:!1,exports:{}};return t[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(s,a,function(e){return t[e]}.bind(null,a));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e,i){"use strict";var s=this&&this.__assign||function(){return(s=Object.assign||function(t){for(var e,i=1,s=arguments.length;i<s;i++)for(var a in e=arguments[i])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0});var a={announce:function(t){a.log("Announce: "+t),Network.sendChat(t)},calcDiff:function(t,e){var i=e.x-t.x,s=t.y-e.y;return{diffX:i,diffY:s,distance:Math.sqrt(i*i+s*s)}},decodeHtml:function(t){var e=a;return e.htmlDecodeHelper=e.htmlDecodeHelper||document.createElement("textarea"),e.htmlDecodeHelper.innerHTML=t,e.htmlDecodeHelper.value},getDeltaTo:function(t){var e=!0,i=(t=t||this.state.victim).pos;t.lowResPos&&(i=(e=a.calcDiff(t.lowResPos,t.pos).distance<450)?i:t.lowResPos);var o=Players.getMe().pos;return s({},a.calcDiff(o,i),{isAccurate:e})},getHostilePlayersSortedByDistance:function(t){var e=this;void 0===t&&(t=null);var i=a.getPlayers().filter(function(e){return e.team!==game.myTeam&&e.id!==t});return i.sort(function(t,i){var s=e.getDeltaTo(t),a=e.getDeltaTo(i);return s.isAccurate&&!a.isAccurate?-1:!s.isAccurate&&a.isAccurate?1:s.distance<a.distance?-1:a.distance<s.distance?1:0}),i},getPlayers:function(){var t=[],e=Players.getIDs();for(var i in e)if(e.hasOwnProperty(i)){var s=Players.get(i);s&&t.push(s)}return t},getRandomNumber:function(t,e){return t+Math.floor(Math.random()*(e-t))},log:function(t){if(a.shouldLog){var e=a;e.logger||(e.logger=document.createElement("textarea"),document.body.appendChild(e.logger),e.logger.style="position: absolute; top: 1px; left: 1px;"),e.logger.innerHTML=t+"\n"+e.logger.innerHTML}},shouldLog:!1};e.Spatie=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(0),a=i(2),o=null,n=!1,r="b";SWAM.registerExtension({name:"SpatieBot 3.1",id:"spatie02",description:"Runs one bot",author:"Spatie",version:"3.1",settingsProvider:function(){var t=new SettingsProvider({limitUpdates:!1,toggleKey:"b"},function(t){n=t.limitUpdates,r=t.toggleKey}),e=t.addSection("SpatieBot settings");return e.addBoolean("limitUpdates","Don't update screen when window doesn't have focus (for hosting many bots)"),e.addString("toggleKey","Key to press to toggle the bot",{maxLength:1}),t}()}),SWAM.on("gamePrep",function(){console.log("Press '"+r+"' to toggle bot");var t=Mobs.add;Mobs.add=function(e,i,s){t.apply(null,arguments),o&&o.onMobAdd(s,e)};var e=UI.updateUpgrades;UI.updateUpgrades=function(t,i,s){e.apply(null,arguments),o&&(o.upgradeInfo.availableUpgrades=i,o.upgradeInfo.upgradeStats=t)};var i=UI.showMessage;UI.showMessage=function(t,e,s){i.apply(null,arguments),/upgrade/.exec(e)&&o&&(o.upgradeInfo.availableUpgrades=o.upgradeInfo.availableUpgrades||0,o.upgradeInfo.availableUpgrades+=1)};var s=Graphics.render;Graphics.render=function(){n&&!document.hasFocus()||s.apply(null,arguments)}}),SWAM.on("keyup",function(t){var e=t.originalEvent.key;e!==r.toLocaleUpperCase()&&e!==r.toLocaleLowerCase()||(o?(o.dispose(),o=null):(o=function(){var t=new a.SpatieBot;return Window.Spatie=s.Spatie,Window.SpatieBot=t,t}()).initialize())}),SWAM.on("playerKilled",function(t,e,i){o&&o.onPlayerKilled(e.id,i.id)}),SWAM.on("chatLineAdded",function(t,e,i){if(console.log(t.name+": "+e),o)if("-sb-bond"===e)o.toggleBonding();else if("-sb-target"===e)o.announceTarget();else{var s=/-sb-suggest[: ]+(.*)/.exec(e);if(s){var a=s[1];o.suggestVictim(t.id,a)}}})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(3),a=i(0),o=i(4),n=i(5),r=i(6),l=new s.BotConfigFactory,c={availableUpgrades:0,upgradeStats:{}},h=function(){function t(){this.upgradeInfo=c}return t.prototype.announceTarget=function(){if(this.isOn()){var t=this.state.victim,e=t?t.name:"(no target)";a.Spatie.announce("Target: "+e)}},t.prototype.dispose=function(){this.state&&this.state.heartbeatInterval&&(clearInterval(this.state.heartbeatInterval),this.commandExecutor.clearCommands(),this.commandExecutor=null,this.victimSelection=null,this.state=null)},t.prototype.initialize=function(){var t=this;this.isOn()||(this.state=new o.SpatiebotState,this.config=l.getConfigByAircraftType(Players.getMe().type),this.commandExecutor=new n.SpatiebotCommandExecutor(this.state,this.config),this.victimSelection=new r.SpatiebotVictimSelection(this.state,this.config),a.Spatie.log("Starting bot of type "+this.config.name),this.config.bondingTimes>0&&(this.config.bondingTimes=this.config.bondingTimes-1),this.state.heartbeatInterval=setInterval(function(){return t.heartbeat()},this.config.heartbeatInterval))},t.prototype.logState=function(){this.isOn()?a.Spatie.log(JSON.stringify(this.state)):a.Spatie.log("(no state: bot is off)")},t.prototype.onMissileFired=function(t){this.isOn()&&(this.state.missileIDs=this.state.missileIDs||[],this.state.missileIDs.push(t))},t.prototype.onMobAdd=function(t,e){if(this.isOn()&&t!==game.myID){[1,2,3,5,6,7].indexOf(e.type)>-1?this.onMissileFired(e.id):[4,8,9].indexOf(e.type)>-1&&this.onPowerupDetected(e.id)}},t.prototype.onPlayerKilled=function(t,e){var i=this;this.isOn()&&(t===game.myID?(a.Spatie.log("I was killed. Restarting."),this.dispose(),setTimeout(function(){return i.initialize()},this.config.respawnTimeout)):this.state.victim&&t===this.state.victim.id&&(a.Spatie.log("Victim was killed, choosing another victim."),this.state.victim=null))},t.prototype.onPowerupDetected=function(t){this.isOn()&&this.config.goForUpgrades&&(this.state.detectedPowerUps=this.state.detectedPowerUps||[],this.state.detectedPowerUps.push(t))},t.prototype.toggleBonding=function(){this.isOn()&&(this.config.bondingTimes?(this.config.bondingTimes=null,a.Spatie.announce("Every SpatieBot for itself")):(this.config.bondingTimes=3,this.state.victim=null,a.Spatie.announce("All SpatieBots, unite!")))},t.prototype.suggestVictim=function(t,e){if(this.isOn()){var i=Players.getByName(e);i&&i.id!==game.myID&&(this.state.suggestedVictimID=i.id,this.state.suggestingPlayerID=t)}},t.prototype.applyUpgrades=function(){var t=this,e=!1;this.state.lastUpgradeApplicationTime&&(e=Date.now()-this.state.lastUpgradeApplicationTime<5e3);var i=this.upgradeInfo.availableUpgrades>=5,s=Players.getMe().health>=.9;if(!e&&i&&s){var a=0;this.state.lastUpgradeApplicationTime=Date.now();var o=setInterval(function(){Network.sendCommand("upgrade",t.config.applyUpgradesTo+""),5===(a+=1)&&clearInterval(o)},400)}},t.prototype.approachCoords=function(){var t={pos:this.state.gotoCoords};this.turnTo(t),a.Spatie.getDeltaTo(t).distance>this.config.distanceClose?(this.setFastMovement(!0),this.setSpeedMovement("UP")):this.state.gotoCoords=null},t.prototype.approachMob=function(){for(var t,e=[],i=0;i<this.state.detectedPowerUps.length;i++){var s=Mobs.get(this.state.detectedPowerUps[i]);s&&(e.push(s.id),s.delta=a.Spatie.getDeltaTo(s),(!t||t.delta.distance>s.delta.distance)&&(t=s))}t&&(this.turnTo(t),t.delta.distance>this.config.distanceTooClose&&this.setFastMovement(!0),this.setSpeedMovement("UP")),this.state.detectedPowerUps=e},t.prototype.approachVictim=function(){var t=this.state.victim;if(t){var e,i=a.Spatie.getDeltaTo(t);this.setFastMovement(!1),this.state.isVictimPoweredUp&&i.distance<this.config.distanceNear&&!this.hasShield()?e="DOWN":i.distance>this.config.distanceFar?(Players.getMe().health>this.config.fleeHealthThresholdMax&&this.setFastMovement(!0),e="UP"):e=i.distance>this.config.distanceTooClose?"UP":"DOWN",this.setSpeedMovement(e)}else this.setSpeedMovement(null)},t.prototype.detectFlagTaken=function(){this.state.flagCarrierID=null;var t=n($("#blueflag-name").html()),e=n($("#redflag-name").html());if(t||e){var i=Players.getMe(),s=Players.getByName(t);s&&s.team!==i.team&&(this.state.flagCarrierID=s.id);var o=Players.getByName(e);o&&o.team!==i.team&&(this.state.flagCarrierID=o.id)}function n(t){var e=/([^<]+)</.exec(t);return e?a.Spatie.decodeHtml(e[1]):null}},t.prototype.detectDangerousObjects=function(){if(this.state.objectToFleeFromID=null,!this.hasShield()){var t=this.state.missileIDs||[];this.state.missileIDs=[];for(var e=[],i=0;i<t.length;i++){var s=Mobs.get(t[i]);s&&(e.push(s),s.delta=null)}var o=this.config.fleeHealthThresholdMax/Players.getMe().health;if(e.length>0){var n=Players.getMe().pos;e.sort(function(t,e){var i=t.delta||a.Spatie.calcDiff(n,t.pos),s=e.delta||a.Spatie.calcDiff(n,e.pos);return t.delta=i,e.delta=s,i.distance<s.distance?-1:s.distance<i.distance?1:0});var r=e[0],l=r.delta||a.Spatie.calcDiff(n,r.pos),c=r.exhaust/18,h=this.config.distanceMissileDangerous*c*o;l.distance<h&&(this.state.objectToFleeFromID=r.id)}for(var u=e.map(function(t){return t.id}),d=0;d<u.length;d++)this.state.missileIDs.push(u[d]);if(!this.state.objectToFleeFromID){var p=this.state.victim?this.state.victim.id:null,g=a.Spatie.getHostilePlayersSortedByDistance(p)[0];if(g){l=a.Spatie.getDeltaTo(g),h=o*this.config.distanceTooClose;l.isAccurate&&l.distance<h&&(this.state.objectToFleeFromID=g.id)}}}},t.prototype.detectShouldFlee=function(){this.hasShield()||Players.getMe().health<this.config.fleeHealthThresholdMin&&(this.state.isFleeing=!0)},t.prototype.detectStuckness=function(){if(!this.state.isStuck){var t=Players.getMe(),e=t.speed;if(Math.abs(e.x)<1&&Math.abs(e.y)<1&&t.state.thrustLevel>0){if(this.state.stucknessTimeout?this.state.stucknessTimeout=this.state.stucknessTimeout-this.config.heartbeatInterval:this.state.stucknessTimeout=Date.now()+this.config.stucknessTimeoutMs,this.state.stucknessTimeout<=0){this.state.stucknessTimeout=null,this.state.isStuck=!0;var i=a.Spatie.getRandomNumber(0,250);this.state.stuckTimeStopTurning=Date.now()+this.config.stucknessTurnDurationMs-i,this.state.stuckTimeStopFlying=Date.now()+this.config.stucknessFlyDurationMs+i,this.state.detectedPowerUps&&this.state.detectedPowerUps.length>0&&(this.state.detectedPowerUps=null);var s=Math.atan2(0,-1),o=a.Spatie.getRandomNumber(.3*s*100,.4*s*100)/100,n=a.Spatie.getRandomNumber(0,2);n=0===n?-1:1,this.setDesiredAngle(Players.getMe().rot+n*o)}}else this.state.stucknessTimeout=this.state.stucknessTimeout+this.config.heartbeatInterval,this.state.stucknessTimeout>this.config.stucknessTimeoutMs&&(this.state.stucknessTimeout=null)}},t.prototype.detectVictimPowerUps=function(){this.state.isVictimPoweredUp=!1,this.state.victim&&(this.state.victim.powerups.rampage||this.state.victim.powerups.shield)&&(this.state.isVictimPoweredUp=!0)},t.prototype.fireAtVictim=function(){if(!this.config.holdFire)if(this.config.fireConstantly)this.setFire(!0,null);else{var t=this.state.isFleeing;if(!t)t=Players.getMe().powerups.rampage;if(!t)if(this.state.victim)t=a.Spatie.getDeltaTo(this.state.victim).distance<this.config.distanceNear;var e=1e3;this.state.isFleeing&&(e=200),this.setFire(t,e)}},t.prototype.fleeFrom=function(t){var e=Players.getMe(),i=a.Spatie.calcDiff(e.pos,t.pos);if("WHOMP"===this.config.useSpecial&&e.energy>.4&&i.distance<this.config.distanceMissileDangerous)return this.setWhomp(),void a.Spatie.log("WHOMPING, energy level "+e.energy);var s=Math.atan2(i.diffX,i.diffY),o=Math.atan2(0,-1);s<0&&(s=2*o+s),this.setDesiredAngle(s),this.setFastMovement(!0),this.setSpeedMovement("DOWN")},t.prototype.handleFlee=function(){if(Players.getMe().health>this.config.fleeHealthThresholdMax||this.hasShield())this.state.isFleeing=!1;else{var t=a.Spatie.getHostilePlayersSortedByDistance()[0];if(t)a.Spatie.getDeltaTo(t).distance>2*this.config.distanceFar?this.state.isFleeing=!1:this.fleeFrom(t);else this.state.isFleeing=!1}},t.prototype.handleObjectToFleeFrom=function(){var t=Mobs.get(this.state.objectToFleeFromID);t||(t=Players.get(this.state.objectToFleeFromID)),t&&!this.hasShield()&&this.fleeFrom(t)},t.prototype.handleStuckness=function(){var t=Date.now();t<this.state.stuckTimeStopFlying?this.setSpeedMovement("DOWN"):t>=this.state.stuckTimeStopFlying&&(this.setSpeedMovement(null),this.state.isStuck=!1)},t.prototype.hasRampage=function(){return Players.getMe().powerups.rampage},t.prototype.hasShield=function(){return Players.getMe().powerups.shield},t.prototype.heartbeat=function(){this.state.previous=this.state.name,this.state.isStuck?(this.state.name="stuck",this.handleStuckness()):this.state.objectToFleeFromID?(this.state.name="flee from object",this.detectStuckness(),this.handleObjectToFleeFrom()):this.state.isFleeing?(this.state.name="low health flee",this.detectStuckness(),this.handleFlee()):this.state.detectedPowerUps&&this.state.detectedPowerUps.length>0?(this.state.name="chase mob",this.approachMob(),this.detectStuckness(),this.detectShouldFlee()):this.state.gotoCoords?(this.state.name="go to coords",this.approachCoords(),this.detectStuckness(),this.detectShouldFlee()):(this.state.name="chase victim "+(this.state.victim?this.state.victim.name:"-"),this.detectFlagTaken(),this.victimSelection.reconsiderVictim(),this.turnToVictim(),this.approachVictim(),this.fireAtVictim(),this.detectVictimPowerUps(),this.detectStuckness(),this.detectShouldFlee()),this.state.name!==this.state.previous&&a.Spatie.log(this.state.name),this.applyUpgrades(),this.commandExecutor.executeCommands(),this.detectDangerousObjects()},t.prototype.isOn=function(){return!!this.state},t.prototype.setFire=function(t,e){void 0===e&&(e=null),this.state.isFiring=t,this.state.stopFiringTimeout=e},t.prototype.setDesiredAngle=function(t){isNaN(this.state.desiredAngle)&&(this.state.desiredAngle=t)},t.prototype.setSpeedMovement=function(t){this.state.speedMovement=t},t.prototype.setFastMovement=function(t){this.state.fast=t},t.prototype.setWhomp=function(){this.state.whomp=!0},t.prototype.turnTo=function(t){var e=a.Spatie.getDeltaTo(t),i=Math.atan2(e.diffX,e.diffY),s=Math.atan2(0,-1);i<0&&(i=2*s+i),this.setDesiredAngle(i)},t.prototype.turnToVictim=function(){var t=this.state.victim;t&&this.turnTo(t)},t}();e.SpatieBot=h},function(t,e,i){"use strict";var s=this&&this.__assign||function(){return(s=Object.assign||function(t){for(var e,i=1,s=arguments.length;i<s;i++)for(var a in e=arguments[i])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0});var a=function(){return function(){}}();e.BotConfig=a;var o=function(){function t(){this.normalBotConfig={applyUpgradesTo:4,bondingTimes:0,distanceFar:600,distanceNear:450,distanceClose:300,distanceTooClose:200,distanceMissileDangerous:300,fleeHealthThresholdMin:.3,fleeHealthThresholdMax:.7,fireConstantly:!1,goForUpgrades:!0,heartbeatInterval:75,holdFire:!1,name:"normal",precision:.1,throttleInterval:150,respawnTimeout:4e3,stucknessTurnDurationMs:500,stucknessFlyDurationMs:2e3,stucknessTimeoutMs:1500,useSpecial:"SPEED",useStealth:!1,victimExpireMs:12e4},this.peacefulBotConfig=s({},this.normalBotConfig,{applyUpgradesTo:2,distanceFar:1200,distanceNear:850,distanceClose:600,distanceTooClose:400,fleeHealthThresholdMin:.5,fleeHealthThresholdMax:.9,goForUpgrades:!0,holdFire:!0,name:"peaceful",precision:.3}),this.agressiveBotConfig=s({},this.normalBotConfig,{applyUpgradesTo:4,distanceTooClose:50,distanceMissileDangerous:50,fireConstantly:!0,fleeHealthThresholdMin:.2,fleeHealthThresholdMax:.5,name:"agressive",precision:.15,stucknessTimeoutMs:1e3}),this.copterBotConfig=s({},this.normalBotConfig,{applyUpgradesTo:2,distanceTooClose:400,distanceMissileDangerous:400,fireConstantly:!0,fleeHealthThresholdMin:.5,fleeHealthThresholdMax:.9,name:"copter",useSpecial:null}),this.tornadoBotConfig=s({},this.normalBotConfig,{applyUpgradesTo:1,distanceTooClose:100,distanceMissileDangerous:200,fleeHealthThresholdMin:.5,fleeHealthThresholdMax:.9,name:"tornado",useSpecial:"FIRE"}),this.prowlerBotConfig=s({},this.normalBotConfig,{distanceNear:300,distanceClose:200,distanceTooClose:50,distanceMissileDangerous:200,name:"prowler",useStealth:!0,useSpecial:"STEALTH"}),this.goliathBotConfig=s({},this.normalBotConfig,{applyUpgradesTo:1,distanceNear:500,distanceClose:300,distanceTooClose:150,distanceMissileDangerous:280,fleeHealthThresholdMin:.2,fleeHealthThresholdMax:.4,name:"goliath",useSpecial:"WHOMP"})}return t.prototype.getConfigByName=function(t){var e=this.normalBotConfig;switch(t){case"peaceful":e=this.peacefulBotConfig;break;case"agressive":e=this.agressiveBotConfig;break;case"copter":e=this.copterBotConfig;break;case"tornado":e=this.tornadoBotConfig;break;case"prowler":e=this.prowlerBotConfig;break;case"goliath":e=this.goliathBotConfig}return e},t.prototype.getConfigByAircraftType=function(t){switch(t){case 1:return this.agressiveBotConfig;case 2:return this.goliathBotConfig;case 3:return this.copterBotConfig;case 4:return this.tornadoBotConfig;case 5:return this.prowlerBotConfig;default:return this.normalBotConfig}},t}();e.BotConfigFactory=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){return function(){}}();e.SpatiebotState=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(0),a=function(){function t(t,e){this.state=t,this.config=e}return t.prototype.clearCommands=function(){Network.sendKey("LEFT",!1),Network.sendKey("RIGHT",!1),Network.sendKey("UP",!1),Network.sendKey("DOWN",!1),Network.sendKey("FIRE",!1),Network.sendKey("SPECIAL",!1)},t.prototype.executeCommands=function(){var t,e,i=this,a=this.state.lastDesiredAngle!==this.state.desiredAngle,o=this.state.previousSpeedMovement!==this.state.speedMovement,n=!this.state.nextMovementExec||Date.now()>this.state.nextMovementExec,r=this.state.previousIsFiring!==this.state.isFiring;if("WHOMP"===this.config.useSpecial&&(t=this.state.previousWhomp!==this.state.whomp),"SPEED"===this.config.useSpecial&&(e=this.state.previousFast!==this.state.fast),n||a||o||e||r||t){if(o&&(this.state.previousSpeedMovement&&Network.sendKey(this.state.previousSpeedMovement,!1),this.state.previousSpeedMovement=this.state.speedMovement),a&&(this.state.lastDesiredAngle=this.state.desiredAngle),e&&(this.state.previousFast=this.state.fast),r&&(this.state.previousIsFiring=this.state.isFiring),isNaN(this.state.desiredAngle)||!a&&!n||AutoPilot.rotateTo(this.state.desiredAngle,Players.getMe(),0,function(){return i.state.desiredAngle=void 0}),this.state.speedMovement&&(o||n)&&Network.sendKey(this.state.speedMovement,!0),"SPEED"===this.config.useSpecial&&(e||n)&&(this.state.fast?this.state.fastTimeout||(Network.sendKey("SPECIAL",!0),this.state.fastTimeout=setTimeout(function(){Network.sendKey("SPECIAL",!1),i.state.fastTimeout=null},1e3)):Network.sendKey("SPECIAL",!1)),r||n){var l="FIRE";if("FIRE"===this.config.useSpecial&&(l="SPECIAL"),this.state.isFiring){if(!this.state.fireTimeout&&(Network.sendKey(l,!0),!this.config.fireConstantly)){var c=this.state.stopFiringTimeout||1e3;this.state.fireTimeout=setTimeout(function(){Network.sendKey(l,!1),i.state.fireTimeout=null},c)}}else Network.sendKey(l,!1)}var h=!1;this.config.useStealth&&"STEALTH"===this.config.useSpecial&&!Players.getMe().stealthed&&(h=!0),t&&(h=!0,this.state.whomp=!1,this.state.previousWhomp=!1),h&&(s.Spatie.log("Sending special"),Network.sendKey("SPECIAL",!0),setTimeout(function(){return Network.sendKey("SPECIAL",!1)},100)),this.state.nextMovementExec=Date.now()+this.config.throttleInterval}},t}();e.SpatiebotCommandExecutor=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(0),a=function(){function t(t,e){this.state=t,this.config=e}return t.prototype.reconsiderVictim=function(){var t=this.state.victim,e=this.getBestVictim();e=e||this.chooseNextVictim(),this.isSamePlayer(t,e)&&(t&&s.Spatie.log("Dropped victim "+t.name),e&&(s.Spatie.log("Chose new victim "+e.name),this.state.lastTimeVictimWasChosen=Date.now()),e&&this.state.hasLockOnTarget===e.id||(this.state.hasLockOnTarget=null)),this.state.previousVictimID=e?e.id:null,e||(this.config.bondingTimes=0),this.state.victim=e?Players.get(e.id):null},t.prototype.isSamePlayer=function(t,e){return!(t&&!e||!t&&e)&&(!t&&!e||t.id===e.id)},t.prototype.getBestVictim=function(){if(this.targetFlagCarrier())return Players.get(this.state.flagCarrierID);var t=this.takeOverSuggestion();if(t)return t;var e=this.state.victim;if(e&&this.isVictimValid(e)){if(this.state.hasLockOnTarget===e.id)return e;var i=this.findVictimCloserByThan(e);return i||e}return null},t.prototype.findVictimCloserByThan=function(t){var e=s.Spatie.getHostilePlayersSortedByDistance()[0];if(e.id!==t.id){var i=s.Spatie.getDeltaTo(t),a=s.Spatie.getDeltaTo(e),o=void 0;if(!a.isAccurate||i.distance<this.config.distanceClose?o=!1:a.isAccurate&&!i.isAccurate?o=!0:a.distance/i.distance<.5&&(o=!0),o)return e}return null},t.prototype.isVictimValid=function(t){var e,i=Date.now()-this.state.lastTimeVictimWasChosen,s=!!Players.get(t.id),a=t.removedFromMap,o=5===t.type,n=!!/^test.*/.exec(t.name)||this.config.bondingTimes>0&&!!/^.+Bot.*/.exec(t.name);return this.state.lastTimeVictimWasChosen&&(e=i>this.config.victimExpireMs),!(!s||o||a||e||n)},t.prototype.chooseNextVictim=function(){return s.Spatie.getHostilePlayersSortedByDistance(this.state.previousVictimID)[0]},t.prototype.targetFlagCarrier=function(){return this.state.flagCarrierID?Players.get(this.state.flagCarrierID):null},t.prototype.takeOverSuggestion=function(){if(!this.state.suggestedVictimID)return null;var t,e=Players.get(this.state.suggestedVictimID);if(!e)return null;0===s.Spatie.getRandomNumber(0,4)&&this.state.suggestingPlayerID!==game.myID?t=Players.get(this.state.suggestingPlayerID):t=e;return t&&s.Spatie.announce("ok, lock on target: "+t.name),this.state.suggestedVictimID=null,this.state.suggestingPlayerID=null,this.state.hasLockOnTarget=t.id,t},t}();e.SpatiebotVictimSelection=a}]);