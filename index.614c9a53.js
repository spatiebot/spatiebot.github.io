function e(e){return e&&e.__esModule?e.default:e}var t,s,n,i,a,r,o,l,c,h,u,d,g,p,E,y,f=globalThis,m={},A={},U=f.parcelRequire94c2;null==U&&((U=function(e){if(e in m)return m[e].exports;if(e in A){var t=A[e];delete A[e];var s={id:e,exports:{}};return m[e]=s,t.call(s.exports,s,s.exports),s.exports}var n=Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(e,t){A[e]=t},f.parcelRequire94c2=U);var R=U.register;R("7we3r",function(e,t){var s=U("gKvUL"),n=U("jJbMR"),i=U("ewFRw"),a=U("lk5EI"),r=function e(t){var r=new i(t),o=n(i.prototype.request,r);return s.extend(o,i.prototype,r),s.extend(o,r),o.create=function(s){return e(a(t,s))},o}(U("lJY4v"));r.Axios=i,r.Cancel=U("4Tkeq"),r.CancelToken=U("lAKPy"),r.isCancel=U("7L4QX"),r.VERSION=U("35BUy").version,r.all=function(e){return Promise.all(e)},r.spread=U("JEeti"),r.isAxiosError=U("dxy9O"),e.exports=r,e.exports.default=r}),R("gKvUL",function(e,t){var s=U("jJbMR"),n=Object.prototype.toString;function i(e){return Array.isArray(e)}function a(e){return void 0===e}function r(e){return"[object ArrayBuffer]"===n.call(e)}function o(e){return null!==e&&"object"==typeof e}function l(e){if("[object Object]"!==n.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function c(e){return"[object Function]"===n.call(e)}function h(e,t){if(null!=e){if("object"!=typeof e&&(e=[e]),i(e))for(var s=0,n=e.length;s<n;s++)t.call(null,e[s],s,e);else for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.call(null,e[a],a,e)}}e.exports={isArray:i,isArrayBuffer:r,isBuffer:function(e){return null!==e&&!a(e)&&null!==e.constructor&&!a(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"[object FormData]"===n.call(e)},isArrayBufferView:function(e){var t;return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&r(e.buffer)},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:o,isPlainObject:l,isUndefined:a,isDate:function(e){return"[object Date]"===n.call(e)},isFile:function(e){return"[object File]"===n.call(e)},isBlob:function(e){return"[object Blob]"===n.call(e)},isFunction:c,isStream:function(e){return o(e)&&c(e.pipe)},isURLSearchParams:function(e){return"[object URLSearchParams]"===n.call(e)},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:h,merge:function e(){var t={};function s(s,n){l(t[n])&&l(s)?t[n]=e(t[n],s):l(s)?t[n]=e({},s):i(s)?t[n]=s.slice():t[n]=s}for(var n=0,a=arguments.length;n<a;n++)h(arguments[n],s);return t},extend:function(e,t,n){return h(t,function(t,i){n&&"function"==typeof t?e[i]=s(t,n):e[i]=t}),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}}}),R("jJbMR",function(e,t){e.exports=function(e,t){return function(){for(var s=Array(arguments.length),n=0;n<s.length;n++)s[n]=arguments[n];return e.apply(t,s)}}}),R("ewFRw",function(e,t){var s=U("gKvUL"),n=U("cbIsf"),i=U("83RYu"),a=U("dlZEJ"),r=U("lk5EI"),o=U("bv3QM"),l=o.validators;function c(e){this.defaults=e,this.interceptors={request:new i,response:new i}}c.prototype.request=function(e,t){if("string"==typeof e?(t=t||{}).url=e:t=e||{},!t.url)throw Error("Provided config url is not valid");(t=r(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var s,n=t.transitional;void 0!==n&&o.assertOptions(n,{silentJSONParsing:l.transitional(l.boolean),forcedJSONParsing:l.transitional(l.boolean),clarifyTimeoutError:l.transitional(l.boolean)},!1);var i=[],c=!0;this.interceptors.request.forEach(function(e){("function"!=typeof e.runWhen||!1!==e.runWhen(t))&&(c=c&&e.synchronous,i.unshift(e.fulfilled,e.rejected))});var h=[];if(this.interceptors.response.forEach(function(e){h.push(e.fulfilled,e.rejected)}),!c){var u=[a,void 0];for(Array.prototype.unshift.apply(u,i),u=u.concat(h),s=Promise.resolve(t);u.length;)s=s.then(u.shift(),u.shift());return s}for(var d=t;i.length;){var g=i.shift(),p=i.shift();try{d=g(d)}catch(e){p(e);break}}try{s=a(d)}catch(e){return Promise.reject(e)}for(;h.length;)s=s.then(h.shift(),h.shift());return s},c.prototype.getUri=function(e){if(!e.url)throw Error("Provided config url is not valid");return n((e=r(this.defaults,e)).url,e.params,e.paramsSerializer).replace(/^\?/,"")},s.forEach(["delete","get","head","options"],function(e){c.prototype[e]=function(t,s){return this.request(r(s||{},{method:e,url:t,data:(s||{}).data}))}}),s.forEach(["post","put","patch"],function(e){c.prototype[e]=function(t,s,n){return this.request(r(n||{},{method:e,url:t,data:s}))}}),e.exports=c}),R("cbIsf",function(e,t){var s=U("gKvUL");function n(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,i){if(!t)return e;if(i)a=i(t);else if(s.isURLSearchParams(t))a=t.toString();else{var a,r=[];s.forEach(t,function(e,t){null!=e&&(s.isArray(e)?t+="[]":e=[e],s.forEach(e,function(e){s.isDate(e)?e=e.toISOString():s.isObject(e)&&(e=JSON.stringify(e)),r.push(n(t)+"="+n(e))}))}),a=r.join("&")}if(a){var o=e.indexOf("#");-1!==o&&(e=e.slice(0,o)),e+=(-1===e.indexOf("?")?"?":"&")+a}return e}}),R("83RYu",function(e,t){var s=U("gKvUL");function n(){this.handlers=[]}n.prototype.use=function(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1},n.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},n.prototype.forEach=function(e){s.forEach(this.handlers,function(t){null!==t&&e(t)})},e.exports=n}),R("dlZEJ",function(e,t){var s=U("gKvUL"),n=U("7YJ0v"),i=U("7L4QX"),a=U("lJY4v"),r=U("4Tkeq");function o(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new r("canceled")}e.exports=function(e){return o(e),e.headers=e.headers||{},e.data=n.call(e,e.data,e.headers,e.transformRequest),e.headers=s.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),s.forEach(["delete","get","head","post","put","patch","common"],function(t){delete e.headers[t]}),(e.adapter||a.adapter)(e).then(function(t){return o(e),t.data=n.call(e,t.data,t.headers,e.transformResponse),t},function(t){return!i(t)&&(o(e),t&&t.response&&(t.response.data=n.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})}}),R("7YJ0v",function(e,t){var s=U("gKvUL"),n=U("lJY4v");e.exports=function(e,t,i){var a=this||n;return s.forEach(i,function(s){e=s.call(a,e,t)}),e}}),R("lJY4v",function(e,t){var s,n=U("hPtJY"),i=U("gKvUL"),a=U("kiL6T"),r=U("8v8A7"),o={"Content-Type":"application/x-www-form-urlencoded"};function l(e,t){!i.isUndefined(e)&&i.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var c={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:("undefined"!=typeof XMLHttpRequest?s=U("at5cb"):void 0!==n&&"[object process]"===Object.prototype.toString.call(n)&&(s=U("at5cb")),s),transformRequest:[function(e,t){return(a(t,"Accept"),a(t,"Content-Type"),i.isFormData(e)||i.isArrayBuffer(e)||i.isBuffer(e)||i.isStream(e)||i.isFile(e)||i.isBlob(e))?e:i.isArrayBufferView(e)?e.buffer:i.isURLSearchParams(e)?(l(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):i.isObject(e)||t&&"application/json"===t["Content-Type"]?(l(t,"application/json"),function(e,t,s){if(i.isString(e))try{return(0,JSON.parse)(e),i.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(0,JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional||c.transitional,s=t&&t.silentJSONParsing,n=t&&t.forcedJSONParsing,a=!s&&"json"===this.responseType;if(a||n&&i.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(a){if("SyntaxError"===e.name)throw r(e,this,"E_JSON_PARSE");throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};i.forEach(["delete","get","head"],function(e){c.headers[e]={}}),i.forEach(["post","put","patch"],function(e){c.headers[e]=i.merge(o)}),e.exports=c}),R("hPtJY",function(e,t){var s,n,i,a=e.exports={};function r(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function l(e){if(s===setTimeout)return setTimeout(e,0);if((s===r||!s)&&setTimeout)return s=setTimeout,setTimeout(e,0);try{return s(e,0)}catch(t){try{return s.call(null,e,0)}catch(t){return s.call(this,e,0)}}}!function(){try{s="function"==typeof setTimeout?setTimeout:r}catch(e){s=r}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var c=[],h=!1,u=-1;function d(){h&&i&&(h=!1,i.length?c=i.concat(c):u=-1,c.length&&g())}function g(){if(!h){var e=l(d);h=!0;for(var t=c.length;t;){for(i=c,c=[];++u<t;)i&&i[u].run();u=-1,t=c.length}i=null,h=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function E(){}a.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var s=1;s<arguments.length;s++)t[s-1]=arguments[s];c.push(new p(e,t)),1!==c.length||h||l(g)},p.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=E,a.addListener=E,a.once=E,a.off=E,a.removeListener=E,a.removeAllListeners=E,a.emit=E,a.prependListener=E,a.prependOnceListener=E,a.listeners=function(e){return[]},a.binding=function(e){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}),R("kiL6T",function(e,t){var s=U("gKvUL");e.exports=function(e,t){s.forEach(e,function(s,n){n!==t&&n.toUpperCase()===t.toUpperCase()&&(e[t]=s,delete e[n])})}}),R("8v8A7",function(e,t){e.exports=function(e,t,s,n,i){return e.config=t,s&&(e.code=s),e.request=n,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},e}}),R("at5cb",function(e,t){var s=U("gKvUL"),n=U("kk0E9"),i=U("8JRzs"),a=U("cbIsf"),r=U("7GD7a"),o=U("lDriZ"),l=U("889er"),c=U("kjF3e"),h=U("lJY4v"),u=U("4Tkeq");e.exports=function(e){return new Promise(function(t,d){var g,p=e.data,E=e.headers,y=e.responseType;function f(){e.cancelToken&&e.cancelToken.unsubscribe(g),e.signal&&e.signal.removeEventListener("abort",g)}s.isFormData(p)&&delete E["Content-Type"];var m=new XMLHttpRequest;if(e.auth){var A=e.auth.username||"",U=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";E.Authorization="Basic "+btoa(A+":"+U)}var R=r(e.baseURL,e.url);function T(){if(m){var s="getAllResponseHeaders"in m?o(m.getAllResponseHeaders()):null;n(function(e){t(e),f()},function(e){d(e),f()},{data:y&&"text"!==y&&"json"!==y?m.response:m.responseText,status:m.status,statusText:m.statusText,headers:s,config:e,request:m}),m=null}}if(m.open(e.method.toUpperCase(),a(R,e.params,e.paramsSerializer),!0),m.timeout=e.timeout,"onloadend"in m?m.onloadend=T:m.onreadystatechange=function(){m&&4===m.readyState&&(0!==m.status||m.responseURL&&0===m.responseURL.indexOf("file:"))&&setTimeout(T)},m.onabort=function(){m&&(d(c("Request aborted",e,"ECONNABORTED",m)),m=null)},m.onerror=function(){d(c("Network Error",e,null,m)),m=null},m.ontimeout=function(){var t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",s=e.transitional||h.transitional;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),d(c(t,e,s.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",m)),m=null},s.isStandardBrowserEnv()){var w=(e.withCredentials||l(R))&&e.xsrfCookieName?i.read(e.xsrfCookieName):void 0;w&&(E[e.xsrfHeaderName]=w)}"setRequestHeader"in m&&s.forEach(E,function(e,t){void 0===p&&"content-type"===t.toLowerCase()?delete E[t]:m.setRequestHeader(t,e)}),s.isUndefined(e.withCredentials)||(m.withCredentials=!!e.withCredentials),y&&"json"!==y&&(m.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&m.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&m.upload&&m.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(g=function(e){m&&(d(!e||e&&e.type?new u("canceled"):e),m.abort(),m=null)},e.cancelToken&&e.cancelToken.subscribe(g),e.signal&&(e.signal.aborted?g():e.signal.addEventListener("abort",g))),p||(p=null),m.send(p)})}}),R("kk0E9",function(e,t){var s=U("kjF3e");e.exports=function(e,t,n){var i=n.config.validateStatus;!n.status||!i||i(n.status)?e(n):t(s("Request failed with status code "+n.status,n.config,null,n.request,n))}}),R("kjF3e",function(e,t){var s=U("8v8A7");e.exports=function(e,t,n,i,a){return s(Error(e),t,n,i,a)}}),R("8JRzs",function(e,t){var s=U("gKvUL");e.exports=s.isStandardBrowserEnv()?{write:function(e,t,n,i,a,r){var o=[];o.push(e+"="+encodeURIComponent(t)),s.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),s.isString(i)&&o.push("path="+i),s.isString(a)&&o.push("domain="+a),!0===r&&o.push("secure"),document.cookie=o.join("; ")},read:function(e){var t=document.cookie.match(RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}}),R("7GD7a",function(e,t){var s=U("ckHwb"),n=U("fE4ul");e.exports=function(e,t){return e&&!s(t)?n(e,t):t}}),R("ckHwb",function(e,t){e.exports=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}}),R("fE4ul",function(e,t){e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}}),R("lDriZ",function(e,t){var s=U("gKvUL"),n=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,i,a,r={};return e&&s.forEach(e.split("\n"),function(e){a=e.indexOf(":"),t=s.trim(e.substr(0,a)).toLowerCase(),i=s.trim(e.substr(a+1)),t&&!(r[t]&&n.indexOf(t)>=0)&&("set-cookie"===t?r[t]=(r[t]?r[t]:[]).concat([i]):r[t]=r[t]?r[t]+", "+i:i)}),r}}),R("889er",function(e,t){var s=U("gKvUL");e.exports=s.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function i(e){var s=e;return t&&(n.setAttribute("href",s),s=n.href),n.setAttribute("href",s),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=i(window.location.href),function(t){var n=s.isString(t)?i(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0}}),R("4Tkeq",function(e,t){function s(e){this.message=e}s.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},s.prototype.__CANCEL__=!0,e.exports=s}),R("7L4QX",function(e,t){e.exports=function(e){return!!(e&&e.__CANCEL__)}}),R("lk5EI",function(e,t){var s=U("gKvUL");e.exports=function(e,t){t=t||{};var n={};function i(e,t){return s.isPlainObject(e)&&s.isPlainObject(t)?s.merge(e,t):s.isPlainObject(t)?s.merge({},t):s.isArray(t)?t.slice():t}function a(n){return s.isUndefined(t[n])?s.isUndefined(e[n])?void 0:i(void 0,e[n]):i(e[n],t[n])}function r(e){if(!s.isUndefined(t[e]))return i(void 0,t[e])}function o(n){return s.isUndefined(t[n])?s.isUndefined(e[n])?void 0:i(void 0,e[n]):i(void 0,t[n])}function l(s){return s in t?i(e[s],t[s]):s in e?i(void 0,e[s]):void 0}var c={url:r,method:r,data:r,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:l};return s.forEach(Object.keys(e).concat(Object.keys(t)),function(e){var t=c[e]||a,i=t(e);s.isUndefined(i)&&t!==l||(n[e]=i)}),n}}),R("bv3QM",function(e,t){var s=U("35BUy").version,n={};["object","boolean","number","function","string","symbol"].forEach(function(e,t){n[e]=function(s){return typeof s===e||"a"+(t<1?"n ":" ")+e}});var i={};n.transitional=function(e,t,n){function a(e,t){return"[Axios v"+s+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return function(s,n,r){if(!1===e)throw Error(a(n," has been removed"+(t?" in "+t:"")));return t&&!i[n]&&(i[n]=!0,console.warn(a(n," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(s,n,r)}},e.exports={assertOptions:function(e,t,s){if("object"!=typeof e)throw TypeError("options must be an object");for(var n=Object.keys(e),i=n.length;i-- >0;){var a=n[i],r=t[a];if(r){var o=e[a],l=void 0===o||r(o,a,e);if(!0!==l)throw TypeError("option "+a+" must be "+l);continue}if(!0!==s)throw Error("Unknown option "+a)}},validators:n}}),R("35BUy",function(e,t){e.exports={version:"0.25.0"}}),R("lAKPy",function(e,t){var s=U("4Tkeq");function n(e){if("function"!=typeof e)throw TypeError("executor must be a function.");this.promise=new Promise(function(e){t=e});var t,n=this;this.promise.then(function(e){if(n._listeners){var t,s=n._listeners.length;for(t=0;t<s;t++)n._listeners[t](e);n._listeners=null}}),this.promise.then=function(e){var t,s=new Promise(function(e){n.subscribe(e),t=e}).then(e);return s.cancel=function(){n.unsubscribe(t)},s},e(function(e){n.reason||(n.reason=new s(e),t(n.reason))})}n.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},n.prototype.subscribe=function(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]},n.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},n.source=function(){var e;return{token:new n(function(t){e=t}),cancel:e}},e.exports=n}),R("JEeti",function(e,t){e.exports=function(e){return function(t){return e.apply(null,t)}}}),R("dxy9O",function(e,t){var s=U("gKvUL");e.exports=function(e){return s.isObject(e)&&!0===e.isAxiosError}});class T{constructor(e=""){this.name=this.constructor.name,this.message=e}}class w extends T{}class x extends T{}var I={LOGIN:0,BACKUP:1,HORIZON:2,ACK:5,PONG:6,KEY:10,COMMAND:11,SCOREDETAILED:12,CHAT:20,WHISPER:21,SAY:22,TEAMCHAT:23,VOTEMUTE:24,LOCALPING:255},S={LOGIN:0,BACKUP:1,PING:5,PING_RESULT:6,ACK:7,ERROR:8,COMMAND_REPLY:9,PLAYER_NEW:10,PLAYER_LEAVE:11,PLAYER_UPDATE:12,PLAYER_FIRE:13,PLAYER_HIT:14,PLAYER_RESPAWN:15,PLAYER_FLAG:16,PLAYER_KILL:17,PLAYER_UPGRADE:18,PLAYER_TYPE:19,PLAYER_POWERUP:20,PLAYER_LEVEL:21,PLAYER_RETEAM:22,GAME_FLAG:30,GAME_SPECTATE:31,GAME_PLAYERSALIVE:32,GAME_FIREWALL:33,EVENT_REPEL:40,EVENT_BOOST:41,EVENT_BOUNCE:42,EVENT_STEALTH:43,EVENT_LEAVEHORIZON:44,MOB_UPDATE:60,MOB_UPDATE_STATIONARY:61,MOB_DESPAWN:62,MOB_DESPAWN_COORDS:63,CHAT_PUBLIC:70,CHAT_TEAM:71,CHAT_SAY:72,CHAT_WHISPER:73,CHAT_VOTEMUTEPASSED:78,CHAT_VOTEMUTED:79,SCORE_UPDATE:80,SCORE_BOARD:81,SCORE_DETAILED:82,SCORE_DETAILED_CTF:83,SCORE_DETAILED_BTR:84,SERVER_MESSAGE:90,SERVER_CUSTOM:91},P=((t={})[t.text=1]="text",t[t.textbig=2]="textbig",t[t.arraysmall=4]="arraysmall",t[t.array=3]="array",t[t.uint8=5]="uint8",t[t.uint16=6]="uint16",t[t.uint24=7]="uint24",t[t.uint32=8]="uint32",t[t.float32=9]="float32",t[t.float64=10]="float64",t[t.boolean=11]="boolean",t[t.speed=12]="speed",t[t.accel=13]="accel",t[t.coordx=14]="coordx",t[t.coordy=15]="coordy",t[t.coord24=16]="coord24",t[t.rotation=17]="rotation",t[t.healthenergy=18]="healthenergy",t[t.regen=19]="regen",t),L={[I.LOGIN]:[["protocol",P.uint8],["name",P.text],["session",P.text],["horizonX",P.uint16],["horizonY",P.uint16],["flag",P.text]],[I.BACKUP]:[["token",P.text]],[I.HORIZON]:[["horizonX",P.uint16],["horizonY",P.uint16]],[I.ACK]:[],[I.PONG]:[["num",P.uint32]],[I.KEY]:[["seq",P.uint32],["key",P.uint8],["state",P.boolean]],[I.COMMAND]:[["com",P.text],["data",P.text]],[I.SCOREDETAILED]:[],[I.CHAT]:[["text",P.text]],[I.WHISPER]:[["id",P.uint16],["text",P.text]],[I.SAY]:[["text",P.text]],[I.TEAMCHAT]:[["text",P.text]],[I.VOTEMUTE]:[["id",P.uint16]],[I.LOCALPING]:[["auth",P.uint32]]},_={[S.LOGIN]:[["success",P.boolean],["id",P.uint16],["team",P.uint16],["clock",P.uint32],["token",P.text],["type",P.uint8],["room",P.text],["players",P.array,[["id",P.uint16],["status",P.uint8],["level",P.uint8],["name",P.text],["type",P.uint8],["team",P.uint16],["posX",P.coordx],["posY",P.coordy],["rot",P.rotation],["flag",P.uint16],["upgrades",P.uint8]]],["serverConfiguration",P.textbig],["bots",P.array,[["id",P.uint16]]]],[S.BACKUP]:[],[S.PING]:[["clock",P.uint32],["num",P.uint32]],[S.PING_RESULT]:[["ping",P.uint16],["playerstotal",P.uint32],["playersgame",P.uint32]],[S.ACK]:[],[S.ERROR]:[["error",P.uint8]],[S.COMMAND_REPLY]:[["type",P.uint8],["text",P.textbig]],[S.PLAYER_NEW]:[["id",P.uint16],["status",P.uint8],["name",P.text],["type",P.uint8],["team",P.uint16],["posX",P.coordx],["posY",P.coordy],["rot",P.rotation],["flag",P.uint16],["upgrades",P.uint8],["isBot",P.boolean]],[S.PLAYER_LEAVE]:[["id",P.uint16]],[S.PLAYER_UPDATE]:[["clock",P.uint32],["id",P.uint16],["keystate",P.uint8],["upgrades",P.uint8],["posX",P.coord24],["posY",P.coord24],["rot",P.rotation],["speedX",P.speed],["speedY",P.speed]],[S.PLAYER_FIRE]:[["clock",P.uint32],["id",P.uint16],["energy",P.healthenergy],["energyRegen",P.regen],["projectiles",P.arraysmall,[["id",P.uint16],["type",P.uint8],["posX",P.coordx],["posY",P.coordy],["speedX",P.speed],["speedY",P.speed],["accelX",P.accel],["accelY",P.accel],["maxSpeed",P.speed]]]],[S.PLAYER_RESPAWN]:[["id",P.uint16],["posX",P.coord24],["posY",P.coord24],["rot",P.rotation],["upgrades",P.uint8]],[S.PLAYER_FLAG]:[["id",P.uint16],["flag",P.uint16]],[S.PLAYER_HIT]:[["id",P.uint16],["type",P.uint8],["posX",P.coordx],["posY",P.coordy],["owner",P.uint16],["players",P.arraysmall,[["id",P.uint16],["health",P.healthenergy],["healthRegen",P.regen]]]],[S.PLAYER_KILL]:[["id",P.uint16],["killer",P.uint16],["posX",P.coordx],["posY",P.coordy]],[S.PLAYER_UPGRADE]:[["upgrades",P.uint16],["type",P.uint8],["speed",P.uint8],["defense",P.uint8],["energy",P.uint8],["missile",P.uint8]],[S.PLAYER_TYPE]:[["id",P.uint16],["type",P.uint8]],[S.PLAYER_POWERUP]:[["type",P.uint8],["duration",P.uint32]],[S.PLAYER_LEVEL]:[["id",P.uint16],["type",P.uint8],["level",P.uint8]],[S.PLAYER_RETEAM]:[["players",P.array,[["id",P.uint16],["team",P.uint16]]]],[S.GAME_FLAG]:[["type",P.uint8],["flag",P.uint8],["id",P.uint16],["posX",P.coord24],["posY",P.coord24],["blueteam",P.uint8],["redteam",P.uint8]],[S.GAME_SPECTATE]:[["id",P.uint16]],[S.GAME_PLAYERSALIVE]:[["players",P.uint16]],[S.GAME_FIREWALL]:[["type",P.uint8],["status",P.uint8],["posX",P.coordx],["posY",P.coordy],["radius",P.float32],["speed",P.float32]],[S.EVENT_REPEL]:[["clock",P.uint32],["id",P.uint16],["posX",P.coordx],["posY",P.coordy],["rot",P.rotation],["speedX",P.speed],["speedY",P.speed],["energy",P.healthenergy],["energyRegen",P.regen],["players",P.arraysmall,[["id",P.uint16],["keystate",P.uint8],["posX",P.coordx],["posY",P.coordy],["rot",P.rotation],["speedX",P.speed],["speedY",P.speed],["energy",P.healthenergy],["energyRegen",P.regen],["playerHealth",P.healthenergy],["playerHealthRegen",P.regen]]],["mobs",P.arraysmall,[["id",P.uint16],["type",P.uint8],["posX",P.coordx],["posY",P.coordy],["speedX",P.speed],["speedY",P.speed],["accelX",P.accel],["accelY",P.accel],["maxSpeed",P.speed]]]],[S.EVENT_BOOST]:[["clock",P.uint32],["id",P.uint16],["boost",P.boolean],["posX",P.coord24],["posY",P.coord24],["rot",P.rotation],["speedX",P.speed],["speedY",P.speed],["energy",P.healthenergy],["energyRegen",P.regen]],[S.EVENT_BOUNCE]:[["clock",P.uint32],["id",P.uint16],["keystate",P.uint8],["posX",P.coord24],["posY",P.coord24],["rot",P.rotation],["speedX",P.speed],["speedY",P.speed]],[S.EVENT_STEALTH]:[["id",P.uint16],["state",P.boolean],["energy",P.healthenergy],["energyRegen",P.regen]],[S.EVENT_LEAVEHORIZON]:[["type",P.uint8],["id",P.uint16]],[S.MOB_UPDATE]:[["clock",P.uint32],["id",P.uint16],["type",P.uint8],["posX",P.coordx],["posY",P.coordy],["speedX",P.speed],["speedY",P.speed],["accelX",P.accel],["accelY",P.accel],["maxSpeed",P.speed]],[S.MOB_UPDATE_STATIONARY]:[["id",P.uint16],["type",P.uint8],["posX",P.float32],["posY",P.float32]],[S.MOB_DESPAWN]:[["id",P.uint16],["type",P.uint8]],[S.MOB_DESPAWN_COORDS]:[["id",P.uint16],["type",P.uint8],["posX",P.coordx],["posY",P.coordy]],[S.SCORE_UPDATE]:[["id",P.uint16],["score",P.uint32],["earnings",P.uint32],["upgrades",P.uint16],["totalkills",P.uint32],["totaldeaths",P.uint32]],[S.SCORE_BOARD]:[["data",P.array,[["id",P.uint16],["score",P.uint32],["level",P.uint8]]],["rankings",P.array,[["id",P.uint16],["x",P.uint8],["y",P.uint8]]]],[S.SCORE_DETAILED]:[["scores",P.array,[["id",P.uint16],["level",P.uint8],["score",P.uint32],["kills",P.uint16],["deaths",P.uint16],["damage",P.float32],["ping",P.uint16]]]],[S.SCORE_DETAILED_CTF]:[["scores",P.array,[["id",P.uint16],["level",P.uint8],["captures",P.uint16],["score",P.uint32],["kills",P.uint16],["deaths",P.uint16],["damage",P.float32],["ping",P.uint16]]]],[S.SCORE_DETAILED_BTR]:[["scores",P.array,[["id",P.uint16],["level",P.uint8],["alive",P.boolean],["wins",P.uint16],["score",P.uint32],["kills",P.uint16],["deaths",P.uint16],["damage",P.float32],["ping",P.uint16]]]],[S.CHAT_TEAM]:[["id",P.uint16],["text",P.text]],[S.CHAT_PUBLIC]:[["id",P.uint16],["text",P.text]],[S.CHAT_SAY]:[["id",P.uint16],["text",P.text]],[S.CHAT_WHISPER]:[["from",P.uint16],["to",P.uint16],["text",P.text]],[S.CHAT_VOTEMUTEPASSED]:[["id",P.uint16]],[S.CHAT_VOTEMUTED]:[],[S.SERVER_MESSAGE]:[["type",P.uint8],["duration",P.uint32],["text",P.textbig]],[S.SERVER_CUSTOM]:[["type",P.uint8],["data",P.textbig]]};const O=e=>{let t=0,s=new Uint8Array(4*e.length);for(let n=0;n!==e.length;n+=1){let i=e.charCodeAt(n);if(i<128){s[t++]=i;continue}if(i<2048)s[t++]=i>>6|192;else{if(i>55295&&i<56320){if(++n>=e.length)throw new w("UTF-8 encode: incomplete surrogate pair");let a=e.charCodeAt(n);if(a<56320||a>57343)throw new w(`UTF-8 encode: second surrogate character 0x${a.toString(16)} at index ${n} out of range`);i=65536+((1023&i)<<10)+(1023&a),s[t++]=i>>18|240,s[t++]=i>>12&63|128}else s[t++]=i>>12|224;s[t++]=i>>6&63|128}s[t++]=63&i|128}return s.subarray(0,t)},b=e=>{let t=0,s="";for(;t<e.length;){let n=e[t++];if(n>127){if(n>191&&n<224){if(t>=e.length)throw new x("UTF-8 decode: incomplete 2-byte sequence");n=(31&n)<<6|63&e[t++]}else if(n>223&&n<240){if(t+1>=e.length)throw new x("UTF-8 decode: incomplete 3-byte sequence");n=(15&n)<<12|(63&e[t++])<<6|63&e[t++]}else if(n>239&&n<248){if(t+2>=e.length)throw new x("UTF-8 decode: incomplete 4-byte sequence");n=(7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++]}else throw new x(`UTF-8 decode: unknown multibyte start 0x${n.toString(16)} at index ${t-1}`)}if(n<=65535)s+=String.fromCharCode(n);else if(n<=1114111)n-=65536,s+=String.fromCharCode(n>>10|55296),s+=String.fromCharCode(1023&n|56320);else throw new x(`UTF-8 decode: code point 0x${n.toString(16)} exceeds UTF-16 reach`)}return s},C=(()=>{let e=new ArrayBuffer(1);return new DataView(e).setUint8(0,5),e})(),M=(()=>{let e=new ArrayBuffer(1);return new DataView(e).setUint8(0,12),e})();var N={[I.LOGIN]:e=>{let t=O(e.name),s=O(e.session),n=O(e.flag),i=new ArrayBuffer(9+t.length+s.length+n.length),a=new DataView(i),r=0;a.setUint8(r,e.c),r+=1,a.setUint8(r,e.protocol),r+=1,a.setUint8(r,t.length),r+=1;for(let e=0;e<t.length;e+=1)a.setUint8(r+e,t[e]);r+=t.length,a.setUint8(r,s.length),r+=1;for(let e=0;e<s.length;e+=1)a.setUint8(r+e,s[e]);r+=s.length,a.setUint16(r,e.horizonX,!0),r+=2,a.setUint16(r,e.horizonY,!0),r+=2,a.setUint8(r,n.length),r+=1;for(let e=0;e<n.length;e+=1)a.setUint8(r+e,n[e]);return i},[I.BACKUP]:e=>{let t=O(e.token),s=new ArrayBuffer(2+t.length),n=new DataView(s),i=0;n.setUint8(i,e.c),i+=1,n.setUint8(i,t.length),i+=1;for(let e=0;e<t.length;e+=1)n.setUint8(i+e,t[e]);return s},[I.HORIZON]:e=>{let t=new ArrayBuffer(5),s=new DataView(t),n=0;return s.setUint8(n,e.c),n+=1,s.setUint16(n,e.horizonX,!0),n+=2,s.setUint16(n,e.horizonY,!0),n+=2,t},[I.ACK]:()=>C,[I.PONG]:e=>{let t=new ArrayBuffer(5),s=new DataView(t),n=0;return s.setUint8(n,e.c),n+=1,s.setUint32(n,e.num,!0),n+=4,t},[I.KEY]:e=>{let t=new ArrayBuffer(7),s=new DataView(t),n=0;return s.setUint8(n,e.c),n+=1,s.setUint32(n,e.seq,!0),n+=4,s.setUint8(n,e.key),n+=1,s.setUint8(n,+(!1!==e.state)),n+=1,t},[I.COMMAND]:e=>{let t=O(e.com),s=O(e.data),n=new ArrayBuffer(3+t.length+s.length),i=new DataView(n),a=0;i.setUint8(a,e.c),a+=1,i.setUint8(a,t.length),a+=1;for(let e=0;e<t.length;e+=1)i.setUint8(a+e,t[e]);a+=t.length,i.setUint8(a,s.length),a+=1;for(let e=0;e<s.length;e+=1)i.setUint8(a+e,s[e]);return n},[I.SCOREDETAILED]:()=>M,[I.CHAT]:e=>{let t=O(e.text),s=new ArrayBuffer(2+t.length),n=new DataView(s),i=0;n.setUint8(i,e.c),i+=1,n.setUint8(i,t.length),i+=1;for(let e=0;e<t.length;e+=1)n.setUint8(i+e,t[e]);return s},[I.WHISPER]:e=>{let t=O(e.text),s=new ArrayBuffer(4+t.length),n=new DataView(s),i=0;n.setUint8(i,e.c),i+=1,n.setUint16(i,e.id,!0),i+=2,n.setUint8(i,t.length),i+=1;for(let e=0;e<t.length;e+=1)n.setUint8(i+e,t[e]);return s},[I.SAY]:e=>{let t=O(e.text),s=new ArrayBuffer(2+t.length),n=new DataView(s),i=0;n.setUint8(i,e.c),i+=1,n.setUint8(i,t.length),i+=1;for(let e=0;e<t.length;e+=1)n.setUint8(i+e,t[e]);return s},[I.TEAMCHAT]:e=>{let t=O(e.text),s=new ArrayBuffer(2+t.length),n=new DataView(s),i=0;n.setUint8(i,e.c),i+=1,n.setUint8(i,t.length),i+=1;for(let e=0;e<t.length;e+=1)n.setUint8(i+e,t[e]);return s},[I.VOTEMUTE]:e=>{let t=new ArrayBuffer(3),s=new DataView(t),n=0;return s.setUint8(n,e.c),n+=1,s.setUint16(n,e.id,!0),n+=2,t},[I.LOCALPING]:e=>{let t=new ArrayBuffer(5),s=new DataView(t),n=0;return s.setUint8(n,e.c),n+=1,s.setUint32(n,e.auth,!0),n+=4,t}};const k=(()=>{let e=new ArrayBuffer(1);return new DataView(e).setUint8(0,1),e})(),D=(()=>{let e=new ArrayBuffer(1);return new DataView(e).setUint8(0,7),e})(),v=(()=>{let e=new ArrayBuffer(1);return new DataView(e).setUint8(0,79),e})();var B={[S.LOGIN]:e=>{let t=[],s=0,n=0;for(let i=0;i<e.players.length;i+=1)n+=17,t[s]=O(e.players[i].name),n+=t[s].length,s+=1;for(let t=0;t<e.bots.length;t+=1)n+=2;let i=O(e.token),a=O(e.room),r=O(e.serverConfiguration),o=new ArrayBuffer(19+i.length+a.length+r.length+n),l=new DataView(o),c=0;s=0,l.setUint8(c,e.c),c+=1,l.setUint8(c,+(!1!==e.success)),c+=1,l.setUint16(c,e.id,!0),c+=2,l.setUint16(c,e.team,!0),c+=2,l.setUint32(c,e.clock,!0),c+=4,l.setUint8(c,i.length),c+=1;for(let e=0;e<i.length;e+=1)l.setUint8(c+e,i[e]);c+=i.length,l.setUint8(c,e.type),c+=1,l.setUint8(c,a.length),c+=1;for(let e=0;e<a.length;e+=1)l.setUint8(c+e,a[e]);c+=a.length;{let{players:n}=e;l.setUint16(c,n.length,!0),c+=2;for(let e=0;e<n.length;e+=1){l.setUint16(c,n[e].id,!0),c+=2,l.setUint8(c,n[e].status),c+=1,l.setUint8(c,n[e].level),c+=1,l.setUint8(c,t[s].length),c+=1;for(let e=0;e<t[s].length;e+=1)l.setUint8(c+e,t[s][e]);c+=t[s].length,s+=1,l.setUint8(c,n[e].type),c+=1,l.setUint16(c,n[e].team,!0),c+=2,l.setUint16(c,2*n[e].posX+32768,!0),c+=2,l.setUint16(c,4*n[e].posY+32768,!0),c+=2,l.setUint16(c,6553.6*n[e].rot,!0),c+=2,l.setUint16(c,n[e].flag,!0),c+=2,l.setUint8(c,n[e].upgrades),c+=1}}l.setUint16(c,r.length,!0),c+=2;for(let e=0;e<r.length;e+=1)l.setUint8(c+e,r[e]);c+=r.length;{let{bots:t}=e;l.setUint16(c,t.length,!0),c+=2;for(let e=0;e<t.length;e+=1)l.setUint16(c,t[e].id,!0),c+=2}return o},[S.BACKUP]:()=>k,[S.PING]:e=>{let t=new ArrayBuffer(9),s=new DataView(t),n=0;return s.setUint8(n,e.c),n+=1,s.setUint32(n,e.clock,!0),n+=4,s.setUint32(n,e.num,!0),n+=4,t},[S.PING_RESULT]:e=>{let t=new ArrayBuffer(11),s=new DataView(t),n=0;return s.setUint8(n,e.c),n+=1,s.setUint16(n,e.ping,!0),n+=2,s.setUint32(n,e.playerstotal,!0),n+=4,s.setUint32(n,e.playersgame,!0),n+=4,t},[S.ACK]:()=>D,[S.ERROR]:e=>{let t=new ArrayBuffer(2),s=new DataView(t),n=0;return s.setUint8(n,e.c),n+=1,s.setUint8(n,e.error),n+=1,t},[S.COMMAND_REPLY]:e=>{let t=O(e.text),s=new ArrayBuffer(4+t.length),n=new DataView(s),i=0;n.setUint8(i,e.c),i+=1,n.setUint8(i,e.type),i+=1,n.setUint16(i,t.length,!0),i+=2;for(let e=0;e<t.length;e+=1)n.setUint8(i+e,t[e]);return s},[S.PLAYER_NEW]:e=>{let t=O(e.name),s=new ArrayBuffer(18+t.length),n=new DataView(s),i=0;n.setUint8(i,e.c),i+=1,n.setUint16(i,e.id,!0),i+=2,n.setUint8(i,e.status),i+=1,n.setUint8(i,t.length),i+=1;for(let e=0;e<t.length;e+=1)n.setUint8(i+e,t[e]);return i+=t.length,n.setUint8(i,e.type),i+=1,n.setUint16(i,e.team,!0),i+=2,n.setUint16(i,2*e.posX+32768,!0),i+=2,n.setUint16(i,4*e.posY+32768,!0),i+=2,n.setUint16(i,6553.6*e.rot,!0),i+=2,n.setUint16(i,e.flag,!0),i+=2,n.setUint8(i,e.upgrades),i+=1,n.setUint8(i,+(!1!==e.isBot)),i+=1,s},[S.PLAYER_LEAVE]:e=>{let t=new ArrayBuffer(3),s=new DataView(t),n=0;return s.setUint8(n,e.c),n+=1,s.setUint16(n,e.id,!0),n+=2,t},[S.PLAYER_UPDATE]:e=>{let t=new ArrayBuffer(21),s=new DataView(t),n=0;s.setUint8(n,e.c),n+=1,s.setUint32(n,e.clock,!0),n+=4,s.setUint16(n,e.id,!0),n+=2,s.setUint8(n,e.keystate),n+=1,s.setUint8(n,e.upgrades),n+=1;{let t=512*e.posX+8388608,i=t%256;s.setUint16(n,(t-i)/256,!0),n+=2,s.setUint8(n,i),n+=1}{let t=512*e.posY+8388608,i=t%256;s.setUint16(n,(t-i)/256,!0),n+=2,s.setUint8(n,i),n+=1}return s.setUint16(n,6553.6*e.rot,!0),n+=2,s.setUint16(n,1638.4*e.speedX+32768,!0),n+=2,s.setUint16(n,1638.4*e.speedY+32768,!0),n+=2,t},[S.PLAYER_FIRE]:e=>{let t=0;for(let s=0;s<e.projectiles.length;s+=1)t+=17;let s=new ArrayBuffer(11+t),n=new DataView(s),i=0;n.setUint8(i,e.c),i+=1,n.setUint32(i,e.clock,!0),i+=4,n.setUint16(i,e.id,!0),i+=2,n.setUint8(i,255*e.energy),i+=1,n.setUint16(i,1e6*e.energyRegen+32768,!0),i+=2;{let{projectiles:t}=e;n.setUint8(i,t.length),i+=1;for(let e=0;e<t.length;e+=1)n.setUint16(i,t[e].id,!0),i+=2,n.setUint8(i,t[e].type),i+=1,n.setUint16(i,2*t[e].posX+32768,!0),i+=2,n.setUint16(i,4*t[e].posY+32768,!0),i+=2,n.setUint16(i,1638.4*t[e].speedX+32768,!0),i+=2,n.setUint16(i,1638.4*t[e].speedY+32768,!0),i+=2,n.setUint16(i,32768*t[e].accelX+32768,!0),i+=2,n.setUint16(i,32768*t[e].accelY+32768,!0),i+=2,n.setUint16(i,1638.4*t[e].maxSpeed+32768,!0),i+=2}return s},[S.PLAYER_HIT]:e=>{let t=0;for(let s=0;s<e.players.length;s+=1)t+=5;let s=new ArrayBuffer(11+t),n=new DataView(s),i=0;n.setUint8(i,e.c),i+=1,n.setUint16(i,e.id,!0),i+=2,n.setUint8(i,e.type),i+=1,n.setUint16(i,2*e.posX+32768,!0),i+=2,n.setUint16(i,4*e.posY+32768,!0),i+=2,n.setUint16(i,e.owner,!0),i+=2;{let{players:t}=e;n.setUint8(i,t.length),i+=1;for(let e=0;e<t.length;e+=1)n.setUint16(i,t[e].id,!0),i+=2,n.setUint8(i,255*t[e].health),i+=1,n.setUint16(i,1e6*t[e].healthRegen+32768,!0),i+=2}return s},[S.PLAYER_RESPAWN]:e=>{let t=new ArrayBuffer(12),s=new DataView(t),n=0;s.setUint8(n,e.c),n+=1,s.setUint16(n,e.id,!0),n+=2;{let t=512*e.posX+8388608,i=t%256;s.setUint16(n,(t-i)/256,!0),n+=2,s.setUint8(n,i),n+=1}{let t=512*e.posY+8388608,i=t%256;s.setUint16(n,(t-i)/256,!0),n+=2,s.setUint8(n,i),n+=1}return s.setUint16(n,6553.6*e.rot,!0),n+=2,s.setUint8(n,e.upgrades),n+=1,t},[S.PLAYER_FLAG]:e=>{let t=new ArrayBuffer(5),s=new DataView(t),n=0;return s.setUint8(n,e.c),n+=1,s.setUint16(n,e.id,!0),n+=2,s.setUint16(n,e.flag,!0),n+=2,t},[S.PLAYER_KILL]:e=>{let t=new ArrayBuffer(9),s=new DataView(t),n=0;return s.setUint8(n,e.c),n+=1,s.setUint16(n,e.id,!0),n+=2,s.setUint16(n,e.killer,!0),n+=2,s.setUint16(n,2*e.posX+32768,!0),n+=2,s.setUint16(n,4*e.posY+32768,!0),n+=2,t},[S.PLAYER_UPGRADE]:e=>{let t=new ArrayBuffer(8),s=new DataView(t),n=0;return s.setUint8(n,e.c),n+=1,s.setUint16(n,e.upgrades,!0),n+=2,s.setUint8(n,e.type),n+=1,s.setUint8(n,e.speed),n+=1,s.setUint8(n,e.defense),n+=1,s.setUint8(n,e.energy),n+=1,s.setUint8(n,e.missile),n+=1,t},[S.PLAYER_TYPE]:e=>{let t=new ArrayBuffer(4),s=new DataView(t),n=0;return s.setUint8(n,e.c),n+=1,s.setUint16(n,e.id,!0),n+=2,s.setUint8(n,e.type),n+=1,t},[S.PLAYER_POWERUP]:e=>{let t=new ArrayBuffer(6),s=new DataView(t),n=0;return s.setUint8(n,e.c),n+=1,s.setUint8(n,e.type),n+=1,s.setUint32(n,e.duration,!0),n+=4,t},[S.PLAYER_LEVEL]:e=>{let t=new ArrayBuffer(5),s=new DataView(t),n=0;return s.setUint8(n,e.c),n+=1,s.setUint16(n,e.id,!0),n+=2,s.setUint8(n,e.type),n+=1,s.setUint8(n,e.level),n+=1,t},[S.PLAYER_RETEAM]:e=>{let t=0;for(let s=0;s<e.players.length;s+=1)t+=4;let s=new ArrayBuffer(3+t),n=new DataView(s),i=0;n.setUint8(i,e.c),i+=1;{let{players:t}=e;n.setUint16(i,t.length,!0),i+=2;for(let e=0;e<t.length;e+=1)n.setUint16(i,t[e].id,!0),i+=2,n.setUint16(i,t[e].team,!0),i+=2}return s},[S.GAME_FLAG]:e=>{let t=new ArrayBuffer(13),s=new DataView(t),n=0;s.setUint8(n,e.c),n+=1,s.setUint8(n,e.type),n+=1,s.setUint8(n,e.flag),n+=1,s.setUint16(n,e.id,!0),n+=2;{let t=512*e.posX+8388608,i=t%256;s.setUint16(n,(t-i)/256,!0),n+=2,s.setUint8(n,i),n+=1}{let t=512*e.posY+8388608,i=t%256;s.setUint16(n,(t-i)/256,!0),n+=2,s.setUint8(n,i),n+=1}return s.setUint8(n,e.blueteam),n+=1,s.setUint8(n,e.redteam),n+=1,t},[S.GAME_SPECTATE]:e=>{let t=new ArrayBuffer(3),s=new DataView(t),n=0;return s.setUint8(n,e.c),n+=1,s.setUint16(n,e.id,!0),n+=2,t},[S.GAME_PLAYERSALIVE]:e=>{let t=new ArrayBuffer(3),s=new DataView(t),n=0;return s.setUint8(n,e.c),n+=1,s.setUint16(n,e.players,!0),n+=2,t},[S.GAME_FIREWALL]:e=>{let t=new ArrayBuffer(15),s=new DataView(t),n=0;return s.setUint8(n,e.c),n+=1,s.setUint8(n,e.type),n+=1,s.setUint8(n,e.status),n+=1,s.setUint16(n,2*e.posX+32768,!0),n+=2,s.setUint16(n,4*e.posY+32768,!0),n+=2,s.setFloat32(n,e.radius,!0),n+=4,s.setFloat32(n,e.speed,!0),n+=4,t},[S.EVENT_REPEL]:e=>{let t=0;for(let s=0;s<e.players.length;s+=1)t+=19;for(let s=0;s<e.mobs.length;s+=1)t+=17;let s=new ArrayBuffer(22+t),n=new DataView(s),i=0;n.setUint8(i,e.c),i+=1,n.setUint32(i,e.clock,!0),i+=4,n.setUint16(i,e.id,!0),i+=2,n.setUint16(i,2*e.posX+32768,!0),i+=2,n.setUint16(i,4*e.posY+32768,!0),i+=2,n.setUint16(i,6553.6*e.rot,!0),i+=2,n.setUint16(i,1638.4*e.speedX+32768,!0),i+=2,n.setUint16(i,1638.4*e.speedY+32768,!0),i+=2,n.setUint8(i,255*e.energy),i+=1,n.setUint16(i,1e6*e.energyRegen+32768,!0),i+=2;{let{players:t}=e;n.setUint8(i,t.length),i+=1;for(let e=0;e<t.length;e+=1)n.setUint16(i,t[e].id,!0),i+=2,n.setUint8(i,t[e].keystate),i+=1,n.setUint16(i,2*t[e].posX+32768,!0),i+=2,n.setUint16(i,4*t[e].posY+32768,!0),i+=2,n.setUint16(i,6553.6*t[e].rot,!0),i+=2,n.setUint16(i,1638.4*t[e].speedX+32768,!0),i+=2,n.setUint16(i,1638.4*t[e].speedY+32768,!0),i+=2,n.setUint8(i,255*t[e].energy),i+=1,n.setUint16(i,1e6*t[e].energyRegen+32768,!0),i+=2,n.setUint8(i,255*t[e].playerHealth),i+=1,n.setUint16(i,1e6*t[e].playerHealthRegen+32768,!0),i+=2}{let{mobs:t}=e;n.setUint8(i,t.length),i+=1;for(let e=0;e<t.length;e+=1)n.setUint16(i,t[e].id,!0),i+=2,n.setUint8(i,t[e].type),i+=1,n.setUint16(i,2*t[e].posX+32768,!0),i+=2,n.setUint16(i,4*t[e].posY+32768,!0),i+=2,n.setUint16(i,1638.4*t[e].speedX+32768,!0),i+=2,n.setUint16(i,1638.4*t[e].speedY+32768,!0),i+=2,n.setUint16(i,32768*t[e].accelX+32768,!0),i+=2,n.setUint16(i,32768*t[e].accelY+32768,!0),i+=2,n.setUint16(i,1638.4*t[e].maxSpeed+32768,!0),i+=2}return s},[S.EVENT_BOOST]:e=>{let t=new ArrayBuffer(23),s=new DataView(t),n=0;s.setUint8(n,e.c),n+=1,s.setUint32(n,e.clock,!0),n+=4,s.setUint16(n,e.id,!0),n+=2,s.setUint8(n,+(!1!==e.boost)),n+=1;{let t=512*e.posX+8388608,i=t%256;s.setUint16(n,(t-i)/256,!0),n+=2,s.setUint8(n,i),n+=1}{let t=512*e.posY+8388608,i=t%256;s.setUint16(n,(t-i)/256,!0),n+=2,s.setUint8(n,i),n+=1}return s.setUint16(n,6553.6*e.rot,!0),n+=2,s.setUint16(n,1638.4*e.speedX+32768,!0),n+=2,s.setUint16(n,1638.4*e.speedY+32768,!0),n+=2,s.setUint8(n,255*e.energy),n+=1,s.setUint16(n,1e6*e.energyRegen+32768,!0),n+=2,t},[S.EVENT_BOUNCE]:e=>{let t=new ArrayBuffer(20),s=new DataView(t),n=0;s.setUint8(n,e.c),n+=1,s.setUint32(n,e.clock,!0),n+=4,s.setUint16(n,e.id,!0),n+=2,s.setUint8(n,e.keystate),n+=1;{let t=512*e.posX+8388608,i=t%256;s.setUint16(n,(t-i)/256,!0),n+=2,s.setUint8(n,i),n+=1}{let t=512*e.posY+8388608,i=t%256;s.setUint16(n,(t-i)/256,!0),n+=2,s.setUint8(n,i),n+=1}return s.setUint16(n,6553.6*e.rot,!0),n+=2,s.setUint16(n,1638.4*e.speedX+32768,!0),n+=2,s.setUint16(n,1638.4*e.speedY+32768,!0),n+=2,t},[S.EVENT_STEALTH]:e=>{let t=new ArrayBuffer(7),s=new DataView(t),n=0;return s.setUint8(n,e.c),n+=1,s.setUint16(n,e.id,!0),n+=2,s.setUint8(n,+(!1!==e.state)),n+=1,s.setUint8(n,255*e.energy),n+=1,s.setUint16(n,1e6*e.energyRegen+32768,!0),n+=2,t},[S.EVENT_LEAVEHORIZON]:e=>{let t=new ArrayBuffer(4),s=new DataView(t),n=0;return s.setUint8(n,e.c),n+=1,s.setUint8(n,e.type),n+=1,s.setUint16(n,e.id,!0),n+=2,t},[S.MOB_UPDATE]:e=>{let t=new ArrayBuffer(22),s=new DataView(t),n=0;return s.setUint8(n,e.c),n+=1,s.setUint32(n,e.clock,!0),n+=4,s.setUint16(n,e.id,!0),n+=2,s.setUint8(n,e.type),n+=1,s.setUint16(n,2*e.posX+32768,!0),n+=2,s.setUint16(n,4*e.posY+32768,!0),n+=2,s.setUint16(n,1638.4*e.speedX+32768,!0),n+=2,s.setUint16(n,1638.4*e.speedY+32768,!0),n+=2,s.setUint16(n,32768*e.accelX+32768,!0),n+=2,s.setUint16(n,32768*e.accelY+32768,!0),n+=2,s.setUint16(n,1638.4*e.maxSpeed+32768,!0),n+=2,t},[S.MOB_UPDATE_STATIONARY]:e=>{let t=new ArrayBuffer(12),s=new DataView(t),n=0;return s.setUint8(n,e.c),n+=1,s.setUint16(n,e.id,!0),n+=2,s.setUint8(n,e.type),n+=1,s.setFloat32(n,e.posX,!0),n+=4,s.setFloat32(n,e.posY,!0),n+=4,t},[S.MOB_DESPAWN]:e=>{let t=new ArrayBuffer(4),s=new DataView(t),n=0;return s.setUint8(n,e.c),n+=1,s.setUint16(n,e.id,!0),n+=2,s.setUint8(n,e.type),n+=1,t},[S.MOB_DESPAWN_COORDS]:e=>{let t=new ArrayBuffer(8),s=new DataView(t),n=0;return s.setUint8(n,e.c),n+=1,s.setUint16(n,e.id,!0),n+=2,s.setUint8(n,e.type),n+=1,s.setUint16(n,2*e.posX+32768,!0),n+=2,s.setUint16(n,4*e.posY+32768,!0),n+=2,t},[S.CHAT_PUBLIC]:e=>{let t=O(e.text),s=new ArrayBuffer(4+t.length),n=new DataView(s),i=0;n.setUint8(i,e.c),i+=1,n.setUint16(i,e.id,!0),i+=2,n.setUint8(i,t.length),i+=1;for(let e=0;e<t.length;e+=1)n.setUint8(i+e,t[e]);return s},[S.CHAT_TEAM]:e=>{let t=O(e.text),s=new ArrayBuffer(4+t.length),n=new DataView(s),i=0;n.setUint8(i,e.c),i+=1,n.setUint16(i,e.id,!0),i+=2,n.setUint8(i,t.length),i+=1;for(let e=0;e<t.length;e+=1)n.setUint8(i+e,t[e]);return s},[S.CHAT_SAY]:e=>{let t=O(e.text),s=new ArrayBuffer(4+t.length),n=new DataView(s),i=0;n.setUint8(i,e.c),i+=1,n.setUint16(i,e.id,!0),i+=2,n.setUint8(i,t.length),i+=1;for(let e=0;e<t.length;e+=1)n.setUint8(i+e,t[e]);return s},[S.CHAT_WHISPER]:e=>{let t=O(e.text),s=new ArrayBuffer(6+t.length),n=new DataView(s),i=0;n.setUint8(i,e.c),i+=1,n.setUint16(i,e.from,!0),i+=2,n.setUint16(i,e.to,!0),i+=2,n.setUint8(i,t.length),i+=1;for(let e=0;e<t.length;e+=1)n.setUint8(i+e,t[e]);return s},[S.CHAT_VOTEMUTEPASSED]:e=>{let t=new ArrayBuffer(3),s=new DataView(t),n=0;return s.setUint8(n,e.c),n+=1,s.setUint16(n,e.id,!0),n+=2,t},[S.CHAT_VOTEMUTED]:()=>v,[S.SCORE_UPDATE]:e=>{let t=new ArrayBuffer(21),s=new DataView(t),n=0;return s.setUint8(n,e.c),n+=1,s.setUint16(n,e.id,!0),n+=2,s.setUint32(n,e.score,!0),n+=4,s.setUint32(n,e.earnings,!0),n+=4,s.setUint16(n,e.upgrades,!0),n+=2,s.setUint32(n,e.totalkills,!0),n+=4,s.setUint32(n,e.totaldeaths,!0),n+=4,t},[S.SCORE_BOARD]:e=>{let t=0;for(let s=0;s<e.data.length;s+=1)t+=7;for(let s=0;s<e.rankings.length;s+=1)t+=4;let s=new ArrayBuffer(5+t),n=new DataView(s),i=0;n.setUint8(i,e.c),i+=1;{let{data:t}=e;n.setUint16(i,t.length,!0),i+=2;for(let e=0;e<t.length;e+=1)n.setUint16(i,t[e].id,!0),i+=2,n.setUint32(i,t[e].score,!0),i+=4,n.setUint8(i,t[e].level),i+=1}{let{rankings:t}=e;n.setUint16(i,t.length,!0),i+=2;for(let e=0;e<t.length;e+=1)n.setUint16(i,t[e].id,!0),i+=2,n.setUint8(i,t[e].x),i+=1,n.setUint8(i,t[e].y),i+=1}return s},[S.SCORE_DETAILED]:e=>{let t=0;for(let s=0;s<e.scores.length;s+=1)t+=17;let s=new ArrayBuffer(3+t),n=new DataView(s),i=0;n.setUint8(i,e.c),i+=1;{let{scores:t}=e;n.setUint16(i,t.length,!0),i+=2;for(let e=0;e<t.length;e+=1)n.setUint16(i,t[e].id,!0),i+=2,n.setUint8(i,t[e].level),i+=1,n.setUint32(i,t[e].score,!0),i+=4,n.setUint16(i,t[e].kills,!0),i+=2,n.setUint16(i,t[e].deaths,!0),i+=2,n.setFloat32(i,t[e].damage,!0),i+=4,n.setUint16(i,t[e].ping,!0),i+=2}return s},[S.SCORE_DETAILED_CTF]:e=>{let t=0;for(let s=0;s<e.scores.length;s+=1)t+=19;let s=new ArrayBuffer(3+t),n=new DataView(s),i=0;n.setUint8(i,e.c),i+=1;{let{scores:t}=e;n.setUint16(i,t.length,!0),i+=2;for(let e=0;e<t.length;e+=1)n.setUint16(i,t[e].id,!0),i+=2,n.setUint8(i,t[e].level),i+=1,n.setUint16(i,t[e].captures,!0),i+=2,n.setUint32(i,t[e].score,!0),i+=4,n.setUint16(i,t[e].kills,!0),i+=2,n.setUint16(i,t[e].deaths,!0),i+=2,n.setFloat32(i,t[e].damage,!0),i+=4,n.setUint16(i,t[e].ping,!0),i+=2}return s},[S.SCORE_DETAILED_BTR]:e=>{let t=0;for(let s=0;s<e.scores.length;s+=1)t+=20;let s=new ArrayBuffer(3+t),n=new DataView(s),i=0;n.setUint8(i,e.c),i+=1;{let{scores:t}=e;n.setUint16(i,t.length,!0),i+=2;for(let e=0;e<t.length;e+=1)n.setUint16(i,t[e].id,!0),i+=2,n.setUint8(i,t[e].level),i+=1,n.setUint8(i,+(!1!==t[e].alive)),i+=1,n.setUint16(i,t[e].wins,!0),i+=2,n.setUint32(i,t[e].score,!0),i+=4,n.setUint16(i,t[e].kills,!0),i+=2,n.setUint16(i,t[e].deaths,!0),i+=2,n.setFloat32(i,t[e].damage,!0),i+=4,n.setUint16(i,t[e].ping,!0),i+=2}return s},[S.SERVER_MESSAGE]:e=>{let t=O(e.text),s=new ArrayBuffer(8+t.length),n=new DataView(s),i=0;n.setUint8(i,e.c),i+=1,n.setUint8(i,e.type),i+=1,n.setUint32(i,e.duration,!0),i+=4,n.setUint16(i,t.length,!0),i+=2;for(let e=0;e<t.length;e+=1)n.setUint8(i+e,t[e]);return s},[S.SERVER_CUSTOM]:e=>{let t=O(e.data),s=new ArrayBuffer(4+t.length),n=new DataView(s),i=0;n.setUint8(i,e.c),i+=1,n.setUint8(i,e.type),i+=1,n.setUint16(i,t.length,!0),i+=2;for(let e=0;e<t.length;e+=1)n.setUint8(i+e,t[e]);return s}};const Y=new class{constructor(){this.storage=[]}last(){return this.storage.length>0?this.storage[this.storage.length-1]:null}put(e){this.storage.push(e)}shift(){return this.storage.shift()}flush(){this.storage=[]}},F=()=>{Y.flush()},V=(e,t)=>{let s=0;for(let n=0;n<t.length;n+=1){let[i,a,r]=t[n],o=e[i];switch(a){case P.text:case P.textbig:Y.put(O(o)),a===P.textbig?s+=2:s+=1,s+=Y.last().length;break;case P.array:case P.arraysmall:a===P.array?s+=2:s+=1;for(let e=0;e<o.length;e+=1)s+=V(o[e],r);break;case P.uint8:case P.boolean:case P.healthenergy:s+=1;break;case P.uint16:case P.speed:case P.accel:case P.coordx:case P.coordy:case P.rotation:case P.regen:s+=2;break;case P.uint24:case P.coord24:s+=3;break;case P.uint32:case P.float32:s+=4;break;case P.float64:s+=8}}return s},H=(e,t,s,n)=>{let i=t;1===i&&e.setUint8(0,s.c);for(let t=0;t<n.length;t+=1){let[a,r,o]=n[t],l=s[a];switch(r){case P.text:case P.textbig:{let t=Y.shift();r===P.textbig?(e.setUint16(i,t.length,!0),i+=2):(e.setUint8(i,t.length),i+=1);for(let s=0;s<t.length;s+=1)e.setUint8(i+s,t[s]);i+=t.length}break;case P.array:case P.arraysmall:r===P.array?(e.setUint16(i,l.length,!0),i+=2):(e.setUint8(i,l.length),i+=1);for(let t=0;t<l.length;t+=1)i=H(e,i,l[t],o);break;case P.uint8:e.setUint8(i,l),i+=1;break;case P.healthenergy:e.setUint8(i,255*l),i+=1;break;case P.uint16:e.setUint16(i,l,!0),i+=2;break;case P.regen:e.setUint16(i,1e6*l+32768,!0),i+=2;break;case P.rotation:e.setUint16(i,6553.6*l,!0),i+=2;break;case P.coordy:e.setUint16(i,4*l+32768,!0),i+=2;break;case P.coordx:e.setUint16(i,2*l+32768,!0),i+=2;break;case P.accel:e.setUint16(i,32768*l+32768,!0),i+=2;break;case P.speed:e.setUint16(i,1638.4*l+32768,!0),i+=2;break;case P.uint24:{let t=l%256,s=(l-t)/256;e.setUint16(i,s,!0),i+=2,e.setUint8(i,t),i+=1}break;case P.coord24:{let t=512*l+8388608,s=t%256,n=(t-s)/256;e.setUint16(i,n,!0),i+=2,e.setUint8(i,s),i+=1}break;case P.uint32:e.setUint32(i,l,!0),i+=4;break;case P.float32:e.setFloat32(i,l,!0),i+=4;break;case P.float64:e.setFloat64(i,l,!0),i+=8;break;case P.boolean:e.setUint8(i,+(!1!==l)),i+=1}}return i},G=(e,t,s)=>{F();let n=e.c,i=null,a=null;switch(t){case 1:a=N[n],i=L[n];break;case 0:a=B[n],i=_[n];break;default:return null}if(null===i)return null;let r=null;if(s&&a)r=a(e);else{let t=null,s=0;H(new DataView(r=new ArrayBuffer(1+V(e,i))),1,e,i)}return r},W=(e,t=!0)=>G(e,1,t),K={c:5},X={c:12};var z={[I.LOGIN]:e=>{let t={c:0},s=new DataView(e),n=1;t.protocol=s.getUint8(n),n+=1;{let e=s.getUint8(n),i=new Uint8Array(e);n+=1;for(let t=0;t<e;t+=1)i[t]=s.getUint8(n+t);t.name=b(i),n+=e}{let e=s.getUint8(n),i=new Uint8Array(e);n+=1;for(let t=0;t<e;t+=1)i[t]=s.getUint8(n+t);t.session=b(i),n+=e}t.horizonX=s.getUint16(n,!0),n+=2,t.horizonY=s.getUint16(n,!0),n+=2;{let e=s.getUint8(n),i=new Uint8Array(e);n+=1;for(let t=0;t<e;t+=1)i[t]=s.getUint8(n+t);t.flag=b(i),n+=e}return t},[I.BACKUP]:e=>{let t={c:1},s=new DataView(e),n=1;{let e=s.getUint8(n),i=new Uint8Array(e);n+=1;for(let t=0;t<e;t+=1)i[t]=s.getUint8(n+t);t.token=b(i),n+=e}return t},[I.HORIZON]:e=>{let t={c:2},s=new DataView(e),n=1;return t.horizonX=s.getUint16(n,!0),n+=2,t.horizonY=s.getUint16(n,!0),n+=2,t},[I.ACK]:()=>K,[I.PONG]:e=>{let t={c:6},s=new DataView(e),n=1;return t.num=s.getUint32(n,!0),n+=4,t},[I.KEY]:e=>{let t={c:10},s=new DataView(e),n=1;return t.seq=s.getUint32(n,!0),n+=4,t.key=s.getUint8(n),n+=1,t.state=0!==s.getUint8(n),n+=1,t},[I.COMMAND]:e=>{let t={c:11},s=new DataView(e),n=1;{let e=s.getUint8(n),i=new Uint8Array(e);n+=1;for(let t=0;t<e;t+=1)i[t]=s.getUint8(n+t);t.com=b(i),n+=e}{let e=s.getUint8(n),i=new Uint8Array(e);n+=1;for(let t=0;t<e;t+=1)i[t]=s.getUint8(n+t);t.data=b(i),n+=e}return t},[I.SCOREDETAILED]:()=>X,[I.CHAT]:e=>{let t={c:20},s=new DataView(e),n=1;{let e=s.getUint8(n),i=new Uint8Array(e);n+=1;for(let t=0;t<e;t+=1)i[t]=s.getUint8(n+t);t.text=b(i),n+=e}return t},[I.WHISPER]:e=>{let t={c:21},s=new DataView(e),n=1;t.id=s.getUint16(n,!0),n+=2;{let e=s.getUint8(n),i=new Uint8Array(e);n+=1;for(let t=0;t<e;t+=1)i[t]=s.getUint8(n+t);t.text=b(i),n+=e}return t},[I.SAY]:e=>{let t={c:22},s=new DataView(e),n=1;{let e=s.getUint8(n),i=new Uint8Array(e);n+=1;for(let t=0;t<e;t+=1)i[t]=s.getUint8(n+t);t.text=b(i),n+=e}return t},[I.TEAMCHAT]:e=>{let t={c:23},s=new DataView(e),n=1;{let e=s.getUint8(n),i=new Uint8Array(e);n+=1;for(let t=0;t<e;t+=1)i[t]=s.getUint8(n+t);t.text=b(i),n+=e}return t},[I.VOTEMUTE]:e=>{let t={c:24},s=new DataView(e),n=1;return t.id=s.getUint16(n,!0),n+=2,t},[I.LOCALPING]:e=>{let t={c:255},s=new DataView(e),n=1;return t.auth=s.getUint32(n,!0),n+=4,t}};const Q={c:1},j={c:7},q={c:79};var J={[S.LOGIN]:e=>{let t={c:0},s=new DataView(e),n=1;t.success=0!==s.getUint8(n),n+=1,t.id=s.getUint16(n,!0),n+=2,t.team=s.getUint16(n,!0),n+=2,t.clock=s.getUint32(n,!0),n+=4;{let e=s.getUint8(n),i=new Uint8Array(e);n+=1;for(let t=0;t<e;t+=1)i[t]=s.getUint8(n+t);t.token=b(i),n+=e}t.type=s.getUint8(n),n+=1;{let e=s.getUint8(n),i=new Uint8Array(e);n+=1;for(let t=0;t<e;t+=1)i[t]=s.getUint8(n+t);t.room=b(i),n+=e}{let e=s.getUint16(n,!0);n+=2,t.players=[];for(let i=0;i<e;i+=1){let e={};e.id=s.getUint16(n,!0),n+=2,e.status=s.getUint8(n),n+=1,e.level=s.getUint8(n),n+=1;{let t=s.getUint8(n),i=new Uint8Array(t);n+=1;for(let e=0;e<t;e+=1)i[e]=s.getUint8(n+e);e.name=b(i),n+=t}e.type=s.getUint8(n),n+=1,e.team=s.getUint16(n,!0),n+=2,e.posX=(s.getUint16(n,!0)-32768)/2,n+=2,e.posY=(s.getUint16(n,!0)-32768)/4,n+=2,e.rot=s.getUint16(n,!0)/6553.6,n+=2,e.flag=s.getUint16(n,!0),n+=2,e.upgrades=s.getUint8(n),n+=1,t.players.push(e)}}{let e=s.getUint16(n,!0),i=new Uint8Array(e);n+=2;for(let t=0;t<e;t+=1)i[t]=s.getUint8(n+t);t.serverConfiguration=b(i),n+=e}{let e=s.getUint16(n,!0);n+=2,t.bots=[];for(let i=0;i<e;i+=1){let e={};e.id=s.getUint16(n,!0),n+=2,t.bots.push(e)}}return t},[S.BACKUP]:()=>Q,[S.PING]:e=>{let t={c:5},s=new DataView(e),n=1;return t.clock=s.getUint32(n,!0),n+=4,t.num=s.getUint32(n,!0),n+=4,t},[S.PING_RESULT]:e=>{let t={c:6},s=new DataView(e),n=1;return t.ping=s.getUint16(n,!0),n+=2,t.playerstotal=s.getUint32(n,!0),n+=4,t.playersgame=s.getUint32(n,!0),n+=4,t},[S.ACK]:()=>j,[S.ERROR]:e=>{let t={c:8},s=new DataView(e),n=1;return t.error=s.getUint8(n),n+=1,t},[S.COMMAND_REPLY]:e=>{let t={c:9},s=new DataView(e),n=1;t.type=s.getUint8(n),n+=1;{let e=s.getUint16(n,!0),i=new Uint8Array(e);n+=2;for(let t=0;t<e;t+=1)i[t]=s.getUint8(n+t);t.text=b(i),n+=e}return t},[S.PLAYER_NEW]:e=>{let t={c:10},s=new DataView(e),n=1;t.id=s.getUint16(n,!0),n+=2,t.status=s.getUint8(n),n+=1;{let e=s.getUint8(n),i=new Uint8Array(e);n+=1;for(let t=0;t<e;t+=1)i[t]=s.getUint8(n+t);t.name=b(i),n+=e}return t.type=s.getUint8(n),n+=1,t.team=s.getUint16(n,!0),n+=2,t.posX=(s.getUint16(n,!0)-32768)/2,n+=2,t.posY=(s.getUint16(n,!0)-32768)/4,n+=2,t.rot=s.getUint16(n,!0)/6553.6,n+=2,t.flag=s.getUint16(n,!0),n+=2,t.upgrades=s.getUint8(n),n+=1,t.isBot=0!==s.getUint8(n),n+=1,t},[S.PLAYER_LEAVE]:e=>{let t={c:11},s=new DataView(e),n=1;return t.id=s.getUint16(n,!0),n+=2,t},[S.PLAYER_UPDATE]:e=>{let t={c:12},s=new DataView(e),n=1;t.clock=s.getUint32(n,!0),n+=4,t.id=s.getUint16(n,!0),n+=2,t.keystate=s.getUint8(n),n+=1,t.upgrades=s.getUint8(n),n+=1;{let e=256*s.getUint16(n,!0);n+=2,t.posX=(e+s.getUint8(n)-8388608)/512,n+=1}{let e=256*s.getUint16(n,!0);n+=2,t.posY=(e+s.getUint8(n)-8388608)/512,n+=1}return t.rot=s.getUint16(n,!0)/6553.6,n+=2,t.speedX=(s.getUint16(n,!0)-32768)/1638.4,n+=2,t.speedY=(s.getUint16(n,!0)-32768)/1638.4,n+=2,t},[S.PLAYER_FIRE]:e=>{let t={c:13},s=new DataView(e),n=1;t.clock=s.getUint32(n,!0),n+=4,t.id=s.getUint16(n,!0),n+=2,t.energy=s.getUint8(n)/255,n+=1,t.energyRegen=(s.getUint16(n,!0)-32768)/1e6,n+=2;{let e=s.getUint8(n);n+=1,t.projectiles=[];for(let i=0;i<e;i+=1){let e={};e.id=s.getUint16(n,!0),n+=2,e.type=s.getUint8(n),n+=1,e.posX=(s.getUint16(n,!0)-32768)/2,n+=2,e.posY=(s.getUint16(n,!0)-32768)/4,n+=2,e.speedX=(s.getUint16(n,!0)-32768)/1638.4,n+=2,e.speedY=(s.getUint16(n,!0)-32768)/1638.4,n+=2,e.accelX=(s.getUint16(n,!0)-32768)/32768,n+=2,e.accelY=(s.getUint16(n,!0)-32768)/32768,n+=2,e.maxSpeed=(s.getUint16(n,!0)-32768)/1638.4,n+=2,t.projectiles.push(e)}}return t},[S.PLAYER_HIT]:e=>{let t={c:14},s=new DataView(e),n=1;t.id=s.getUint16(n,!0),n+=2,t.type=s.getUint8(n),n+=1,t.posX=(s.getUint16(n,!0)-32768)/2,n+=2,t.posY=(s.getUint16(n,!0)-32768)/4,n+=2,t.owner=s.getUint16(n,!0),n+=2;{let e=s.getUint8(n);n+=1,t.players=[];for(let i=0;i<e;i+=1){let e={};e.id=s.getUint16(n,!0),n+=2,e.health=s.getUint8(n)/255,n+=1,e.healthRegen=(s.getUint16(n,!0)-32768)/1e6,n+=2,t.players.push(e)}}return t},[S.PLAYER_RESPAWN]:e=>{let t={c:15},s=new DataView(e),n=1;t.id=s.getUint16(n,!0),n+=2;{let e=256*s.getUint16(n,!0);n+=2,t.posX=(e+s.getUint8(n)-8388608)/512,n+=1}{let e=256*s.getUint16(n,!0);n+=2,t.posY=(e+s.getUint8(n)-8388608)/512,n+=1}return t.rot=s.getUint16(n,!0)/6553.6,n+=2,t.upgrades=s.getUint8(n),n+=1,t},[S.PLAYER_FLAG]:e=>{let t={c:16},s=new DataView(e),n=1;return t.id=s.getUint16(n,!0),n+=2,t.flag=s.getUint16(n,!0),n+=2,t},[S.PLAYER_KILL]:e=>{let t={c:17},s=new DataView(e),n=1;return t.id=s.getUint16(n,!0),n+=2,t.killer=s.getUint16(n,!0),n+=2,t.posX=(s.getUint16(n,!0)-32768)/2,n+=2,t.posY=(s.getUint16(n,!0)-32768)/4,n+=2,t},[S.PLAYER_UPGRADE]:e=>{let t={c:18},s=new DataView(e),n=1;return t.upgrades=s.getUint16(n,!0),n+=2,t.type=s.getUint8(n),n+=1,t.speed=s.getUint8(n),n+=1,t.defense=s.getUint8(n),n+=1,t.energy=s.getUint8(n),n+=1,t.missile=s.getUint8(n),n+=1,t},[S.PLAYER_TYPE]:e=>{let t={c:19},s=new DataView(e),n=1;return t.id=s.getUint16(n,!0),n+=2,t.type=s.getUint8(n),n+=1,t},[S.PLAYER_POWERUP]:e=>{let t={c:20},s=new DataView(e),n=1;return t.type=s.getUint8(n),n+=1,t.duration=s.getUint32(n,!0),n+=4,t},[S.PLAYER_LEVEL]:e=>{let t={c:21},s=new DataView(e),n=1;return t.id=s.getUint16(n,!0),n+=2,t.type=s.getUint8(n),n+=1,t.level=s.getUint8(n),n+=1,t},[S.PLAYER_RETEAM]:e=>{let t={c:22},s=new DataView(e),n=1;{let e=s.getUint16(n,!0);n+=2,t.players=[];for(let i=0;i<e;i+=1){let e={};e.id=s.getUint16(n,!0),n+=2,e.team=s.getUint16(n,!0),n+=2,t.players.push(e)}}return t},[S.GAME_FLAG]:e=>{let t={c:30},s=new DataView(e),n=1;t.type=s.getUint8(n),n+=1,t.flag=s.getUint8(n),n+=1,t.id=s.getUint16(n,!0),n+=2;{let e=256*s.getUint16(n,!0);n+=2,t.posX=(e+s.getUint8(n)-8388608)/512,n+=1}{let e=256*s.getUint16(n,!0);n+=2,t.posY=(e+s.getUint8(n)-8388608)/512,n+=1}return t.blueteam=s.getUint8(n),n+=1,t.redteam=s.getUint8(n),n+=1,t},[S.GAME_SPECTATE]:e=>{let t={c:31},s=new DataView(e),n=1;return t.id=s.getUint16(n,!0),n+=2,t},[S.GAME_PLAYERSALIVE]:e=>{let t={c:32},s=new DataView(e),n=1;return t.players=s.getUint16(n,!0),n+=2,t},[S.GAME_FIREWALL]:e=>{let t={c:33},s=new DataView(e),n=1;return t.type=s.getUint8(n),n+=1,t.status=s.getUint8(n),n+=1,t.posX=(s.getUint16(n,!0)-32768)/2,n+=2,t.posY=(s.getUint16(n,!0)-32768)/4,n+=2,t.radius=s.getFloat32(n,!0),n+=4,t.speed=s.getFloat32(n,!0),n+=4,t},[S.EVENT_REPEL]:e=>{let t={c:40},s=new DataView(e),n=1;t.clock=s.getUint32(n,!0),n+=4,t.id=s.getUint16(n,!0),n+=2,t.posX=(s.getUint16(n,!0)-32768)/2,n+=2,t.posY=(s.getUint16(n,!0)-32768)/4,n+=2,t.rot=s.getUint16(n,!0)/6553.6,n+=2,t.speedX=(s.getUint16(n,!0)-32768)/1638.4,n+=2,t.speedY=(s.getUint16(n,!0)-32768)/1638.4,n+=2,t.energy=s.getUint8(n)/255,n+=1,t.energyRegen=(s.getUint16(n,!0)-32768)/1e6,n+=2;{let e=s.getUint8(n);n+=1,t.players=[];for(let i=0;i<e;i+=1){let e={};e.id=s.getUint16(n,!0),n+=2,e.keystate=s.getUint8(n),n+=1,e.posX=(s.getUint16(n,!0)-32768)/2,n+=2,e.posY=(s.getUint16(n,!0)-32768)/4,n+=2,e.rot=s.getUint16(n,!0)/6553.6,n+=2,e.speedX=(s.getUint16(n,!0)-32768)/1638.4,n+=2,e.speedY=(s.getUint16(n,!0)-32768)/1638.4,n+=2,e.energy=s.getUint8(n)/255,n+=1,e.energyRegen=(s.getUint16(n,!0)-32768)/1e6,n+=2,e.playerHealth=s.getUint8(n)/255,n+=1,e.playerHealthRegen=(s.getUint16(n,!0)-32768)/1e6,n+=2,t.players.push(e)}}{let e=s.getUint8(n);n+=1,t.mobs=[];for(let i=0;i<e;i+=1){let e={};e.id=s.getUint16(n,!0),n+=2,e.type=s.getUint8(n),n+=1,e.posX=(s.getUint16(n,!0)-32768)/2,n+=2,e.posY=(s.getUint16(n,!0)-32768)/4,n+=2,e.speedX=(s.getUint16(n,!0)-32768)/1638.4,n+=2,e.speedY=(s.getUint16(n,!0)-32768)/1638.4,n+=2,e.accelX=(s.getUint16(n,!0)-32768)/32768,n+=2,e.accelY=(s.getUint16(n,!0)-32768)/32768,n+=2,e.maxSpeed=(s.getUint16(n,!0)-32768)/1638.4,n+=2,t.mobs.push(e)}}return t},[S.EVENT_BOOST]:e=>{let t={c:41},s=new DataView(e),n=1;t.clock=s.getUint32(n,!0),n+=4,t.id=s.getUint16(n,!0),n+=2,t.boost=0!==s.getUint8(n),n+=1;{let e=256*s.getUint16(n,!0);n+=2,t.posX=(e+s.getUint8(n)-8388608)/512,n+=1}{let e=256*s.getUint16(n,!0);n+=2,t.posY=(e+s.getUint8(n)-8388608)/512,n+=1}return t.rot=s.getUint16(n,!0)/6553.6,n+=2,t.speedX=(s.getUint16(n,!0)-32768)/1638.4,n+=2,t.speedY=(s.getUint16(n,!0)-32768)/1638.4,n+=2,t.energy=s.getUint8(n)/255,n+=1,t.energyRegen=(s.getUint16(n,!0)-32768)/1e6,n+=2,t},[S.EVENT_BOUNCE]:e=>{let t={c:42},s=new DataView(e),n=1;t.clock=s.getUint32(n,!0),n+=4,t.id=s.getUint16(n,!0),n+=2,t.keystate=s.getUint8(n),n+=1;{let e=256*s.getUint16(n,!0);n+=2,t.posX=(e+s.getUint8(n)-8388608)/512,n+=1}{let e=256*s.getUint16(n,!0);n+=2,t.posY=(e+s.getUint8(n)-8388608)/512,n+=1}return t.rot=s.getUint16(n,!0)/6553.6,n+=2,t.speedX=(s.getUint16(n,!0)-32768)/1638.4,n+=2,t.speedY=(s.getUint16(n,!0)-32768)/1638.4,n+=2,t},[S.EVENT_STEALTH]:e=>{let t={c:43},s=new DataView(e),n=1;return t.id=s.getUint16(n,!0),n+=2,t.state=0!==s.getUint8(n),n+=1,t.energy=s.getUint8(n)/255,n+=1,t.energyRegen=(s.getUint16(n,!0)-32768)/1e6,n+=2,t},[S.EVENT_LEAVEHORIZON]:e=>{let t={c:44},s=new DataView(e),n=1;return t.type=s.getUint8(n),n+=1,t.id=s.getUint16(n,!0),n+=2,t},[S.MOB_UPDATE]:e=>{let t={c:60},s=new DataView(e),n=1;return t.clock=s.getUint32(n,!0),n+=4,t.id=s.getUint16(n,!0),n+=2,t.type=s.getUint8(n),n+=1,t.posX=(s.getUint16(n,!0)-32768)/2,n+=2,t.posY=(s.getUint16(n,!0)-32768)/4,n+=2,t.speedX=(s.getUint16(n,!0)-32768)/1638.4,n+=2,t.speedY=(s.getUint16(n,!0)-32768)/1638.4,n+=2,t.accelX=(s.getUint16(n,!0)-32768)/32768,n+=2,t.accelY=(s.getUint16(n,!0)-32768)/32768,n+=2,t.maxSpeed=(s.getUint16(n,!0)-32768)/1638.4,n+=2,t},[S.MOB_UPDATE_STATIONARY]:e=>{let t={c:61},s=new DataView(e),n=1;return t.id=s.getUint16(n,!0),n+=2,t.type=s.getUint8(n),n+=1,t.posX=s.getFloat32(n,!0),n+=4,t.posY=s.getFloat32(n,!0),n+=4,t},[S.MOB_DESPAWN]:e=>{let t={c:62},s=new DataView(e),n=1;return t.id=s.getUint16(n,!0),n+=2,t.type=s.getUint8(n),n+=1,t},[S.MOB_DESPAWN_COORDS]:e=>{let t={c:63},s=new DataView(e),n=1;return t.id=s.getUint16(n,!0),n+=2,t.type=s.getUint8(n),n+=1,t.posX=(s.getUint16(n,!0)-32768)/2,n+=2,t.posY=(s.getUint16(n,!0)-32768)/4,n+=2,t},[S.CHAT_PUBLIC]:e=>{let t={c:70},s=new DataView(e),n=1;t.id=s.getUint16(n,!0),n+=2;{let e=s.getUint8(n),i=new Uint8Array(e);n+=1;for(let t=0;t<e;t+=1)i[t]=s.getUint8(n+t);t.text=b(i),n+=e}return t},[S.CHAT_TEAM]:e=>{let t={c:71},s=new DataView(e),n=1;t.id=s.getUint16(n,!0),n+=2;{let e=s.getUint8(n),i=new Uint8Array(e);n+=1;for(let t=0;t<e;t+=1)i[t]=s.getUint8(n+t);t.text=b(i),n+=e}return t},[S.CHAT_SAY]:e=>{let t={c:72},s=new DataView(e),n=1;t.id=s.getUint16(n,!0),n+=2;{let e=s.getUint8(n),i=new Uint8Array(e);n+=1;for(let t=0;t<e;t+=1)i[t]=s.getUint8(n+t);t.text=b(i),n+=e}return t},[S.CHAT_WHISPER]:e=>{let t={c:73},s=new DataView(e),n=1;t.from=s.getUint16(n,!0),n+=2,t.to=s.getUint16(n,!0),n+=2;{let e=s.getUint8(n),i=new Uint8Array(e);n+=1;for(let t=0;t<e;t+=1)i[t]=s.getUint8(n+t);t.text=b(i),n+=e}return t},[S.CHAT_VOTEMUTEPASSED]:e=>{let t={c:78},s=new DataView(e),n=1;return t.id=s.getUint16(n,!0),n+=2,t},[S.CHAT_VOTEMUTED]:()=>q,[S.SCORE_UPDATE]:e=>{let t={c:80},s=new DataView(e),n=1;return t.id=s.getUint16(n,!0),n+=2,t.score=s.getUint32(n,!0),n+=4,t.earnings=s.getUint32(n,!0),n+=4,t.upgrades=s.getUint16(n,!0),n+=2,t.totalkills=s.getUint32(n,!0),n+=4,t.totaldeaths=s.getUint32(n,!0),n+=4,t},[S.SCORE_BOARD]:e=>{let t={c:81},s=new DataView(e),n=1;{let e=s.getUint16(n,!0);n+=2,t.data=[];for(let i=0;i<e;i+=1){let e={};e.id=s.getUint16(n,!0),n+=2,e.score=s.getUint32(n,!0),n+=4,e.level=s.getUint8(n),n+=1,t.data.push(e)}}{let e=s.getUint16(n,!0);n+=2,t.rankings=[];for(let i=0;i<e;i+=1){let e={};e.id=s.getUint16(n,!0),n+=2,e.x=s.getUint8(n),n+=1,e.y=s.getUint8(n),n+=1,t.rankings.push(e)}}return t},[S.SCORE_DETAILED]:e=>{let t={c:82},s=new DataView(e),n=1;{let e=s.getUint16(n,!0);n+=2,t.scores=[];for(let i=0;i<e;i+=1){let e={};e.id=s.getUint16(n,!0),n+=2,e.level=s.getUint8(n),n+=1,e.score=s.getUint32(n,!0),n+=4,e.kills=s.getUint16(n,!0),n+=2,e.deaths=s.getUint16(n,!0),n+=2,e.damage=s.getFloat32(n,!0),n+=4,e.ping=s.getUint16(n,!0),n+=2,t.scores.push(e)}}return t},[S.SCORE_DETAILED_CTF]:e=>{let t={c:83},s=new DataView(e),n=1;{let e=s.getUint16(n,!0);n+=2,t.scores=[];for(let i=0;i<e;i+=1){let e={};e.id=s.getUint16(n,!0),n+=2,e.level=s.getUint8(n),n+=1,e.captures=s.getUint16(n,!0),n+=2,e.score=s.getUint32(n,!0),n+=4,e.kills=s.getUint16(n,!0),n+=2,e.deaths=s.getUint16(n,!0),n+=2,e.damage=s.getFloat32(n,!0),n+=4,e.ping=s.getUint16(n,!0),n+=2,t.scores.push(e)}}return t},[S.SCORE_DETAILED_BTR]:e=>{let t={c:84},s=new DataView(e),n=1;{let e=s.getUint16(n,!0);n+=2,t.scores=[];for(let i=0;i<e;i+=1){let e={};e.id=s.getUint16(n,!0),n+=2,e.level=s.getUint8(n),n+=1,e.alive=0!==s.getUint8(n),n+=1,e.wins=s.getUint16(n,!0),n+=2,e.score=s.getUint32(n,!0),n+=4,e.kills=s.getUint16(n,!0),n+=2,e.deaths=s.getUint16(n,!0),n+=2,e.damage=s.getFloat32(n,!0),n+=4,e.ping=s.getUint16(n,!0),n+=2,t.scores.push(e)}}return t},[S.SERVER_MESSAGE]:e=>{let t={c:90},s=new DataView(e),n=1;t.type=s.getUint8(n),n+=1,t.duration=s.getUint32(n,!0),n+=4;{let e=s.getUint16(n,!0),i=new Uint8Array(e);n+=2;for(let t=0;t<e;t+=1)i[t]=s.getUint8(n+t);t.text=b(i),n+=e}return t},[S.SERVER_CUSTOM]:e=>{let t={c:91},s=new DataView(e),n=1;t.type=s.getUint8(n),n+=1;{let e=s.getUint16(n,!0),i=new Uint8Array(e);n+=2;for(let t=0;t<e;t+=1)i[t]=s.getUint8(n+t);t.data=b(i),n+=e}return t}};const $=(e,t=0,s)=>{let n={},i=t;0===i&&(n.c=e.getUint8(0),i+=1);for(let t=0;t<s.length;t+=1){let[a,r,o]=s[t];switch(r){case P.text:case P.textbig:{let t=0;r===P.text?(t=e.getUint8(i),i+=1):(t=e.getUint16(i,!0),i+=2);let s=new Uint8Array(t);for(let n=0;n<t;n+=1)s[n]=e.getUint8(i+n);n[a]=b(s),i+=t}break;case P.array:case P.arraysmall:{let t=0;r===P.arraysmall?(t=e.getUint8(i),i+=1):(t=e.getUint16(i,!0),i+=2),n[a]=[];for(let s=0;s<t;s+=1){let t={};for(let s=0;s<o.length;s+=1){let[n,a]=o[s];switch(a){case P.text:case P.textbig:{let s=0;a===P.text?(s=e.getUint8(i),i+=1):(s=e.getUint16(i,!0),i+=2);let r=new Uint8Array(s);for(let t=0;t<s;t+=1)r[t]=e.getUint8(i+t);t[n]=b(r),i+=s}break;case P.uint8:t[n]=e.getUint8(i),i+=1;break;case P.uint16:t[n]=e.getUint16(i,!0),i+=2;break;case P.uint24:{let s=256*e.getUint16(i,!0);i+=2,t[n]=s+e.getUint8(i),i+=1}break;case P.uint32:t[n]=e.getUint32(i,!0),i+=4;break;case P.float32:t[n]=e.getFloat32(i,!0),i+=4;break;case P.float64:t[n]=e.getFloat64(i,!0),i+=8;break;case P.boolean:t[n]=0!==e.getUint8(i),i+=1;break;case P.speed:t[n]=(e.getUint16(i,!0)-32768)/1638.4,i+=2;break;case P.accel:t[n]=(e.getUint16(i,!0)-32768)/32768,i+=2;break;case P.coordx:t[n]=(e.getUint16(i,!0)-32768)/2,i+=2;break;case P.coordy:t[n]=(e.getUint16(i,!0)-32768)/4,i+=2;break;case P.coord24:{let s=256*e.getUint16(i,!0);i+=2,t[n]=(s+e.getUint8(i)-8388608)/512,i+=1}break;case P.rotation:t[n]=e.getUint16(i,!0)/6553.6,i+=2;break;case P.regen:t[n]=(e.getUint16(i,!0)-32768)/1e6,i+=2;break;case P.healthenergy:t[n]=e.getUint8(i)/255,i+=1;break;default:throw Error()}}n[a].push(t)}}break;case P.uint8:n[a]=e.getUint8(i),i+=1;break;case P.uint16:n[a]=e.getUint16(i,!0),i+=2;break;case P.uint24:{let t=256*e.getUint16(i,!0);i+=2,n[a]=t+e.getUint8(i),i+=1}break;case P.uint32:n[a]=e.getUint32(i,!0),i+=4;break;case P.float32:n[a]=e.getFloat32(i,!0),i+=4;break;case P.float64:n[a]=e.getFloat64(i,!0),i+=8;break;case P.boolean:n[a]=0!==e.getUint8(i),i+=1;break;case P.speed:n[a]=(e.getUint16(i,!0)-32768)/1638.4,i+=2;break;case P.accel:n[a]=(e.getUint16(i,!0)-32768)/32768,i+=2;break;case P.coordx:n[a]=(e.getUint16(i,!0)-32768)/2,i+=2;break;case P.coordy:n[a]=(e.getUint16(i,!0)-32768)/4,i+=2;break;case P.coord24:{let t=256*e.getUint16(i,!0);i+=2,n[a]=(t+e.getUint8(i)-8388608)/512,i+=1}break;case P.rotation:n[a]=e.getUint16(i,!0)/6553.6,i+=2;break;case P.regen:n[a]=(e.getUint16(i,!0)-32768)/1e6,i+=2;break;case P.healthenergy:n[a]=e.getUint8(i)/255,i+=1;break;default:return null}}return n},Z=(e,t,s)=>{let n=new DataView(e),i=n.getUint8(0),a=null,r=null,o=null;switch(t){case 1:a=z[i],o=L[i];break;case 0:a=J[i],o=_[i];break;default:return null}if(s&&a)r=a(e);else{if(null===o)return null;r=$(n,0,o)}return r},ee=(e,t=!0)=>Z(e,0,t);var et=((s={})[s.UP=1]="UP",s[s.DOWN=2]="DOWN",s[s.LEFT=3]="LEFT",s[s.RIGHT=4]="RIGHT",s[s.FIRE=5]="FIRE",s[s.SPECIAL=6]="SPECIAL",s);Object.assign({},...Object.entries(et).map(([e,t])=>({[t]:e})));var es=((n={})[n.PACKET_FLOODING_DISCONNECT=1]="PACKET_FLOODING_DISCONNECT",n[n.PACKET_FLOODING_BAN=2]="PACKET_FLOODING_BAN",n[n.GLOBAL_BAN=3]="GLOBAL_BAN",n[n.UNKNOWN_ERROR=4]="UNKNOWN_ERROR",n[n.REQUIRED_INACTIVITY_AND_HEALTH_TO_RESPAWN=5]="REQUIRED_INACTIVITY_AND_HEALTH_TO_RESPAWN",n[n.AFK_DISCONNECT=6]="AFK_DISCONNECT",n[n.PLAYER_KICKED=7]="PLAYER_KICKED",n[n.INVALID_LOGIN_DATA=8]="INVALID_LOGIN_DATA",n[n.INCORRECT_PROTOCOL=9]="INCORRECT_PROTOCOL",n[n.ACCOUNT_BANNED=10]="ACCOUNT_BANNED",n[n.ALREADY_LOGGED_IN=11]="ALREADY_LOGGED_IN",n[n.FORBIDDEN_TO_CHANGE_PLANE_IN_BTR=12]="FORBIDDEN_TO_CHANGE_PLANE_IN_BTR",n[n.REQUIRED_INACTIVITY_AND_HEALTH_TO_SPECTATE=13]="REQUIRED_INACTIVITY_AND_HEALTH_TO_SPECTATE",n[n.NOT_ENOUGH_UPGRADES=20]="NOT_ENOUGH_UPGRADES",n[n.CHAT_SPAMMING=30]="CHAT_SPAMMING",n[n.FLAG_CHANGE_TOO_FAST=31]="FLAG_CHANGE_TOO_FAST",n[n.UNKNOWN_COMMAND=100]="UNKNOWN_COMMAND",n),en=((i={})[i.ALERT=1]="ALERT",i[i.INFO=2]="INFO",i),ei=((a={})[a.PLAYER=0]="PLAYER",a[a.MOB=1]="MOB",a),ea=((r={})[r.PLAYER=0]="PLAYER",r[r.PREDATOR_MISSILE=1]="PREDATOR_MISSILE",r[r.GOLIATH_MISSILE=2]="GOLIATH_MISSILE",r[r.COPTER_MISSILE=3]="COPTER_MISSILE",r[r.TORNADO_MISSILE=5]="TORNADO_MISSILE",r[r.TORNADO_SMALL_MISSILE=6]="TORNADO_SMALL_MISSILE",r[r.PROWLER_MISSILE=7]="PROWLER_MISSILE",r[r.UPGRADE=4]="UPGRADE",r[r.SHIELD=8]="SHIELD",r[r.INFERNO=9]="INFERNO",r[r.FIREWALL=200]="FIREWALL",r),er=((o={})[o.INFORM=0]="INFORM",o[o.LEVELUP=1]="LEVELUP",o),eo=((l={})[l.ALIVE=0]="ALIVE",l[l.INACTIVE=1]="INACTIVE",l),el=((c={})[c.BTR=1]="BTR",c[c.CTF=2]="CTF",c),ec=((h={})[h.SHIELD=1]="SHIELD",h[h.INFERNO=2]="INFERNO",h),eh=((u={})[u.BLUE=1]="BLUE",u[u.RED=2]="RED",u),eu=((d={})[d.STATIC=1]="STATIC",d[d.DYNAMIC=2]="DYNAMIC",d),ed=((g={})[g.FFA=1]="FFA",g[g.CTF=2]="CTF",g[g.BTR=3]="BTR",g);Object.assign({},...Object.entries(((p={})[p.LOGIN=1]="LOGIN",p[p.CONNECTING=2]="CONNECTING",p[p.PLAYING=3]="PLAYING",p)).map(([e,t])=>({[t]:e})));const eg={WIDTH:32768,HEIGHT:16384},ep={1:"SY",2:"TH",3:"TM",4:"TN",5:"TR",6:"TT",7:"TW",8:"TZ",9:"UA",10:"UN",11:"US",12:"UY",13:"UZ",14:"VE",15:"VN",16:"PR",17:"PT",18:"PY",19:"QA",20:"RAINBOW",21:"RO",22:"RS",23:"RU",24:"SA",25:"SE",26:"SG",27:"SI",28:"SK",29:"SM",30:"MK",31:"MO",32:"MT",33:"MX",34:"MY",35:"NG",36:"NL",37:"NO",38:"NP",39:"NZ",40:"OM",41:"PA",42:"PE",43:"JP",44:"KP",45:"KR",46:"KW",47:"KZ",48:"LB",49:"LI",50:"LK",51:"LT",52:"LU",53:"LV",54:"HN",55:"HR",56:"HU",57:"ID",58:"IE",59:"IL",60:"IM",61:"IMPERIAL",62:"IN",63:"IQ",64:"DE",65:"DK",66:"DO",67:"DZ",68:"EC",69:"EE",70:"EG",71:"ES",72:"EU",73:"BH",74:"BO",75:"BR",76:"BT",77:"BY",78:"CA",79:"CH",80:"AD",81:"AE",82:"AL",83:"AM",84:"CL",85:"AQ",86:"CN",87:"AR",88:"FI",89:"CO",90:"AT",91:"IR",92:"FR",93:"COMMUNIST",94:"AU",95:"LY",96:"IS",97:"GB",98:"CONFEDERATE",99:"AZ",100:"MA",101:"IT",102:"GE",103:"CR",104:"BA",105:"PH",106:"MC",107:"JM",108:"GR",109:"CU",110:"BD",111:"SO",112:"PK",113:"MD",114:"JO",115:"GT",116:"CY",117:"BE",118:"ZA",119:"SV",120:"PL",121:"ME",122:"JOLLY",123:"HK",124:"CZ",125:"BG"};Object.assign({},...Object.entries(ep).map(([e,t])=>({[t]:~~e})));const eE={AL:"Albania",DZ:"Algeria",AD:"Andorra",AQ:"Antarctica",AR:"Argentina",AM:"Armenia",AU:"Australia",AT:"Austria",AZ:"Azerbaijan",BH:"Bahrain",BD:"Bangladesh",BY:"Belarus",BE:"Belgium",BT:"Bhutan",BO:"Bolivia",BA:"Bosnia and Herzegovina",BR:"Brazil",BG:"Bulgaria",CA:"Canada",CL:"Chile",CN:"China",CO:"Colombia",COMMUNIST:"Communist",CONFEDERATE:"Confederate",CR:"CostaRica",HR:"Croatia",CU:"Cuba",CY:"Cyprus",CZ:"Czech Republic",DK:"Denmark",DO:"Dominican Republic",KP:"DPRK",EC:"Ecuador",EG:"Egypt",SV:"ElSalvador",EE:"Estonia",EU:"European Union",FI:"Finland",FR:"France",GE:"Georgia",DE:"Germany",GR:"Greece",GT:"Guatemala",HN:"Honduras",HK:"HongKong",HU:"Hungary",IS:"Iceland",IMPERIAL:"Imperial Japan",IN:"India",ID:"Indonesia",IR:"Iran",IQ:"Iraq",IE:"Ireland",IM:"Isle of Man",IL:"Israel",IT:"Italy",JM:"Jamaica",JP:"Japan",JOLLY:"Jolly Rogers",JO:"Jordan",KZ:"Kazakhstan",KW:"Kuwait",LV:"Latvia",LB:"Lebanon",LY:"Libyan Arab Jamahiriya",LI:"Liechtenstein",LT:"Lithuania",LU:"Luxembourg",MO:"Macao",MK:"Macedonia",MY:"Malaysia",MT:"Malta",MX:"Mexico",MD:"Moldova",MC:"Monaco",ME:"Montenegro",MA:"Morocco",NP:"Nepal",NL:"Netherlands",NZ:"New Zealand",NG:"Nigeria",NO:"Norway",OM:"Oman",PK:"Pakistan",PA:"Panama",PY:"Paraguay",PE:"Peru",PH:"Philippines",PL:"Poland",PT:"Portugal",PR:"PuertoRico",QA:"Qatar",RAINBOW:"Rainbow",RO:"Romania",RU:"Russian Federation",SM:"SanMarino",SA:"Saudi Arabia",RS:"Serbia",SG:"Singapore",SK:"Slovakia",SI:"Slovenia",SO:"Somalia",ZA:"South Africa",KR:"South Korea",ES:"Spain",LK:"Sri Lanka",SE:"Sweden",CH:"Switzerland",SY:"Syrian Arab Republic",TW:"Taiwan",TZ:"Tanzania",TH:"Thailand",TT:"Trinidad and Tobago",TN:"Tunisia",TR:"Turkey",TM:"Turkmenistan",UA:"Ukraine",AE:"United Arab Emirates",GB:"United Kingdom",UN:"United Nations",US:"United States",UY:"Uruguay",UZ:"Uzbekistan",VE:"Venezuela",VN:"Vietnam"},ey=(e,t,s)=>e<=t?t:e>=s?s:e,ef=(e,t)=>({x:128*e-eg.WIDTH/2+64,y:ey(128*t-eg.HEIGHT,-eg.HEIGHT/2,eg.HEIGHT/2)+64}),em=e=>({speed:7&e,shield:(8&e)>>3,inferno:(16&e)>>4}),eA=e=>({keystate:{UP:(1&e)==1,DOWN:(2&e)==2,LEFT:(4&e)==4,RIGHT:(8&e)==8},boost:(16&e)==16,strafe:(32&e)==32,stealthed:(64&e)==64,flagspeed:(128&e)==128});class eU{static #e=this.performanceNow=()=>performance.now();constructor(e=null){this.timeoutMs=e,this.start()}start(){this.startTime=eU.performanceNow()}get elapsedMs(){return eU.performanceNow()-this.startTime}get elapsedSeconds(){return this.elapsedMs/1e3}get elapsedMinutes(){return this.elapsedSeconds/60}get hasTimedOut(){return!!this.timeoutMs&&this.elapsedMs>this.timeoutMs}get timeoutFraction(){return this.timeoutMs?this.elapsedMs/this.timeoutMs:0}}class eR{constructor(e){this.context=e,this.keyQueue=[],this.isWorkerInitializing=!1,this.stopwatchAfterCalculatingPath=new eU,this.initPathFindingWorker()}initPathFindingWorker(){!this.isWorkerInitializing&&this.calculatingPathStopwatch&&this.calculatingPathStopwatch.elapsedMs>500&&(this.context.logger.warn("Recycling pathfindingworker after "+this.calculatingPathStopwatch.elapsedMs+" ms"),this.pathFindingWorker.terminate(),this.pathFindingWorker=null,this.calculatingPathStopwatch=null),this.pathFindingWorker||(this.isWorkerInitializing=!0,this.pathFindingWorker=eR.createPathFindingWorker(),this.pathFindingWorker.onmessage=e=>{if("ready"===e.data){this.isWorkerInitializing=!1;return}let t=JSON.parse(e.data);this.calculatingPathStopwatch.elapsedMs<500&&(this.path=t.path),this.calculatingPathStopwatch=null,this.stopwatchAfterCalculatingPath.start()})}get needsNewPath(){return!this.calculatingPathStopwatch&&this.stopwatchAfterCalculatingPath.elapsedMs>500}calcPath(e){this.pathFindingWorker.postMessage(JSON.stringify(e)),this.calculatingPathStopwatch=new eU}stop(e=!1){this.path=null,this.playerToKill=null,this.autoPilotToFlag=!1,this.autoBoost=!1,(!this.autoFireToggledManually||e)&&(this.autoFire=!1)}isOn(){return!!this.path||!!this.playerToKill||!!this.autoPilotToFlag||!!this.autoFire}enqueueKey(e,t,s=0){this.keyQueue.push({key:e,state:t,duration:s})}eatKeyQueue(){let e=this.keyQueue;return this.keyQueue=[],e}requestTimeoutFor(e){return e.key===et.SPECIAL?this.boostTimeout?null:(this.boostTimeout=setTimeout(()=>{this.context.connection.sendKey(e.key,!e.state),this.context.botstate.boostTimeout=null},e.duration),this.boostTimeout):this.turningTimeout?null:(this.turningTimeout=setTimeout(()=>{this.context.connection.sendKey(e.key,!e.state),this.context.botstate.turningTimeout=null},e.duration),this.turningTimeout)}}var eT=((E={})[E.BOT_STEERING_INSTRUCTION=0]="BOT_STEERING_INSTRUCTION",E[E.CHAT_NOT_POSSIBLE_BC_MUTED=1]="CHAT_NOT_POSSIBLE_BC_MUTED",E[E.CHAT_PLAYER_MUTED=2]="CHAT_PLAYER_MUTED",E[E.CHAT_RECEIVED=3]="CHAT_RECEIVED",E[E.CHAT_SEND=4]="CHAT_SEND",E[E.CONNECTION_ERROR=5]="CONNECTION_ERROR",E[E.CONNECTION_CLOSE=6]="CONNECTION_CLOSE",E[E.CRATE_NEW=7]="CRATE_NEW",E[E.CTF_GAME_OVER=8]="CTF_GAME_OVER",E[E.EACH_SECOND=9]="EACH_SECOND",E[E.EXPLOSION=10]="EXPLOSION",E[E.FLAG_UPDATE=11]="FLAG_UPDATE",E[E.KEYBOARD=12]="KEYBOARD",E[E.LOGIN=13]="LOGIN",E[E.LEAVE_HORIZON=14]="LEAVE_HORIZON",E[E.MESSAGE_TO_PLAYER=15]="MESSAGE_TO_PLAYER",E[E.MOB_DESPAWN=16]="MOB_DESPAWN",E[E.MINI_MAP=17]="MINI_MAP",E[E.MISSILE_UPDATE=18]="MISSILE_UPDATE",E[E.MOUNTAIN_HIT=19]="MOUNTAIN_HIT",E[E.PLAYER_BOUNCE=20]="PLAYER_BOUNCE",E[E.PLAYER_BOOST=21]="PLAYER_BOOST",E[E.PLAYER_CHANGE_FLAG=22]="PLAYER_CHANGE_FLAG",E[E.PLAYER_FIRE=23]="PLAYER_FIRE",E[E.PLAYER_HIT=24]="PLAYER_HIT",E[E.PLAYER_KILLED=25]="PLAYER_KILLED",E[E.PLAYER_LEAVE=26]="PLAYER_LEAVE",E[E.PLAYER_LEVEL=27]="PLAYER_LEVEL",E[E.PLAYER_NEW=28]="PLAYER_NEW",E[E.PLAYER_POWERUP=29]="PLAYER_POWERUP",E[E.PLAYER_REPEL=30]="PLAYER_REPEL",E[E.PLAYER_RESPAWN=31]="PLAYER_RESPAWN",E[E.PLAYER_UPDATE=32]="PLAYER_UPDATE",E[E.PLAYER_UPGRADE_APPLIED=33]="PLAYER_UPGRADE_APPLIED",E[E.PLAYER_SPECTATE=34]="PLAYER_SPECTATE",E[E.PLAYER_STEALTH=35]="PLAYER_STEALTH",E[E.PLAYER_SWITCH_TYPE=36]="PLAYER_SWITCH_TYPE",E[E.SERVER_ANNOUNCEMENT=37]="SERVER_ANNOUNCEMENT",E[E.SERVER_COMMAND_REPLY=38]="SERVER_COMMAND_REPLY",E[E.SERVER_CUSTOM=39]="SERVER_CUSTOM",E[E.SERVER_ERROR=40]="SERVER_ERROR",E[E.SERVER_MESSAGE=41]="SERVER_MESSAGE",E[E.SCORE_BOARD=42]="SCORE_BOARD",E[E.SCORE_DETAILED=43]="SCORE_DETAILED",E[E.SCORE_UPDATE=44]="SCORE_UPDATE",E[E.SPAM_WARING_RECEIVED=45]="SPAM_WARING_RECEIVED",E[E.TEAMS=46]="TEAMS",E[E.TICK=47]="TICK",E);const ew=1e3/60;class ex{constructor(e){this.context=e,this.skippedFrames=0}startProcessingEventQueue(){for(let e of(this.handlersByType={},this.context.handlers))for(let t of e.handles){let s=this.handlersByType[t]||[];s.push(e),this.handlersByType[t]=s}this.context.tm.setInterval(()=>this.tick(),Math.floor(ew))}tick(){this.stopwatch||(this.stopwatch=new eU,this.tickCounter=1,this.eachSecondStopwatch=new eU,this.skippedFrames=0);let e=this.context.connection.getLagMs(),t=this.stopwatch.elapsedMs+e,s=!1;if(t<ew)s=!0;else if(t>ew*(this.tickCounter+1))this.skippedFrames++;else{let e=this.skippedFrames+t/(ew*this.tickCounter);for(this.context.eventQueue.pub(eT.TICK,{frame:this.tickCounter,frameFactor:e,skippedFrames:this.skippedFrames,timeFromStart:t}),this.eachSecondStopwatch.elapsedSeconds>=1&&(this.context.eventQueue.pub(eT.EACH_SECOND,{}),this.eachSecondStopwatch.start()),this.skippedFrames=0;;){let e=this.context.eventQueue.dequeue();if(!e)break;this.process(e)}}this.context.state.skippedFrames=this.skippedFrames,!s&&this.tickCounter++,this.skippedFrames>300?this.stopwatch=null:(this.skippedFrames>0||s)&&this.context.tm.setTimeout(()=>this.tick(),1)}process(e){for(let t of this.handlersByType[e.type]||[])try{t.exec(e)}catch(n){let s=JSON.parse(JSON.stringify(n,Object.getOwnPropertyNames(n)));this.context.logger.error(`Error handling message ${e.type} with handler ${t.constructor.name}`,s)}}}class eI{constructor(e){this.context=e,this.handles=[eT.CHAT_SEND]}exec(e){let t=e.args;this.context.connection.sendChat(t.type,t.text,t.playerId)}}class eS{constructor(e){this.context=e,this.handles=[eT.KEYBOARD]}exec(e){let t=e.args;this.context.connection.sendKey(t.key,t.state)}}const eP={MIN_X:-16384,MIN_Y:-8192,MAX_X:16384,MAX_Y:8192},eL={MIN_X:-16352,MIN_Y:-8160,MAX_X:16352,MAX_Y:8160},e_={[ea.PREDATOR_MISSILE]:{maxSpeed:9,baseSpeed:4.05,speedFactor:.3,infernoSpeedFactor:1,accel:.105,damage:.4,infernoDamageFactor:1,distance:1104,shape:1,repelEnergy:197},[ea.GOLIATH_MISSILE]:{maxSpeed:6,baseSpeed:2.1,speedFactor:.3,infernoSpeedFactor:1,accel:.0375,damage:1.2,infernoDamageFactor:1,distance:1076,shape:2,repelEnergy:260},[ea.COPTER_MISSILE]:{maxSpeed:9,baseSpeed:5.7,speedFactor:.3,infernoSpeedFactor:1,accel:.14,damage:.2,infernoDamageFactor:1,distance:1161,shape:3,repelEnergy:155},[ea.TORNADO_MISSILE]:{maxSpeed:7,baseSpeed:3.5,speedFactor:.3,infernoSpeedFactor:1,accel:.0875,damage:.4,infernoDamageFactor:1,distance:997,shape:1,repelEnergy:186},[ea.TORNADO_SMALL_MISSILE]:{maxSpeed:7,baseSpeed:3.5,speedFactor:.3,infernoSpeedFactor:1,accel:.0875,damage:.3,infernoDamageFactor:1,distance:581,shape:1,repelEnergy:145},[ea.PROWLER_MISSILE]:{maxSpeed:7,baseSpeed:2.8,speedFactor:.3,infernoSpeedFactor:1,accel:.07,damage:.45,infernoDamageFactor:1,distance:819,shape:1,repelEnergy:168}};class eO{constructor(e){this.context=e,this.handles=[eT.TICK]}exec(e){let t=e.args;for(let e of this.context.state.getMissiles()){let s=e_[e.mobType],n=e.speed.x,i=e.speed.y,a=t.frameFactor;e.speed.x+=e.accel.x*a,e.speed.y+=e.accel.y*a;let r=Math.hypot(e.speed.x,e.speed.y);r>e.maxSpeed?(e.speed.x*=e.maxSpeed/r,e.speed.y*=e.maxSpeed/r,e.speed.length=e.maxSpeed):e.speed.length=r,e.pos.x+=(n+.5*(e.speed.x-n))*a,e.pos.y+=(i+.5*(e.speed.y-i))*a,e.distance=(e.distance||0)+Math.hypot(e.speed.x,e.speed.y),(e.pos.x<eP.MIN_X||e.pos.x>eP.MAX_X||e.pos.y<eP.MIN_Y||e.pos.y>eP.MAX_Y||e.distance>=s.distance)&&this.context.state.removeMob(e.id)}}}const eb={PREDATOR:1,GOLIATH:2,COPTER:3,TORNADO:4,PROWLER:5},eC="fire",eM="infernoFire",eN=(e,t,s,n,i=!1)=>({type:e,x:t,y:s,rot:n,alt:i}),ek=(e=[],t=[])=>({default:e,special:t}),eD={[eb.PREDATOR]:{name:"raptor",turnFactor:.065,accelFactor:.225,brakeFactor:.025,boostFactor:1.5,infernoFactor:.75,maxSpeed:5.5,minSpeed:.001,flagSpeed:5,healthRegen:.001,energyRegen:.008,fireEnergy:.6,specialEnergy:0,specialEnergyRegen:-.01,specialDelay:0,fireDelay:550,damageFactor:2,energyLight:.6,collisions:[[0,5,23],[0,-15,15],[0,-25,12]],repelEnergy:2100,[eC]:ek([eN(ea.PREDATOR_MISSILE,0,35,0)]),[eM]:ek([eN(ea.PREDATOR_MISSILE,-20,5,-.05),eN(ea.PREDATOR_MISSILE,0,35,0),eN(ea.PREDATOR_MISSILE,20,5,.05)])},[eb.GOLIATH]:{name:"spirit",turnFactor:.04,accelFactor:.15,brakeFactor:.015,boostFactor:1,infernoFactor:.75,maxSpeed:3.5,minSpeed:.001,flagSpeed:5,healthRegen:5e-4,energyRegen:.005,fireEnergy:.9,specialEnergy:.5,specialEnergyRegen:0,specialDelay:1e3,fireDelay:300,damageFactor:1,energyLight:.9,collisions:[[0,0,35],[50,14,16],[74,26,14],[30,8,23],[63,22,15],[-50,14,16],[-74,26,14],[-30,8,23],[-63,22,15]],repelEnergy:7500,[eC]:ek([eN(ea.GOLIATH_MISSILE,0,35,0)]),[eM]:ek([eN(ea.GOLIATH_MISSILE,-30,0,-.05),eN(ea.GOLIATH_MISSILE,0,35,0),eN(ea.GOLIATH_MISSILE,30,0,.05)])},[eb.COPTER]:{name:"mohawk",turnFactor:.07,accelFactor:.275,brakeFactor:.025,boostFactor:1,infernoFactor:.75,maxSpeed:6,minSpeed:.001,flagSpeed:5,healthRegen:.001,energyRegen:.01,fireEnergy:.3,specialEnergy:0,specialEnergyRegen:0,specialDelay:0,fireDelay:300,damageFactor:2.78,energyLight:.3,collisions:[[0,-12,15],[0,0,17],[0,13,15],[0,26,15]],repelEnergy:1800,[eC]:ek([eN(ea.COPTER_MISSILE,15,10,0,!0)]),[eM]:ek([eN(ea.COPTER_MISSILE,-10,5,-.05),eN(ea.COPTER_MISSILE,0,10,0),eN(ea.COPTER_MISSILE,10,5,.05)])},[eb.TORNADO]:{name:"tornado",turnFactor:.055,accelFactor:.2,brakeFactor:.025,boostFactor:1,infernoFactor:.75,maxSpeed:4.5,minSpeed:.001,flagSpeed:5,healthRegen:.001,energyRegen:.006,fireEnergy:.5,specialEnergy:.9,specialEnergyRegen:0,specialDelay:0,fireDelay:500,damageFactor:5/3,energyLight:.5,collisions:[[0,8,18],[14,12,13],[-14,12,13],[0,-12,16],[0,-26,14],[0,-35,12]],repelEnergy:2400,[eC]:ek([eN(ea.TORNADO_MISSILE,0,40,0)],[eN(ea.TORNADO_SMALL_MISSILE,-15,10,-.05),eN(ea.TORNADO_SMALL_MISSILE,0,40,0),eN(ea.TORNADO_SMALL_MISSILE,15,10,.05)]),[eM]:ek([eN(ea.TORNADO_MISSILE,-15,10,-.05),eN(ea.TORNADO_MISSILE,0,40,0),eN(ea.TORNADO_MISSILE,15,10,.05)],[eN(ea.TORNADO_MISSILE,-30,20,-.06),eN(ea.TORNADO_MISSILE,-20,15,-.03),eN(ea.TORNADO_MISSILE,0,40,0),eN(ea.TORNADO_MISSILE,20,15,.03),eN(ea.TORNADO_MISSILE,30,20,.06)])},[eb.PROWLER]:{name:"prowler",turnFactor:.055,accelFactor:.2,brakeFactor:.025,boostFactor:1,infernoFactor:.75,maxSpeed:4.5,minSpeed:.001,flagSpeed:5,healthRegen:.001,energyRegen:.006,fireEnergy:.75,specialEnergy:.6,specialEnergyRegen:0,specialDelay:1500,damageFactor:5/3,fireDelay:300,energyLight:.75,collisions:[[0,11,25],[0,-8,18],[19,20,10],[-19,20,10],[0,-20,14]],repelEnergy:2600,[eC]:ek([eN(ea.PROWLER_MISSILE,0,35,0)]),[eM]:ek([eN(ea.PROWLER_MISSILE,-20,0,-.05),eN(ea.PROWLER_MISSILE,0,35,0),eN(ea.PROWLER_MISSILE,20,0,.05)])}},ev={SPEED:{cost:[0,1,1,1,1,1],factor:[1,1.05,1.1,1.15,1.2,1.25]}};class eB{constructor(e,t=3){this.context=e,this.intervalSeconds=t,this.stopwatch=new eU}log(e,...t){this.stopwatch.elapsedSeconds<this.intervalSeconds||(this.context.logger.info(e,...t),this.stopwatch.start())}}const eY=2*Math.PI;class eF{constructor(e){this.context=e,this.handles=[eT.TICK],this.logger=new eB(this.context)}exec(e){let t=e.args;for(let e of this.context.state.getPlayers())e.status!==eo.INACTIVE&&this.updatePlayer(e,t)}updatePlayer(e,t){let s=eD[e.type],n=e.boost?s.boostFactor:1,i=t.frameFactor;if(!isNaN(e.energyRegen)){let t=e.energyRegen*i;e.energy+=t,e.energy>1?e.energy=1:e.energy<0?e.energy=0:isNaN(e.energy)&&(e.energy=1)}e.health+=i*s.healthRegen,e.health>1?e.health=1:e.health<0&&(e.health=0),e.shieldOrInfernoTimer&&e.shieldOrInfernoTimer.hasTimedOut&&(e.shieldOrInfernoTimer=null,e.powerUps.inferno=null,e.powerUps.shield=null);let a=-999;e.strafe?(e.keystate.LEFT&&(a=e.rot-.5*Math.PI),e.keystate.RIGHT&&(a=e.rot+.5*Math.PI)):(e.keystate.LEFT||e.keystate.RIGHT)&&(e.keystate.LEFT&&(e.rot-=i*s.turnFactor),e.keystate.RIGHT&&(e.rot+=i*s.turnFactor),e.rot=(e.rot%eY+eY)%eY),e.keystate.UP?-999===a?a=e.rot:a+=Math.PI*(e.keystate.RIGHT?-.25:.25):e.keystate.DOWN&&(-999===a?a=e.rot+Math.PI:a+=Math.PI*(e.keystate.RIGHT?.25:-.25));let r=0;if(0!==e.speed.x||0!==e.speed.y||e.keystate.UP||e.keystate.DOWN||e.strafe){let t=e.speed.x,o=e.speed.y;-999!==a&&(e.speed.x+=Math.sin(a)*s.accelFactor*n*i,e.speed.y-=Math.cos(a)*s.accelFactor*n*i),r=Math.hypot(e.speed.x,e.speed.y);let l=s.maxSpeed*n*ev.SPEED.factor[e.upgrades.speed];e.powerUps.inferno&&(l*=s.infernoFactor),e.flagspeed&&(l=s.flagSpeed),r>l?(e.speed.x*=l/r,e.speed.y*=l/r):e.speed.x>s.minSpeed||e.speed.x<-s.minSpeed||e.speed.y>s.minSpeed||e.speed.y<-s.minSpeed?(e.speed.x*=1-s.brakeFactor*i,e.speed.y*=1-s.brakeFactor*i):(e.speed.x=0,e.speed.y=0),e.pos.x+=i*t+.5*(e.speed.x-t)*i*i,e.pos.y+=i*o+.5*(e.speed.y-o)*i*i}e.pos.x<eL.MIN_X&&(e.pos.x=eL.MIN_X),e.pos.x>eL.MAX_X&&(e.pos.x=eL.MAX_X),e.pos.y<eL.MIN_Y&&(e.pos.y=eL.MIN_Y),e.pos.y>eL.MAX_Y&&(e.pos.y=eL.MAX_Y)}}var eV=((y={})[y.CHAT=0]="CHAT",y[y.SAY=1]="SAY",y[y.TEAM=2]="TEAM",y[y.WHISPER=3]="WHISPER",y);class eH{constructor(e){this.context=e,this.handles=[eT.SERVER_MESSAGE]}exec(e){let t;let s=e.args;switch(s.c){case S.CHAT_PUBLIC:t=eV.CHAT,this.context.eventQueue.pub(eT.CHAT_RECEIVED,{chatMessage:s.text,chatType:t,playerId:s.id});break;case S.CHAT_SAY:t=eV.SAY,this.context.eventQueue.pub(eT.CHAT_RECEIVED,{chatMessage:s.text,chatType:t,playerId:s.id});break;case S.CHAT_TEAM:t=eV.TEAM,this.context.eventQueue.pub(eT.CHAT_RECEIVED,{chatMessage:s.text,chatType:t,playerId:s.id});break;case S.CHAT_WHISPER:t=eV.WHISPER,this.context.eventQueue.pub(eT.CHAT_RECEIVED,{chatMessage:s.text,chatType:t,playerId:s.from,to:s.to});break;case S.CHAT_VOTEMUTED:this.context.eventQueue.pub(eT.CHAT_NOT_POSSIBLE_BC_MUTED,s);break;case S.CHAT_VOTEMUTEPASSED:this.context.eventQueue.pub(eT.CHAT_PLAYER_MUTED,s);break;case S.COMMAND_REPLY:this.context.eventQueue.pub(eT.SERVER_COMMAND_REPLY,s);break;case S.ERROR:this.context.eventQueue.pub(eT.SERVER_ERROR,s);break;case S.EVENT_BOOST:this.context.eventQueue.pub(eT.PLAYER_BOOST,s);break;case S.EVENT_BOUNCE:this.context.eventQueue.pub(eT.PLAYER_BOUNCE,s);break;case S.EVENT_LEAVEHORIZON:this.context.eventQueue.pub(eT.LEAVE_HORIZON,s);break;case S.EVENT_REPEL:this.context.eventQueue.pub(eT.PLAYER_REPEL,s);break;case S.EVENT_STEALTH:this.context.eventQueue.pub(eT.PLAYER_STEALTH,s);break;case S.GAME_FLAG:this.context.eventQueue.pub(eT.FLAG_UPDATE,s);break;case S.GAME_SPECTATE:this.context.eventQueue.pub(eT.PLAYER_SPECTATE,s);case S.LOGIN:this.context.eventQueue.pub(eT.LOGIN,s);break;case S.MOB_DESPAWN:this.context.eventQueue.pub(eT.MOB_DESPAWN,s);break;case S.MOB_DESPAWN_COORDS:this.context.eventQueue.pub(eT.MOUNTAIN_HIT,s);break;case S.MOB_UPDATE:this.context.eventQueue.pub(eT.MISSILE_UPDATE,s);break;case S.MOB_UPDATE_STATIONARY:this.context.eventQueue.pub(eT.CRATE_NEW,s);break;case S.PLAYER_FIRE:this.context.eventQueue.pub(eT.PLAYER_FIRE,s);break;case S.PLAYER_FLAG:this.context.eventQueue.pub(eT.PLAYER_CHANGE_FLAG,s);break;case S.PLAYER_HIT:this.context.eventQueue.pub(eT.PLAYER_HIT,s);break;case S.PLAYER_KILL:this.context.eventQueue.pub(eT.PLAYER_KILLED,s);break;case S.PLAYER_LEAVE:this.context.eventQueue.pub(eT.PLAYER_LEAVE,s);break;case S.PLAYER_LEVEL:this.context.eventQueue.pub(eT.PLAYER_LEVEL,s);break;case S.PLAYER_NEW:this.context.eventQueue.pub(eT.PLAYER_NEW,s);break;case S.PLAYER_POWERUP:this.context.eventQueue.pub(eT.PLAYER_POWERUP,s);break;case S.PLAYER_UPDATE:this.context.eventQueue.pub(eT.PLAYER_UPDATE,s);break;case S.PLAYER_RETEAM:this.context.eventQueue.pub(eT.TEAMS,s);break;case S.PLAYER_UPGRADE:this.context.eventQueue.pub(eT.PLAYER_UPGRADE_APPLIED,s);break;case S.PLAYER_RESPAWN:this.context.eventQueue.pub(eT.PLAYER_RESPAWN,s);break;case S.PLAYER_TYPE:this.context.eventQueue.pub(eT.PLAYER_SWITCH_TYPE,s);break;case S.SERVER_CUSTOM:this.context.eventQueue.pub(eT.SERVER_CUSTOM,s);break;case S.SERVER_MESSAGE:this.context.eventQueue.pub(eT.SERVER_ANNOUNCEMENT,s);break;case S.SCORE_BOARD:this.context.eventQueue.pub(eT.SCORE_BOARD,s.data),this.context.eventQueue.pub(eT.MINI_MAP,s.rankings);break;case S.SCORE_DETAILED:case S.SCORE_DETAILED_CTF:this.context.eventQueue.pub(eT.SCORE_DETAILED,{ffaScores:s.scores});break;case S.SCORE_UPDATE:this.context.eventQueue.pub(eT.SCORE_UPDATE,s)}}}const eG=2*Math.PI;class eW{constructor(e,t){(e||0===e)&&(t||0===t)?(this.x=e,this.y=t):e?(this.x=e.x,this.y=e.y):(this.x=0,this.y=0)}direction(){let e=-(Math.atan2(this.x,this.y)+Math.PI);return e<0&&(e+=eG),e>eG&&(e-=eG),e}equals(e){return!!e&&e.x===this.x&&e.y===this.y}}class eK{get pos(){return this.highResPos}set pos(e){this.highResPos=e,this.posUpdateTimer.start()}constructor(){this.posUpdateTimer=new eU,this.speed=new eW,this.pos=new eW,this.accel=new eW}}class eX{constructor(e){this.context=e,this.handles=[eT.CRATE_NEW]}exec(e){let t=e.args,s=new eK;s.id=t.id,s.pos=new eW(t.posX,t.posY),s.mobType=t.type,this.context.state.addMob(s)}}class ez{constructor(e){this.context=e,this.handles=[eT.FLAG_UPDATE]}exec(e){let t=e.args,s=this.context.state.getCtfTeam(t.flag);s.flagState=t.type,s.flagTakenById=t.id,s.flagPos=new eW(t.posX,t.posY),this.context.state.getCtfTeam(eh.BLUE).score=t.blueteam,this.context.state.getCtfTeam(eh.RED).score=t.redteam}}class eQ{constructor(e){this.context=e,this.handles=[eT.LEAVE_HORIZON]}exec(e){let t;let s=e.args;(t=s.type===ei.MOB?this.context.state.getMobById(s.id):this.context.state.getPlayerById(s.id))&&(t.isVisibleOnScreen=!1),s.type!==ei.PLAYER&&this.context.state.removeMob(s.id)}}class ej{static upgradesToPowerUps(e){return e?em(e):null}static keystateToPlayerMovements(e){return e?eA(e):null}}class eq{}class eJ{constructor(){this.speed=0,this.defense=0,this.energy=0,this.missile=0,this.available=0}}class e$ extends eK{get posFromMinimap(){return this.lowResPos}set posFromMinimap(e){this.lowResPos=e,this.lowResPosUpdateTimer.start()}constructor(){super(),this.energy=1,this.health=1,this.score=0,this.lowResPosUpdateTimer=new eU,this.mobType=ea.PLAYER,this.upgrades=new eJ,this.powerUps=new eq,this.keystate={}}get mostReliablePos(){return this.posUpdateTimer.elapsedMs-this.lowResPosUpdateTimer.elapsedMs<4e3||!this.lowResPos?this.pos:this.lowResPos}setMovements(e){e?(this.boost=e.boost,this.flagspeed=e.flagspeed,this.stealthed=e.stealthed,this.strafe=e.strafe,this.keystate=e.keystate):(this.boost=!1,this.flagspeed=!1,this.stealthed=!1,this.strafe=!1,this.keystate={})}}class eZ{constructor(e){this.context=e,this.handles=[eT.LOGIN]}exec(e){let t=e.args,s=this.context.state;if(s.id=t.id,this.context.state.spectatingId||(s.myPlayerId=t.id),!t.players)return;s.team=t.team,this.context.gameType=ed.FFA,(t.team===eh.BLUE||t.team===eh.RED)&&(this.context.gameType=ed.CTF);let n=0;for(let e of t.players){let t=new e$;n++,t.id=e.id,t.flag=e.flag,t.name=e.name,t.pos=new eW(e.posX,e.posY),t.type=e.type,t.rot=e.rot,t.status=e.status,t.team=e.team,t.ranking=n,t.health=1,t.energy=1,t.level=e.level,t.powerUps=ej.upgradesToPowerUps(e.upgrades)||new eq,s.addPlayer(t)}}}class e1{constructor(e){this.context=e,this.handles=[eT.MINI_MAP]}exec(e){for(let t of e.args){let e=this.context.state.getPlayerById(t.id);if(e){if(0===t.x&&0===t.y){let t=this.context.state.getFocusedPlayer();t&&t.stealthed&&(e.status=eo.INACTIVE)}else{let s=ef(t.x,t.y);e.posFromMinimap=new eW(s)}}}}}class e0{constructor(e){this.context=e,this.handles=[eT.MISSILE_UPDATE]}exec(e){let t=e.args,s=this.context.state.getMobById(t.id);s||((s=new eK).id=t.id,this.context.state.addMob(s)),s.isVisibleOnScreen=!0,s.pos=new eW(t.posX,t.posY),s.accel=new eW(t.accelX,t.accelY),s.maxSpeed=t.maxSpeed,s.speed=new eW(t.speedX,t.speedY),s.rot=s.speed.direction(),s.mobType=t.type}}class e2{constructor(e){this.context=e,this.handles=[eT.MOB_DESPAWN]}exec(e){let t=e.args;this.context.state.removeMob(t.id)}}class e8{constructor(e){this.context=e,this.handles=[eT.MOUNTAIN_HIT]}exec(e){let t=e.args;this.context.eventQueue.pub(eT.EXPLOSION,{pos:new eW(t.posX,t.posY),type:t.type}),this.context.state.removeMob(t.id)}}class e6{constructor(e){this.context=e,this.handles=[eT.PLAYER_BOOST]}exec(e){let t=e.args,s=this.context.state.getPlayerById(t.id);s&&(s.boost=t.boost,s.energy=t.energy,s.energyRegen=t.energyRegen,s.pos=new eW(t.posX,t.posY),s.rot=t.rot,s.speed=new eW(t.speedX,t.speedY))}}class e3{constructor(e){this.context=e,this.handles=[eT.PLAYER_BOUNCE]}exec(e){let t=e.args,s=this.context.state.getPlayerById(t.id);if(!s)return;let n=ej.keystateToPlayerMovements(t.keystate);s.setMovements(n),s.pos=new eW(t.posX,t.posY),s.rot=t.rot,s.speed=new eW(t.speedX,t.speedY)}}class e4{constructor(e){this.context=e,this.handles=[eT.PLAYER_CHANGE_FLAG]}exec(e){let t=e.args,s=this.context.state.getPlayerById(t.id);s&&(s.flag=t.flag)}}class e5{constructor(e){this.context=e,this.handles=[eT.PLAYER_FIRE]}exec(e){let t=e.args,s=this.context.state.getPlayerById(t.id);if(s)for(let e of(s.energy=t.energy,s.energyRegen=t.energyRegen,t.projectiles)){let n=new eK;n.id=e.id,n.pos=new eW(e.posX,e.posY),n.accel=new eW(e.accelX,e.accelY),n.maxSpeed=e.maxSpeed,n.speed=new eW(e.speedX,e.speedY),n.mobType=e.type,n.ownerId=t.id,n.rot=n.speed.direction(),n.team=s.team,this.context.state.addMob(n)}}}class e7{constructor(e){this.context=e,this.handles=[eT.PLAYER_HIT]}exec(e){let t=e.args;for(let e of(this.context.eventQueue.pub(eT.EXPLOSION,{pos:new eW(t.posX,t.posY),type:t.type}),t.players)){let t=this.context.state.getPlayerById(e.id);t&&(t.health=e.health,t.healthRegen=e.healthRegen)}this.context.state.removeMob(t.id)}}class e9{constructor(e){this.context=e,this.handles=[eT.PLAYER_KILLED]}exec(e){let t=e.args,s=this.context.state.getPlayerById(t.id);s&&(s.status=eo.INACTIVE)}}class te{constructor(e){this.context=e,this.handles=[eT.PLAYER_LEAVE]}exec(e){let t=e.args;this.context.state.removePlayer(t.id)}}class tt{constructor(e){this.context=e,this.handles=[eT.PLAYER_LEVEL]}exec(e){let t=e.args,s=this.context.state.getPlayerById(t.id);s&&(s.level=t.level,t.type===er.LEVELUP&&t.id===this.context.state.id&&this.context.eventQueue.pub(eT.MESSAGE_TO_PLAYER,{message:`You have reached level ${s.level}!`}))}}class ts{constructor(e){this.context=e,this.handles=[eT.PLAYER_NEW]}exec(e){let t=e.args,s=new e$;s.id=t.id,s.flag=t.flag,s.name=t.name,s.pos=new eW(t.posX,t.posY),s.type=t.type,s.rot=t.rot,s.status=t.status,s.team=t.team,s.energy=1,s.health=1,s.powerUps=ej.upgradesToPowerUps(t.upgrades)||new eq,this.context.state.addPlayer(s)}}class tn{constructor(e){this.context=e,this.handles=[eT.PLAYER_POWERUP]}exec(e){let t=e.args,s=this.context.state.getFocusedPlayer();s&&(s.hasShield=t.type===ec.SHIELD,s.hasInferno=t.type===ec.INFERNO,s.shieldOrInfernoTimer=new eU(t.duration))}}class ti{constructor(e){this.context=e,this.handles=[eT.PLAYER_REPEL]}exec(e){let t=e.args,s=this.context.state.getPlayerById(t.id);for(let e of(s&&(s.pos=new eW(t.posX,t.posY),s.rot=t.rot,s.speed=new eW(t.speedX,t.speedY),s.energyRegen=t.energyRegen,s.energy=t.energy),t.players)){let t=this.context.state.getPlayerById(e.id);if(!t)continue;let s=ej.keystateToPlayerMovements(e.keystate);t.setMovements(s),t.pos=new eW(e.posX,e.posY),t.rot=e.rot,t.speed=new eW(e.speedX,e.speedY),t.energyRegen=e.energyRegen,t.energy=e.energy,t.health=e.playerHealth,t.healthRegen=e.playerHealthRegen}for(let e of t.mobs){let n=this.context.state.getMobById(e.id);n&&(n.pos=new eW(e.posX,e.posY),n.accel=new eW(e.accelX,e.accelY),n.maxSpeed=e.maxSpeed,n.speed=new eW(e.speedX,e.speedY),n.rot=n.speed.direction(),n.mobType=e.type,n.ownerId=t.id,n.team=s.team)}}}class ta{constructor(e){this.context=e,this.handles=[eT.PLAYER_RESPAWN]}exec(e){let t=e.args,s=this.context.state.getPlayerById(t.id);s&&(s.pos=new eW(t.posX,t.posY),s.rot=t.rot,s.powerUps=ej.upgradesToPowerUps(t.upgrades)||new eq,s.status=eo.ALIVE,s.health=1,s.energy=1,t.id===this.context.state.myPlayerId&&this.context.state.spectatingId&&(this.context.state.spectatingId=null,this.context.state.id=this.context.state.myPlayerId))}}class tr{constructor(e){this.context=e,this.handles=[eT.PLAYER_SPECTATE]}exec(e){let t=e.args;this.context.state.getPlayerById(t.id)&&(this.context.state.spectatingId=t.id)}}class to{constructor(e){this.context=e,this.handles=[eT.PLAYER_STEALTH]}exec(e){let t=e.args,s=this.context.state.getPlayerById(t.id);s&&(s.stealthed=t.state,s.energy=t.energy,s.energyRegen=t.energyRegen)}}class tl{constructor(e){this.context=e,this.handles=[eT.PLAYER_SWITCH_TYPE]}exec(e){let t=e.args,s=this.context.state.getPlayerById(t.id);s&&(s.type=t.type)}}class tc{constructor(e){this.context=e,this.handles=[eT.PLAYER_UPDATE]}exec(e){let t=e.args,s=this.context.state.getPlayerById(t.id);if(!s)return;s.isVisibleOnScreen=!0;let n=ej.keystateToPlayerMovements(t.keystate);s.setMovements(n);let i=ej.upgradesToPowerUps(t.upgrades);s.powerUps=i||new eq,s.upgrades=s.upgrades||new eJ,s.upgrades.speed=s.powerUps.speed||0,s.pos=new eW(t.posX,t.posY),s.rot=t.rot,s.speed=new eW(t.speedX,t.speedY)}}class th{constructor(e){this.context=e,this.handles=[eT.PLAYER_UPGRADE_APPLIED]}exec(e){let t=this.context.state.getFocusedPlayer();if(!t)return;t.upgrades||(t.upgrades=new eJ);let s=e.args,n=t.upgrades;n.available=s.upgrades,n.defense=s.defense,n.energy=s.energy,n.missile=s.missile,n.speed=s.speed}}class tu{constructor(e){this.context=e,this.handles=[eT.SCORE_BOARD]}exec(e){let t=e.args,s=0;for(let e of t){s++;let t=this.context.state.getPlayerById(e.id);t&&(t.score=e.score,t.level=e.level,t.ranking=s)}}}class td{constructor(e){this.context=e,this.handles=[eT.SCORE_DETAILED]}exec(e){let t=e.args;if(t.ffaScores)for(let e of t.ffaScores){let t=this.context.state.getPlayerById(e.id);t&&(t.score=e.score,t.level=e.level,t.kills=e.kills,t.deaths=e.deaths,t.damage=e.damage,t.ping=e.ping)}else if(t.ctfScores)for(let e of t.ctfScores){let t=this.context.state.getPlayerById(e.id);t&&(t.score=e.score,t.level=e.level,t.kills=e.kills,t.deaths=e.deaths,t.damage=e.damage,t.ping=e.ping,t.captures=e.captures)}}}class tg{constructor(e){this.context=e,this.handles=[eT.SCORE_UPDATE]}exec(e){let t=e.args,s=this.context.state.getPlayerById(t.id);s&&(s.score=t.score,s.kills=t.totalkills,s.deaths=t.totaldeaths,s.upgrades||(s.upgrades=new eJ),s.upgrades.available=t.upgrades)}}class tp{constructor(e){this.context=e,this.handles=[eT.SERVER_ANNOUNCEMENT]}exec(e){let t=e.args;this.context.logger.info("Server message: "+t.text)}}class tE{constructor(e){this.context=e,this.handles=[eT.SERVER_COMMAND_REPLY,eT.CHAT_NOT_POSSIBLE_BC_MUTED]}exec(e){if(e.type===eT.CHAT_NOT_POSSIBLE_BC_MUTED)this.context.eventQueue.pub(eT.MESSAGE_TO_PLAYER,{message:"You have been muted."});else{let t=e.args;"Don't spam!"===t.text&&this.context.eventQueue.pub(eT.SPAM_WARING_RECEIVED,{}),this.context.eventQueue.pub(eT.MESSAGE_TO_PLAYER,{message:t.text})}}}class ty{constructor(e){this.context=e,this.handles=[eT.SERVER_CUSTOM]}exec(e){let t=e.args;if(t.type===el.CTF){let e=JSON.parse(t.data);this.context.eventQueue.pub(eT.CTF_GAME_OVER,e)}}}class tf{constructor(e){this.context=e,this.handles=[eT.SERVER_ERROR]}exec(e){let t=e.args;this.context.logger.error("Server reports error: "+t.error)}}class tm{constructor(e){this.context=e,this.handles=[eT.TEAMS]}exec(e){for(let t of e.args.players){t.id===this.context.state.myPlayerId&&(this.context.state.team=t.team);let e=this.context.state.getPlayerById(t.id);e&&(e.team=t.team)}}}class tA{static getDefaultHandlers(e){return[new eX(e),new ez(e),new eQ(e),new eZ(e),new e1(e),new e0(e),new e2(e),new e8(e),new e6(e),new e3(e),new e4(e),new e5(e),new e7(e),new e9(e),new te(e),new tt(e),new ts(e),new tn(e),new ti(e),new ta(e),new tr(e),new to(e),new tl(e),new tc(e),new th(e),new tE(e),new ty(e),new tf(e),new eH(e),new tp(e),new tu(e),new td(e),new tg(e),new tm(e),new eO(e),new eF(e),new eS(e),new eI(e)]}}class tU{constructor(){this.websocketUrl="wss://game.airmash.cc/ffa",this.playerName="Unknown",this.horizonX=2e3,this.horizonY=2e3,this.flag="jolly",this.logLevel="info",this.isDevelopment=!1,this.zoom=.8,this.useBitmaps=!0,this.shouldShowDebugInfo=!1}}class tR{}const tT=[ea.PREDATOR_MISSILE,ea.GOLIATH_MISSILE,ea.COPTER_MISSILE,ea.TORNADO_MISSILE,ea.TORNADO_SMALL_MISSILE,ea.PROWLER_MISSILE],tw=[ea.UPGRADE,ea.SHIELD,ea.INFERNO];class tx{constructor(){this.skippedFrames=0,this.players={},this.mobs={},this.teams={},this.explosions=[],this.farts=[],this.kills=[],this.rocketTrailClouds=[],this.teams[eh.BLUE]=new tR,this.teams[eh.RED]=new tR}addPlayer(e){this.players[Number(e.id)]=e}removePlayer(e){delete this.players[Number(e)]}getFocusedPlayer(){return this.getPlayerById(this.id)}getPlayerById(e){return this.players[Number(e)]}getPlayerByName(e){return this.getPlayers().find(t=>t.name===e)}getPlayers(){return Object.values(this.players)}getPlayerName(e){if(!e)return"(empty)";let t=this.getPlayerById(e);return t?t.name:e+"_(left)"}addMob(e){this.mobs[Number(e.id)]=e}removeMob(e){delete this.mobs[Number(e)]}getMobById(e){return this.mobs[Number(e)]}getMissiles(){return Object.values(this.mobs).filter(e=>-1!==tT.indexOf(e.mobType))}getUpcrates(){return Object.values(this.mobs).filter(e=>-1!==tw.indexOf(e.mobType))}getCtfTeam(e){return this.teams[e]}getOtherCtfTeam(e){let t=e===eh.BLUE?eh.RED:eh.BLUE;return this.teams[t]}purgeAfterPanic(){this.explosions.splice(0),this.kills.splice(0),this.rocketTrailClouds.splice(0)}addExplosion(e){this.explosions.push(e)}getActiveExplosions(){let e=this.explosions.filter(e=>!e.isFinished);return this.explosions=e,e}addKill(e){this.kills.push(e)}getActiveKills(){let e=this.kills.filter(e=>!e.isFinished);return this.kills=e,e}addFart(e){this.farts.push(e)}getActiveFarts(){let e=this.farts.filter(e=>!e.isFinished);return this.farts=e,e}addRocketTrailCloud(e){this.rocketTrailClouds.push(e)}getActiveRocketTrailClouds(){let e=this.rocketTrailClouds.filter(e=>!e.isFinished);return this.rocketTrailClouds=e,e}}class tI{setTimeout(e,t){let s=setTimeout(()=>{this.onTimeoutFinished(s),e()},t);return this.timeouts.push(s),s}setInterval(e,t){let s=setInterval(()=>e(),t);return this.intervals.push(s),s}clearTimeout(e){clearTimeout(e),this.onTimeoutFinished(e)}clearInterval(e){clearInterval(e),this.onIntervalCleared(e)}clearAll(){for(let e of this.timeouts)clearTimeout(e);for(let e of this.intervals)clearInterval(e);this.timeouts=[],this.intervals=[]}onTimeoutFinished(e){this.timeouts=this.timeouts.filter(t=>t!==e)}onIntervalCleared(e){this.intervals=this.intervals.filter(t=>t!==e)}constructor(){this.timeouts=[],this.intervals=[]}}class tS{constructor(e,t){this.key=e,this.state=t,this.lastPressed=new eU}}class tP{constructor(e){this.context=e,this.keySequenceNumber=0,this.lagMs=0,this.lastReceivedMessages={},this.lastReceivedMessagesGcStopwatch=new eU,this.lastSentKeyStates=[]}async init(){this.client=await this.initWebSocket(!0),await this.onInitPrimary()}sendKey(e,t){let s=this.lastSentKeyStates.find(s=>s.key===e&&s.state===t);if(s){if(s.lastPressed.elapsedMs<50)return}else s=new tS(e,t),this.lastSentKeyStates.push(s);s.lastPressed.start(),this.keySequenceNumber++;let n={c:I.KEY,key:e,seq:this.keySequenceNumber,state:t};this.send(n),this.backupClientIsConnected&&this.send(n,!0)}sendCommand(e,t){let s={c:I.COMMAND,com:e,data:t};this.send(s)}voteMute(e){let t={c:I.VOTEMUTE,id:e};this.send(t)}fetchDetailedScore(){this.send({c:I.SCOREDETAILED})}sendChat(e,t,s=null){let n;switch(e){case eV.CHAT:n=I.CHAT;break;case eV.SAY:n=I.SAY;break;case eV.TEAM:n=I.TEAMCHAT;break;case eV.WHISPER:n=I.WHISPER}let i={c:n,id:s,text:t};this.send(i)}sendScreenSize(e,t){this.send({c:I.HORIZON,horizonX:Math.ceil(e/2),horizonY:Math.ceil(t/2)})}getLagMs(){return this.lagMs}onInitPrimary(){return new Promise((e,t)=>{this.loginPromiseResolver=e,this.context.logger.debug("Primary socket connecting");let s="none";this.context.auth&&(s=JSON.stringify({token:this.context.auth.tokens.game})),this.send({c:I.LOGIN,flag:this.context.settings.flag,horizonX:Math.ceil(this.context.settings.horizonX),horizonY:Math.ceil(this.context.settings.horizonY),name:this.context.settings.playerName,protocol:5,session:s})})}async afterLogin(e){this.ackInterval&&this.context.tm.clearInterval(this.ackInterval),this.ackInterval=this.context.tm.setInterval(()=>{this.send({c:I.ACK},this.ackToBackup),this.ackToBackup=!this.ackToBackup},1e3);let t=e.token;this.backupClientIsConnected&&(this.backupClient.close(),this.backupClientIsConnected=!1),this.backupClient=await this.initWebSocket(!1),this.onInitBackup(t),this.context.eventQueue.pub(eT.SERVER_MESSAGE,e),this.loginPromiseResolver()}resetCalibration(e){this.serverClockCalibrationTimeResetStopwatch=new eU,this.serverClockCalibrationTime=e,this.lagMs=0}onInitBackup(e){this.context.logger.debug("Backup socket connecting"),this.backupClientIsConnected=!0,this.send({c:I.BACKUP,token:e},!0)}initWebSocket(e){return new Promise((t,s)=>{let n=this.context.webSocketFactory.create(this.context.settings.websocketUrl);return n.binaryType="arraybuffer",n.onopen=()=>t(n),n.onmessage=t=>{try{let s=ee(t.data);if(!s){this.context.logger.warn("no result",t);return}if(this.shouldDropMessage(s))return;this.calibrateTime(s),s.c===S.PING?this.send({c:I.PONG,num:s.num},!e):s.c===S.BACKUP?(this.context.logger.debug("backup client connected"),this.backupClientIsConnected=!0):s.c===S.LOGIN?this.afterLogin(s):s.c===S.PING_RESULT?(this.context.state.ping=s.ping,this.context.state.numPlayers=s.playersgame,this.context.state.numPlayersTotal=s.playerstotal):this.context.eventQueue.pub(eT.SERVER_MESSAGE,s)}catch(e){this.context.logger.error("Error receiving message",e)}},n.onerror=e=>{this.context.eventQueue.pub(eT.CONNECTION_ERROR,e)},n.onclose=()=>{this.context.eventQueue.pub(eT.CONNECTION_CLOSE,{isPrimary:e})},n})}calibrateTime(e){if(!e.clock)return;let t=e.clock/100;if(!this.serverClockCalibrationTimeResetStopwatch||this.serverClockCalibrationTimeResetStopwatch.elapsedMinutes>5){this.resetCalibration(t);return}if(t<this.lastServerClock)return;this.lastServerClock=t;let s=t-this.serverClockCalibrationTime,n=this.serverClockCalibrationTimeResetStopwatch.elapsedMs;this.lagMs=n-s}shouldDropMessage(e){if(!e.id||!e.clock||e.id!==this.context.state.id)return!1;if(this.lastReceivedMessagesGcStopwatch.elapsedSeconds>5)for(let e of Object.keys(this.lastReceivedMessages))this.lastReceivedMessages[e].elapsedSeconds>1&&delete this.lastReceivedMessages[e];let t=`${e.c}_${e.clock}`;return!!this.lastReceivedMessages[t]||(this.lastReceivedMessages[t]=new eU,!1)}send(e,t=!1){let s=W(e);t?this.backupClientIsConnected&&this.backupClient.send(s):this.client&&this.client.send(s)}}class tL{}class t_{pub(e,t){let s=new tL;s.type=e,s.args=t,this.queue.push(s)}dequeue(){return this.queue.shift()}constructor(){this.queue=[]}}class tO{constructor(e){this.context=e}clearKeys(){let e=this.context.state.getFocusedPlayer();e&&(e.keystate.DOWN&&this.context.connection.sendKey(et.DOWN,!1),e.keystate.UP&&this.context.connection.sendKey(et.UP,!1),e.keystate.LEFT&&this.context.connection.sendKey(et.LEFT,!1),e.keystate.RIGHT&&this.context.connection.sendKey(et.RIGHT,!1),this.context.connection.sendKey(et.SPECIAL,!1),this.context.connection.sendKey(et.FIRE,!1))}}var tb={};tb=function(){function e(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)e[n]=s[n]}return e}return function t(s,n){function i(t,i,a){if("undefined"!=typeof document){"number"==typeof(a=e({},n,a)).expires&&(a.expires=new Date(Date.now()+864e5*a.expires)),a.expires&&(a.expires=a.expires.toUTCString()),t=encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var r="";for(var o in a)a[o]&&(r+="; "+o,!0!==a[o]&&(r+="="+a[o].split(";")[0]));return document.cookie=t+"="+s.write(i,t)+r}}return Object.create({set:i,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var t=document.cookie?document.cookie.split("; "):[],n={},i=0;i<t.length;i++){var a=t[i].split("="),r=a.slice(1).join("=");try{var o=decodeURIComponent(a[0]);if(n[o]=s.read(r,o),e===o)break}catch(e){}}return e?n[e]:n}},remove:function(t,s){i(t,"",e({},s,{expires:-1}))},withAttributes:function(s){return t(this.converter,e({},this.attributes,s))},withConverter:function(s){return t(e({},this.converter,s),this.attributes)}},{attributes:{value:Object.freeze(n)},converter:{value:Object.freeze(s)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})}();class tC{constructor(e){this.context=e,this.handles=[eT.PLAYER_CHANGE_FLAG]}exec(t){let s=t.args;if(s.id!==this.context.state.id)return;let n=ep[""+s.flag];e(tb).set("flag",n,{expires:365})}}class tM{constructor(e){this.context=e,this.handles=[eT.CHAT_RECEIVED,eT.MESSAGE_TO_PLAYER]}exec(e){if(e.type===eT.MESSAGE_TO_PLAYER){let t=e.args;this.context.renderer.addMessageToPlayer(t.message)}else{let t=e.args,s=this.context.state.getPlayerName(t.playerId);this.context.renderer.addChat(t.playerId,s,t.chatType,t.chatMessage,t.to)}}}class tN{constructor(e){this.context=e,this.handles=[eT.CTF_GAME_OVER]}exec(e){let t=e.args;this.context.renderer.showServerMessage(en.INFO,5e3,`Game over!<br/>The ${t.w===eh.BLUE?"blue":"red"} team has won!`)}}class tk{constructor(e){this.context=e,this.handles=[eT.EACH_SECOND]}exec(e){this.context.isBrowserVisible&&(this.context.renderer.renderMinimap(),this.context.renderer.renderPlayerList(),this.context.renderer.showPing(),this.context.renderer.showStats(),this.context.renderer.hideServerMessageAfterTimeout())}}class tD{get isFinished(){return this.stopwatch.elapsedMs>500}get size(){return .12*this.stopwatch.elapsedMs}constructor(){this.stopwatch=new eU}}class tv{constructor(e){this.context=e,this.handles=[eT.EXPLOSION]}exec(e){if(!this.context.isBrowserVisible)return;let t=e.args,s=new tD;s.pos=t.pos,s.type=t.type,this.context.state.addExplosion(s)}}class tB{constructor(e){this.context=e,this.handles=[eT.TICK]}exec(e){if(!this.context.isBrowserVisible)return;let t=1===e.args.frame;window.requestAnimationFrame(()=>this.context.renderer.renderGame(t))}}class tY{get isFinished(){return this.stopwatch.elapsedMs>150}get size(){return 120+.13333333333333333*this.stopwatch.elapsedMs}constructor(){this.stopwatch=new eU}}class tF{constructor(e){this.context=e,this.handles=[eT.PLAYER_REPEL]}exec(e){let t=e.args,s=new tY;s.player=this.context.state.getPlayerById(t.id),this.context.state.addFart(s)}}class tV{get isFinished(){return this.stopwatch.elapsedMs>500}get size(){return .12*this.stopwatch.elapsedMs}constructor(){this.stopwatch=new eU}}class tH{constructor(e){this.context=e,this.handles=[eT.PLAYER_KILLED]}exec(e){let t=e.args,s=new tV;s.pos=new eW(t.posX,t.posY),this.context.state.addKill(s)}}class tG{constructor(e){this.spec=e,this.stopwatch=new eU}get isFinished(){return this.stopwatch.elapsedMs>this.spec.cloudTimeoutMs}get opacity(){return this.stopwatch.elapsedMs<this.spec.cloudGrowMs?this.stopwatch.elapsedMs*this.spec.opacityGrowStep:Math.max(0,this.spec.opacityMax-this.stopwatch.elapsedMs*this.spec.opacityShrinkStep)}get size(){return this.stopwatch.elapsedMs<this.spec.cloudGrowMs?this.spec.sizeStart+this.stopwatch.elapsedMs*this.spec.sizeGrowStep:Math.max(0,this.spec.sizeMax-this.spec.sizeShrinkStep*this.stopwatch.elapsedMs)}}const tW={};class tK{static getFor(e){return tW[e]||(tW[e]=new tK(e)),tW[e]}constructor(e){this.opacityMax=.22;let t=1+(e_[e].damage-.3)/1.8;this.cloudTimeoutMs=800*t,this.cloudGrowMs=200*t,this.opacityGrowStep=this.opacityMax/this.cloudGrowMs,this.opacityShrinkStep=this.opacityMax/(this.cloudTimeoutMs-this.cloudGrowMs),this.sizeStart=5*t,this.sizeMax=15*t,this.sizeShrinkStep=this.sizeMax/(this.cloudTimeoutMs-this.cloudGrowMs),this.sizeGrowStep=(this.sizeMax-this.sizeStart)/this.cloudGrowMs,this.spawnFreq=Math.ceil(2*t*1.2),this.distribBandwidth=Math.ceil(3*t)}}class tX{constructor(e){this.context=e,this.handles=[eT.TICK]}exec(e){if(!this.context.isBrowserVisible)return;let t=e.args;for(let e of this.context.state.getMissiles()){let s=tK.getFor(e.mobType);if(t.frame%s.spawnFreq==0){let n=new tG(s);n.pos=new eW(e.pos);let i=e_[e.mobType].maxSpeed,a=e.speed.y/i*s.distribBandwidth,r=e.speed.x/i*s.distribBandwidth;n.pos.x+=t.frame%(2*s.spawnFreq)==0?-a:a,n.pos.y+=t.frame%(2*s.spawnFreq)==0?r:-r,this.context.state.addRocketTrailCloud(n)}}}}class tz{constructor(e){this.context=e,this.handles=[eT.SERVER_ANNOUNCEMENT,eT.SERVER_ERROR]}exec(e){let t;if(e.type===eT.SERVER_ANNOUNCEMENT)t=e.args;else{let s=e.args;switch(t={type:en.ALERT,duration:4e3},s.error){case es.ACCOUNT_BANNED:t.text="Account is banned";break;case es.AFK_DISCONNECT:t.text="Disconnected, away too long.";break;case es.ALREADY_LOGGED_IN:t.text="You are already logged in.";break;case es.CHAT_SPAMMING:t.text="Don't spam!";break;case es.FLAG_CHANGE_TOO_FAST:t.text="Wait before changing your flag.";break;case es.FORBIDDEN_TO_CHANGE_PLANE_IN_BTR:t.text="Can't change aircraft in BTR.";break;case es.GLOBAL_BAN:t.text="You have been banned.";break;case es.INCORRECT_PROTOCOL:t.text="Your client uses an incorrect protocol version.";break;case es.INVALID_LOGIN_DATA:t.text="Invalid login data.";break;case es.NOT_ENOUGH_UPGRADES:t.text="Not enough upgrades";break;case es.PACKET_FLOODING_BAN:t.text="Banned for packet flooding.";break;case es.PACKET_FLOODING_DISCONNECT:t.text="Disconnected for packet flooding.";break;case es.PLAYER_KICKED:t.text="You have been kicked.";break;case es.REQUIRED_INACTIVITY_AND_HEALTH_TO_RESPAWN:t.text="Two seconds of inactivity and full health required to respawn.";break;case es.REQUIRED_INACTIVITY_AND_HEALTH_TO_SPECTATE:t.text="Two seconds of inactivity and full health required to spectate.";break;case es.UNKNOWN_COMMAND:t.text="Unknown command";break;case es.UNKNOWN_ERROR:t.text="Unknown error"}}this.context.renderer.showServerMessage(t.type,t.duration,t.text);let s=document.createElement("div");s.innerHTML=t.text,t.text=s.innerText,this.context.renderer.addChat(null,"Server",eV.CHAT,t.text,null)}}class tQ{constructor(e){this.context=e,this.handles=[eT.PLAYER_KILLED]}exec(e){let t=e.args;if(!t.killer)return;let s="";t.killer===this.context.state.id?s=`You have destroyed ${this.context.state.getPlayerName(t.id)}`:t.id===this.context.state.id&&(s=`Destroyed by ${this.context.state.getPlayerName(t.killer)}`,this.context.renderer.renderKill()),s&&this.context.renderer.showServerMessage(en.INFO,1e3,s)}}class tj{constructor(e){this.context=e,this.handles=[eT.PLAYER_HIT]}exec(e){e.args.players.find(e=>e.id===this.context.state.id)&&this.context.renderer.renderHit()}}class tq{constructor(e){this.context=e}detectVisibilityChange(){let e,t;void 0!==document.hidden?(e="hidden",t="visibilitychange"):void 0!==document.msHidden?(e="msHidden",t="msvisibilitychange"):void 0!==document.webkitHidden&&(e="webkitHidden",t="webkitvisibilitychange"),document.addEventListener(t,()=>{let t=!document[e];this.context.setBrowserVisibility(t)},!1),this.context.isBrowserVisible=!document[e]}throttleZoom(){let e=new eU;document.getElementById("root").addEventListener("wheel",t=>{if(t.ctrlKey){if(e.elapsedSeconds<1){t.preventDefault();return}e.start()}})}}class tJ{debug(e,...t){window.debug&&this.log(e,...t)}info(e,...t){this.log(e,...t)}warn(e,...t){this.log(e,...t)}error(e,...t){this.log(e,...t)}fatal(e,...t){this.log(e,...t)}log(e,...t){console.log(e,...t)}}class t${create(e){return new WebSocket(e)}}const tZ="-20px";class t1{constructor(e){this.context=e}setClip(e){e.width=window.innerWidth+40,e.height=window.innerHeight+40,e.style.left=tZ,e.style.top=tZ;let t=this.context.settings.zoom;if(this.lastWidth!==e.width||this.lastHeight!==e.height){let s=e.width/t,n=e.height/t;this.context.connection.sendScreenSize(s,n),this.lastWidth=e.width,this.lastHeight=e.height,this.context.settings.horizonX=s/2,this.context.settings.horizonY=n/2}let s=this.context.state.getFocusedPlayer().pos,n=e.width/t/2,i=e.height/t/2;this.clipRectangle=[new eW(s.x-n,s.y-i),new eW(s.x+n,s.y+i)],this.zoom=t}isVisible(e){return this.clipRectangle[0].x<e.x&&this.clipRectangle[1].x>e.x&&this.clipRectangle[0].y<e.y&&this.clipRectangle[1].y>e.y}translate(e){return new eW((e.x-this.clipRectangle[0].x)*this.zoom,(e.y-this.clipRectangle[0].y)*this.zoom)}scale(e){return e*this.zoom}getClipRectangle(){return[new eW(this.clipRectangle[0]),new eW(this.clipRectangle[1])]}getClipSize(){return new eW(this.lastWidth,this.lastHeight)}}class t0{constructor(e,t){this.clip=e,this.context=t,this.backgroundImage=document.getElementById("map")}renderBackground(e){let t=this.clip.getClipRectangle();if(this.context.settings.useBitmaps){let s=new eW(t[1].x-t[0].x,t[1].y-t[0].y);e.drawImage(this.backgroundImage,(eg.WIDTH/2+t[0].x)*.25,(eg.HEIGHT/2+t[0].y)*.25,.25*s.x,.25*s.y,0,0,this.clip.scale(s.x),this.clip.scale(s.y))}e.fillStyle=constants.BACKGROUND_GRID_COLOR;let s=this.clip.scale(100);for(let n=t[0].y-t[0].y%s;n<t[1].y;n+=s)for(let i=t[0].x-t[0].x%s;i<t[1].x;i+=s){let t=this.clip.translate(new eW(i,n));e.fillRect(t.x,t.y,1,1)}}}class t2{constructor(e){this.context=e,this.debugPanel=document.getElementById("debugPanel")}render(){if(!this.context.settings.shouldShowDebugInfo)return;let e=this.context.connection.getLagMs().toLocaleString("en-us",{maximumFractionDigits:2,minimumFractionDigits:2}),t=this.context.state.skippedFrames.toString();this.debugPanel.innerHTML=`Lag: ${e}
Skipped frames: ${t}
My id: ${this.context.state.id}
GameType: ${this.context.gameType}`}}class t8{constructor(e,t){this.context=e,this.clip=t}renderExplosions(e){for(let t of(e.fillStyle=constants.EFFECTS_EXPLOSION_COLOR,this.context.state.getActiveExplosions())){let s=t.pos;if(s&&this.clip.isVisible(s)){let n=this.clip.translate(s);e.beginPath(),e.arc(n.x,n.y,this.clip.scale(t.size),0,2*Math.PI),e.fill()}}for(let t of(e.fillStyle=constants.EFFECTS_KILL_COLOR,this.context.state.getActiveKills())){let s=t.pos;if(s&&this.clip.isVisible(s)){let n=this.clip.translate(s);e.beginPath(),e.arc(n.x,n.y,this.clip.scale(t.size),0,2*Math.PI),e.fill()}}for(let t of(e.fillStyle=constants.EFFECTS_FART_COLOR,this.context.state.getActiveFarts())){if(!t.player)continue;let s=t.player.pos;if(s&&this.clip.isVisible(s)){let n=this.clip.translate(s);e.beginPath(),e.arc(n.x,n.y,this.clip.scale(t.size),0,2*Math.PI),e.fill()}}for(let t of this.context.state.getActiveRocketTrailClouds()){let s=t.pos;if(s&&this.clip.isVisible(s)){let n=t.opacity;if(0===n)continue;e.fillStyle=`rgba(${constants.EFFECTS_MISSILE_BASE_COLOR}, ${n})`;let i=this.clip.translate(s);e.beginPath();let a=this.clip.scale(t.size);e.arc(i.x,i.y,a,0,2*Math.PI),e.fill()}}}}const t6={blue:{x:-9670,y:-1470},red:{x:8600,y:-940}};class t3{constructor(e,t){this.context=e,this.clip=t,this.blueFlag=document.getElementById("blue-flag"),this.redFlag=document.getElementById("red-flag")}render(e){let t=this.context.state.getCtfTeam(eh.RED),s=this.context.state.getCtfTeam(eh.BLUE);this.renderFlag(t,this.redFlag,e),this.renderFlag(s,this.blueFlag,e),this.renderBase(e,t6.blue,constants.CTF_BLUE_TEAM_COLOR),this.renderBase(e,t6.red,constants.CTF_RED_TEAM_COLOR)}renderBase(e,t,s){let n=new eW(t.x-60,t.y-60),i=new eW(t.x+60,t.y+60);if(!this.clip.isVisible(n)&&!this.clip.isVisible(i))return;let a=this.clip.translate(t),r=this.clip.scale(120),o=r/2;e.strokeStyle=s,e.lineWidth=this.clip.scale(8),e.lineJoin="round",e.strokeRect(a.x-o,a.y-o,r,r)}renderFlag(e,t,s){let n,i=e.flagPos;if(!i)return;let a=!1;if(e.flagState===eu.DYNAMIC){let t=this.context.state.getPlayerById(e.flagTakenById);t&&(i=t.mostReliablePos,n=t.isVisibleOnScreen&&this.clip.isVisible(i),a=!0)}else n=this.clip.isVisible(i);if(n){let e=this.clip.translate(i),n=this.clip.scale(t.width),r=this.clip.scale(t.height);s.drawImage(t,0,0,t.width,t.height,e.x-n/2+(a?n/2:0),e.y-r/2-(a?r/2:0),n,r)}}}const t4=eg.WIDTH/2,t5=eg.HEIGHT/2;class t7{constructor(e){this.context=e,this.canvas=document.getElementById("minimap-canvas"),this.canvasContext=this.canvas.getContext("2d"),this.blueFlag=document.getElementById("blue-flag"),this.redFlag=document.getElementById("red-flag")}highlight(e){this.playerToHighlight=e}render(){this.canvasContext.clearRect(0,0,this.canvas.width,this.canvas.height);let e=this.canvas.width/eg.WIDTH,t=this.canvas.height/eg.HEIGHT,s=this.context.state.id;for(let n of this.context.state.getPlayers()){if(n.status===eo.INACTIVE)continue;let i=new eW((n.mostReliablePos.x+t4)*e,(n.mostReliablePos.y+t5)*t);if(n.id===s)this.canvasContext.strokeStyle=constants.MINIMAP_HIGHLIGHT_COLOR,this.canvasContext.strokeRect(i.x-7.5,i.y-5,15,10);else{let e=constants.MINIMAP_FFA_PLAYER_COLOR;switch(n.team===eh.BLUE?e=constants.CTF_BLUE_TEAM_COLOR:n.team===eh.RED&&(e=constants.CTF_RED_TEAM_COLOR),n.ranking){case 1:e=constants.MINIMAP_PLAYER_1_COLOR;break;case 2:e=constants.MINIMAP_PLAYER_2_COLOR;break;case 3:e=constants.MINIMAP_PLAYER_3_COLOR}this.canvasContext.fillStyle=e,this.canvasContext.beginPath(),this.canvasContext.arc(i.x,i.y,3,0,2*Math.PI),this.canvasContext.fill(),n.id===this.playerToHighlight&&(this.canvasContext.strokeStyle=constants.MINIMAP_HIGHLIGHT_COLOR,this.canvasContext.beginPath(),this.canvasContext.arc(i.x,i.y,6,0,2*Math.PI),this.canvasContext.stroke())}}if(this.context.gameType===ed.CTF){let e=this.context.state.getCtfTeam(eh.RED),t=this.context.state.getCtfTeam(eh.BLUE);this.renderFlag(e,this.redFlag,this.canvasContext,t6.red,constants.CTF_RED_TEAM_COLOR),this.renderFlag(t,this.blueFlag,this.canvasContext,t6.blue,constants.CTF_BLUE_TEAM_COLOR)}}renderFlag(e,t,s,n,i){let a=e.flagPos;if(!a)return;if(e.flagState===eu.DYNAMIC){let t=this.context.state.getPlayerById(e.flagTakenById);t&&(a=t.mostReliablePos)}let r=this.canvas.width/eg.WIDTH,o=this.canvas.height/eg.HEIGHT,l=new eW((a.x+t4)*r,(a.y+t5)*o),c=10/t.width*t.height;if(s.drawImage(t,0,0,t.width,t.height,l.x-5,l.y-c/2,10,c),!a.equals(n)){let e=new eW((n.x+t4)*r,(n.y+t5)*o);this.canvasContext.strokeStyle=i,this.canvasContext.strokeRect(e.x-2,e.y-2,4,4)}}}class t9{constructor(e,t){this.context=e,this.clip=t,this.missileImage=document.getElementById("missile")}renderMissiles(e){for(let t of(e.fillStyle=constants.MISSILE_COLOR,this.context.state.getMissiles())){let s=t.pos;if(!s||!this.clip.isVisible(s))continue;let n=this.clip.translate(s),i=1+(e_[t.mobType].damage-.3)/1.8;if(this.context.settings.useBitmaps){e.translate(n.x,n.y),e.rotate(t.rot);let s=!1;this.context.gameType===ed.CTF&&t.team&&t.team===this.context.state.team&&t.ownerId!==this.context.state.id&&(e.globalAlpha=.4,s=!0);let a=this.clip.scale(this.missileImage.width*i*1),r=this.clip.scale(this.missileImage.height*i*1);e.drawImage(this.missileImage,0,0,this.missileImage.width,this.missileImage.height,-a/2,-r/2,a,r),s&&(e.globalAlpha=1),e.rotate(-t.rot),e.translate(-n.x,-n.y)}else e.beginPath(),e.arc(n.x,n.y,this.clip.scale(4*i),0,2*Math.PI),e.fill()}}}class se{constructor(e,t){this.clip=e,this.context=t}renderPath(e){let t=this.context.botstate.path;if(t&&t.length>0){let s=0;for(let n of(e.strokeStyle="orange",e.lineWidth=2,e.beginPath(),t)){let t=this.clip.translate(n);0===s?e.moveTo(t.x,t.y):e.lineTo(t.x,t.y),e.stroke(),1===s&&(e.font="16px 'Courier New'",e.fillStyle="white",e.fillText("dist: "+this.context.botstate.distanceToTarget,t.x,t.y)),s++}}}}class st{constructor(e){this.context=e,this.listElement=document.getElementById("player-list")}render(){let e=this.context.state.getPlayers();e.sort((e,t)=>(e.ranking||Number.MAX_SAFE_INTEGER)-(t.ranking||Number.MAX_SAFE_INTEGER));let t=0;for(let s of e){let e,n,i,a,r;if(s.status===eo.INACTIVE&&"Server"===s.name)continue;let o=this.listElement.rows[t];o?(e=o.cells[0],n=o.cells[1],i=o.cells[2],a=o.cells[3],r=n.firstElementChild):((e=(o=this.listElement.insertRow()).insertCell()).className="playerlist-pos",(n=o.insertCell()).className="playerlist-flag",(i=o.insertCell()).className="playerlist-name player-name",(a=o.insertCell()).className="playerlist-score",(r=document.createElement("img")).width=24,r.height=24,n.appendChild(r)),o.className=s.status===eo.INACTIVE?"playerlist-player-inactive":"",s.team===eh.BLUE?o.className+=" playerlist-team-blue":s.team===eh.RED&&(o.className+=" playerlist-team-red");let l=s.ranking||t;e.innerText=`${l}. `;let c=ep[""+s.flag]||"JOLLY";r.src="flags/"+c+".png",s.level?i.innerText=`${s.name} [${s.level}]`:i.innerText=s.name,i.dataset.name=encodeURI(s.name),i.dataset.id=s.id.toString(),a.innerText=`${s.score}`,t++}for(;this.listElement.rows[t];)this.listElement.rows[t].remove()}}class ss{constructor(e,t){this.context=e,this.clip=t,this.flagImages={},this.saysToSay=[],this.images={mohawk:document.getElementById("mohawk"),prowler:document.getElementById("prowler"),raptor:document.getElementById("raptor"),spirit:document.getElementById("spirit"),tornado:document.getElementById("tornado")}}addSay(e,t){this.saysToSay.push({playerId:e,msg:t,sw:new eU})}renderPlayers(e){let t=this.clip.scale(11);e.font=t+"pt 'Tahoma'";let s=this.clip.scale(24),n=this.clip.scale(4),i=this.clip.scale(10);for(let a of(this.flagImages.JOLLY||this.initFlagImages(),this.context.state.getPlayers())){if(a.status===eo.INACTIVE)continue;let r=a.mostReliablePos,o=r&&this.clip.isVisible(r),l=o&&!a.isVisibleOnScreen,c=o&&a.stealthed,h=a.team===this.context.state.team,u=a.type===eb.PROWLER&&!h&&(l||c);if(!a.isVisibleOnScreen&&!u)continue;let d=this.clip.translate(r);e.translate(d.x,d.y),u?e.filter="blur(10px)":e.rotate(a.rot),this.renderAircraft(a,e,u),u?e.filter="none":(e.rotate(-a.rot),this.renderBars(e,a)),this.renderName(a,e,s,i,t,n),this.renderTextBubble(a,e),e.translate(-d.x,-d.y)}}renderTextBubble(e,t){for(let s of this.saysToSay)if(s.playerId===e.id){t.fillStyle=constants.PLAYER_SAY_BACKGROUND_COLOR;let e=t.measureText(s.msg).width,n=e/2,i=-this.clip.scale(80),a=this.clip.scale(20),r=this.clip.scale(40);t.fillRect(-n-a,i-a,e+2*a,r),t.fillStyle=constants.PLAYER_SAY_FOREGROUND_COLOR,t.fillText(s.msg,-n,i)}this.saysToSay=this.saysToSay.filter(e=>e.sw.elapsedSeconds<5)}renderName(e,t,s,n,i,a){let r=this.context.settings.useBitmaps?constants.PLAYER_NAME_COLOR:constants.PLAYER_NAME_NOBITMAP_COLOR;e.team===eh.BLUE?r=constants.PLAYER_NAME_BLUE_TEAM_COLOR:e.team===eh.RED&&(r=constants.PLAYER_NAME_RED_TEAM_COLOR),t.fillStyle=r;let o="";e.level&&(o=` [${e.level}]`);let l=`${e.ranking||"?"}. ${e.name}${o}`,c=this.context.settings.useBitmaps?s+n:0,h=t.measureText(l).width+c,u=-h/2,d=this.clip.scale(70);if(t.fillText(l,u,d),this.context.settings.useBitmaps){let n=ep[""+e.flag]||"JOLLY",r=this.flagImages[n];t.drawImage(r,0,0,24,24,u+h-s,d-s+i-a,s,s)}}renderBars(e,t){e.strokeStyle=constants.PLAYER_HEALTH_OK_COLOR,t.health<.3?e.strokeStyle=constants.PLAYER_HEALTH_DANGER_COLOR:t.health<.6&&(e.strokeStyle=constants.PLAYER_HEALTH_WARN_COLOR);let s=this.clip.scale(75);e.lineWidth=this.clip.scale(8),e.globalAlpha=t.id===this.context.state.id?.8:.5,e.beginPath(),e.arc(0,0,s,Math.PI,Math.PI+Math.PI*t.health/2),e.stroke(),e.strokeStyle=constants.PLAYER_ENERGY_COLOR,e.beginPath();let n=Math.max(.01,t.energy);if(e.arc(0,0,s,0,2*Math.PI-Math.PI*n/2,!0),e.stroke(),t.powerUps.inferno||t.powerUps.shield){e.strokeStyle=t.powerUps.shield?constants.PLAYER_SHIELD_COLOR:constants.PLAYER_INFERNO_COLOR,e.beginPath();let s=t.shieldOrInfernoTimer?Math.max(.01,1-t.shieldOrInfernoTimer.timeoutFraction):1;e.lineWidth=this.clip.scale(16);let n=this.clip.scale(63);e.arc(0,0,n,Math.PI,Math.PI+Math.PI*s),e.stroke()}e.globalAlpha=1}renderAircraft(e,t,s){let n=eD[e.type];if(s){t.fillStyle=e.team===eh.BLUE?constants.PLAYER_NOBITMAP_BLUE_TEAM_PROWLER_COLOR:e.team===eh.RED?constants.PLAYER_NOBITMAP_RED_TEAM_PROWLER_COLOR:constants.PLAYER_NOBITMAP_PROWLER_COLOR;let s=this.clip.scale(300);t.beginPath(),t.arc(0,0,s,0,2*Math.PI),t.fill()}else if(this.context.settings.useBitmaps){let s=this.images[n.name],i=this.clip.scale(+s.width),a=this.clip.scale(+s.height),r=i/2,o=a/2;e.stealthed&&(t.globalAlpha=.4),t.drawImage(s,0,0,s.width,s.height,-r,-o,i,a),t.globalAlpha=1}else for(let s of(e.team===eh.BLUE?t.fillStyle=e.stealthed?constants.PLAYER_NOBITMAP_BLUE_TEAM_PROWLER_COLOR:constants.PLAYER_NOBITMAP_BLUE_TEAM_COLOR:e.team===eh.RED?t.fillStyle=e.stealthed?constants.PLAYER_NOBITMAP_RED_TEAM_PROWLER_COLOR:constants.PLAYER_NOBITMAP_RED_TEAM_COLOR:t.fillStyle=e.stealthed?constants.PLAYER_NOBITMAP_PROWLER_COLOR:constants.PLAYER_NOBITMAP_COLOR,n.collisions)){let e=new eW(this.clip.scale(s[0]),this.clip.scale(s[1])),n=this.clip.scale(s[2]);t.beginPath(),t.arc(e.x,e.y,n,0,2*Math.PI),t.fill()}}initFlagImages(){for(let e of Object.keys(eE))this.flagImages[e]=document.getElementById(`flag-${e}`)}}class sn{constructor(e){this.context=e,this.scoreElement=document.getElementById("stats-score"),this.upgradesElement=document.getElementById("stats-upgrades"),this.killsElement=document.getElementById("stats-kills"),this.deathsElement=document.getElementById("stats-deaths"),this.upgrSpeedElement=document.getElementById("stats-speed"),this.upgrDefenseElement=document.getElementById("stats-defense"),this.upgrEnergyElement=document.getElementById("stats-energy"),this.upgrMissileElement=document.getElementById("stats-missile"),this.ctfInfo=document.getElementById("ctf-info"),this.blueScore=document.getElementById("blue-score"),this.redScore=document.getElementById("red-score"),this.blueFlagLocation=document.getElementById("blue-flag-location"),this.redFlagLocation=document.getElementById("red-flag-location")}toString(e){return 0===e||e?""+e:""}render(){let e=this.context.state.getFocusedPlayer();if(!e)return;this.scoreElement.innerText=this.toString(e.score),this.killsElement.innerText=this.toString(e.kills),this.deathsElement.innerText=this.toString(e.deaths);let t=e.upgrades||new eJ;if(this.upgradesElement.innerText=this.toString(t.available),this.upgrDefenseElement.innerText=this.toString(t.defense),this.upgrEnergyElement.innerText=this.toString(t.energy),this.upgrMissileElement.innerText=this.toString(t.missile),this.upgrSpeedElement.innerText=this.toString(t.speed),this.context.gameType===ed.CTF){"block"!==this.ctfInfo.style.display&&(this.ctfInfo.style.display="block");let e=this.context.state.getCtfTeam(eh.BLUE),t=this.context.state.getCtfTeam(eh.RED),s=e.score?e.score:0,n=t.score?t.score:0;this.blueScore.innerText=this.toString(s),this.redScore.innerText=this.toString(n);let i="?";if(e.flagState===eu.DYNAMIC){let t=this.context.state.getPlayerName(e.flagTakenById);i=`taken by ${t}`}else i=e.flagPos.equals(t6.blue)?"home":"abandoned";this.blueFlagLocation.innerText=i;let a="?";if(t.flagState===eu.DYNAMIC){let e=this.context.state.getPlayerName(t.flagTakenById);a=`taken by ${e}`}else a=t.flagPos.equals(t6.red)?"home":"abandoned";this.redFlagLocation.innerText=a}}}const si=Math.PI/4;class sa{constructor(e,t){this.context=e,this.clip=t,this.logger=new eB(e)}renderUpcrates(e){for(let t of this.context.state.getUpcrates()){let s=t.pos;if(!s||!this.clip.isVisible(s))continue;let n=constants.UPCRATES_UPGRADE_CRATE_COLOR;switch(t.mobType){case ea.INFERNO:n=constants.UPCRATES_RAMPAGE_CRATE_COLOR;break;case ea.SHIELD:n=constants.UPCRATES_SHIELD_CRATE_COLOR}let i=this.clip.translate(s);e.translate(i.x,i.y),e.rotate(si),e.beginPath(),e.fillStyle=n;let a=this.clip.scale(12),r=this.clip.scale(24);e.rect(-a,-a,r,r),e.fill(),e.strokeStyle=constants.UPCRATES_BORDER_COLOR,e.stroke(),e.rotate(-si),e.translate(-i.x,-i.y)}}}const sr=[[1009,-2308,108],[1241,-2490,60],[1157,-2379,84],[622,-2126,48],[669,-2187,72],[-392,-1669,132],[-273,-1746,60],[-252,-1504,120],[1553,-2016,48],[1637,-1972,60],[1736,-1922,60],[2150,-2406,72],[2238,-2318,108],[2364,-2391,72],[2491,-2682,72],[2596,-2671,108],[-150,-3147,48],[-155,-3044,84],[-427,-3600,48],[-259,-2982,60],[-379,-3529,72],[-665,-3052,60],[20,-1816,60],[127,-1799,60],[263,-2572,48],[405,-2570,108],[851,-4183,120],[754,-3971,108],[1757,-5065,132],[1169,-4453,108],[2054,-5244,108],[1631,-4901,108],[2305,-5281,108],[1007,-4281,96],[2766,-5202,96],[2927,-5204,84],[3206,-5218,36],[3099,-5193,72],[1417,-4726,120],[2844,-1513,60],[3206,-1464,120],[2881,-1403,108],[3804,-2025,84],[4116,-1778,108],[3715,-1508,72],[4247,-1126,72],[3860,268,60],[4334,-1011,132],[3849,349,72],[3956,490,96],[4073,667,108],[3583,-864,96],[4135,836,120],[4785,-743,120],[4993,-839,108],[5224,-482,84],[5235,-1238,132],[5419,-1346,72],[6075,-5099,96],[5767,-4953,108],[5896,-4967,108],[5384,-4642,108],[5704,-4857,108],[5563,-4697,108],[5406,-4470,132],[5352,-3964,108],[5309,-3665,132],[5247,-3464,108],[5300,-3121,108],[3524,-3340,132],[3661,-3589,108],[7236,-1376,72],[7624,-1610,96],[7403,-1555,84],[7514,-1568,108],[3660,-2705,108],[3374,-2813,96],[7347,-1447,108],[7236,-775,60],[7207,-631,108],[7303,-468,108],[7262,-1263,108],[7404,-350,120],[7589,-305,108],[7741,-1589,120],[7949,-1594,120],[8152,-1599,132],[8378,-1602,144],[7873,-321,72],[8543,-1661,84],[7790,-259,120],[8675,-1573,120],[8163,-245,84],[8329,-311,84],[8275,-229,120],[8447,-277,120],[8824,-1447,108],[7221,-1140,60],[8924,-1273,108],[6844,-950,120],[8949,-1060,132],[8904,-920,96],[8582,-338,84],[8963,-803,120],[8680,-322,108],[8811,-449,108],[8910,-610,108],[6855,114,96],[6971,241,120],[6852,656,60],[6980,706,108],[6946,939,120],[6027,-560,72],[7521,425,48],[7599,389,60],[5863,-431,108],[9392,262,108],[7521,512,72],[9807,1027,60],[9554,237,120],[9346,392,144],[9789,1142,84],[9747,-532,96],[8591,347,72],[9951,-509,120],[9308,2417,60],[10185,-522,108],[10330,2147,72],[9350,2480,84],[10503,2124,108],[12500,2628,60],[13188,2864,60],[12637,2659,84],[13262,2899,60],[13777,5168,60],[15709,6399,48],[13539,5664,60],[15660,6474,48],[13743,5248,84],[15482,6600,48],[15591,6525,36],[13487,5738,84],[15407,6702,72],[8171,-2568,60],[16001,6015,72],[16017,6110,48],[6496,-1491,60],[6626,-1480,84],[6190,-1022,96],[8325,-2615,120],[8222,-2412,120],[9204,-2288,108],[9279,-2216,120],[10375,-1558,96],[10309,-1421,108],[10247,-1216,144],[10079,-2310,108],[10320,-2330,120],[10942,-2963,108],[10807,-2778,132],[12989,-1929,72],[12613,-1181,48],[12559,-1120,60],[11642,-1900,84],[11558,-1692,108],[11509,-1479,60],[12559,-2673,96],[12446,-2487,120],[12375,-2303,108],[10363,-3514,84],[10290,-3340,108],[10162,-3207,84],[9003,-3048,108],[9161,-3119,72],[14550,-3462,108],[14407,-3335,108],[14366,-4493,108],[14477,-4437,120],[15305,-4230,108],[15481,-4283,108],[15349,-5009,48],[11874,-4879,72],[15453,-4984,84],[11907,-4742,96],[12440,-4278,60],[11980,-4582,108],[12131,-4387,132],[15681,-4973,120],[12591,-4252,96],[12777,-4244,108],[12969,-4227,108],[15897,-5071,108],[13204,-4228,120],[11592,-5261,84],[12743,-4826,48],[10102,-5078,84],[12854,-4782,108],[10191,-5033,84],[10523,-5133,120],[10336,-4977,132],[10667,-5250,96],[9665,-6403,84],[10798,-5379,60],[9670,-5547,108],[9834,-6369,120],[9864,-5572,132],[11362,-3957,108],[11162,-3830,120],[8922,-6173,120],[9003,-5368,60],[8453,-6153,72],[8954,-5229,108],[8905,-5072,96],[8704,-3873,108],[8578,-6105,96],[8508,-3710,84],[8614,-5400,60],[8788,-4922,132],[8936,-3905,72],[9701,-4613,108],[6973,-4776,72],[7016,-4674,108],[9124,-3853,108],[7253,-4648,96],[6602,-4591,72],[8510,-5322,108],[6687,-3810,84],[9525,-4492,132],[7461,-4705,108],[9280,-3812,96],[6467,-2811,36],[6842,-3820,96],[6483,-2725,72],[7675,-4864,132],[6991,-2885,108],[6610,-2664,108],[6822,-2736,108],[6763,-4582,108],[6509,-2490,108],[7216,-3865,132],[7018,-3708,120],[2254,-3301,96],[6378,-2310,96],[7197,-2857,108],[2609,-3483,60],[2449,-3385,108],[4585,-2889,84],[4470,-2768,96],[4083,-4033,108],[1568,-2869,48],[4336,-4105,144],[1977,-1678,60],[1412,-3642,60],[1570,-2792,72],[1932,-1586,72],[1310,-3547,72],[3611,1391,120],[3558,2174,108],[3431,1563,108],[3142,2813,84],[3330,2296,132],[3001,2818,72],[3703,2044,48],[2872,3863,108],[3125,2942,132],[2841,4018,132],[2402,5140,72],[2511,5167,96],[-14607,-5112,108],[-14430,-5180,108],[-14197,-5222,144],[-14895,-4703,60],[-14797,-4728,48],[-14697,-4739,48],[-13919,-5281,132],[-13646,-5170,84],[-13400,-5068,144],[-13099,-5108,132],[-12824,-5092,108],[-12631,-5044,108],[-12427,-4914,108],[-12270,-4816,84],[-11772,-4983,84],[-11940,-4867,108],[-12091,-4699,108],[-12270,-4529,84],[-12460,-4396,108],[-13058,-4252,108],[-12894,-4096,84],[-12738,-4077,84],[-13546,-4341,48],[-13428,-4299,108],[-14679,-4192,84],[-14368,-4308,84],[-14495,-4133,132],[-12072,-3824,96],[-11904,-3648,120],[-11654,-3569,84],[-11648,-3357,108],[-11420,-3359,108],[-11296,-3135,84],[-10782,-2838,96],[-11410,-3039,36],[-10581,-2773,132],[-11118,-5114,96],[-10675,-5079,108],[-10205,-4890,96],[-11543,-4164,96],[-11287,-4244,60],[-10018,-4747,120],[-9278,419,60],[-9341,470,60],[-9180,496,96],[-11365,-4131,120],[-9353,0,72],[-8975,528,120],[-9413,89,108],[-8230,770,48],[-9231,17,84],[-6808,1667,60],[-6694,1622,96],[-8285,855,72],[-6793,1796,96],[-6865,1935,60],[-7043,2222,72],[-7083,2368,72],[-7103,2533,84],[-7099,2721,96],[-7178,2874,48],[-6964,3110,84],[-6246,4191,72],[-6735,3446,48],[-6722,3537,84],[-6396,3388,108],[-6787,3140,108],[-6227,4488,84],[-6281,3953,72],[-6530,3576,132],[-6147,3994,132],[-6141,4292,144],[-6377,5578,84],[-6152,4569,108],[-6222,4769,84],[-6266,4956,72],[-6233,5414,108],[-6347,5646,84],[-6400,6066,84],[-6411,6261,96],[-6565,7043,72],[-6377,6415,108],[-6440,6614,84],[-5944,1954,60],[-6001,2039,96],[-6467,7070,108],[-4963,3608,72],[-4776,3510,48],[-5785,1998,132],[-3708,3449,72],[-3790,3582,108],[-4031,3697,84],[-4859,3634,120],[-3850,3730,120],[-4689,4605,108],[-3492,2892,72],[-4507,4483,72],[-4829,2745,108],[-4435,4273,108],[-3383,2930,108],[-4888,2821,108],[-5372,5172,60],[-5036,2981,108],[-9895,-1942,120],[-9371,-2159,72],[-9995,-1773,108],[-5280,5218,108],[-5079,5183,108],[-5149,3079,72],[-9695,-2048,120],[-5063,5374,108],[-9504,-2059,120],[-8948,-2140,84],[-9262,-2081,132],[-9068,-2071,120],[-8861,-2045,132],[-8654,-2083,120],[-8473,-2048,120],[-8283,-1965,120],[-8182,-1863,108],[-10037,-1579,108],[-10063,-1365,108],[-10074,-1190,108],[-8167,-1225,60],[-8188,-1087,96],[-9975,-1022,108],[-9835,-910,120],[-9709,-848,120],[-9532,-792,120],[-9348,-779,120],[-9131,-784,132],[-8754,-795,84],[-8587,-797,120],[-8424,-856,108],[-8246,-921,108],[-8153,-1701,84],[-6447,-2137,72],[-8153,-1591,60],[-7694,-1393,120],[-6541,-2030,84],[-7135,-1547,84],[-5885,-2958,72],[-7171,-1440,96],[-5620,-3123,72],[-6631,-1866,96],[-5882,-3696,96],[-5716,-2944,108],[-5949,-3528,60],[-6869,-4052,96],[-7081,-2673,60],[-6725,-4069,72],[-10487,-2295,60],[-7032,-2749,72],[-10769,-3817,72],[-6607,-4081,60],[-10849,-1824,84],[-10479,-2146,108],[-7003,-2611,108],[-10749,-1511,72],[-10697,-1953,120],[-10848,-1330,108],[-10912,-1220,60],[-9843,-2685,84],[-10823,-3717,84],[-9697,-2713,72],[-10080,-3431,48],[-10648,-3844,108],[-9530,-2695,120],[-2387,-6791,108],[-8465,-5037,84],[-2550,-6627,108],[-9325,-2822,84],[-10140,-3346,96],[-8461,-4908,108],[8116,-1076,96],[8115,-940,96],[-2503,-6359,168],[-9062,-1580,96],[8120,-790,96],[-9065,-1444,96],[-2615,-6159,120],[-2744,-5943,132],[-3713,-4955,108],[-9061,-1292,96],[-1551,-4718,60],[5251,-6249,60],[5192,-6181,48],[-2898,-5732,108],[-1705,-4629,96],[1618,-7035,60],[-3829,-4776,108],[-2851,-5589,132],[-2974,-5399,132],[-3952,-4568,108],[-4135,-4368,132],[-3428,-5104,132],[-3167,-5254,108],[-3049,-6916,120],[-3097,-6722,108],[-3190,-6493,120],[-3318,-6284,132],[-4672,-5861,132],[-4480,-5668,120],[-4294,-5548,108],[-3433,-6072,120],[-3568,-5881,120],[-3736,-5698,144],[-3978,-7517,108],[-3956,-5572,120],[-4103,-5400,120],[-4281,-5240,120],[-4409,-5034,120],[-4475,-4808,108],[-2777,-7546,120],[-2542,-7502,108],[-2398,-7364,108],[-2350,-7151,108],[-2315,-6976,96],[-3749,-7488,120],[-2995,-7596,144],[-3253,-7558,132],[-3468,-7472,120],[-5028,-6473,120],[-3604,-7301,132],[-3678,-7078,132],[-3835,-6826,132],[-3935,-6595,120],[-5214,-7381,120],[-4065,-6416,132],[-4174,-6231,84],[-4556,-6940,120],[-4663,-6781,120],[-4748,-6548,156],[-4847,-6257,132],[-4806,-6016,108],[-4950,-7410,168],[-5470,-7251,156],[-5637,-7038,120],[-5593,-6819,120],[-5406,-6727,120],[-5263,-6580,120],[-4636,-7476,120],[-4399,-7496,108],[-6769,-7571,108],[-6853,-7377,108],[-8273,-7231,60],[-4182,-7512,108],[-7525,-5855,108],[-7495,-6329,60],[-7297,-6946,108],[-8148,-7137,84],[-7030,-7301,84]];class so{constructor(e,t){this.clip=e,this.context=t;let s=document.getElementById("mountain-medium"),n=document.getElementById("mountain-large"),i=[];i.push(document.getElementById("mountain-regular-a")),i.push(document.getElementById("mountain-regular-b")),i.push(document.getElementById("mountain-regular-c"));let a=document.getElementById("mountain-small"),r=document.getElementById("mountain-smaller"),o=document.getElementById("mountain-mini"),l=0;for(let e of(this.wallImages={},sr)){let t;let c=e[2];t=c>=132?n:c>=120?s:c>=108?i[l%i.length]:c>=84?a:c>=60?r:o,e[3]=l,this.wallImages[l]=t,l++}}renderWalls(e){for(let t of sr){let s=new eW(t[0],t[1]),n=t[2],i=new eW(s.x-n,s.y-n),a=new eW(s.x+n,s.y+n);if(this.clip.isVisible(i)||this.clip.isVisible(a)){let i=this.clip.translate(s);if(this.context.settings.useBitmaps){let s=1.4*this.clip.scale(n),a=t[3],r=this.wallImages[a];e.drawImage(r,0,0,r.width,r.height,i.x-s,i.y-s,2*s,2*s)}else{let t=this.clip.scale(n);e.fillStyle=constants.WALLS_NOBITMAP_COLOR,e.beginPath(),e.arc(i.x,i.y,t,0,2*Math.PI),e.fill()}}}}}class sl{constructor(e){this.context=e,this.ignoredPlayers=[],this.getUiElements(),this.periodicLogger=new eB(e),this.clip=new t1(e),this.backgroundRenderer=new t0(this.clip,e),this.wallsRenderer=new so(this.clip,e),this.flagRenderer=new t3(e,this.clip),this.upcratesRenderer=new sa(e,this.clip),this.playersRenderer=new ss(e,this.clip),this.missilesRenderer=new t9(e,this.clip),this.explosionsRenderer=new t8(e,this.clip),this.minimapRenderer=new t7(e),this.playerListRenderer=new st(e),this.statsRenderer=new sn(e),this.debugInfoRenderer=new t2(e),this.pathRenderer=new se(this.clip,e)}addMessageToPlayer(e){this.chatBox.innerHTML+=`<div class="chat chat-warning">${e}</div>`,this.chatBox.scrollTop=this.chatBox.scrollHeight}addChat(e,t,s,n,i){if(-1===this.ignoredPlayers.indexOf(e)){if(t=t.replace(/</g,"&lt;").replace(/>/g,"&gt;"),n=n.replace(/</g,"&lt;").replace(/>/g,"&gt;"),s===eV.SAY)this.playersRenderer.addSay(e,n);else{let a="",r="";s===eV.TEAM?(a="chat-team",r=" =&gt; team"):s===eV.WHISPER&&(a="chat-whisper",r=e===this.context.state.myPlayerId?" =&gt; "+this.context.state.getPlayerName(i):" =&gt; me");let o=encodeURI(t);this.chatBox.innerHTML+=`<div class="chat ${a}"><strong class="player-name" data-name="${o}" data-id="${e}">${t}${r}</strong>: ${n}</div>`,this.chatBox.scrollTop=this.chatBox.scrollHeight}}}showServerMessage(e,t,s){this.serverMessageStopwatch=new eU(t),this.serverMessage.innerHTML=s}hideServerMessageAfterTimeout(){this.serverMessageStopwatch&&this.serverMessageStopwatch.hasTimedOut&&(this.serverMessage.innerHTML="",this.serverMessageStopwatch=null)}showStats(){this.statsRenderer.render()}showPing(){this.pingElement.innerText=""+this.context.state.ping+" ms"}highlightPlayerOnMinimap(e){this.minimapRenderer.highlight(e)}ignorePlayer(e){-1===this.ignoredPlayers.indexOf(e)&&e!==this.context.state.id&&this.ignoredPlayers.push(e)}unignorePlayer(e){this.ignoredPlayers=this.ignoredPlayers.filter(t=>t!==e)}renderMinimap(){this.minimapRenderer.render()}renderPlayerList(){this.playerListRenderer.render()}renderHit(){this.canvas.className="shake-hit",this.stopShaking()}renderKill(){this.canvas.className="shake-kill",this.stopShaking()}renderGame(e){if(e&&this.context.state.purgeAfterPanic(),!this.context.state.getFocusedPlayer())return;let t=this.canvasContext;this.clip.setClip(this.canvas),this.backgroundRenderer.renderBackground(t),this.wallsRenderer.renderWalls(t),this.pathRenderer.renderPath(t),this.upcratesRenderer.renderUpcrates(t),this.playersRenderer.renderPlayers(t),this.missilesRenderer.renderMissiles(t),this.explosionsRenderer.renderExplosions(t),this.context.gameType===ed.CTF&&this.flagRenderer.render(t),this.debugInfoRenderer.render()}getUiElements(){this.canvas=document.getElementById("canvas"),this.canvasContext=this.canvas.getContext("2d"),this.chatBox=document.getElementById("chat"),this.serverMessage=document.getElementById("server-message"),this.pingElement=document.getElementById("stats-ping")}stopShaking(){this.shakeTimeout&&this.context.tm.clearTimeout(this.shakeTimeout),this.shakeTimeout=this.context.tm.setTimeout(()=>this.canvas.className="",1e3)}}class sc{constructor(e){this.context=e,document.getElementById("select-raptor").onclick=()=>this.selectAircraft("1"),document.getElementById("select-spirit").onclick=()=>this.selectAircraft("2"),document.getElementById("select-mohawk").onclick=()=>this.selectAircraft("3"),document.getElementById("select-tornado").onclick=()=>this.selectAircraft("4"),document.getElementById("select-prowler").onclick=()=>this.selectAircraft("5")}selectAircraft(e){this.context.connection.sendCommand("respawn",e)}}class sh{constructor(e){this.context=e,document.getElementById("select-speed").onclick=()=>this.applyUpgrade("1"),document.getElementById("select-defense").onclick=()=>this.applyUpgrade("2"),document.getElementById("select-energy").onclick=()=>this.applyUpgrade("3"),document.getElementById("select-missile").onclick=()=>this.applyUpgrade("4"),document.getElementById("drop-upgrade").onclick=()=>this.dropUpgrade()}applyUpgrade(e){this.context.connection.sendCommand("upgrade",e)}dropUpgrade(){this.context.connection.sendCommand("upgrades","drop")}}class su{constructor(e){this.context=e,this.commandRegex=/^\/(\w+)(?:\s(.+))?$/,this.input=document.getElementById("chat-input-textbox"),this.input.addEventListener("blur",()=>this.hide()),this.hide(),document.getElementById("input-instruction").addEventListener("click",()=>this.showAndFocus())}showAndFocus(){this.input.style.display="block",this.input.focus()}hide(){this.input.style.display="none"}startChat(e){this.showAndFocus(),this.input.value=e}isChatInputFocused(){return"block"===this.input.style.display.toLowerCase()}submit(){let e=this.input.value;if(e){this.input.value="";let t=this.commandRegex.exec(e);if(t){let e=t[1],s=t[2];if("t"===e)this.context.eventQueue.pub(eT.CHAT_SEND,{text:s,type:eV.TEAM});else if("s"===e)this.context.eventQueue.pub(eT.CHAT_SEND,{text:s,type:eV.SAY});else if("w"===e){let e;let t=this.context.state.getPlayers();for(let n of(t.sort((e,t)=>t.name.length-e.name.length),t))if(s.startsWith(n.name)){e=n;break}if(e){let t=s.substr(e.name.length+1);this.context.eventQueue.pub(eT.CHAT_SEND,{playerId:e.id,text:t,type:eV.WHISPER})}else this.context.eventQueue.pub(eT.MESSAGE_TO_PLAYER,{message:"Unknown player, message not sent."})}else this.context.connection.sendCommand(e,s||"")}else this.context.eventQueue.pub(eT.CHAT_SEND,{text:e,type:eV.CHAT});this.hide()}}}class sd{constructor(e,t,s,n,i,a,r,o){this.context=e,this.chatInput=t,this.applyUpgrades=s,this.dropFlag=n,this.autoFire=i,this.spectate=a,this.aircraftSelection=r,this.playerDropdownMenu=o,document.addEventListener("keydown",e=>this.onKey(e,!0)),document.addEventListener("keyup",e=>this.onKey(e,!1));let l=document.getElementById("canvas");l.addEventListener("mousedown",e=>this.onMouseFire(e,!0)),l.addEventListener("mouseup",e=>this.onMouseFire(e,!1));let c=document.getElementById("chat"),h=document.getElementById("player-list");c.addEventListener("mouseup",e=>this.onMouseUpInChatOrPlayerList(e,!1)),c.addEventListener("contextmenu",e=>this.onMouseUpInChatOrPlayerList(e,!0)),h.addEventListener("mouseup",e=>this.onMouseUpInChatOrPlayerList(e,!1)),h.addEventListener("contextmenu",e=>this.onMouseUpInChatOrPlayerList(e,!0))}onMouseUpInChatOrPlayerList(e,t){if(!this.context.isActive)return;let s=e.target;if(!s.className||-1===s.className.indexOf("player-name")){this.playerDropdownMenu.hide();return}if(!t&&2===e.button)return;let n=s.dataset.name,i=s.dataset.id;this.playerDropdownMenu.show(e.x,e.y,i,n),e.preventDefault(),e.stopPropagation()}onMouseFire(e,t){this.context.isActive&&(this.context.eventQueue.pub(eT.KEYBOARD,{key:et.FIRE,state:t}),this.playerDropdownMenu.hide())}onKey(e,t){let s;if(!this.context.isActive)return;if(this.chatInput.isChatInputFocused()){t&&(27===e.keyCode&&this.chatInput.hide(),13===e.keyCode&&this.chatInput.submit());return}let n=!1;switch(e.keyCode){case 16:case 17:s=et.SPECIAL;break;case 32:s=et.FIRE;break;case 65:case 37:n=!0,s=et.LEFT;break;case 87:case 38:n=!0,s=et.UP;break;case 68:case 39:n=!0,s=et.RIGHT;break;case 83:case 40:n=!0,s=et.DOWN;break;case 13:t&&this.chatInput.showAndFocus();break;case 86:t&&this.spectate.spectate();break;case 88:t&&this.applyUpgrades.dropUpgrade();break;case 89:t&&this.dropFlag.dropFlag();break;case 90:t&&this.autoFire.toggleAutoFire();break;case 49:case 50:case 51:case 52:t&&this.applyUpgrades.applyUpgrade(""+(e.keyCode-48));break;case 112:case 113:case 114:case 115:case 116:n=!0,t&&this.aircraftSelection.selectAircraft(""+(e.keyCode-111))}s&&!e.repeat&&(this.context.botstate.stop(),this.context.eventQueue.pub(eT.KEYBOARD,{key:s,state:t})),n&&(e.stopPropagation(),e.preventDefault())}}class sg{constructor(e,t,s){for(let n of(this.context=e,this.chatInput=t,this.renderer=s,this.menu=document.getElementById("player-context-menu"),this.menuTitle=document.getElementById("menu-title"),this.menuStats=document.getElementById("menu-stats"),this.menu.getElementsByClassName("menu-item")))n.addEventListener("click",()=>this.onMenuItemClicked(n))}show(e,t,s,n){this.menu.style.left=e+"px",this.menu.style.top=t+"px",this.menu.style.display="block",this.currentId=Number(s),this.currentName=decodeURI(n);let i=this.context.state.getPlayerById(Number(s));this.menuTitle.innerText=this.currentName,this.menuStats.innerText="Kills: "+i.kills+"; Deaths: "+i.deaths+"\nDamage: "+i.damage+"; Ping: "+i.ping+(this.context.gameType===ed.CTF?"\nCaptures: "+(i.captures??0):"")}hide(){this.menu.style.display="none"}onMenuItemClicked(e){this.hide();let t=this.context.state.getPlayerById(this.currentId);if(t&&"Server"!==t.name)switch(e.id){case"menu-flag":this.context.connection.sendCommand("flag",ep[""+t.flag]);break;case"menu-whisper":this.chatInput.startChat(`/w ${this.currentName} `);break;case"menu-ignore":this.renderer.ignorePlayer(t.id),this.renderer.addMessageToPlayer("Player chats will be ignored for player "+t.name);break;case"menu-unignore":this.renderer.unignorePlayer(t.id),this.renderer.addMessageToPlayer("Removed player from the ignore list.");break;case"menu-votemute":this.context.connection.voteMute(t.id),this.renderer.addMessageToPlayer("You have voted to mute player "+t.name);break;case"menu-locate":this.renderer.highlightPlayerOnMinimap(t.id);break;case"menu-spectate":this.context.state.spectatingId||this.context.connection.sendCommand("spectate","-3"),this.context.connection.sendCommand("spectate",t.id+"");break;case"menu-kill":this.context.botstate.playerToKill=t.id}}}class sp{constructor(e){this.context=e,this.handles=[eT.EACH_SECOND]}exec(e){this.context.state.spectatingId&&this.context.connection.sendKey(et.SPECIAL,!0)}}class sE{constructor(e){this.context=e,document.getElementById("drop-flag").onclick=()=>this.dropFlag()}dropFlag(){this.context.connection.sendCommand("drop","")}}class sy{constructor(e){this.context=e,document.getElementById("auto-fire").onclick=()=>this.toggleAutoFire()}toggleAutoFire(){this.context.botstate.autoFire=!this.context.botstate.autoFire,this.context.botstate.autoFireToggledManually=this.context.botstate.autoFire}}class sf{constructor(e){this.context=e,this.handles=[eT.TICK],this.timer=new eU,this.wasAutoFiring=!1}exec(e){(this.wasAutoFiring||this.context.botstate.autoFire)&&(this.timer.elapsedMs<250||(this.timer.start(),this.context.connection.sendKey(et.FIRE,this.context.botstate.autoFire),this.wasAutoFiring=this.context.botstate.autoFire))}}class sm{constructor(e){this.context=e,document.getElementById("spectate").onclick=()=>this.spectate()}spectate(){this.context.connection.sendCommand("spectate","-3")}}class sA{constructor(e){this.context=e,document.getElementById("switch-sides").onclick=()=>this.switch()}switch(){if(this.timer&&this.timer.elapsedSeconds>5){this.showMessage("Switch failed, giving up."),this.timer=null;return}this.timer||(this.timer=new eU);let e=this.context;if(e.botstate.isOn()){this.showMessage("Switching, stopping automatic activity..."),e.botstate.stop(!0),e.tm.setTimeout(()=>this.switch(),2e3);return}if(!e.state.spectatingId){this.showMessage("Switching, entering spec mode..."),e.connection.sendCommand("spectate","-3"),e.tm.setTimeout(()=>this.switch(),500+this.timer.elapsedMs/4);return}this.timer=null,this.showMessage("Switching..."),e.connection.sendCommand("switch",""),e.tm.setTimeout(()=>{this.showMessage("Switching, respawning...");let t=e.state.getPlayerById(e.state.myPlayerId);e.connection.sendCommand("respawn",t.type.toString())},500)}showMessage(e){this.context.eventQueue.pub(eT.SERVER_ANNOUNCEMENT,{text:e,duration:1e3})}}class sU{static getAngleDiff(e,t){return Math.atan2(Math.sin(t-e),Math.cos(t-e))}static getTargetRotation(e,t){let s=Math.atan2(t.x-e.x,e.y-t.y);return s<0&&(s+=2*Math.PI),s}}const sR=1e3/60;class sT{constructor(e,t,s){this.context=e,this.me=t,this.locationToFace=s}execute(){let e,t;if(this.context.botstate.turningTimeout)return;let s=this.locationToFace,n=sU.getTargetRotation(this.me.pos,s),i=sU.getAngleDiff(this.me.rot,n),a=Math.abs(i);i>0?(e=et.RIGHT,t=et.LEFT):(e=et.LEFT,t=et.RIGHT);let r=eD[this.me.type].turnFactor;this.context.botstate.enqueueKey(e,!0,a/r*sR),this.context.botstate.enqueueKey(t,!1)}}class sw{static getDelta(e,t){if(!e||!t)return null;let s=t.x-e.x,n=t.y-e.y,i=Math.sqrt(s*s+n*n);return{diffX:s,diffY:n,distance:i}}}const sx=1e3/60;class sI{static predictPosition(e,t,s){if(!t||!e)return e;let n=s/sx;return{x:e.x+t.x*n,y:e.y+t.y*n}}}const sS=1e3/60;class sP{constructor(e,t,s,n=300,i=!0){this.context=e,this.me=t,this.posToGoTo=s,this.closeness=n,this.backupIfTooClose=i}finish(e,t){return this.context.botstate.path=null,this.context.botstate.enqueueKey(et.UP,!1),this.backupIfTooClose&&this.context.botstate.enqueueKey(et.DOWN,!0),{isClose:e,distance:t}}execute(e,t=600){let{distance:s}=sw.getDelta(this.me.pos,this.posToGoTo);if(this.context.botstate.distanceToTarget=Math.round(s),s<50)return this.finish(!0,s);if(this.context.botstate.initPathFindingWorker(),this.context.botstate.needsNewPath){let t=[];for(let s of this.context.state.getPlayers())s.id!==this.me.id&&s.id!==this.context.botstate.playerToKill&&t.push(sI.predictPosition(s.mostReliablePos,s.speed,e));for(let s of this.context.state.getMissiles())s.team!==this.me.team&&t.push(sI.predictPosition(s.pos,s.speed,e));this.context.botstate.calcPath({pos1:this.me.pos,pos2:this.posToGoTo,aircraftType:this.me.type,pointsToAvoid:t})}if(!this.context.botstate.path)return{isClose:!1,distance:s};let n=this.context.botstate.path,i=this.nextStep(n,e);if(!i)return this.finish(!0,s);new sT(this.context,this.me,i).execute();let a=s<this.closeness;return a?this.finish(!0,s):(this.context.botstate.enqueueKey(et.UP,!0),this.me.type===eb.PREDATOR&&(this.context.botstate.autoBoost=s>t),{isClose:a,distance:s})}nextStep(e,t){let s=e[0];if(!s)return null;let{distance:n}=sw.getDelta(this.me.mostReliablePos,s),i=t/sS;return n>3*(Math.sqrt(Math.pow(this.me.speed.y,2)+Math.pow(this.me.speed.x,2))*i)?(this.context.botstate.path=e.slice(1),s):this.nextStep(e.slice(1),t)}}class sL{constructor(e){this.context=e,this.handles=[eT.TICK],this.timer=new eU(250),this.timer.start()}exec(e){this.timer.hasTimedOut&&(this.context.botstate.autoPilotToFlag?this.autoPilot():this.context.botstate.playerToKill&&this.followPlayer(),this.doSteering(),this.timer.start())}autoPilot(){let e=this.context.state.getOtherCtfTeam(this.context.state.team);if(!e)return;let t=this.context.state.getFocusedPlayer(),s=e.flagPos;if(e.flagState===eu.DYNAMIC){if(e.flagTakenById===this.context.state.myPlayerId)s=this.context.state.team===eh.BLUE?t6.blue:t6.red;else{let t=this.context.state.getPlayerById(e.flagTakenById);t&&(s=t.mostReliablePos)}}new sP(this.context,t,s,10,!1).execute(this.timer.elapsedMs)}followPlayer(){let e=this.context.state.getPlayerById(this.context.botstate.playerToKill);if(!e){this.context.botstate.playerToKill=null;return}if(e.status!==eo.ALIVE)return;let t=this.context.state.getFocusedPlayer(),s=e.mostReliablePos,{isClose:n,distance:i}=new sP(this.context,t,s).execute(this.timer.elapsedMs,1e3);n&&new sT(this.context,t,s).execute(),i<1e3?this.context.botstate.autoFire=!0:this.context.botstate.autoFire=!1}doSteering(){let e=this.context.botstate.eatKeyQueue();for(let t of[et.UP,et.DOWN,et.LEFT,et.RIGHT,et.FIRE,et.SPECIAL])for(let s=e.length-1;s>=0;s--){let n=e[s];if(n.key===t){n.duration>0?this.context.botstate.requestTimeoutFor(n)&&this.context.connection.sendKey(n.key,n.state):this.context.connection.sendKey(n.key,n.state);break}}}}class s_{constructor(e){this.context=e,document.getElementById("fly-to-flag").onclick=()=>this.autoPilotToFlag()}autoPilotToFlag(){this.context.botstate.autoPilotToFlag=!this.context.botstate.autoPilotToFlag}}class sO{constructor(e){this.context=e,this.handles=[eT.TICK],this.timer=new eU,this.wasAutoBoosting=!1}exec(e){if(!this.wasAutoBoosting&&!this.context.botstate.autoBoost||this.timer.elapsedMs<1e3)return;let t=this.context.state.getOtherCtfTeam(this.context.state.team);t&&t.flagTakenById===this.context.state.myPlayerId||(this.timer.start(),this.context.connection.sendKey(et.SPECIAL,this.context.botstate.autoBoost),this.wasAutoBoosting=this.context.botstate.autoBoost)}}var sb={};sb=U("7we3r");class sC{}class sM{}class sN{}const sk="wss://ffa.airmash.click";class sD{addLocalServerUrl(e){if(!sk)return;let t=new URL(sk);e.data.unshift({games:[{host:t.host,id:"local",name:"Local",nameShort:"local",path:t.pathname.slice(1),players:0,type:+("ws:"!==t.protocol)}],id:"local",name:"Local"})}async getServerInfo(){let t;try{let s=(await e(sb).get("https://data.airmash.rocks/games?main=1&_="+Date.now())).data;s.data=JSON.parse(s.data),t=s}catch(e){t=await this.getFallbackData()}return this.addLocalServerUrl(t),t}async getFallbackData(){let t=(await e(sb).get("https://raw.githubusercontent.com/airmash-refugees/airmash-games/master/games.txt?_="+Date.now())).data.split("\n"),s=new sN;for(let e of(s.country="?",s.protocol=1,s.data=[],t)){let t=e.split("|"),n=s.data.find(e=>e.name===t[0]);n||((n=new sM).name=t[0],n.id=t[0],n.games=[],s.data.push(n));let i=new sC;i.name=t[3],i.nameShort=t[4],i.host=t[5],i.path=t[6],n.games.push(i)}return s}}class sv{async loadStyle(e){for(let t of document.querySelectorAll("img"))t.src=t.src.replace(this.lastUrl,e);let t=document.getElementById("ui-styling");t.href=t.href.replace(this.lastUrl,e),this.lastUrl=e}constructor(){this.lastUrl="styles/default/"}}const sB="https://login.airmash.rocks",sY="auth-data";class sF{constructor(e){for(let t of(this.context=e,this.loginButton=document.getElementById("loginButton"),this.loginSelector=document.getElementById("loginselector"),this.overlay=document.getElementById("overlay"),this.loginMessage=document.getElementById("loginMessage"),this.orgLoginMessageText=this.loginMessage.innerHTML,this.orgLoginButtonText=this.loginButton.value,this.loginButton.addEventListener("click",()=>{this.context.auth?this.logout():(this.overlay.style.display="block",this.loginSelector.style.display="block")}),this.overlay.addEventListener("click",()=>this.finish()),document.querySelectorAll(".loginbutton"))){let e=t.getAttribute("data-provider");t.addEventListener("click",()=>this.loginPopup(Number(e)))}this.loadPreviousLoginData()}async loadPreviousLoginData(){try{let e=localStorage.getItem(sY);if(e){let t=JSON.parse(e);this.context.auth=t}}catch(e){this.context.logger.error("Auth data could not be loaded",e)}this.toggleLoginMessage()}toggleLoginMessage(){this.context.auth?(this.loginButton.value="Log out",this.loginMessage.innerHTML=`Logged in as ${this.context.auth.loginName}`):(this.loginButton.value=this.orgLoginButtonText,this.loginMessage.innerHTML=this.orgLoginMessageText)}finish(){this.overlay.style.display="none",this.loginSelector.style.display="none"}getRandomToken(e){let t=window.crypto.getRandomValues(new Uint32Array(1))[0].toString(16);return e-t.length>0&&(t+=this.getRandomToken(e-t.length)),t.substr(0,e)}loginPopup(e){window.addEventListener("message",e=>this.receiveLoginMessage(e),{once:!0}),this.usedProvider=e,this.loginToken=this.getRandomToken(32);let t=`${sB}/login?provider=${e}&nonce=${this.loginToken}&origin=${window.origin}`;this.openLoginWindow(t,"Login",4===e?900:400,5===e?800:600)}openLoginWindow(e,t,s,n){let i=window.screenLeft?window.screenLeft:window.screenX,a=window.screenTop?window.screenTop:window.screenY,r=(window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width)/2-s/2+i,o=(window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height)/2-n/2+a;window.open(e,t,"width="+s+", height="+n+", top="+o+", left="+r)}receiveLoginMessage(e){if(e.origin!==sB){this.context.logger.error("bad origin for login message: "+e.origin);return}if(e.data.provider!==this.usedProvider){this.context.logger.error("identity provider does not match: "+e.data.provider);return}if(e.data.nonce!==this.loginToken){this.context.logger.error("nonce does not match: "+e.data.nonce);return}this.loginToken=null,this.usedProvider=null,this.loginSuccess({identityProvider:e.data.provider,loginName:e.data.loginname,tokens:e.data.tokens})}loginSuccess(e){this.context.auth=e,localStorage.setItem(sY,JSON.stringify(e)),this.toggleLoginMessage(),this.finish()}logout(){localStorage.removeItem(sY),this.context.auth=null,this.toggleLoginMessage()}}eR.createPathFindingWorker=()=>new Worker("browser-worker.js?v="+timestamp),new class{constructor(e){this.context=e,this.serverGamesRepository=new sD,this.stylesRepository=new sv,this.nameInput=document.getElementById("playerName"),this.styleSelect=document.getElementById("styleSelect"),this.zoomSelect=document.getElementById("zoomSelect"),this.thirdPartyLogin=new sF(e)}async run(){this.doBackground(),await this.populateServerList(),this.loadAllFlags(),this.fillInPrevSettings(),this.loadConstantsPromise=this.stylesRepository.loadStyle("styles/default/"),this.styleSelect.addEventListener("change",()=>{"no-bitmaps"!==this.styleSelect.value&&(this.loadConstantsPromise=this.stylesRepository.loadStyle(this.styleSelect.value))})}fillInPrevSettings(){let t=e(tb).get("settings");if(!t)return;let s=JSON.parse(t);this.nameInput.value=s.playerName,this.select(this.zoomSelect,s.zoom.toString()),s.useBitmaps||(this.styleSelect.options[1].selected=!0)}select(e,t){for(let s of e.options)if(s.value===t){s.selected=!0;break}}async startGame(t){this.context.settings.playerName=this.nameInput.value||"Unknown",this.context.settings.websocketUrl=t,this.context.settings.zoom=Number(this.zoomSelect.value)||1,this.context.settings.useBitmaps="no-bitmaps"!==this.styleSelect.value,this.context.settings.horizonX=window.innerWidth/2,this.context.settings.horizonY=window.innerHeight/2,e(tb).set("settings",JSON.stringify(this.context.settings),{expires:365}),document.getElementById("nameAndGame").style.display="none",document.getElementById("chat").style.display="block",document.getElementById("chat-input").style.display="block",document.getElementById("aircraftSelection").style.display="block",document.getElementById("stats").style.display="block",document.getElementById("upgradeSelection").style.display="block",document.getElementById("actionButtons").style.display="block",document.getElementById("minimap").style.display="block",document.getElementById("player-list").style.display="block",document.getElementById("server-message").style.display="block",location.href.indexOf("debug")>-1&&(document.getElementById("debugPanel").style.display="block",this.context.settings.shouldShowDebugInfo=!0),await this.loadConstantsPromise,window.document.body.style.backgroundImage="inherit",this.context.start(),window.gameContext=this.context}async populateServerList(){let t=await this.serverGamesRepository.getServerInfo(),s=e(tb).get("flag")||t.country;this.context.settings.flag=s;let n=document.getElementById("games"),i=document.createElement("table");for(let e of(i.innerHTML="<tr><th>Region</th><th>Game</th><th>Players online</th><th></th></tr>",n.append(i),t.data))for(let t of e.games){let s=document.createElement("tr");i.append(s);let n=document.createElement("td");s.append(n),n.innerText=e.name,n.className="region";let a=document.createElement("td");s.append(a),a.innerText=t.name,a.className="game-name";let r=document.createElement("td");s.append(r),r.innerText=t.players||0===t.players?t.players.toString():"?",r.className="num-players";let o=document.createElement("td");s.append(o);let l=document.createElement("input");o.append(l),o.className="start-button",l.type="button",l.value="Start";let c="wss";0===t.type&&(c="ws");let h=`${c}://${t.host}/${t.path}`;l.onclick=()=>this.startGame(h)}}loadAllFlags(){for(let e of Object.keys(eE)){let t=document.createElement("img");t.src=`flags/${e}.png`,t.style.display="none",t.id=`flag-${e}`,document.body.appendChild(t)}}doBackground(){let e=document.getElementById("map");window.document.body.style.backgroundImage=`url(${e.src})`,window.document.body.style.backgroundSize="cover"}}(new class{constructor(){this.renderer=new sl(this),this.botstate=new eR(this),this.chatInput=new su(this),this.aircraftSelection=new sc(this),this.upgradeSelection=new sh(this),this.dropFlag=new sE(this),this.autofire=new sy(this),this.spectate=new sm(this),this.autoPilotToFlag=new s_(this),this.switchSides=new sA(this),this.playerDropdownMenu=new sg(this,this.chatInput,this.renderer),this.browserInitialization=new tq(this),this.browserVisibilityHandler=new tO(this),this.keyboardInput=new sd(this,this.chatInput,this.upgradeSelection,this.dropFlag,this.autofire,this.spectate,this.aircraftSelection,this.playerDropdownMenu),this.browserInitialization.detectVisibilityChange(),this.browserInitialization.throttleZoom(),this.logger=new tJ,this.webSocketFactory=new t$,this.settings=new tU,this.eventQueue=new t_,this.tm=new tI,this.processor=new ex(this),this.state=new tx,this.connection=new tP(this),this.handlers=[...tA.getDefaultHandlers(this),new tv(this),new tH(this),new tF(this),new tB(this),new tM(this),new tk(this),new tz(this),new tN(this),new tQ(this),new tj(this),new tC(this),new tX(this),new sp(this),new sf(this),new sO(this),new sL(this)]}async start(){this.logger.info("Initializing app"),this.processor.startProcessingEventQueue(),await this.connection.init(),this.isActive=!0,this.logger.info("Initialization finished")}setBrowserVisibility(e){this.isBrowserVisible=e,e||this.browserVisibilityHandler.clearKeys()}}).run();
//# sourceMappingURL=index.614c9a53.js.map
